<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=UTF8" http-equiv="content-type"><title>XML-Change XML Structure</title></head><body>
<div id="body_content" style="border: 0px none ; margin: 0px; padding: 0px; background: rgb(255, 255, 255) none repeat scroll 0%; color: rgb(0, 0, 0); font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: 300; letter-spacing: normal; line-height: 28px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;"><div id="main_content" style="border: 0px none ; margin: 0px; padding: 0px;"><div class="main section" id="main" style="border: 0px none ; margin: 0px; padding: 0px;"><div class="widget Blog" id="Blog1" style="border: 0px none ; margin: 0px; padding: 0px;"><div class="blog-posts hfeed" style="border: 0px none ; margin: 0px; padding: 0px;"><div class="post hentry" style="border: 0px none ; margin: 0px 0px 40px; padding: 0px;"><h3 class="post-title entry-title" style="border: 0px none ; margin: 0px 0px 16px; padding: 0px; font-weight: lighter; font-size: 26px; line-height: 26px; font-family: 'Helvetica Neue UltraLight','Helvetica Neue Light','Helvetica Neue',Helvetica,Arial,sans-serif;">Groovy Goodness: Change XML Structure</h3><div class="post-body entry-content" style="border: 0px none ; margin: 0px; padding: 0px;"><p style="border: 0px none ; margin: 0px 0px 20px; padding: 0px;">We know how easy it is to<span class="Apple-converted-space">&nbsp;</span><a href="http://mrhaki.blogspot.com/2009/10/groovy-goodness-reading-xml.html" style="border: 0px none ; margin: 0px; padding: 0px; color: rgb(51, 51, 51);">read XML</a><span class="Apple-converted-space">&nbsp;</span>and to<span class="Apple-converted-space">&nbsp;</span><a href="http://mrhaki.blogspot.com/2009/10/groovy-goodness-creating-xml-with.html" style="border: 0px none ; margin: 0px; padding: 0px; color: rgb(51, 51, 51);">write XML</a>. Recently someone asked during a workshop if it is possible to change the XML structure as easy. I found the answer on the<span class="Apple-converted-space">&nbsp;</span><a href="http://groovy.codehaus.org/Updating+XML+with+XmlSlurper" style="border: 0px none ; margin: 0px; padding: 0px; color: rgb(51, 51, 51);">Groovy website</a>. It turns out we can simple use<span class="Apple-converted-space">&nbsp;</span><code style="border: 1px solid rgb(212, 217, 217); margin: 0px; padding: 1px 4px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 0.9375em; line-height: 24px; font-family: Menlo,Monaco,'Liberation Mono',Consolas,monospace; color: rgb(59, 59, 59); white-space: nowrap; text-shadow: none; background-color: rgb(239, 241, 241);">XmlSlurper</code><span class="Apple-converted-space">&nbsp;</span>and we can traverse the structure to change existing node values and attributes. We use<span class="Apple-converted-space">&nbsp;</span><code style="border: 1px solid rgb(212, 217, 217); margin: 0px; padding: 1px 4px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 0.9375em; line-height: 24px; font-family: Menlo,Monaco,'Liberation Mono',Consolas,monospace; color: rgb(59, 59, 59); white-space: nowrap; text-shadow: none; background-color: rgb(239, 241, 241);">appendNode()</code><span class="Apple-converted-space">&nbsp;</span>and<span class="Apple-converted-space">&nbsp;</span><code style="border: 1px solid rgb(212, 217, 217); margin: 0px; padding: 1px 4px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 0.9375em; line-height: 24px; font-family: Menlo,Monaco,'Liberation Mono',Consolas,monospace; color: rgb(59, 59, 59); white-space: nowrap; text-shadow: none; background-color: rgb(239, 241, 241);">replaceNode()</code><span class="Apple-converted-space">&nbsp;</span>to work with nodes using a builder syntax.</p><pre class="brush:groovy" style="border: 0px none ; margin: 0px; padding: 0px; font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 16px; line-height: 24px; font-family: Menlo,Monaco,'Liberation Mono',Consolas,monospace;">@Grapes(<br>    @Grab(group='xmlunit', module='xmlunit', version='1.3')<br>)<br>import org.custommonkey.xmlunit.*<br>import groovy.xml.*<br><br>def xml = '''<br>&lt;todo&gt;<br>    &lt;item priority="2"&gt;<br>        &lt;title&gt;Look into GPars&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item priority="1"&gt;<br>        &lt;title&gt;Start developing Griffon App&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item priority="2"&gt;<br>        &lt;title&gt;Grails 1.4 M1&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item priority="3"&gt;<br>        &lt;title&gt;GWT Sample&lt;/title&gt;<br>    &lt;/item&gt;<br>&lt;/todo&gt;<br>'''<br><br>def todo = new XmlSlurper().parseText(xml)<br><br>// Change node values.<br>def items = todo.item.findAll { <br>   it.@priority.toInteger() &lt; 3 <br>}<br>items.each { item -&gt; <br>    item.title = "DO: " + item.title <br>}<br><br>// Change attribute value.<br>def gpars= todo.item.find { <br>    it.title =~ /.*GPars.*/ <br>}<br>gpars.@priority = '1'<br><br>// Add extra item node.<br>todo.appendNode {<br>    item(priority: 2) {<br>        title 'Work on blog post'<br>    }<br>}<br><br>// Change node.<br>def grailsItem = todo.item.find { <br>    it.title.toString().contains('Grails') <br>}<br>grailsItem.replaceNode { node -&gt;<br>    item(who: 'mrhaki', priority: node.@priority) {<br>        title 'Download Grails 1.4 M1'       <br>    }<br>}<br><br>// Remove node. Index value based on result directly after parsing.<br>// So here we remove the item about GWT.<br>todo.item[3].replaceNode {}<br><br>// Create output.<br>def newTodo = new StreamingMarkupBuilder().bind { <br>    mkp.yield todo <br>}.toString()<br><br>def expected = '''<br>&lt;todo&gt;<br>    &lt;item priority="1"&gt;<br>        &lt;title&gt;DO: Look into GPars&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item priority="1"&gt;<br>        &lt;title&gt;DO: Start developing Griffon App&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item who="mrhaki" priority="2"&gt;<br>        &lt;title&gt;Download Grails 1.4 M1&lt;/title&gt;<br>    &lt;/item&gt;<br>    &lt;item priority="2"&gt;<br>        &lt;title&gt;Work on blog post&lt;/title&gt;<br>    &lt;/item&gt;<br>&lt;/todo&gt;<br>'''<br><br>// Check to see expected XML equals new todo XML.<br>XMLUnit.ignoreWhitespace = true<br>def difference = new Diff(newTodo, expected)<br>assert difference.similar()<br></pre></div></div></div></div></div></div></div>
<iframe name="oauth2relay486465786" id="oauth2relay486465786" src="about:blank" tabindex="-1" style="border: 0px none ; margin: 0px; padding: 0px; color: rgb(0, 0, 0); font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif; font-size: 16px; font-style: normal; font-variant: normal; font-weight: 300; letter-spacing: normal; line-height: 28px; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; width: 1px; height: 1px; position: absolute; top: -100px;"></iframe><br class="Apple-interchange-newline">

  

</body></html>