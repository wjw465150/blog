
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  
<!-- Mirrored from redis.readthedocs.org/en/2.4/list.html by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 22 Nov 2011 10:08:51 GMT -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>表(List) &mdash; Redis命令参考简体中文版 v2.4 documentation</title>
    <link rel="stylesheet" href="static/nature.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.4',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <script type="text/javascript" src="static/translations.js"></script>
    <link rel="author" title="关于这些文档" href="about.html" />
    <link rel="top" title="Redis命令参考简体中文版 v2.4 documentation" href="index.html" />
    <link rel="next" title="集合(Set)" href="set.html" />
    <link rel="prev" title="哈希表(Hash)" href="hash.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="set.html" title="集合(Set)"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="hash.html" title="哈希表(Hash)"
             accesskey="P">上一页</a> |</li>
        <li><a href="index.html">Redis命令参考简体中文版 v2.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="list">
<span id="list-struct"></span><h1>表(List)<a class="headerlink" href="#list" title="永久链接至标题">¶</a></h1>
<p><strong>头元素和尾元素</strong></p>
<p>头元素指的是列表左端/前端第一个元素，尾元素指的是列表右端/后端第一个元素。</p>
<p>举个例子，列表<tt class="docutils literal"><span class="pre">list</span></tt>包含三个元素：<tt class="docutils literal"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z</span></tt>，其中<tt class="docutils literal"><span class="pre">x</span></tt>是头元素，而<tt class="docutils literal"><span class="pre">z</span></tt>则是尾元素。</p>
<p><strong>空列表</strong></p>
<p>指不包含任何元素的列表，Redis将不存在的<tt class="docutils literal"><span class="pre">key</span></tt>也视为空列表。</p>
<div class="section" id="lpush">
<span id="id1"></span><h2>LPUSH<a class="headerlink" href="#lpush" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LPUSH key value [value ...]</tt></dt>
<dd></dd></dl>

<p>将一个或多个值<tt class="docutils literal"><span class="pre">value</span></tt>插入到列表<tt class="docutils literal"><span class="pre">key</span></tt>的<em>表头</em>。</p>
<p>如果有多个<tt class="docutils literal"><span class="pre">value</span></tt>值，那么各个<tt class="docutils literal"><span class="pre">value</span></tt>值按从左到右的顺序依次插入到表头：比如对一个空列表(<tt class="docutils literal"><span class="pre">mylist</span></tt>)执行<tt class="docutils literal"><span class="pre">LPUSH</span> <span class="pre">mylist</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></tt>，则结果列表为<tt class="docutils literal"><span class="pre">c</span> <span class="pre">b</span> <span class="pre">a</span></tt>，等同于执行执行命令<tt class="docutils literal"><span class="pre">LPUSH</span> <span class="pre">mylist</span> <span class="pre">a</span></tt>、<tt class="docutils literal"><span class="pre">LPUSH</span> <span class="pre">mylist</span> <span class="pre">b</span></tt>、<tt class="docutils literal"><span class="pre">LPUSH</span> <span class="pre">mylist</span> <span class="pre">c</span></tt>。</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不存在，一个空列表会被创建并执行<a class="reference internal" href="#lpush">LPUSH</a>操作。</p>
<p>当<tt class="docutils literal"><span class="pre">key</span></tt>存在但不是列表类型时，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd>执行<a class="reference internal" href="#lpush">LPUSH</a>命令后，列表的长度。</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">在Redis 2.4版本以前的<a class="reference internal" href="#lpush">LPUSH</a>命令，都只接受单个<tt class="docutils literal"><span class="pre">value</span></tt>值。</p>
</div>
<div class="highlight-python"><pre># 加入单个元素

redis&gt; LPUSH languages python
(integer) 1

# 加入重复元素

redis&gt; LPUSH languages python
(integer) 2

redis&gt; LRANGE languages 0 -1 # 列表允许重复元素
1) "python"
2) "python"

# 加入多个元素

redis&gt; LPUSH mylist a b c
(integer) 3

redis&gt; LRANGE mylist 0 -1
1) "c"
2) "b"
3) "a"</pre>
</div>
</div>
<div class="section" id="lpushx">
<span id="id2"></span><h2>LPUSHX<a class="headerlink" href="#lpushx" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LPUSHX key value</tt></dt>
<dd></dd></dl>

<p>将值<tt class="docutils literal"><span class="pre">value</span></tt>插入到列表<tt class="docutils literal"><span class="pre">key</span></tt>的表头，当且仅当<tt class="docutils literal"><span class="pre">key</span></tt>存在并且是一个列表。</p>
<p>和<a class="reference internal" href="#lpush">LPUSH</a>命令相反，当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，<a class="reference internal" href="#lpushx">LPUSHX</a>命令什么也不做。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><a class="reference internal" href="#lpushx">LPUSHX</a>命令执行之后，表的长度。</dd>
</dl>
<div class="highlight-python"><pre># 情况1：对空列表执行LPUSHX

redis&gt; LLEN greet    # greet是一个空列表
(integer) 0

redis&gt; LPUSHX greet "hello"  # 尝试LPUSHX，失败，因为列表为空
(integer) 0


# 情况2：对非空列表执行LPUSHX

redis&gt; LPUSH greet "hello"   # 先用LPUSH创建一个有一个元素的列表
(integer) 1

redis&gt; LPUSHX greet "good morning"   # 这次LPUSHX执行成功
(integer) 2

redis&gt; LRANGE greet 0 -1
1) "good morning"
2) "hello"</pre>
</div>
</div>
<div class="section" id="rpush">
<span id="id3"></span><h2>RPUSH<a class="headerlink" href="#rpush" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">RPUSH key value [value ...]</tt></dt>
<dd></dd></dl>

<p>将一个或多个值<tt class="docutils literal"><span class="pre">value</span></tt>插入到列表<tt class="docutils literal"><span class="pre">key</span></tt>的<em>表尾</em>。</p>
<p>如果有多个<tt class="docutils literal"><span class="pre">value</span></tt>值，那么各个<tt class="docutils literal"><span class="pre">value</span></tt>值按从左到右的顺序依次插入到表尾：比如对一个空列表(<tt class="docutils literal"><span class="pre">mylist</span></tt>)执行<tt class="docutils literal"><span class="pre">RPUSH</span> <span class="pre">mylist</span> <span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></tt>，则结果列表为<tt class="docutils literal"><span class="pre">a</span> <span class="pre">b</span> <span class="pre">c</span></tt>，等同于执行命令<tt class="docutils literal"><span class="pre">RPUSH</span> <span class="pre">mylist</span> <span class="pre">a</span></tt>、<tt class="docutils literal"><span class="pre">RPUSH</span> <span class="pre">mylist</span> <span class="pre">b</span></tt>、<tt class="docutils literal"><span class="pre">RPUSH</span> <span class="pre">mylist</span> <span class="pre">c</span></tt>。</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不存在，一个空列表会被创建并执行<a class="reference internal" href="#rpush">RPUSH</a>操作。</p>
<p>当<tt class="docutils literal"><span class="pre">key</span></tt>存在但不是列表类型时，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd>执行<a class="reference internal" href="#rpush">RPUSH</a>操作后，表的长度。</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">注解</p>
<p class="last">在Redis 2.4版本以前的<a class="reference internal" href="#rpush">RPUSH</a>命令，都只接受单个<tt class="docutils literal"><span class="pre">value</span></tt>值。</p>
</div>
<div class="highlight-python"><pre># 添加单个元素

redis&gt; RPUSH languages c
(integer) 1

# 添加重复元素

redis&gt; RPUSH languages c
(integer) 2

redis&gt; LRANGE languages 0 -1 # 列表允许重复元素
1) "c"
2) "c"

# 添加多个元素

redis&gt; RPUSH mylist a b c
(integer) 3

redis&gt; LRANGE mylist 0 -1
1) "a"
2) "b"
3) "c"</pre>
</div>
</div>
<div class="section" id="rpushx">
<span id="id4"></span><h2>RPUSHX<a class="headerlink" href="#rpushx" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">RPUSHX key value</tt></dt>
<dd></dd></dl>

<p>将值<tt class="docutils literal"><span class="pre">value</span></tt>插入到列表<tt class="docutils literal"><span class="pre">key</span></tt>的表尾，当且仅当<tt class="docutils literal"><span class="pre">key</span></tt>存在并且是一个列表。</p>
<p>和<a class="reference internal" href="#rpush">RPUSH</a>命令相反，当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，<a class="reference internal" href="#rpushx">RPUSHX</a>命令什么也不做。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><a class="reference internal" href="#rpushx">RPUSHX</a>命令执行之后，表的长度。</dd>
</dl>
<div class="highlight-python"><pre># 情况1：key不存在

redis&gt; LLEN greet
(integer) 0

redis&gt; RPUSHX greet "hello"  # 对不存在的key进行RPUSHX，PUSH失败。
(integer) 0


# 情况2：key存在且是一个非空列表

redis&gt; RPUSH greet "hi"  # 先用RPUSH插入一个元素
(integer) 1

redis&gt; RPUSHX greet "hello"  # greet现在是一个列表类型，RPUSHX操作成功。
(integer) 2

redis&gt; LRANGE greet 0 -1
1) "hi"
2) "hello"</pre>
</div>
</div>
<div class="section" id="lpop">
<span id="id5"></span><h2>LPOP<a class="headerlink" href="#lpop" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LPOP key</tt></dt>
<dd></dd></dl>

<p>移除并返回列表<tt class="docutils literal"><span class="pre">key</span></tt>的头元素。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">列表的头元素。</div>
<div class="line">当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，返回<tt class="docutils literal"><span class="pre">nil</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; LLEN course
(integer) 0

redis&gt; RPUSH course algorithm001
(integer) 1
redis&gt; RPUSH course c++101
(integer) 2

redis&gt; LPOP course  # 移除头元素
"algorithm001"</pre>
</div>
</div>
<div class="section" id="rpop">
<span id="id6"></span><h2>RPOP<a class="headerlink" href="#rpop" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">RPOP key</tt></dt>
<dd></dd></dl>

<p>移除并返回列表<tt class="docutils literal"><span class="pre">key</span></tt>的尾元素。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">列表的尾元素。</div>
<div class="line">当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，返回<tt class="docutils literal"><span class="pre">nil</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; RPUSH mylist "one"
(integer) 1
redis&gt; RPUSH mylist "two"
(integer) 2
redis&gt; RPUSH mylist "three"
(integer) 3

redis&gt; RPOP mylist  # 返回被弹出的元素
"three"

redis&gt; LRANGE mylist 0 -1   # 列表剩下的元素
1) "one"
2) "two"</pre>
</div>
</div>
<div class="section" id="blpop">
<span id="id7"></span><h2>BLPOP<a class="headerlink" href="#blpop" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">BLPOP key [key ...] timeout</tt></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#blpop">BLPOP</a>是列表的阻塞式(blocking)弹出原语。</p>
<p>它是<a class="reference internal" href="#lpop">LPOP</a>命令的阻塞版本，当给定列表内没有任何元素可供弹出的时候，连接将被<a class="reference internal" href="#blpop">BLPOP</a>命令阻塞，直到等待超时或发现可弹出元素为止。</p>
<p>当给定多个<tt class="docutils literal"><span class="pre">key</span></tt>参数时，按参数<tt class="docutils literal"><span class="pre">key</span></tt>的先后顺序依次检查各个列表，弹出第一个非空列表的头元素。</p>
<p><strong>非阻塞行为</strong></p>
<p>当<a class="reference internal" href="#blpop">BLPOP</a>被调用时，如果给定<tt class="docutils literal"><span class="pre">key</span></tt>内至少有一个非空列表，那么弹出遇到的第一个非空列表的头元素，并和被弹出元素所属的列表的名字一起，组成结果返回给调用者。</p>
<p>当存在多个给定<tt class="docutils literal"><span class="pre">key</span></tt>时，<a class="reference internal" href="#blpop">BLPOP</a>按给定<tt class="docutils literal"><span class="pre">key</span></tt>参数排列的先后顺序，依次检查各个列表。</p>
<p>假设现在有<tt class="docutils literal"><span class="pre">job</span></tt>、 <tt class="docutils literal"><span class="pre">command</span></tt>和<tt class="docutils literal"><span class="pre">request</span></tt>三个列表，其中<tt class="docutils literal"><span class="pre">job</span></tt>不存在，<tt class="docutils literal"><span class="pre">command</span></tt>和<tt class="docutils literal"><span class="pre">request</span></tt>都持有非空列表。考虑以下命令：</p>
<p><tt class="docutils literal"><span class="pre">BLPOP</span> <span class="pre">job</span> <span class="pre">command</span> <span class="pre">request</span> <span class="pre">0</span></tt></p>
<p><a class="reference internal" href="#blpop">BLPOP</a>保证返回的元素来自<tt class="docutils literal"><span class="pre">command</span></tt>，因为它是按&#8221;查找<tt class="docutils literal"><span class="pre">job</span></tt> -&gt; 查找<tt class="docutils literal"><span class="pre">command</span></tt> -&gt; 查找<tt class="docutils literal"><span class="pre">request</span></tt>&#8220;这样的顺序，第一个找到的非空列表。</p>
<div class="highlight-python"><pre>redis&gt; DEL job command request  # 确保key都被删除
(integer) 0
redis&gt; LPUSH command "update system..."  # 为command列表增加一个值
(integer) 1
redis&gt; LPUSH request "visit page"  # 为request列表增加一个值
(integer) 1

redis&gt; BLPOP job command request 0  # job列表为空，被跳过，紧接着command列表的第一个元素被弹出。
1) "command"    # 弹出元素所属的列表
2) "update system..."   # 弹出元素所属的值</pre>
</div>
<p><strong>阻塞行为</strong></p>
<p>如果所有给定<tt class="docutils literal"><span class="pre">key</span></tt>都不存在或包含空列表，那么<a class="reference internal" href="#blpop">BLPOP</a>命令将阻塞连接，直到等待超时，或有另一个客户端对给定<tt class="docutils literal"><span class="pre">key</span></tt>的任意一个执行<a class="reference internal" href="#lpush">LPUSH</a>或<a class="reference internal" href="#rpush">RPUSH</a>命令为止。</p>
<p>超时参数<tt class="docutils literal"><span class="pre">timeout</span></tt>接受一个以秒为单位的数字作为值。超时参数设为<tt class="docutils literal"><span class="pre">0</span></tt>表示阻塞时间可以无限期延长(block indefinitely) 。</p>
<div class="highlight-python"><pre>redis&gt; EXISTS job  # 确保两个key都不存在
(integer) 0
redis&gt; EXISTS command
(integer) 0

redis&gt; BLPOP job command 300  #因为key一开始不存在，所以操作会被阻塞，直到另一客户端对job或者command列表进行PUSH操作。
1) "job"  # 这里被push的是job
2) "do my home work"  # 被弹出的值
(26.26s)  # 等待的秒数

redis&gt; BLPOP job command 5  # 等待超时的情况
(nil)
(5.66s) # 等待的秒数</pre>
</div>
<p><strong>相同的key被多个客户端同时阻塞</strong></p>
<div class="line-block">
<div class="line">相同的<tt class="docutils literal"><span class="pre">key</span></tt>可以被多个客户端同时阻塞。</div>
<div class="line">不同的客户端被放进一个队列中，按&#8221;先阻塞先服务&#8221;(first-BLPOP，first-served)的顺序为<tt class="docutils literal"><span class="pre">key</span></tt>执行<a class="reference internal" href="#blpop">BLPOP</a>命令。</div>
</div>
<p><strong>在MULTI/EXEC事务中的BLPOP</strong></p>
<p><a class="reference internal" href="#blpop">BLPOP</a>可以用于流水线(pipline,批量地发送多个命令并读入多个回复)，但把它用在<a class="reference internal" href="transaction.html#multi"><em>MULTI</em></a>/<a class="reference internal" href="transaction.html#exec"><em>EXEC</em></a>块当中没有意义。因为这要求整个服务器被阻塞以保证块执行时的原子性，该行为阻止了其他客户端执行<a class="reference internal" href="#lpush">LPUSH</a>或<a class="reference internal" href="#rpush">RPUSH</a>命令。</p>
<p>因此，一个被包裹在<a class="reference internal" href="transaction.html#multi"><em>MULTI</em></a>/<a class="reference internal" href="transaction.html#exec"><em>EXEC</em></a>块内的<a class="reference internal" href="#blpop">BLPOP</a>命令，行为表现得就像<a class="reference internal" href="#lpop">LPOP</a>一样，对空列表返回<tt class="docutils literal"><span class="pre">nil</span></tt>，对非空列表弹出列表元素，不进行任何阻塞操作。</p>
<div class="highlight-python"><pre># 情况1：对非空列表进行操作

redis&gt; RPUSH job programming
(integer) 1

redis&gt; MULTI
OK

redis&gt; BLPOP job 30
QUEUED

redis&gt; EXEC  # 不阻塞，立即返回
1) 1) "job"
   2) "programming"


# 情况2：对空列表进行操作

redis&gt; LLEN job  # 空列表
(integer) 0

redis&gt; MULTI
OK

redis&gt; BLPOP job 30
QUEUED

redis&gt; EXEC  # 不阻塞，立即返回
1) (nil)</pre>
</div>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">如果列表为空，返回一个<tt class="docutils literal"><span class="pre">nil</span></tt>。</div>
<div class="line">反之，返回一个含有两个元素的列表，第一个元素是被弹出元素所属的<tt class="docutils literal"><span class="pre">key</span></tt>，第二个元素是被弹出元素的值。</div>
</div>
</dd>
</dl>
</div>
<div class="section" id="brpop">
<span id="id8"></span><h2>BRPOP<a class="headerlink" href="#brpop" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">BRPOP key [key ...] timeout</tt></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#brpop">BRPOP</a>是列表的阻塞式(blocking)弹出原语。</p>
<p>它是<a class="reference internal" href="#rpop">RPOP</a>命令的阻塞版本，当给定列表内没有任何元素可供弹出的时候，连接将被<a class="reference internal" href="#brpop">BRPOP</a>命令阻塞，直到等待超时或发现可弹出元素为止。</p>
<p>当给定多个<tt class="docutils literal"><span class="pre">key</span></tt>参数时，按参数<tt class="docutils literal"><span class="pre">key</span></tt>的先后顺序依次检查各个列表，弹出第一个非空列表的尾部元素。</p>
<p>关于阻塞操作的更多信息，请查看<a class="reference internal" href="#blpop">BLPOP</a>命令，<a class="reference internal" href="#brpop">BRPOP</a>除了弹出元素的位置和<a class="reference internal" href="#blpop">BLPOP</a>不同之外，其他表现一致。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">假如在指定时间内没有任何元素被弹出，则返回一个<tt class="docutils literal"><span class="pre">nil</span></tt>和等待时长。</div>
<div class="line">反之，返回一个含有两个元素的列表，第一个元素是被弹出元素所属的<tt class="docutils literal"><span class="pre">key</span></tt>，第二个元素是被弹出元素的值。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; LLEN course
(integer) 0

redis&gt; RPUSH course algorithm001
(integer) 1
redis&gt; RPUSH course c++101  # 尾部元素
(integer) 2

redis&gt; BRPOP course 30
1) "course" # 弹出元素的key
2) "c++101" # 弹出元素的值</pre>
</div>
</div>
<div class="section" id="llen">
<span id="id9"></span><h2>LLEN<a class="headerlink" href="#llen" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LLEN key</tt></dt>
<dd></dd></dl>

<p>返回列表<tt class="docutils literal"><span class="pre">key</span></tt>的长度。</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不存在，则<tt class="docutils literal"><span class="pre">key</span></tt>被解释为一个空列表，返回<tt class="docutils literal"><span class="pre">0</span></tt>.</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不是列表类型，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd>列表<tt class="docutils literal"><span class="pre">key</span></tt>的长度。</dd>
</dl>
<div class="highlight-python"><pre># 情况1：空列表

redis&gt; LLEN job
(integer) 0


# 情况2：非空列表

redis&gt; LPUSH job "cook food"
(integer) 1
redis&gt; LPUSH job "have lunch"
(integer) 2

redis&gt; LLEN job
(integer) 2</pre>
</div>
</div>
<div class="section" id="lrange">
<span id="id10"></span><h2>LRANGE<a class="headerlink" href="#lrange" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LRANGE key start stop</tt></dt>
<dd></dd></dl>

<p>返回列表<tt class="docutils literal"><span class="pre">key</span></tt>中指定区间内的元素，区间以偏移量<tt class="docutils literal"><span class="pre">start</span></tt>和<tt class="docutils literal"><span class="pre">stop</span></tt>指定。</p>
<p>下标(index)参数<tt class="docutils literal"><span class="pre">start</span></tt>和<tt class="docutils literal"><span class="pre">stop</span></tt>都以<tt class="docutils literal"><span class="pre">0</span></tt>为底，也就是说，以<tt class="docutils literal"><span class="pre">0</span></tt>表示列表的第一个元素，以<tt class="docutils literal"><span class="pre">1</span></tt>表示列表的第二个元素，以此类推。</p>
<p>你也可以使用负数下标，以<tt class="docutils literal"><span class="pre">-1</span></tt>表示列表的最后一个元素，<tt class="docutils literal"><span class="pre">-2</span></tt>表示列表的倒数第二个元素，以此类推。</p>
<p><strong>注意LRANGE命令和编程语言区间函数的区别</strong></p>
<p>假如你有一个包含一百个元素的列表，对该列表执行<tt class="docutils literal"><span class="pre">LRANGE</span> <span class="pre">list</span> <span class="pre">0</span> <span class="pre">10</span></tt>，结果是一个包含11个元素的列表，这表明<tt class="docutils literal"><span class="pre">stop</span></tt>下标也在<a class="reference internal" href="#lrange">LRANGE</a>命令的取值范围之内(闭区间)，这和某些语言的区间函数可能不一致，比如Ruby的<tt class="docutils literal"><span class="pre">Range.new</span></tt>、<tt class="docutils literal"><span class="pre">Array#slice</span></tt>和Python的<tt class="docutils literal"><span class="pre">range()</span></tt>函数。</p>
<p><strong>超出范围的下标</strong></p>
<p>超出范围的下标值不会引起错误。</p>
<p>如果<tt class="docutils literal"><span class="pre">start</span></tt>下标比列表的最大下标<tt class="docutils literal"><span class="pre">end</span></tt>(<tt class="docutils literal"><span class="pre">LLEN</span> <span class="pre">list</span></tt>减去<tt class="docutils literal"><span class="pre">1</span></tt>)还要大，或者<tt class="docutils literal"><span class="pre">start</span> <span class="pre">&gt;</span> <span class="pre">stop</span></tt>，<a class="reference internal" href="#lrange">LRANGE</a>返回一个空列表。</p>
<p>如果<tt class="docutils literal"><span class="pre">stop</span></tt>下标比<tt class="docutils literal"><span class="pre">end</span></tt>下标还要大，Redis将<tt class="docutils literal"><span class="pre">stop</span></tt>的值设置为<tt class="docutils literal"><span class="pre">end</span></tt>。</p>
<dl class="docutils">
<dt><strong>时间复杂度:</strong></dt>
<dd>O(S+N)，<tt class="docutils literal"><span class="pre">S</span></tt>为偏移量<tt class="docutils literal"><span class="pre">start</span></tt>，<tt class="docutils literal"><span class="pre">N</span></tt>为指定区间内元素的数量。</dd>
<dt><strong>返回值:</strong></dt>
<dd>一个列表，包含指定区间内的元素。</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; RPUSH fp-language lisp   # 插入一个值到列表fp-language
(integer) 1
redis&gt; LRANGE fp-language 0 0
1) "lisp"

redis&gt; RPUSH fp-language scheme
(integer) 2
redis&gt; LRANGE fp-language 0 1
1) "lisp"
2) "scheme"</pre>
</div>
</div>
<div class="section" id="lrem">
<span id="id11"></span><h2>LREM<a class="headerlink" href="#lrem" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LREM key count value</tt></dt>
<dd></dd></dl>

<p>根据参数<tt class="docutils literal"><span class="pre">count</span></tt>的值，移除列表中与参数<tt class="docutils literal"><span class="pre">value</span></tt>相等的元素。</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">count</span></tt>的值可以是以下几种：</dt>
<dd><ul class="first last simple">
<li><tt class="docutils literal"><span class="pre">count</span> <span class="pre">&gt;</span> <span class="pre">0</span></tt>: 从表头开始向表尾搜索，移除与<tt class="docutils literal"><span class="pre">value</span></tt>相等的元素，数量为<tt class="docutils literal"><span class="pre">count</span></tt>。</li>
<li><tt class="docutils literal"><span class="pre">count</span> <span class="pre">&lt;</span> <span class="pre">0</span></tt>: 从表尾开始向表头搜索，移除与<tt class="docutils literal"><span class="pre">value</span></tt>相等的元素，数量为<tt class="docutils literal"><span class="pre">count</span></tt>的绝对值。</li>
<li><tt class="docutils literal"><span class="pre">count</span> <span class="pre">=</span> <span class="pre">0</span></tt>: 移除表中所有与<tt class="docutils literal"><span class="pre">value</span></tt>相等的值。</li>
</ul>
</dd>
<dt><strong>时间复杂度：</strong></dt>
<dd>O(N)，<tt class="docutils literal"><span class="pre">N</span></tt>为列表的长度。</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">被移除元素的数量。</div>
<div class="line">因为不存在的<tt class="docutils literal"><span class="pre">key</span></tt>被视作空表(empty list)，所以当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，<a class="reference internal" href="#lrem">LREM</a>命令总是返回<tt class="docutils literal"><span class="pre">0</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre># 先创建一个表，内容排列是
# morning hello morning helllo morning

redis&gt; LPUSH greet "morning"
(integer) 1
redis&gt; LPUSH greet "hello"
(integer) 2
redis&gt; LPUSH greet "morning"
(integer) 3
redis&gt; LPUSH greet "hello"
(integer) 4
redis&gt; LPUSH greet "morning"
(integer) 5

redis&gt; LRANGE greet 0 4 # 查看所有元素
1) "morning"
2) "hello"
3) "morning"
4) "hello"
5) "morning"

redis&gt; LREM greet 2 morning  # 移除从表头到表尾，最先发现的两个morning
(integer) 2  # 两个元素被移除

redis&gt; LLEN greet   # 还剩3个元素
(integer) 3

redis&gt; LRANGE greet 0 2
1) "hello"
2) "hello"
3) "morning"

redis&gt; LREM greet -1 morning  # 移除从表尾到表头，第一个morning
(integer) 1

redis&gt; LLEN greet
(integer) 2

redis&gt; LRANGE greet 0 1
1) "hello"
2) "hello"

redis&gt; LREM greet 0 hello  # 移除表中所有hello
(integer) 2  # 两个hello被移除

redis&gt; LLEN greet
(integer) 0</pre>
</div>
</div>
<div class="section" id="lset">
<span id="id12"></span><h2>LSET<a class="headerlink" href="#lset" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LSET key index value</tt></dt>
<dd></dd></dl>

<p>将列表<tt class="docutils literal"><span class="pre">key</span></tt>下标为<tt class="docutils literal"><span class="pre">index</span></tt>的元素的值甚至为<tt class="docutils literal"><span class="pre">value</span></tt>。</p>
<p>更多信息请参考<a class="reference internal" href="#lindex">LINDEX</a>操作。</p>
<p>当<tt class="docutils literal"><span class="pre">index</span></tt>参数超出范围，或对一个空列表(<tt class="docutils literal"><span class="pre">key</span></tt>不存在)进行<a class="reference internal" href="#lset">LSET</a>时，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd><div class="first last line-block">
<div class="line">对头元素或尾元素进行<a class="reference internal" href="#lset">LSET</a>操作，复杂度为O(1)。</div>
<div class="line">其他情况下，为O(N)，<tt class="docutils literal"><span class="pre">N</span></tt>为列表的长度。</div>
</div>
</dd>
<dt><strong>返回值：</strong></dt>
<dd>操作成功返回<tt class="docutils literal"><span class="pre">ok</span></tt>，否则返回错误信息。</dd>
</dl>
<div class="highlight-python"><pre># 情况1：对空列表(key不存在)进行LSET

redis&gt; EXISTS list
(integer) 0

redis&gt; LSET list 0 item
(error) ERR no such key


# 情况2：对非空列表进行LSET

redis&gt; LPUSH job "cook food"
(integer) 1

redis&gt; LRANGE job 0 0
1) "cook food"

redis&gt; LSET job 0 "play game"
OK

redis&gt; LRANGE job  0 0
1) "play game"


# 情况3：index超出范围

redis&gt; LLEN list # 列表长度为1
(integer) 1

redis&gt; LSET list 3 'out of range'
(error) ERR index out of range</pre>
</div>
</div>
<div class="section" id="ltrim">
<span id="id13"></span><h2>LTRIM<a class="headerlink" href="#ltrim" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LTRIM key start stop</tt></dt>
<dd></dd></dl>

<p>对一个列表进行修剪(trim)，就是说，让列表只保留指定区间内的元素，不在指定区间之内的元素都将被删除。</p>
<p>举个例子，执行命令<tt class="docutils literal"><span class="pre">LTRIM</span> <span class="pre">list</span> <span class="pre">0</span> <span class="pre">2</span></tt>，表示只保留列表<tt class="docutils literal"><span class="pre">list</span></tt>的前三个元素，其余元素全部删除。</p>
<p>下标(index)参数<tt class="docutils literal"><span class="pre">start</span></tt>和<tt class="docutils literal"><span class="pre">stop</span></tt>都以<tt class="docutils literal"><span class="pre">0</span></tt>为底，也就是说，以<tt class="docutils literal"><span class="pre">0</span></tt>表示列表的第一个元素，以<tt class="docutils literal"><span class="pre">1</span></tt>表示列表的第二个元素，以此类推。</p>
<p>你也可以使用负数下标，以<tt class="docutils literal"><span class="pre">-1</span></tt>表示列表的最后一个元素，<tt class="docutils literal"><span class="pre">-2</span></tt>表示列表的倒数第二个元素，以此类推。</p>
<p>当<tt class="docutils literal"><span class="pre">key</span></tt>不是列表类型时，返回一个错误。</p>
<p><a class="reference internal" href="#ltrim">LTRIM</a>命令通常和<a class="reference internal" href="#lpush">LPUSH</a>命令或<a class="reference internal" href="#rpush">RPUSH</a>命令配合使用，举个例子：</p>
<div class="highlight-python"><pre>LPUSH log newest_log
LTRIM log 0 99</pre>
</div>
<p>这个例子模拟了一个日志程序，每次将最新日志<tt class="docutils literal"><span class="pre">newest_log</span></tt>放到<tt class="docutils literal"><span class="pre">log</span></tt>列表中，并且只保留最新的<tt class="docutils literal"><span class="pre">100</span></tt>项。注意当这样使用<tt class="docutils literal"><span class="pre">LTRIM</span></tt>命令时，时间复杂度是O(1)，因为平均情况下，每次只有一个元素被移除。</p>
<p><strong>注意LTRIM命令和编程语言区间函数的区别</strong></p>
<p>假如你有一个包含一百个元素的列表<tt class="docutils literal"><span class="pre">list</span></tt>，对该列表执行<tt class="docutils literal"><span class="pre">LTRIM</span> <span class="pre">list</span> <span class="pre">0</span> <span class="pre">10</span></tt>，结果是一个包含11个元素的列表，这表明<tt class="docutils literal"><span class="pre">stop</span></tt>下标也在<a class="reference internal" href="#ltrim">LTRIM</a>命令的取值范围之内(闭区间)，这和某些语言的区间函数可能不一致，比如Ruby的<tt class="docutils literal"><span class="pre">Range.new</span></tt>、<tt class="docutils literal"><span class="pre">Array#slice</span></tt>和Python的<tt class="docutils literal"><span class="pre">range()</span></tt>函数。</p>
<p><strong>超出范围的下标</strong></p>
<p>超出范围的下标值不会引起错误。</p>
<p>如果<tt class="docutils literal"><span class="pre">start</span></tt>下标比列表的最大下标<tt class="docutils literal"><span class="pre">end</span></tt>(<tt class="docutils literal"><span class="pre">LLEN</span> <span class="pre">list</span></tt>减去<tt class="docutils literal"><span class="pre">1</span></tt>)还要大，或者<tt class="docutils literal"><span class="pre">start</span> <span class="pre">&gt;</span> <span class="pre">stop</span></tt>，<a class="reference internal" href="#ltrim">LTRIM</a>返回一个空列表(因为<a class="reference internal" href="#ltrim">LTRIM</a>已经将整个列表清空)。</p>
<p>如果<tt class="docutils literal"><span class="pre">stop</span></tt>下标比<tt class="docutils literal"><span class="pre">end</span></tt>下标还要大，Redis将<tt class="docutils literal"><span class="pre">stop</span></tt>的值设置为<tt class="docutils literal"><span class="pre">end</span></tt>。</p>
<dl class="docutils">
<dt><strong>时间复杂度:</strong></dt>
<dd>O(N)，<tt class="docutils literal"><span class="pre">N</span></tt>为被移除的元素的数量。</dd>
<dt><strong>返回值:</strong></dt>
<dd><div class="first last line-block">
<div class="line">命令执行成功时，返回<tt class="docutils literal"><span class="pre">ok</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre># 情况1：一般情况下标

redis&gt; LRANGE alpha 0 -1 # 建立一个5元素的列表
1) "h"
2) "e"
3) "l"
4) "l"
5) "o"

redis&gt; LTRIM alpha 1 -1  # 删除索引为0的元素
OK

redis&gt; LRANGE alpha 0 -1 # "h"被删除
1) "e"
2) "l"
3) "l"
4) "o"


# 情况2：stop下标比元素的最大下标要大

redis&gt; LTRIM alpha 1 10086
OK
redis&gt; LRANGE alpha 0 -1
1) "l"
2) "l"
3) "o"


# 情况3：start和stop下标都比最大下标要大，且start &lt; sotp

redis&gt; LTRIM alpha 10086 200000
OK
redis&gt; LRANGE alpha 0 -1 # 整个列表被清空，等同于DEL alpha
(empty list or set)


# 情况4：start &gt; stop

redis&gt; LRANGE alpha 0 -1 # 在新建一个列表
1) "h"
2) "u"
3) "a"
4) "n"
5) "g"
6) "z"

redis&gt; LTRIM alpha 10086 4
OK

redis&gt; LRANGE alpha 0 -1 # 列表同样被清空
(empty list or set)</pre>
</div>
</div>
<div class="section" id="lindex">
<span id="id14"></span><h2>LINDEX<a class="headerlink" href="#lindex" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LINDEX key index</tt></dt>
<dd></dd></dl>

<p>返回列表<tt class="docutils literal"><span class="pre">key</span></tt>中，下标为<tt class="docutils literal"><span class="pre">index</span></tt>的元素。</p>
<p>下标(index)参数<tt class="docutils literal"><span class="pre">start</span></tt>和<tt class="docutils literal"><span class="pre">stop</span></tt>都以<tt class="docutils literal"><span class="pre">0</span></tt>为底，也就是说，以<tt class="docutils literal"><span class="pre">0</span></tt>表示列表的第一个元素，以<tt class="docutils literal"><span class="pre">1</span></tt>表示列表的第二个元素，以此类推。</p>
<p>你也可以使用负数下标，以<tt class="docutils literal"><span class="pre">-1</span></tt>表示列表的最后一个元素，<tt class="docutils literal"><span class="pre">-2</span></tt>表示列表的倒数第二个元素，以此类推。</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不是列表类型，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd><div class="first last line-block">
<div class="line">O(N)，<tt class="docutils literal"><span class="pre">N</span></tt>为到达下标<tt class="docutils literal"><span class="pre">index</span></tt>过程中经过的元素数量。</div>
<div class="line">因此，对列表的头元素和尾元素执行<a class="reference internal" href="#lindex">LINDEX</a>命令，复杂度为O(1)。</div>
</div>
</dd>
<dt><strong>返回值:</strong></dt>
<dd><div class="first last line-block">
<div class="line">列表中下标为<tt class="docutils literal"><span class="pre">index</span></tt>的元素。</div>
<div class="line">如果<tt class="docutils literal"><span class="pre">index</span></tt>参数的值不在列表的区间范围内(out of range)，返回<tt class="docutils literal"><span class="pre">nil</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; LPUSH mylist "World"
(integer) 1

redis&gt; LPUSH mylist "Hello"
(integer) 2

redis&gt; LINDEX mylist 0
"Hello"

redis&gt; LINDEX mylist -1
"World"

redis&gt; LINDEX mylist 3  # index不在mylist的区间范围内
(nil)</pre>
</div>
</div>
<div class="section" id="linsert">
<span id="id15"></span><h2>LINSERT<a class="headerlink" href="#linsert" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">LINSERT key BEFORE|AFTER pivot value</tt></dt>
<dd></dd></dl>

<p>将值<tt class="docutils literal"><span class="pre">value</span></tt>插入到列表<tt class="docutils literal"><span class="pre">key</span></tt>当中，位于值<tt class="docutils literal"><span class="pre">pivot</span></tt>之前或之后。</p>
<p>当<tt class="docutils literal"><span class="pre">pivot</span></tt>不存在于列表<tt class="docutils literal"><span class="pre">key</span></tt>时，不执行任何操作。</p>
<p>当<tt class="docutils literal"><span class="pre">key</span></tt>不存在时，<tt class="docutils literal"><span class="pre">key</span></tt>被视为空列表，不执行任何操作。</p>
<p>如果<tt class="docutils literal"><span class="pre">key</span></tt>不是列表类型，返回一个错误。</p>
<dl class="docutils">
<dt><strong>时间复杂度:</strong></dt>
<dd>O(N)，<tt class="docutils literal"><span class="pre">N</span></tt>为寻找<tt class="docutils literal"><span class="pre">pivot</span></tt>过程中经过的元素数量。</dd>
<dt><strong>返回值:</strong></dt>
<dd><div class="first last line-block">
<div class="line">如果命令执行成功，返回插入操作完成之后，列表的长度。</div>
<div class="line">如果没有找到<tt class="docutils literal"><span class="pre">pivot</span></tt>，返回<tt class="docutils literal"><span class="pre">-1</span></tt>。</div>
<div class="line">如果<tt class="docutils literal"><span class="pre">key</span></tt>不存在或为空列表，返回<tt class="docutils literal"><span class="pre">0</span></tt>。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre>redis&gt; RPUSH mylist "Hello"
(integer) 1
redis&gt; RPUSH mylist "World"
(integer) 2

redis&gt; LINSERT mylist BEFORE "World" "There"
(integer) 3

redis&gt; LRANGE mylist 0 -1
1) "Hello"
2) "There"
3) "World"

redis&gt; LINSERT mylist BEFORE "go" "let's"    # 对一个非空列表插入，查找一个不存在的pivot
(integer) -1    # 失败

redis&gt; EXISTS fake_list  # 对一个空列表执行LINSERT命令
(integer) 0

redis&gt; LINSERT fake_list BEFORE "nono" "gogogog"
(integer) 0 # 失败</pre>
</div>
</div>
<div class="section" id="rpoplpush">
<span id="id16"></span><h2>RPOPLPUSH<a class="headerlink" href="#rpoplpush" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">RPOPLPUSH source destination</tt></dt>
<dd></dd></dl>

<p>命令<a class="reference internal" href="#rpoplpush">RPOPLPUSH</a>在一个原子时间内，执行以下两个动作：</p>
<blockquote>
<div><ul class="simple">
<li>将列表<tt class="docutils literal"><span class="pre">source</span></tt>中的最后一个元素(尾元素)弹出，并返回给客户端。</li>
<li>将<tt class="docutils literal"><span class="pre">source</span></tt>弹出的元素插入到列表<tt class="docutils literal"><span class="pre">destination</span></tt>，作为<tt class="docutils literal"><span class="pre">destination</span></tt>列表的的头元素。</li>
</ul>
</div></blockquote>
<p>举个例子，你有两个列表<tt class="docutils literal"><span class="pre">source</span></tt>和<tt class="docutils literal"><span class="pre">destination</span></tt>，<tt class="docutils literal"><span class="pre">source</span></tt>列表有元素<tt class="docutils literal"><span class="pre">a,</span> <span class="pre">b,</span> <span class="pre">c</span></tt>，<tt class="docutils literal"><span class="pre">destination</span></tt>列表有元素<tt class="docutils literal"><span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z</span></tt>，执行<tt class="docutils literal"><span class="pre">RPOPLPUSH</span> <span class="pre">source</span> <span class="pre">destination</span></tt>之后，<tt class="docutils literal"><span class="pre">source</span></tt>列表包含元素<tt class="docutils literal"><span class="pre">a,</span> <span class="pre">b</span></tt>，<tt class="docutils literal"><span class="pre">destination</span></tt>列表包含元素<tt class="docutils literal"><span class="pre">c,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">z</span></tt> ，并且元素<tt class="docutils literal"><span class="pre">c</span></tt>被返回。</p>
<p>如果<tt class="docutils literal"><span class="pre">source</span></tt>不存在，值<tt class="docutils literal"><span class="pre">nil</span></tt>被返回，并且不执行其他动作。</p>
<p>如果<tt class="docutils literal"><span class="pre">source</span></tt>和<tt class="docutils literal"><span class="pre">destination</span></tt>相同，则列表中的表尾元素被移动到表头，并返回该元素，可以把这种特殊情况视作列表的旋转(rotation)操作。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd>被弹出的元素。</dd>
</dl>
<div class="highlight-python"><pre># 相关数据

redis&gt; RPUSH alpha a
(integer) 1
redis&gt; RPUSH alpha b
(integer) 2
redis&gt; RPUSH alpha c
(integer) 3
redis&gt; RPUSH alpha d
(integer) 4

# 情况1：source和destination不同

redis&gt; LRANGE alpha 0 -1 # 查看所有元素
1) "a"
2) "b"
3) "c"
4) "d"

redis&gt; RPOPLPUSH alpha reciver   # 执行一次RPOPLPUSH看看
"d"

redis&gt; LRANGE alpha 0 -1
1) "a"
2) "b"
3) "c"

redis&gt; LRANGE reciver 0 -1
1) "d"

redis&gt; RPOPLPUSH alpha reciver   # 再执行一次，确保rpop和lpush的位置正确
"c"

redis&gt; LRANGE alpha 0 -1
1) "a"
2) "b"

redis&gt; LRANGE reciver 0 -1
1) "c"
2) "d"


# 情况2：source和destination相同

redis&gt; RPOPLPUSH alpha alpha
"c"

redis&gt; LRANGE alpha 0 -1 # 原来的尾元素"c"被放到了头部
1) "c"
2) "a"
3) "b"</pre>
</div>
<p><strong>设计模式： 一个安全的队列</strong></p>
<p>Redis的列表经常被用作队列(queue)，用于在不同程序之间有序地交换消息(message)。一个程序(称之为生产者，producer)通过<a class="reference internal" href="#lpush">LPUSH</a>命令将消息放入队列中，而另一个程序(称之为消费者，consumer)通过<a class="reference internal" href="#rpop">RPOP</a>命令取出队列中等待时间最长的消息。</p>
<p>不幸的是，在这个过程中，一个消费者可能在获得一个消息之后崩溃，而未执行完成的消息也因此丢失。</p>
<p>使用<a class="reference internal" href="#rpoplpush">RPOPLPUSH</a>命令可以解决这个问题，因为它在返回一个消息之余，还将该消息添加到另一个列表当中，另外的这个列表可以用作消息的备份表：假如一切正常，当消费者完成该消息的处理之后，可以用<a class="reference internal" href="#lrem">LREM</a>命令将该消息从备份表删除。</p>
<p>另一方面，助手(helper)程序可以通过监视备份表，将超过一定处理时限的消息重新放入队列中去(负责处理该消息的消费者可能已经崩溃)，这样就不会丢失任何消息了。</p>
</div>
<div class="section" id="brpoplpush">
<span id="id17"></span><h2>BRPOPLPUSH<a class="headerlink" href="#brpoplpush" title="永久链接至标题">¶</a></h2>
<dl class="function">
<dt>
<tt class="descname">BRPOPLPUSH source destination timeout</tt></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#brpoplpush">BRPOPLPUSH</a>是<a class="reference internal" href="#rpoplpush">RPOPLPUSH</a>的阻塞版本，当给定列表<tt class="docutils literal"><span class="pre">source</span></tt>不为空时，<a class="reference internal" href="#brpoplpush">BRPOPLPUSH</a>的表现和<a class="reference internal" href="#rpoplpush">RPOPLPUSH</a>一样。</p>
<p>当列表<tt class="docutils literal"><span class="pre">source</span></tt>为空时，<a class="reference internal" href="#brpoplpush">BRPOPLPUSH</a>命令将阻塞连接，直到等待超时，或有另一个客户端对<tt class="docutils literal"><span class="pre">source</span></tt>执行<a class="reference internal" href="#lpush">LPUSH</a>或<a class="reference internal" href="#rpush">RPUSH</a>命令为止。</p>
<p>超时参数<tt class="docutils literal"><span class="pre">timeout</span></tt>接受一个以秒为单位的数字作为值。超时参数设为<tt class="docutils literal"><span class="pre">0</span></tt>表示阻塞时间可以无限期延长(block indefinitely) 。</p>
<p>更多相关信息，请参考<a class="reference internal" href="#rpoplpush">RPOPLPUSH</a>命令。</p>
<dl class="docutils">
<dt><strong>时间复杂度：</strong></dt>
<dd>O(1)</dd>
<dt><strong>返回值：</strong></dt>
<dd><div class="first last line-block">
<div class="line">假如在指定时间内没有任何元素被弹出，则返回一个<tt class="docutils literal"><span class="pre">nil</span></tt>和等待时长。</div>
<div class="line">反之，返回一个含有两个元素的列表，第一个元素是被弹出元素的值，第二个元素是等待时长。</div>
</div>
</dd>
</dl>
<div class="highlight-python"><pre># 情况1：非空列表

redis&gt; BRPOPLPUSH msg reciver 500
"hello moto"    # 弹出元素的值
(3.38s)         # 等待时长

redis&gt; LLEN reciver
(integer) 1

redis&gt; LRANGE reciver 0 0
1) "hello moto"


# 情况2：空列表

redis&gt; BRPOPLPUSH msg reciver 1
(nil)
(1.34s)</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">表(List)</a><ul>
<li><a class="reference internal" href="#lpush">LPUSH</a></li>
<li><a class="reference internal" href="#lpushx">LPUSHX</a></li>
<li><a class="reference internal" href="#rpush">RPUSH</a></li>
<li><a class="reference internal" href="#rpushx">RPUSHX</a></li>
<li><a class="reference internal" href="#lpop">LPOP</a></li>
<li><a class="reference internal" href="#rpop">RPOP</a></li>
<li><a class="reference internal" href="#blpop">BLPOP</a></li>
<li><a class="reference internal" href="#brpop">BRPOP</a></li>
<li><a class="reference internal" href="#llen">LLEN</a></li>
<li><a class="reference internal" href="#lrange">LRANGE</a></li>
<li><a class="reference internal" href="#lrem">LREM</a></li>
<li><a class="reference internal" href="#lset">LSET</a></li>
<li><a class="reference internal" href="#ltrim">LTRIM</a></li>
<li><a class="reference internal" href="#lindex">LINDEX</a></li>
<li><a class="reference internal" href="#linsert">LINSERT</a></li>
<li><a class="reference internal" href="#rpoplpush">RPOPLPUSH</a></li>
<li><a class="reference internal" href="#brpoplpush">BRPOPLPUSH</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="hash.html"
                        title="上一章">哈希表(Hash)</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="set.html"
                        title="下一章">集合(Set)</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="sources/list.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="http://redis.readthedocs.org/en/2.4/search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="搜索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的模块，术语，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="set.html" title="集合(Set)"
             >下一页</a> |</li>
        <li class="right" >
          <a href="hash.html" title="哈希表(Hash)"
             >上一页</a> |</li>
        <li><a href="index.html">Redis命令参考简体中文版 v2.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; 版权所有 2011, huangz1990.
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.8.
    </div>
  </body>

<!-- Mirrored from redis.readthedocs.org/en/2.4/list.html by HTTrack Website Copier/3.x [XR&CO'2010], Tue, 22 Nov 2011 10:08:52 GMT -->
</html>