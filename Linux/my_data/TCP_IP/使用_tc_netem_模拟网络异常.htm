<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>使用 tc netem 模拟网络异常</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
html,body { 
	/* Default Font */
	font-family: Arial, Helvetica, sans-serif;
	font-size: 11pt;
}
</style>

</head>

<body>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>在某些情况下，我们需要模拟网络很差的状态来测试软件能够正常工作，比如网络延迟、丢包、乱序、重复等。linux 
系统强大的流量控制工具 tc 能很轻松地完成，tc 命令行是<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>iproute2</CODE><SPAN>&nbsp;</SPAN>软件包中的软件，可以根据系统版本自行安装。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>流量控制是个系统而复杂的话题，tc 
能做的事情很多，除了本文介绍的还有带宽控制、优先级控制等等，这些功能是通过类似的<SPAN>&nbsp;</SPAN><STRONG 
style="FONT-WEIGHT: bold; TEXT-INDENT: 0px">模块</STRONG><SPAN>&nbsp;</SPAN>组件实现的，这篇文章介绍的功能主要是通过<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>netem</CODE><SPAN>&nbsp;</SPAN>这个组件实现的。<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>netem</CODE><SPAN>&nbsp;</SPAN>是<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>Network 
Emulator</CODE><SPAN>&nbsp;</SPAN>的缩写，关于更多功能以及参数的详细解释可以参阅<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>tc-netem</CODE><SPAN>&nbsp;</SPAN>的 
man page。</P>
<H2 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>网络状况模拟</H2>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>网络状况欠佳从用户角度来说就是下载东西慢（网页一直加载、视频卡顿、图片加载很久等），从网络报文角度来看却有很多情况：延迟（某个机器发送报文很慢）、丢包（发送的报文在网络中丢失需要一直重传）、乱序（报文顺序错乱，需要大量计算时间来重新排序）、重复（报文有大量重复，导致网络拥堵）、错误（接收到的报文有误只能丢弃重传）等。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>对于这些情况，都可以用 
netem 来模拟。需要注意的是，netem 
是直接添加到网卡上的，也就是说所有从网卡发送出去的包都会收到配置参数的影响，所以最好搭建临时的虚拟机进行测试。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>在下面的例子中<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>add</CODE><SPAN>&nbsp;</SPAN>表示为网卡添加 
netem 配置，<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>change</CODE><SPAN>&nbsp;</SPAN>表示修改已经存在的 
netem 配置到新的值，如果要删除网卡上的配置可以使用<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>del</CODE><SPAN>&nbsp;</SPAN>：</P><PRE class="hljs makefile" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'><SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc del dev eth0 root</SPAN></PRE>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>1. 
模拟延迟传输</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>最简单的例子是所有的报文延迟 
100ms 发送：</P><PRE class="hljs vim" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'># <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">tc</SPAN> qdisc <SPAN class=hljs-built_in style="COLOR: rgb(57,115,0)">add</SPAN> dev eth0 root netem delay <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN>ms</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>如果你想在一个局域网里模拟远距离传输的延迟可以用这个方法，比如实际用户会访问外国网站，延迟为 
120ms，而你测试环境网络交互只需要 10ms，那么只要添加 110 ms 额外延迟就行。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>在我本地的虚拟机中实验结果：</P><PRE class="prettyprint hljs perl" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc replace dev enp0s8 root netem delay 100ms</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes of data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">time</SPAN>=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">101</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">time</SPAN>=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">time</SPAN>=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">102</SPAN> ms
^C
--- <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> ping statistics ---
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> packets transmitted, <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> received, <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0</SPAN>% packet loss, <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">time</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2003</SPAN>ms
rtt min/avg/max/mdev = <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100.725</SPAN>/<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">101.370</SPAN>/<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">102.048</SPAN>/<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">653</SPAN> ms</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>如果在网络中看到非常稳定的时延，很可能是某个地方加了定时器，因为网络线路很复杂，传输过程一定会有变化。因此实际情况网络延迟一定会有变化的，<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>netem</CODE><SPAN>&nbsp;</SPAN>也考虑到这一点，提供了额外的参数来控制延迟的时间分布，完整的参数列表为：</P><PRE class="prettyprint hljs nginx" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'><SPAN class=hljs-attribute style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">DELAY</SPAN> := delay TIME [ JITTER [ CORRELATION ]]]
    [ distribution { <SPAN class=hljs-attribute style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">uniform</SPAN> | normal | pareto |  paretonormal } ]</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>除了延迟时间<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>TIME</CODE><SPAN>&nbsp;</SPAN>之外，还有三个可选参数：</P>
<UL 
style='LIST-STYLE-TYPE: none; FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>JITTER</CODE><SPAN>&nbsp;</SPAN>：抖动，增加一个随机时间长度，让延迟时间出现在某个范围</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>CORRELATION</CODE><SPAN>&nbsp;</SPAN>：相关，下一个报文延迟时间和上一个报文的相关系数</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>distribution</CODE><SPAN>&nbsp;</SPAN>：分布，延迟的分布模式，可以选择的值有<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>uniform</CODE><SPAN>&nbsp;</SPAN>、<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>normal</CODE><SPAN>&nbsp;</SPAN>、<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>pareto</CODE><SPAN>&nbsp;</SPAN>和<CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>paretonormal</CODE></LI></UL>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>先说说<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>JITTER</CODE><SPAN>&nbsp;</SPAN>，如果设置为<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>20ms</CODE><SPAN>&nbsp;</SPAN>，那么报文延迟的时间在 
100ms ± 20ms 之间（90ms - 110ms），具体值随机选择：</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc replace dev enp0s8 root netem delay 100ms 20ms</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">112</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">89.7</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">114</SPAN> ms
......</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>CORRELATION</CODE><SPAN>&nbsp;</SPAN>指相关性，因为网络状况是平滑变化的，短时间里相邻报文的延迟应该是近似的而不是完全随机的。这个值是个百分比，如果为<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>100%</CODE><SPAN>&nbsp;</SPAN>，就退化到固定延迟的情况；如果是<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>0%</CODE>则退化到随机延迟的情况</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc replace dev enp0s8 root netem delay 100ms 20ms 50%</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">116</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">89.7</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">90.8</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">4</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">96.4</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">5</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">90.5</SPAN> ms</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>报文的分布和很多现实事件一样都满足某种统计规律，比如最常用的正态分布。因此为了更逼近现实情况，可以使用<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>distribution</CODE><SPAN>&nbsp;</SPAN>参数来限制它的延迟分布模型。比如让报文延迟时间满足正态分布：</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'><SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc change dev eth0 root netem delay 100ms 20ms distribution normal</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc replace dev enp0s8 root netem delay 100ms 20ms distribution normal</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">119</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">102</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">115</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">4</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">105</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">5</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">119</SPAN> ms</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>这样的话，大部分的延迟会在平均值的一定范围内，而很少接近出现最大值和最小值的延迟。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>其他分布方法包括：<SPAN>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="https://en.wikipedia.org/wiki/Uniform_distribution_(continuous)" 
rel=nofollow,noindex 
target=_blank>uniform</A><SPAN>&nbsp;</SPAN>、<SPAN>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="https://en.wikipedia.org/wiki/Pareto_distribution" rel=nofollow,noindex 
target=_blank>pareto</A><SPAN>&nbsp;</SPAN>和<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>paretonormal</CODE><SPAN>&nbsp;</SPAN>，这些分布我没有深入去看它们的意思，感兴趣的读者可以自行了解。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>对于大多数情况，随机在某个时间范围里延迟就能满足需求的。</P>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>2. 
模拟丢包率</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>另一个常见的网络异常是因为丢包，丢包会导致重传，从而增加网络链路的流量和延迟。netem 
的<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>loss</CODE><SPAN>&nbsp;</SPAN>参数可以模拟丢包率，比如发送的报文有 
50% 的丢包率（为了容易用 ping 看出来，所以这个数字我选的很大，实际情况丢包率可能比这个小很多，比如<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>0.5%</CODE><SPAN>&nbsp;</SPAN>）：</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc change dev enp0s8 root netem loss 50%</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.716</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.713</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">5</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.719</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">7</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.938</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">10</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.594</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">11</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.698</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">12</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.681</SPAN> ms</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>可以从<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>icmp_seq</CODE><SPAN>&nbsp;</SPAN>序号看出来大约有一半的报文丢掉了，和延迟类似，丢包率也可以增加一个相关系数，表示后一个报文丢包概率和它前一个报文的相关性：</P><PRE class="hljs vim" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'># <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">tc</SPAN> qdisc <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">change</SPAN> dev eth0 root netem loss <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.3</SPAN>% <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">25</SPAN>%</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>这个命令表示，丢包率是 
0.3%，并且当前报文丢弃的可能性和前一个报文 25% 相关。默认的丢包模型为随机，loss 也支持<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>state</CODE><SPAN>&nbsp;</SPAN>（4-state 
Markov 模型） 和<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>gemodel</CODE><SPAN>&nbsp;</SPAN>（Gilbert-Elliot 
丢包模型） 两种模型的丢包，因为两者都相对负责，这里也不再介绍了。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>需要注意的是，丢包信息会发送到上层协议，如果是 
TCP 协议，那么 TCP 会进行重传，所以对应用来说看不到丢包。这时候要模拟丢包，需要把 loss 配置到王桥或者路由设备上。</P>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>3. 
模拟包重复</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>报文重复和丢包的参数类似，就是重复率和相关性两个参数，比如随机产生 
50% 重复的包：</P><PRE class="prettyprint hljs scheme" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[<SPAN class=hljs-name style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">root@node02</SPAN> ~]# tc qdisc change dev enp0s8 root netem duplicate <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">50</SPAN>%
[<SPAN class=hljs-name style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">root@node02</SPAN> ~]# ping <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.8.100
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.8.100 (<SPAN class=hljs-name style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">172.17.8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-name style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">84</SPAN>) bytes of data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.8.100: icmp_seq=1 ttl=64 time=0.705 ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.8.100: icmp_seq=1 ttl=64 time=1.03 ms (<SPAN class=hljs-name style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">DUP!</SPAN>)
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes from <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.8.100: icmp_seq=2 ttl=64 time=0.710 ms
......</PRE>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>4. 
模拟包损坏</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>报文损坏和报文重复的参数也类似，比如随机产生 
2% 损坏的报文（在报文的随机位置造成一个比特的错误）：</P><PRE class="hljs vim" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'># <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">tc</SPAN> qdisc <SPAN class=hljs-built_in style="COLOR: rgb(57,115,0)">add</SPAN> dev eth0 root netem corrupt <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN>%</PRE>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>5. 
模拟包乱序</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>网络传输并不能保证顺序，传输层 
TCP 会对报文进行重组保证顺序，所以报文乱序对应用的影响比上面的几种问题要下。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>报文乱序可前面的参数不太一样，因为上面的报文问题都是独立的，针对单个报文做操作就行，而乱序则牵涉到多个报文的重组。模拟报乱序一定会用到延迟（因为模拟乱序的本质就是把一些包延迟发送），netem 
有两种方法可以做。第一种是固定的每隔一定数量的报文就乱序一次：</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>每 
5 个报文（第 5、10、15…报文）会正常发送，其他的报文延迟 100ms：</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'><SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc change dev enp0s8 root netem reorder 50% gap 3 delay 100ms</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping -i 0.05 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.634</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">4</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.765</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">102</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">5</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">7</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">50.3</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">6</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">100</SPAN> ms
......</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>要想看到 
ping 报文的乱序，我们要保证发送报文的间隔小于报文的延迟时间<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>100ms</CODE><SPAN>&nbsp;</SPAN>，这里用<CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>-i 
0.05</CODE><SPAN>&nbsp;</SPAN>把发送间隔设置为<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>50ms</CODE><SPAN>&nbsp;</SPAN>。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>第二种方法的乱序是相对随机的，使用概率来选择乱序的报文：</P><PRE class="prettyprint hljs livescript" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># tc qdisc change dev enp0s8 root netem reorder 50% 15% delay 300ms</SPAN>
[root@node02 ~]<SPAN class=hljs-comment style="COLOR: rgb(136,136,136)"># ping -i 0.05 172.17.8.100</SPAN>
PING <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN> (<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>) <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">56</SPAN>(<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">84</SPAN>) bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">of</SPAN> data.
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">1</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">0.545</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">5</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">120</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">2</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">300</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">19.8</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">3</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">301</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">9</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">28.3</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">4</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">300</SPAN> ms
<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> bytes <SPAN class=hljs-keyword style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">from</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">172.17</SPAN>.<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">8.100</SPAN>: icmp_seq=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">11</SPAN> ttl=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">64</SPAN> time=<SPAN class=hljs-number style="COLOR: rgb(136,0,0)">35.5</SPAN> ms
......</PRE>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>50% 
的报文会正常发送，其他报文（1-50%）延迟 300ms 发送，这里选择的延迟很大是为了能够明显看出来乱序的结果。</P>
<H2 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>两个工具</H2>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>netem 
在 tc 
中算是比较简单的模块，如果要实现流量控制或者精细化的过滤需要更复杂的配置。这里推荐两个小工具，它们共同的特点是用法简单，能满足特定的需求，而不用自己去倒腾 tc 
的命令。</P>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>wondershaper</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>netem 
只能模拟网络状况，不能控制带宽，<SPAN>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="https://www.hecticgeek.com/2012/02/simple-traffic-shaping-ubuntu-linux/" 
rel=nofollow,noindex 
target=_blank>wondershaper</A><SPAN>&nbsp;</SPAN>能完美解决这个问题。wondershaper 
的使用非常简单，只有三个参数：网卡名、下行限速、上行限速。比如要设置网卡下载速度为 200kb/s，上传速度为<SPAN>&nbsp;</SPAN><CODE 
style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>150kb/s</CODE><SPAN>&nbsp;</SPAN>：</P><PRE class="hljs nginx" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'><SPAN class=hljs-attribute style="FONT-WEIGHT: 700; COLOR: rgb(51,51,51)">wondershaper</SPAN> enp0s8 <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">200</SPAN> <SPAN class=hljs-number style="COLOR: rgb(136,0,0)">150</SPAN></PRE>
<H3 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>comcast</H3>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="https://github.com/tylertreat/comcast" rel=nofollow,noindex 
target=_blank>comcast</A><SPAN>&nbsp;</SPAN>是一个跨平台的网络模拟工具，旨在其他平台（OSX、Windows、BSD）也提供类似网络模拟的功能。</P>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>它的使用也相对简单：</P><PRE class="prettyprint hljs lua" style='WORD-WRAP: break-word; FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: pre; WORD-SPACING: 0px; OVERFLOW-X: auto; BORDER-BOTTOM: medium none; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: 400; COLOR: rgb(68,68,68); PADDING-BOTTOM: 0.5em; FONT-STYLE: normal; PADDING-TOP: 0.5em; PADDING-LEFT: 0.5em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: medium none; ORPHANS: 2; WIDOWS: 2; DISPLAY: block; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.5em; BACKGROUND-COLOR: rgb(246,246,246); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; border-radius: 4px'>$ comcast <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--device=eth0 --latency=250 \</SPAN>
    <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--target-bw=1000 --default-bw=1000000 \</SPAN>
    <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--packet-loss=10% \</SPAN>
    <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--target-addr=8.8.8.8,10.0.0.0/24 \</SPAN>
    <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--target-proto=tcp,udp,icmp \</SPAN>
    <SPAN class=hljs-comment style="COLOR: rgb(136,136,136)">--target-port=80,22,1000:2000</SPAN></PRE>
<UL 
style='LIST-STYLE-TYPE: none; FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--device</CODE><SPAN>&nbsp;</SPAN>说明要控制的网卡为<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>eth0</CODE></LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--latency</CODE><SPAN>&nbsp;</SPAN>指定 
  250ms 的延迟</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--target-bw</CODE><SPAN>&nbsp;</SPAN>指定目标带宽</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--default-bw</CODE><SPAN>&nbsp;</SPAN>指定默认带宽</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--packet-loss</CODE><SPAN>&nbsp;</SPAN>是丢包率</LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--target-addr</CODE><SPAN>&nbsp;</SPAN>、<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--target-proto</CODE><SPAN>&nbsp;</SPAN>、<SPAN>&nbsp;</SPAN><CODE 
  style='FONT-SIZE: 14px; BORDER-TOP: medium none; FONT-FAMILY: Menlo, Monaco, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; FONT-WEIGHT: 600; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>--target-port</CODE><SPAN>&nbsp;</SPAN>参数指定在满足这些条件的报文上实施上面的配置</LI></UL>
<H2 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>总结</H2>
<P 
style='FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.75em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>可以看出，tc 
的 netem 模块主要用来模拟各种网络的异常状况，本身并没有提供宽带限制的功能，而且一旦在网卡上配置了 
netem，该网卡上所有的报文都会受影响，如果想精细地控制部分报文，需要用到 tc 的<SPAN>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://lartc.org/howto/lartc.qdisc.filters.html" rel=nofollow,noindex 
target=_blank>filter</A><SPAN>&nbsp;</SPAN>功能。</P>
<H2 
style='FONT-SIZE: 18px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: bold; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 0.5em; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.6em; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 1em; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial; text-rendering: optimizeLegibility'>参考资料</H2>
<UL 
style='LIST-STYLE-TYPE: none; FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: 400; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0px; FONT-STYLE: normal; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px; BACKGROUND-COLOR: rgb(254,254,254); TEXT-INDENT: 0px; font-variant-ligatures: normal; font-variant-caps: normal; -webkit-text-stroke-width: 0px; text-decoration-style: initial; text-decoration-color: initial'>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="https://wiki.linuxfoundation.org/networking/netem" rel=nofollow,noindex 
  target=_blank>the Linux Foundation wiki: netem</A></LI>
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.172.7072&amp;rep=rep1&amp;type=pdf" 
  rel=nofollow,noindex target=_blank>Definition of a general and intuitive loss 
  model for packet networks and its implementation in the Netem module in the 
  Linux kernel</A></LI></UL></body>
</html>
