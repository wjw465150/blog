<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Linux EXT3文件系统下成功恢复误删的文件</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</head>
<body><!--StartFragment-->
<span class="Apple-style-span" style="WHITE-SPACE: normal; WORD-SPACING: 0px; BORDER-COLLAPSE: separate; TEXT-TRANSFORM: none; COLOR: rgb(0,0,0); FONT: medium Simsun; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; -webkit-text-size-adjust: auto; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px; -webkit-text-decorations-in-effect: none"              ><span class="Apple-style-span" style="FONT-SIZE: 12px; FONT-FAMILY: Tahoma, Arial; TEXT-ALIGN: left" >　环境：CentOS 5.3 x86_64下，/dev/sdb1为数据分区/data0，EXT3文件系统。<br>　　前因：误删了/data0/tcsql/cankao/phpcws-1.5.0/httpcws.cpp文件。由于忘了备份httpcws.cpp文件，重新开发工作量较大，因此只有恢复该文件一条路可走。<br><br>　　debugfs命令针对EXT2分区还行，但对EXT3分区就帮不上忙了。偶然发现的一款开源软件，解决了我的大忙。该软件下载网址为：<br>　　<a href="http://code.google.com/p/ext3grep/" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   >http://code.google.com/p/ext3grep/</a><br><br>　　1、先安装ext3grep软件：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >wget<span class="Apple-converted-space">&nbsp;</span><a href="http://ext3grep.googlecode.com/files/ext3grep-0.10.1.tar.gz" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   >http://ext3grep.googlecode.com/files/ext3grep-0.10.1.tar.gz</a><br>tar zxvf ext3grep-0.10.1.tar.gz<br>cd ext3grep-0.10.1<br>./configure<br>make<br>make install</div><br><br>　　2、umount /data0分区：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >umount /data0</div><br>　　如果提示busy，先kill正在使用这个目录的进程，再umount：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >fuser -k /data0<br>umount /data0</div><br><br>　　3、查询所有Inode，（执行需要几分钟～十多分钟）：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >ext3grep /dev/sdb1 --ls --inode 2</div><br>　　<a href="http://blog.s135.com/linux_ext3_undelete/attachment.php?fid=21" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   ><IMG title=点击在新窗口中浏览此图片 class=insertimage border=0 alt=点击在新窗口中浏览此图片 src="attachment.php_fid=21"></a><br><br>　　4、逐级查找Inode，看是否能找到httpcws.cpp文件（此步骤也可省略）：<br><a name="entrymore" ></a><br>　　<a href="http://blog.s135.com/linux_ext3_undelete/attachment.php?fid=22" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   ><IMG title=点击在新窗口中浏览此图片 class=insertimage border=0 alt=点击在新窗口中浏览此图片 src="attachment.php_fid=22"></a><br><br>　　<a href="http://blog.s135.com/linux_ext3_undelete/attachment.php?fid=23" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   ><IMG title=点击在新窗口中浏览此图片 class=insertimage border=0 alt=点击在新窗口中浏览此图片 src="attachment.php_fid=23"></a><br><br>　　5、恢复/data0/tcsql/cankao/phpcws-1.5.0/httpcws.cpp文件：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >ext3grep /dev/sdb1 --restore-file tcsql/cankao/phpcws-1.5.0/httpcws.cpp</div><br>　　<a href="http://blog.s135.com/linux_ext3_undelete/attachment.php?fid=24" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   ><IMG title=点击在新窗口中浏览此图片 class=insertimage border=0 alt=点击在新窗口中浏览此图片 src="attachment.php_fid=24"></a><br><br>　　如果提示以下信息，则表示恢复成功：<br>　　Restoring tcsql/cankao/phpcws-1.5.0/httpcws.cpp<br><br>　　这时，执行ext3grep命令的当前目录下将会自动生成一个名为<span style="COLOR: rgb(255,0,0)"   >RESTORED_FILES</span>的文件夹，文件夹下的tcsql/cankao/phpcws-1.5.0/httpcws.cpp即为恢复的文件。查看了一下，和被删除前的内容一样，大功告成。<br><br><br>　　6、重新mount /data0分区：<br><div style="BORDER-TOP: rgb(0,160,198) 1px dashed; BORDER-RIGHT: rgb(0,160,198) 1px dashed; BORDER-BOTTOM: rgb(0,160,198) 1px dashed; PADDING-BOTTOM: 3px; PADDING-TOP: 3px; PADDING-LEFT: 3px; MARGIN: 5px 5px 0px; BORDER-LEFT: rgb(0,160,198) 1px dashed; PADDING-RIGHT: 3px; BACKGROUND-COLOR: rgb(255,255,255)"                       >mount /dev/sdb1 /data0</div>
<P><br><br>　　参考资料：<a href="http://www.xs4all.nl/~carlo17/howto/undelete_ext3.html" target="_blank" style="TEXT-DECORATION: none; COLOR: rgb(79,99,113)"   >http://www.xs4all.nl/~carlo17/howto/undelete_ext3.html</a></span></span> 
<!--EndFragment--></P>
</body>
</htm</html>