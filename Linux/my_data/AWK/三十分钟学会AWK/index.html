<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Language" content="zh-CN">
    <meta name="robots" content="index, follow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="管宜尧,agiledev">
            <meta name="keywords" content="管宜尧,agiledev,开源中国博客">
                <meta name="description" itemprop="description" content="本文大部分内容翻译自我开始学习AWK时看到的一篇英文文章 AWK Tutorial ，觉得对AWK入门非常有帮助，所以对其进行了粗略的翻译，并对其中部分内容进行了删减或者补充，希望能为对AWK感兴趣的小伙伴提供一份快速入门的教程，帮助小伙伴们快速掌握AWK的基本使用方式，当然，我也是刚开始学习AWK，本文在翻译或者补充的过程中肯定会有很多疏漏或者错误，希望大家能够帮忙指正。"><title>三十分钟学会AWK - Aicode - 开源中国社区</title>
        
    <link rel="shortcut icon" type="image/x-icon" href="urn:not-loaded:https://my.oschina.net/img/favicon.ico?t=1451961935000">

                        <meta itemprop="name" content="三十分钟学会AWK - Aicode - 开源中国社区">
<meta itemprop="image" content="https://www.oschina.net/img/logo_s2.png">


            <link type="text/css" href="index_files/icon-svg.min.css" rel="stylesheet">
                    <link type="text/css" href="index_files/blog.min.css" rel="stylesheet">
            
            <script src="index_files/push.js"></script><script src="index_files/share.js"></script><script src="index_files/share-1.js"></script><link rel="stylesheet" href="index_files/share_style0_16.css"><link rel="stylesheet" type="text/css" href="index_files/zenburn.css"><link rel="stylesheet" type="text/css" href="index_files/zenburn-1.css"><link rel="stylesheet" type="text/css" href="index_files/jquery.atwho.css"><link rel="stylesheet" type="text/css" href="index_files/emoji.min.css"></head><body><val data-name="isMobileDevice" data-value="false"></val>
    
    <x-foo-define data-define="blog_detail"></x-foo-define>
    <val data-name="owner_id" data-value="170995"></val>
    <val data-name="owner_home_url" data-value="https://my.oschina.net/agiledev"></val>
    <val data-name="this_page" data-value="https%3A%2F%2Fmy.oschina.net%2Fagiledev%2Fblog%2F778891"></val>

            <val data-name="g_user_login" data-value="false"></val>
        <val data-name="goto_this_page" data-value="https://www.oschina.net/home/login?goto_page=https%3A%2F%2Fmy.oschina.net%2Fagiledev%2Fblog%2F778891"></val>
        <val data-name="is_owner" data-value="false"></val>
            <val data-name="blog_id" data-value="778891"></val>
                    

            <header class="header-navbar">
    </header><div class="layout-flex top-banner">
        <div class="flex-grow">
            <br>
</div>
        <div class="user-bar"><br>
</div>
    </div>
    <div>
                        


<val data-name="is_login" data-value="false"></val>
<val data-name="hljs_js_url" data-value="/dist/www/vendor/highlight/9.5.0/highlight.js?t=1475078300000"></val>
<val data-name="hljs_css_url" data-value="/build/www/vendor/highlight/9.4.0/styles/zenburn.css?t=1474299593000"></val>

<val data-name="atwho_js_url" data-value="/dist/www/vendor/jquery.atwho/jquery.atwho.js?t=1475078300000"></val>
<val data-name="atwho_css_url" data-value="/dist/www/vendor/jquery.atwho/jquery.atwho.css?t=1471280191000"></val>
<val data-name="user_follow_url" data-value="/action/user/follow"></val>
<val data-name="user_unfollow_url" data-value="/action/user/unfollow"></val>

<!-- content     -->
<div class="blog blog-article">
    <div class="">
        <!-- 侧边栏-目录 -->
                                <div class="blog-wrapper"><br>
</div>
                            <div class="blog-wrapper">
            <div class="back-list">
                <a href="https://my.oschina.net/agiledev/blog" class="font-green">管宜尧的博客</a> &gt; 详情
            </div>
        </div>

        <!-- 广告 -->
                <div class="blog-title-ad">
            <div class="blog-wrapper">
                
<!--<p style="margin:0 0 10px 0;"><a style="color:#A00;font-weight:bold;" href="http://www.oschina.net/events" target="_blank">盛夏7月，OSC源创会走进济南青岛~！ &gt;&gt;&gt;</a>&nbsp;&nbsp;<img src="http://my.oschina.net/img/hot3.png" align="absmiddle"></p>-->

<!--<a href="http://click.aliyun.com/m/6857/" target="_blank">
<img src="http://static.oschina.net/uploads/space/2016/1018/111014_CqGM_2702053.jpg" style="width:800px;"></a>-->

<div id="blog-title-ad" data-traceid="blog_ali" data-tracepid="blogup" style="display: none;"></div>
<script><!--

/* Script removed by snapshot save */

--></script>            </div>
        </div>
                <div class="float-heading">
            <div class="blog-wrapper">
                <div class="layout-flex">
                    <div class="flex-grow">
                        <div class="heading">三十分钟学会AWK</div>
                        <div class="data-info">
                            <a href="https://my.oschina.net/agiledev/home" class="link-blue" target="_blank">管宜尧</a>
                            发表于1天前
                        </div>
                    </div>
                    <div class="">
                        <div class="opr-btn">
                            <div class="opr-btn-blog btn-reward-blog">
                                <a href="javascript:void(0);" data-popupbox-model="reward">
                                    <i class="icon-svg icon-reward-blog"></i>
                                </a>
                            </div>
                            <!-- 点赞 -->
                            <div class="opr-btn-blog btn-like-blog">
                                                                <a href="javascript:void(0);" class="" onclick="">
                                    <i class="icon-svg icon-thumbs-o-up-blog"></i>
                                </a>
                            </div>
                                                            <!-- 收藏 -->
                                <div class="opr-btn-blog btn-favor-blog hover">
                                    <a href="javascript:void(0);" class="" data-blogid="778891" data-blogtype="3" data-userid="" data-thispage="https://my.oschina.net/agiledev/blog/778891">
                                        <i class="icon-svg icon-star-blog"></i>
                                     
                                    </a>
                                                                    </div>

                                                        <!-- 分享 -->
                            <div class="opr-btn-blog btn-share-blog hover">
                                <a href="javascript:void(0);" class="">
                                    <i class="icon-svg icon-share-o-blog"></i>
                                </a>
                                <div class="operate-dropdown share-dropdown">
                                    <span class="share-title">分享到：</span>
                                    <div class="bdsharebuttonbox bdshare-button-style0-16" data-bd-bind="1478053206294">
                                        <a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享">一键分享</a>
                                        <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间">QQ空间</a>
                                        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信">微信</a>
                                        <a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博">腾讯微博</a>
                                        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博">新浪微博</a>
                                        <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友">QQ好友</a>
                                        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记">有道云笔记</a>
                                    </div>
                                    <script><!--

/* Script removed by snapshot save */

--></script>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- 文章内容 -->
        <div class="blog-content">
            <!-- 标题 -->
            <div class="blog-heading">
                <div class="title">
                    <span class="status-tag original" title="原创博客">原</span>                    <span class="status-tag recommend" title="首页推荐过的博客">荐</span>                                                            三十分钟学会AWK
                </div>
                <div class="info-opr layout">
                    <div class="layout-right">
                                                    
                                                                <!-- 收藏 -->
                                <div class="opr-btn-blog btn-favor-blog favor hover">
                                    <a href="javascript:void(0);" class="btn btn-black-blog" data-blogid="778891" data-blogtype="3" data-userid="" data-thispage="https://my.oschina.net/agiledev/blog/778891">
                                        <i class="icon-svg icon-star-blog"></i>
                                     <span id="" class="operate_title">
                                                                                    收藏
                                                                             </span>
                                    </a>
                                                                    </div>
                                                                        </div>
                    <div class="layout-column">
                        <div class="user-info">
                                                                                                                <div class="name">
                                <a href="https://my.oschina.net/agiledev/home" target="_blank">管宜尧</a>
                            </div>
                        </div>
                        <div class="data-info text-gary">
                            <ul>
                                <li class="time">发表于 <span id="">1天前</span></li>
                                <li class="read">阅读 <span id="read">1690</span></li>
                                <li class="favor">收藏 <span id="">136</span></li>
                                <li class="vote">点赞 <span id="">9</span></li>
                                <li class="comment">
                                    <a href="#comment-list" data-href="#comment-list" class="link-blue">
                                        评论 <span id="comment">8</span>
                                    </a>
                                </li>
                                
                            </ul>
                        </div>
                    </div>
                        
                </div>
            </div>
            <!-- 摘要 -->
                            <div class="blog-abstract">
摘要: 本文大部分内容翻译自我开始学习AWK时看到的一篇英文文章 AWK Tutorial
，觉得对AWK入门非常有帮助，所以对其进行了粗略的翻译，并对其中部分内容进行了删减或者补充，希望能为对AWK感兴趣的小伙伴提供一份快速入门的教
程，帮助小伙伴们快速掌握AWK的基本使用方式，当然，我也是刚开始学习AWK，本文在翻译或者补充的过程中肯定会有很多疏漏或者错误，希望大家能够帮忙
指正。 </div>
                        <!-- 正文 -->
            <div class="blog-body" id="blogBody">
                                    <val data-name="blog_content_type" data-value="markdown"></val>
                                        <div class="loading-gif" id="blogContentLoading" style="display: none;"></div>
                    <textarea style="display: none;" class="noshow_content">本
文大部分内容翻译自我开始学习AWK时看到的一篇英文文章 [AWK
Tutorial](https://www.tutorialspoint.com/awk/index.htm)
，觉得对AWK入门非常有帮助，所以对其进行了粗略的翻译，并对其中部分内容进行了删减或者补充，希望能为对AWK感兴趣的小伙伴提供一份快速入门的教
程，帮助小伙伴们快速掌握AWK的基本使用方式，当然，我也是刚开始学习AWK，本文在翻译或者补充的过程中肯定会有很多疏漏或者错误，希望大家能够帮忙
指正。
本文将会持续修正和更新，最新内容请参考我的 [GITHUB](https://github.com/mylxsw) 上的
[程序猿成长计划](https://github.com/mylxsw/growing-up) 项目，欢迎 Star。
## 概述
AWK是一门解释型的编程语言。在文本处理领域它是非常强大的，它的名字来源于它的三位作者的姓氏：**Alfred Aho**， **Peter
Weinberger** 和 **Brian Kernighan**。
GNU/Linux发布的AWK目前由自由软件基金会（FSF）进行开发和维护，通常也称它为 **GNU AWK**。
### AWK的类型
下面是几个AWK的变体：
- **AWK** - 原先来源于 AT &amp; T 实验室的的AWK
- **NAWK** - AT &amp; T 实验室的AWK的升级版
- **GAWK** - 这就是GNU AWK。所有的GNU/Linux发布版都自带GAWK，它与AWK和NAWK完全兼容
### AWK的典型用途
使用AWK可以做很多任务，下面是其中一些
- 文本处理
- 输出格式化的文本报表
- 执行算数运算
- 执行字符串操作等等
## 工作流
要成为AWK编程专家，你需要先知道它的内部实现机制，AWK遵循了非常简单的工作流 -
**读取**，**执行**和**重复**，下图描述了AWK的工作流。
![](https://oayrssjpa.qnssl.com/2016-10-31-14774633531266.jpg)
**Read**
AWK从输入流（文件，管道或者标准输入）中读取一行，然后存储到内存中。
**Execute**
所有的AWK命令都依次在输入上执行。默认情况下，AWK会对每一行执行命令，我们可以通过提供模式限制这种行为。
**Repeat**
处理过程不断重复，直到到达文件结尾。
### 程序结构
现在，让我们先学习一下AWK的程序结构。
#### BEGIN 语句块
BEGIN语句块的语法 BEGIN {awk-commands}
BEGIN语句块在程序开始的使用执行，它只执行一次，在这里可以初始化变量。BEGIN是AWK的关键字，因此它必须为大写，注意，这个语句块是可选
的。
#### BODY 语句块
BODY语句块的语法 /pattern/ {awk-commands}
BODY语句块中的命令会对输入的每一行执行，我们也可以通过提供模式来控制这种行为。注意，BODY语句块没有关键字。
#### END 语句块
END语句块的语法 END {awk-commands}
END语句块在程序的最后执行，END是AWK的关键字，因此必须为大写，它也是可选的。
让我们创建一个包含序号，学生姓名，科目名称和得分的文件 *marks.txt*。 1) Amit Physics 80 2) Rahul
Maths 90 3) Shyam Biology 87 4) Kedar English 85 5) Hari History 89
下面的例子中我们将会显示文件内容，并且添加每一列的标题 $ awk 'BEGIN{printf "Sr
No\tName\tSub\tMarks\n"} {print}' marks.txt 上述代码执行后，输出以下内容 Sr No Name
Sub Marks 1) Amit Physics 80 2) Rahul Maths 90 3) Shyam Biology 87 4)
Kedar English 85 5) Hari History 89
在程序的开始，AWK在BEGIN语句中打印出标题。然后再BODY语句中，它会读取文件的每一行然后执行AWK的print命令将每一行的内容打印到标
准输出。这个过程会一直重复直到文件的结尾。
## 基础语法
AWK的使用非常简单，我们可以直接在命令行中执行AWK的命令，也可以从包含AWK命令的文本文件中执行。
### AWK命令行
我们可以使用单引号在命令行中指定AWK命令 awk [options] file ...
比如我们有一个包含下面内容的文本文件 *marks.txt*: 1) Amit Physics 80 2) Rahul Maths 90 3)
Shyam Biology 87 4) Kedar English 85 5) Hari History 89
我们可以使用下面的命令显示该文件的完整内容 $ awk '{print}' marks.txt ### AWK程序文件
我们可以使用脚本文件提供AWK命令 awk [options] -f file ....
首先，创建一个包含下面内容的文本文件 *command.awk* {print}
现在，我们可以让AWK执行该文件中的命令，这里我们实现了和上例同样的结果 $ awk -f command.awk marks.txt
### AWK标准选项
AWK支持下列命令行标准选项
#### `-v` 变量赋值选项
该选项将一个值赋予一个变量，它会在程序开始之前进行赋值，下面的例子描述了该选项的使用 $ awk -v name=Jerry
'BEGIN{printf "Name = %s\n", name}' Name = Jerry
#### `--dump-variables[=file]` 选项
该选项会输出排好序的全局变量列表和它们最终的值到文件中，默认的文件是 **awkvars.out**。 $ awk
--dump-variables '' $ cat awkvars.out ARGC: 1 ARGIND: 0 ARGV: array, 1
elements BINMODE: 0 CONVFMT: "%.6g" ERRNO: "" FIELDWIDTHS: "" FILENAME:
"" FNR: 0 FPAT: "[^[:space:]]+" FS: " " IGNORECASE: 0 LINT: 0 NF: 0 NR:
0 OFMT: "%.6g" OFS: " " ORS: "\n" RLENGTH: 0 RS: "\n" RSTART: 0 RT: ""
SUBSEP: "\034" TEXTDOMAIN: "messages"
#### `--help` 选项
打印帮助信息。 $ awk --help Usage: awk [POSIX or GNU style options] -f
progfile [--] file ... Usage: awk [POSIX or GNU style options] [--]
'program' file ... POSIX options : GNU long options: (standard) -f
progfile --file=progfile -F fs --field-separator=fs -v var=val
--assign=var=val Short options : GNU long options: (extensions) -b
--characters-as-bytes -c --traditional -C --copyright -d[file]
--dump-variables[=file] -e 'program-text' --source='program-text' -E
file --exec=file -g           --gen-pot
       -h                         --help
       -L [fatal]                 --lint[=fatal]
       -n                         --non-decimal-data
       -N                         --use-lc-numeric
       -O                         --optimize
       -p[file]                   --profile[=file]
       -P                         --posix
       -r                         --re-interval
       -S                         --sandbox
       -t                         --lint-old
       -V                         --version

#### `--lint[=fatal]` 选项

该选项允许检查程序的不兼容性或者模棱两可的代码，当提供参数 **fatal**的时候，它会对待Warning消息作为Error。

    $ awk --lint '' /bin/ls
    awk: cmd. line:1: warning: empty program text on command line
    awk: cmd. line:1: warning: source file does not end in newline
    awk: warning: no program text at all!

#### `--posix` 选项

该选项开启严格的POSIX兼容。

#### `--profile[=file]`选项

该选项会输出一份格式化之后的程序到文件中，默认文件是 *awkprof.out*。

    $ awk --profile 'BEGIN{printf"---|Header|--\n"} {print} 
    END{printf"---|Footer|---\n"}' marks.txt &gt; /dev/null 
    $ cat awkprof.out
    	# gawk 配置, 创建 Wed Oct 26 15:05:49 2016
    
    	# BEGIN 块
    
    	BEGIN {
    		printf "---|Header|--\n"
    	}
    
    	# 规则
    
    	{
    		print $0
    	}
    
    	# END 块
    
    	END {
    		printf "---|Footer|---\n"
    	}


#### `--traditional` 选项

该选项会禁止所有的gawk规范的扩展。

#### `--version` 选项

输出版本号

    $ awk --version
    GNU Awk 3.1.7
    版权所有 © 1989, 1991-2009 自由软件基金会(FSF)。
    
    该程序为自由软件，你可以在自由软件基金会发布的 GNU 通用公共许可证(GPL)第
    3版或以后版本下修改或重新发布。
    
    该程序之所以被发布是因为希望他能对你有所用处，但我们不作任何担保。这包含
    但不限于任何商业适售性以及针对特定目的的适用性的担保。详情参见 GNU 通用公
    共许可证(GPL)。
    
    你应该收到程序附带的一份 GNU 通用公共许可证(GPL)。如果没有收到，请参看 http://www.gnu.org/licenses/ 。
    You have new mail in /var/spool/mail/root

## 基本使用示例

本部分会讲述一些有用的AWK命令和它们的使用示例，所有的例子都是以下面的文本文件 *marks.txt* 为基础的

	1) Amit	Physics		80
	2) Rahul	Maths		90
	3) Shyam	Biology		87
	4) Kedar	English		85
	5) Hari	History		89

### 打印某列或者字段

AWK可以只打印输入字段中的某些列。

    $ awk '{print $3 "\t" $4}' marks.txt
    Physics	80
    Maths	90
    Biology	87
    English	85
    History	89

在文件*marks.txt*中，第三列包含了科目名，第四列则是得分，上面的例子中，我们只打印出了这两列，**$3** 和 **$4** 代表了输入记录中的第三和第四个字段。

### 打印所有的行

默认情况下，AWK会打印出所有匹配模式的行

    $ awk '/a/ {print $0}' marks.txt
    2)  Rahul   Maths    90
    3)  Shyam   Biology  87
    4)  Kedar   English  85
    5)  Hari    History  89

上述命令会判断每一行中是否包含`a`，如果包含则打印该行，如果BODY部分缺失则默认会执行打印，因此，上述命令和下面这个是等价的

    $ awk '/a/' marks.txt
    
### 打印匹配模式的列

当模式匹配成功时，默认情况下AWK会打印该行，但是也可以让它只打印指定的字段。例如，下面的例子中，只会打印出匹配模式的第三和第四个字段。

    $ awk '/a/ {print $3 "\t" $4}' marks.txt
    Maths	90
    Biology	87
    English	85
    History	89

### 任意顺序打印列

    $ awk '/a/ {print $4 "\t" $3}' marks.txt
    90	Maths
    87	Biology
    85	English
    89	History

### 统计匹配模式的行数

    $ awk '/a/{++cnt} END {print "Count = ", cnt}' marks.txt
    Count =  4

### 打印超过18个字符的行

	$ awk 'length($0) &gt; 18' marks.txt
	3) Shyam   Biology   87
	4) Kedar   English   85
    
## 内建变量

AWK提供了很多内置的变量，它们在开发AWK脚本的过程中起着非常重要的角色。

### 标准AWK变量

#### ARGC 命令行参数个数

命令行中提供的参数个数

    $ awk 'BEGIN {print "Arguments =", ARGC}' One Two Three Four
    Arguments = 5

#### ARGV 命令行参数数组

存储命令行参数的数组，索引范围从**0** - **ARGC - 1**。

    $ awk 'BEGIN { 
       for (i = 0; i &lt; ARGC - 1; ++i) { 
          printf "ARGV[%d] = %s\n", i, ARGV[i] 
       } 
    }' one two three four
    ARGV[0] = awk
    ARGV[1] = one
    ARGV[2] = two
    ARGV[3] = three

#### CONVFMT 数字的约定格式

代表了数字的约定格式，默认值是**%.6g**

    $ awk 'BEGIN { print "Conversion Format =", CONVFMT }'
    Conversion Format = %.6g

#### ENVIRON 环境变量

环境变量的关联数组

    $ awk 'BEGIN { print ENVIRON["USER"] }'
    mylxsw
    
#### FILENAME 当前文件名

    $ awk 'END {print FILENAME}' marks.txt
    marks.txt

#### FS 输入字段的分隔符

代表了输入字段的分隔符，默认值为**空格**，可以通过`-F`选项在命令行选项中修改它。

    $ awk 'BEGIN {print "FS = " FS}' | cat -vte
    FS =  $
    $ awk -F , 'BEGIN {print "FS = " FS}' | cat -vte
    FS = ,$

#### NF 字段数目

代表了当前行中的字段数目，例如下面例子打印出了包含大于两个字段的行

    $ echo -e "One Two\nOne Two Three\nOne Two Three Four" | awk 'NF &gt; 2'
    One Two Three
    One Two Three Four

#### NR 行号

    $ echo -e "One Two\nOne Two Three\nOne Two Three Four" | awk 'NR &lt; 3'
    One Two
    One Two Three

#### FNR 行号（相对当前文件）

与NR相似，不过在处理多文件时更有用，获取的行号相对于当前文件。

#### OFMT 输出格式数字

默认值为**%.6g**

    $ awk 'BEGIN {print "OFMT = " OFMT}'
    OFMT = %.6g
    
#### OFS 输出字段分隔符

输出字段分隔符，默认为空格

    $ awk 'BEGIN {print "OFS = " OFS}' | cat -vte
    OFS =  $

#### ORS 输出行分隔符

默认值为换行符

    $ awk 'BEGIN {print "ORS = " ORS}' | cat -vte
    ORS = $
    $

#### RLENGTH 

代表了 **match** 函数匹配的字符串长度。

    $ awk 'BEGIN { if (match("One Two Three", "re")) { print RLENGTH } }'
    2

#### RS 输入记录分隔符

    $ awk 'BEGIN {print "RS = " RS}' | cat -vte
    RS = $
    $

#### RSTART 

**match**函数匹配的第一次出现位置

    $ awk 'BEGIN { if (match("One Two Three", "Thre")) { print RSTART } }
    9

#### SUBSEP 数组子脚本的分隔符

数组子脚本的分隔符，默认为**\034**

    $ awk 'BEGIN { print "SUBSEP = " SUBSEP }' | cat -vte
    SUBSEP = ^\$

#### **$ 0** 代表了当前行

代表了当前行

    $ awk '{print $0}' marks.txt
    1) Amit     Physics   80
    2) Rahul    Maths     90
    3) Shyam    Biology   87
    4) Kedar    English   85
    5) Hari     History   89

#### $n

当前行中的第n个字段

    $ awk '{print $3 "\t" $4}' marks.txt
    Physics   80
    Maths     90
    Biology   87
    English   85
    History   89

### GNU AWK的变量

#### ARGIND

当前被处理的ARGV的索引

    $ awk '{ 
       print "ARGIND   = ", ARGIND; print "Filename = ", ARGV[ARGIND] 
    }' junk1 junk2 junk3
    ARGIND   =  1
    Filename =  junk1
    ARGIND   =  2
    Filename =  junk2
    ARGIND   =  3
    Filename =  junk3

#### BINMODE

在非POSIX系统上指定对所有的文件I/O采用二进制模式。

#### ERRORNO

一个代表了**getline**跳转失败或者是**close**调用失败的错误的字符串。

    $ awk 'BEGIN { ret = getline &lt; "junk.txt"; if (ret == -1) print "Error:", ERRNO }'
    Error: No such file or directory

#### FIELDWIDTHS

设置了空格分隔的字段宽度变量列表的话，GAWK会将输入解析为固定宽度的字段，而不是使用**FS**进行分隔。

#### IGNORECASE

设置了这个变量的话，AWK会忽略大小写。

    $ awk 'BEGIN{IGNORECASE = 1} /amit/' marks.txt
    1) Amit  Physics   80

#### LINT

提供了对**--lint**选项的动态控制。

    $ awk 'BEGIN {LINT = 1; a}'
    awk: cmd. line:1: warning: reference to uninitialized variable `a'
    awk: cmd. line:1: warning: statement has no effect
    
#### PROCINFO

包含进程信息的关联数组，例如UID，进程ID等

    $ awk 'BEGIN { print PROCINFO["pid"] }'
    4316

#### TEXTDOMAIN

代表了AWK的文本域，用于查找字符串的本地化翻译。

    $ awk 'BEGIN { print TEXTDOMAIN }'
    messages

## 操作符

与其它编程语言一样，AWK也提供了大量的操作符。

### 算数操作符

算数操作符不多说，直接看例子，无非就是**+-\*/%**
    
    $ awk 'BEGIN { a = 50; b = 20; print "(a + b) = ", (a + b) }'
    (a + b) =  70
    
    $ awk 'BEGIN { a = 50; b = 20; print "(a - b) = ", (a - b) }'
    (a - b) =  30
    
    $ awk 'BEGIN { a = 50; b = 20; print "(a * b) = ", (a * b) }'
    (a * b) =  1000
    
    $ awk 'BEGIN { a = 50; b = 20; print "(a / b) = ", (a / b) }'
    (a / b) =  2.5
    
    $ awk 'BEGIN { a = 50; b = 20; print "(a % b) = ", (a % b) }'
    (a % b) =  10

### 增减运算符

自增自减与C语言一致。

    $ awk 'BEGIN { a = 10; b = ++a; printf "a = %d, b = %d\n", a, b }'
    a = 11, b = 11
    
    $ awk 'BEGIN { a = 10; b = --a; printf "a = %d, b = %d\n", a, b }'
    a = 9, b = 9
    
    $ awk 'BEGIN { a = 10; b = a++; printf "a = %d, b = %d\n", a, b }'
    a = 11, b = 10
    
    $ awk 'BEGIN { a = 10; b = a--; printf "a = %d, b = %d\n", a, b }'
    a = 9, b = 10

### 赋值操作符

    $ awk 'BEGIN { name = "Jerry"; print "My name is", name }'
    My name is Jerry
    $ awk 'BEGIN { cnt = 10; cnt += 10; print "Counter =", cnt }'
    Counter = 20
    $ awk 'BEGIN { cnt = 100; cnt -= 10; print "Counter =", cnt }'
    Counter = 90
    $ awk 'BEGIN { cnt = 10; cnt *= 10; print "Counter =", cnt }'
    Counter = 100
    $ awk 'BEGIN { cnt = 100; cnt /= 5; print "Counter =", cnt }'
    Counter = 20
    $ awk 'BEGIN { cnt = 100; cnt %= 8; print "Counter =", cnt }'
    Counter = 4
    $ awk 'BEGIN { cnt = 2; cnt ^= 4; print "Counter =", cnt }'
    Counter = 16
    $ awk 'BEGIN { cnt = 2; cnt **= 4; print "Counter =", cnt }'
    Counter = 16


### 关系操作符

    $ awk 'BEGIN { a = 10; b = 10; if (a == b) print "a == b" }'
    a == b
    $ awk 'BEGIN { a = 10; b = 20; if (a != b) print "a != b" }'
    a != b
    $ awk 'BEGIN { a = 10; b = 20; if (a &lt; b) print "a  &lt; b" }'
    a  &lt; b
    $ awk 'BEGIN { a = 10; b = 10; if (a &lt;= b) print "a &lt;= b" }'
    a &lt;= b
    $ awk 'BEGIN { a = 10; b = 20; if (b &gt; a ) print "b &gt; a" }'
    b &gt; a

### 逻辑操作符

    $ awk 'BEGIN {
       num = 5; if (num &gt;= 0 &amp;&amp; num &lt;= 7) printf "%d is in octal format\n", num
    }'
    5 is in octal format
    $ awk 'BEGIN {
       ch = "\n"; if (ch == " " || ch == "\t" || ch == "\n")
       print "Current character is whitespace."
    }'
    Current character is whitespace.
    $ awk 'BEGIN { name = ""; if (! length(name)) print "name is empty string." }'
    name is empty string.

### 三元操作符

    $ awk 'BEGIN { a = 10; b = 20; (a &gt; b) ? max = a : max = b; print "Max =", max}'
    Max = 20

### 一元操作符

    $ awk 'BEGIN { a = -10; a = +a; print "a =", a }'
    a = -10
    $ awk 'BEGIN { a = -10; a = -a; print "a =", a }'
    a = 10

### 指数操作符

    $ awk 'BEGIN { a = 10; a = a ^ 2; print "a =", a }'
    a = 100
    
    $ awk 'BEGIN { a = 10; a ^= 2; print "a =", a }'
    a = 100

### 字符串连接操作符

    $ awk 'BEGIN { str1 = "Hello, "; str2 = "World"; str3 = str1 str2; print str3 }'
    Hello, World

### 数组成员操作符

    $ awk 'BEGIN { 
       arr[0] = 1; arr[1] = 2; arr[2] = 3; for (i in arr) printf "arr[%d] = %d\n", i, arr[i]
    }'
    arr[2] = 3
    arr[0] = 1
    arr[1] = 2

### 正则表达式操作符

正则表达式操作符使用 **~** 和 **!~** 分别代表匹配和不匹配。

    $ awk '$0 ~ 9' marks.txt
    2) Rahul   Maths    90
    5) Hari    History  89
    
    $ awk '$0 !~ 9' marks.txt
    1) Amit     Physics   80
    3) Shyam    Biology   87
    4) Kedar    English   85

    # 匹配正则表达式需要在表达式前后添加反斜线，与js类似吧
    $ tail -n 40 /var/log/nginx/access.log | awk '$0 ~ /ip\[127\.0\.0\.1\]/'

&gt; 更多关于正则表达式请看后面的正则表达式部分

## 正则表达式

AWK在处理正则表达式方面是非常强大的，使用简单的正则表达式可以处理非常复杂的问题。

    $ echo -e "cat\nbat\nfun\nfin\nfan" | awk '/f.n/'
    fun
    fin
    fan
    
    $ echo -e "This\nThat\nThere\nTheir\nthese" | awk '/^The/'
    There
    Their
    
    $ echo -e "knife\nknow\nfun\nfin\nfan\nnine" | awk '/n$/'
    fun
    fin
    fan
    
    $ echo -e "Call\nTall\nBall" | awk '/[CT]all/'
    Call
    Tall
    
    $ echo -e "Call\nTall\nBall" | awk '/[^CT]all/'
    Ball
    
    $ echo -e "Call\nTall\nBall\nSmall\nShall" | awk '/Call|Ball/'
    Call
    Ball
    
    $ echo -e "Colour\nColor" | awk '/Colou?r/'
    Colour
    Color
    
    $ echo -e "ca\ncat\ncatt" | awk '/cat*/'
    ca
    cat
    catt
    
    $ echo -e "111\n22\n123\n234\n456\n222"  | awk '/2+/'
    22
    123
    234
    222
    
    $ echo -e "Apple Juice\nApple Pie\nApple Tart\nApple Cake" | awk '/Apple (Juice|Cake)/'
    Apple Juice
    Apple Cake
    
## 数组

AWK支持关联数组，也就是说，不仅可以使用数字索引的数组，还可以使用字符串作为索引，而且数字索引也不要求是连续的。数组不需要声明可以直接使用，语法如下：

    array_name[index] = value

创建数组的方式非常简单，直接为变量赋值即可

    $ awk 'BEGIN {
       fruits["mango"] = "yellow";
       fruits["orange"] = "orange"
       print fruits["orange"] "\n" fruits["mango"]
    }'
    orange
    yellow
    
删除数组元素使用`delete`语句

    $ awk 'BEGIN {
       fruits["mango"] = "yellow";
       fruits["orange"] = "orange";
       delete fruits["orange"];
       print fruits["orange"]
    }'

在AWK中，只支持一维数组，但是可以通过一维数组模拟多维，例如我们有一个3x3的三维数组

    100   200   300
    400   500   600
    700   800   900

可以这样操作

    $ awk 'BEGIN {
       array["0,0"] = 100;
       array["0,1"] = 200;
       array["0,2"] = 300;
       array["1,0"] = 400;
       array["1,1"] = 500;
       array["1,2"] = 600;
    
       # print array elements
       print "array[0,0] = " array["0,0"];
       print "array[0,1] = " array["0,1"];
       print "array[0,2] = " array["0,2"];
       print "array[1,0] = " array["1,0"];
       print "array[1,1] = " array["1,1"];
       print "array[1,2] = " array["1,2"];
    }'
    array[0,0] = 100
    array[0,1] = 200
    array[0,2] = 300
    array[1,0] = 400
    array[1,1] = 500
    array[1,2] = 600

## 流程控制

流程控制语句与大多数语言一样，基本格式如下

    if (condition)
       action
       
    if (condition) {
       action-1
       action-1
       .
       .
       action-n
    }
    
    if (condition)
       action-1
   
else if (condition2) action-2 else action-3
例如： $ awk 'BEGIN { num = 11; if (num % 2 == 0) printf "%d is even
number.\n", num; else printf "%d is odd number.\n", num }' $ awk 'BEGIN
{ a = 30; if (a==10) print "a = 10"; else if (a == 20) print "a = 20";
else if (a == 30) print "a = 30"; }'
## 循环
循环操作与其他C系语言一样，主要包括 `for`，`whlie`，`do...while`，`break`，`continue`
语句，当然，还有一个 `exit`语句用于退出脚本执行。 for (initialisation; condition;
increment/decrement) action while (condition) action do action while
(condition) 例子： $ awk 'BEGIN { for (i = 1; i &lt;= 5; ++i) print i }' $
awk 'BEGIN {i = 1; while (i &lt; 6) { print i; ++i } }' $ awk 'BEGIN {i
= 1; do { print i; ++i } while (i &lt; 6) }' $ awk 'BEGIN { sum = 0;
for (i = 0; i &lt; 20; ++i) { sum += i; if (sum &gt; 50) break; else
print "Sum =", sum } }' $ awk 'BEGIN { for (i = 1; i &lt;= 20; ++i) {
if (i % 2 == 0) print i ; else continue } }' $ awk 'BEGIN { sum = 0;
for (i = 0; i &lt; 20; ++i) { sum += i; if (sum &gt; 50) exit(10); else
print "Sum =", sum } }' &gt; `exit`用于退出脚本，参数为退出的状态码，可以通过shell中的`$?`获取
## 函数
### 内建函数
AWK提供了很多方便的内建函数供编程人员使用。由于函数比较多，个人觉得单纯看每个函数的使用也没有什么实际意义，比较容易遗忘，因此，这里只简单的列
出常用的一些函数，只需要对其有个印象即可，使用的时候再去
[查手册](https://www.gnu.org/software/gawk/manual/gawk.html#Built_002din)
效果会更好一些吧。
#### 数学函数
- `atan2(y, x) ` - `cos(expr) ` - `exp(expr) ` - `int(expr) ` -
`log(expr) ` - `rand ` - `sin(expr) ` - `sqrt(expr) ` - `srand([expr])`
#### 字符串函数
- `asort(arr [, d [, how] ])` - `asorti(arr [, d [, how] ])` -
`gsub(regex, sub, string)` - `index(str, sub)` - `length(str)` -
`match(str, regex)` - `split(str, arr, regex)` - `sprintf(format,
expr-list)` - `strtonum(str)` - `sub(regex, sub, string)` -
`substr(str, start, l)` - `tolower(str)` - `toupper(str)`
#### 时间函数
- `systime ` - `mktime(datespec) ` - `strftime([format [, timestamp[,
utc-flag]]])` #### 字节操作函数
- `and` - `compl ` - `lshift ` - `rshift ` - `or ` - `xor` #### 其它
- `close(expr) ` 关闭管道文件 请看下面这段代码 $ awk 'BEGIN { cmd = "tr [a-z] [A-Z]"
print "hello, world !!!" |&amp; cmd close(cmd, "to") cmd |&amp; getline
out print out; close(cmd); }' HELLO, WORLD !!! 是不是感觉很难懂？让我来解释一下 *
第一个语句`cmd = "tr [a-z] [A-Z]"`是我们在AWK中要用来建立双向连接的命令。 *
第二个语句`print`提供了`tr`命令的输入，使用 **&amp;|** 表名建立双向连接。 * 第三个语句`close(cmd,
"to")`用于执行完成后关闭**to**进程 * 第四个语句`cmd |&amp; getline
out`使用`getline`函数存储输出到**out**变量 * 接下来打印变量out的内容，然后关闭cmd - `delete `
用于删除数组元素
- `exit ` 退出脚本执行，并返回状态码参数
- `fflush ` - `getline ` 该命令让awk读取下一行内容 该命令让awk读取下一行内容，比如 $ awk
'{getline; print $0}' marks.txt 2) Rahul Maths 90 4) Kedar English 85
5) Hari History 89 使用`getline var &lt; file`可以从file中读取输入，存储到变量var中 { if
(NF == 2 &amp;&amp; $1 == "@include") { while ((getline line &lt; $2)
&gt; 0) print line #
这里的close确保如果文件中两个[@include](https://my.oschina.net/JLXINAO)，可以让其读取两次
close($2) } else print } 命令的输出也可以通过管道输入到`getline`，使用`command |
getline`这种方式。在这种情况下，字符串命令会作为shell命令执行，其标准输出会通过管道传递个awk作为其输入，这种形式的getline
会从管道中一次读取一条记录。例如下面的命令会从输入中逐行读取，如果遇到`@execute`，则将该行作为命令执行，将命令的输出作为最终的输出内容
{ if ($1 == "@execute") { tmp = substr($0, 10) # Remove "@execute"
while ((tmp | getline) &gt; 0) # 这里实际上设置了$0为这一行的内容 print close(tmp) }
else print } 如果文件包含以下内容 foo bar baz
[@execute](https://my.oschina.net/u/1024735) who bletch 则会输出 foo bar baz arnold ttyv0 Jul 13 14:22 miriam ttyp0 Jul 13
14:23 (murphy:0) bill ttyp1 Jul 13 14:23 (murphy:0) bletch 使用`command |
getline var`可以实现将命令的输出写入到变量var。 BEGIN { "date" | getline current_time
close("date") print "Report printed on " current_time }
`getline`使用管道读取输入是一种单向的操作，在某些场景下，你可能希望发送数据到另一个进程，然后从这个进程中读取处理后的结果，
这就用到了协同进程，我们可以使用`|&amp;`打开一个双向管道。 print "some query" |&amp; "db_server"
"db_server" |&amp; getline 同样，我们也可以使用`command |&amp; getline
var`将协同进程的输出写入到变量var。
- `next ` - `nextfile ` - `return` 用于用户自定义函数的返回值。
首先，创建一个**functions.awk**文件，包含下面的awk命令 function addition(num1, num2) {
result = num1 + num2 return result } BEGIN { res = addition(10, 20)
print "10 + 20 = " res } 执行上述代码，输出 10 + 20 = 30
- `system` 该函数用于执行指定的命令并且返回它的退出状态，返回状态码0表示命令成功执行。 $ awk 'BEGIN { ret =
system("date"); print "Return value = " ret }' 2016年 10月 27日 星期四
22:08:36 CST Return value = 0
### 用户自定义函数
函数是程序基本的组成部分，AWK允许我们自己创建自定义的函数。一个大型的程序可以被划分为多个函数，每个函数之间可以独立的开发和测试，提供可重用的
代码。
下面是用户自定义函数的基本语法 function function_name(argument1, argument2, ...) {
function body }
例如，我们创建一个名为functions.awk的文件，包含下面的代码 # Returns minimum number function
find_min(num1, num2){ if (num1 &lt; num2) return num1 return num2 } #
Returns maximum number function find_max(num1, num2){ if (num1 &gt;
num2) return num1 return num2 } # Main function function main(num1,
num2){ # Find minimum number result = find_min(10, 20) print "Minimum
=", result # Find maximum number result = find_max(10, 20) print
"Maximum =", result } # Script execution starts here BEGIN { main(10,
20) }
执行上述代码，会得到下面的输出 Minimum = 10 Maximum = 20
## 输出重定向
### 重定向操作符
到目前为止，我们所有的程序都是直接显示数据到了标准输出流，其实，我们也可以将输出重定向到文件。重定向操作符跟在`print`和`printf`函
数的后面，与shell中的用法基本一致。 print DATA &gt; output-file print DATA &gt;&gt;
output-file
例如，下面两条命令输出是一致的 $ echo "Hello, World !!!" &gt; /tmp/message.txt $ awk
'BEGIN { print "Hello, World !!!" &gt; "/tmp/message.txt" }'
&gt; 与shell中一样，`&gt;`用于将输出写入到指定的文件中，如果文件中有内容则覆盖，而`&gt;&gt;`则为追加模式写入。 $
awk 'BEGIN { print "Hello, World !!!" &gt;&gt; "/tmp/message.txt" }' $
cat /tmp/message.txt
### 管道
除了将输出重定向到文件之外，我们还可以将输出重定向到其它程序，与shell中一样，我们可以使用管道操作符`|`。 $ awk 'BEGIN {
print "hello, world !!!" | "tr [a-z] [A-Z]" }' HELLO, WORLD !!!
AWK中可以使用`|&amp;`进行**双向连接**，那么什么是双向连接呢？一种常见的场景是我们发送数据到另一个程序处理，然后读取处理结果，这种
场景下就需要打开一个到另外一个进程的双向管道了。第二个进程会与**gawk**程序并行执行，这里称其为
**协作进程**。与单向连接使用`|`操作符不同的是，双向连接使用`|&amp;`操作符。 do { print data |&amp;
"subprogram" "subprogram" |&amp; getline results } while (data left to
process) close("subprogram")
第一次I/O操作使用了`|&amp;`操作符，gawk会创建一个到运行其它程序的子进程的双向管道，`print`的输出被写入到了
`subprogram`的标准输入，而这个`subprogram`的标准输出在gawk中使用`getline`函数进行读取。
&gt;
注意：目前协同进程的标准错误输出将会和gawk的标准错误输出混杂在一起，无法单独获取标准错误输出。另外，I/O缓冲可能存在问题，gawk程序会自
动的刷新所有输出到下游的协同进程的管道。但是，如果协同进程没有刷新其标准输出的话，gawk将可能会在使用`getline`函数从协同进程读取输出
的时候挂起，这就可能引起死锁。
我们可以使用`close`函数关闭双向管道的**to**或者**from**一端，这两个字符串值告诉gawk发送数据到协同进程完成时或者从协同进
程读取完毕时关闭管道。在使用系统命令`sort`的时候是这样做是非常必要的，因为它必须等所有输出都读取完毕时才能进行排序。 BEGIN {
command = "LC_ALL=C sort" n = split("abcdefghijklmnopqrstuvwxyz", a,
"") for (i = n; i &gt; 0; i--) print a[i] |&amp; command close(command,
"to") while ((command |&amp; getline line) &gt; 0) print "got", line
close(command) }
例如，下面的例子中使用`tr`命令转换小写为大写。我们的**command.awk**文件包含以下内容 BEGIN { cmd = "tr
[a-z] [A-Z]" print "hello, world !!!" |&amp; cmd close(cmd, "to") cmd
|&amp; getline out print out; close(cmd); }
输出 HELLO, WORLD !!!
上例看起来有些复杂，我们逐行分析一下
- 首先，第一行 **cmd = "tr [a-z] [A-Z]"** 是在AWK中要建立双向连接的命令
- 第二行的**print**命令用于为**tr**命令提供输入，而 `|&amp;` 用于指出要建立双向连接
- 第三行用于在上面的语句**close(cmd, "to"),**在执行完成后关闭其**to**进程
- 第四行 **cmd |&amp; getline out**使用getline函数存储输出到变量out中
- 最后一行使用**close**函数关闭命令
## 美化输出
到目前为止，我们已经使用过`print`和`printf`函数显示数据到标准输出，但是`printf`函数实际上要比我们之前使用的情况更加强大得
多。该函数是从C语言中借鉴来的，在处理格式化的输出时非常有用。 $ awk 'BEGIN { printf "Hello\nWorld\n"
}' Hello World $ awk 'BEGIN { printf "ASCII value 65 = character %c\n",
65 }' ASCII value 65 = character A &gt; 格式化输出标识有 `%c`， `%d`，`%s`
等，基本与C语言一致，这里就不多赘述了。
## 执行shell命令
在AWK中执行shell命令有两种方式
- 使用`system`函数
- 使用管道
### 使用system函数
**system**函数用于执行操作系统命令并且返回命令的退出码到awk。 END { system("date | mail -s 'awk
run done' root") }
### 使用管道
如果要执行的命令很多，可以将输出的命令直接用管道传递给**"/bin/sh"**执行 while (more stuff to do)
print command | "/bin/sh" close("/bin/sh")
## 参考
- [AWK Tutorial](https://www.tutorialspoint.com/awk/index.htm)
- [The GNU Awk User's
Guide](https://www.gnu.org/software/gawk/manual/gawk.html)
本文将会持续修正和更新，最新内容请参考我的 [GITHUB](https://github.com/mylxsw) 上的
[程序猿成长计划](https://github.com/mylxsw/growing-up) 项目，欢迎 Star。</textarea>
                    <div class="BlogContent"><p>本文大部分内容翻译自我开始学习AWK时看到的一篇英文文章 <a href="https://www.tutorialspoint.com/awk/index.htm">AWK Tutorial</a>
，觉得对AWK入门非常有帮助，所以对其进行了粗略的翻译，并对其中部分内容进行了删减或者补充，希望能为对AWK感兴趣的小伙伴提供一份快速入门的教
程，帮助小伙伴们快速掌握AWK的基本使用方式，当然，我也是刚开始学习AWK，本文在翻译或者补充的过程中肯定会有很多疏漏或者错误，希望大家能够帮忙
指正。</p>
<p>本文将会持续修正和更新，最新内容请参考我的 <a href="https://github.com/mylxsw">GITHUB</a> 上的 <a href="https://github.com/mylxsw/growing-up">程序猿成长计划</a> 项目，欢迎 Star。</p>
<h2 id="h2_0">概述</h2>
<p>AWK是一门解释型的编程语言。在文本处理领域它是非常强大的，它的名字来源于它的三位作者的姓氏：<strong>Alfred Aho</strong>， <strong>Peter Weinberger</strong> 和 <strong>Brian Kernighan</strong>。</p>
<p>GNU/Linux发布的AWK目前由自由软件基金会（FSF）进行开发和维护，通常也称它为 <strong>GNU AWK</strong>。</p>
<h3 id="h3_1">AWK的类型</h3>
<p>下面是几个AWK的变体：</p>
<ul>
<li><strong>AWK</strong> - 原先来源于 AT &amp; T 实验室的的AWK</li>
<li><strong>NAWK</strong> - AT &amp; T 实验室的AWK的升级版</li>
<li><strong>GAWK</strong> - 这就是GNU AWK。所有的GNU/Linux发布版都自带GAWK，它与AWK和NAWK完全兼容</li>
</ul>
<h3 id="h3_2">AWK的典型用途</h3>
<p>使用AWK可以做很多任务，下面是其中一些</p>
<ul>
<li>文本处理</li>
<li>输出格式化的文本报表</li>
<li>执行算数运算</li>
<li>执行字符串操作等等</li>
</ul>
<h2 id="h2_3">工作流</h2>
<p>要成为AWK编程专家，你需要先知道它的内部实现机制，AWK遵循了非常简单的工作流 - <strong>读取</strong>，<strong>执行</strong>和<strong>重复</strong>，下图描述了AWK的工作流。</p>
<p><img src="index_files/2016-10-31-14774633531266.jpg" alt=""></p>
<p><strong>Read</strong></p>
<p>AWK从输入流（文件，管道或者标准输入）中读取一行，然后存储到内存中。</p>
<p><strong>Execute</strong></p>
<p>所有的AWK命令都依次在输入上执行。默认情况下，AWK会对每一行执行命令，我们可以通过提供模式限制这种行为。</p>
<p><strong>Repeat</strong></p>
<p>处理过程不断重复，直到到达文件结尾。</p>
<h3 id="h3_4">程序结构</h3>
<p>现在，让我们先学习一下AWK的程序结构。</p>
<h4 id="h4_5">BEGIN 语句块</h4>
<p>BEGIN语句块的语法</p>
<pre class="hljs powershell"><code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span> {awk-commands}<br></code></pre><p>BEGIN语句块在程序开始的使用执行，它只执行一次，在这里可以初始化变量。BEGIN是AWK的关键字，因此它必须为大写，注意，这个语句块是可选的。</p>
<h4 id="h4_6">BODY 语句块</h4>
<p>BODY语句块的语法</p>
<pre class="hljs groovy"><code class="hljs groovy"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/pattern/</span></span></span></span> {awk-commands}<br></code></pre><p>BODY语句块中的命令会对输入的每一行执行，我们也可以通过提供模式来控制这种行为。注意，BODY语句块没有关键字。</p>
<h4 id="h4_7">END 语句块</h4>
<p>END语句块的语法</p>
<pre class="hljs powershell"><code class="hljs powershell"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">END</span></span></span></span> {awk-commands}<br></code></pre><p>END语句块在程序的最后执行，END是AWK的关键字，因此必须为大写，它也是可选的。</p>
<p>让我们创建一个包含序号，学生姓名，科目名称和得分的文件 <em>marks.txt</em>。</p>
<pre class="hljs"><code class="hljs">1)  Amit    Physics  80<br>2)  Rahul   Maths    90<br>3)  Shyam   Biology  87<br>4)  Kedar   English  85<br>5)  Hari    History  89<br></code></pre><p>下面的例子中我们将会显示文件内容，并且添加每一列的标题</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN{printf "Sr No\tName\tSub\tMarks\n"} {print}'</span></span></span></span> marks.txt<br></code></pre><p>上述代码执行后，输出以下内容</p>
<pre class="hljs nginx"><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute"><span class="hljs-attribute"><span class="hljs-attribute">Sr</span></span></span></span> No     Name     Sub          Marks<br> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>)       Amit     Physics      <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>)       Rahul    Maths        <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>)       Shyam    Biology      <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>)       Kedar    English      <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>)       Hari     History      <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><p>在程序的开始，AWK在BEGIN语句中打印出标题。然后再BODY语句中，它会读取文件的每一行然后执行AWK的print命令将每一行的内容打印到标准输出。这个过程会一直重复直到文件的结尾。</p>
<h2 id="h2_8">基础语法</h2>
<p>AWK的使用非常简单，我们可以直接在命令行中执行AWK的命令，也可以从包含AWK命令的文本文件中执行。</p>
<h3 id="h3_9">AWK命令行</h3>
<p>我们可以使用单引号在命令行中指定AWK命令</p>
<pre class="hljs gradle"><code class="hljs gradle">awk [<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">options</span></span></span></span>] <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">file</span></span></span></span> ...<br></code></pre><p>比如我们有一个包含下面内容的文本文件 <em>marks.txt</em>:</p>
<pre class="hljs"><code class="hljs">1) Amit     Physics    80<br>2) Rahul    Maths      90<br>3) Shyam    Biology    87<br>4) Kedar    English    85<br>5) Hari     History    89<br></code></pre><p>我们可以使用下面的命令显示该文件的完整内容</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'{print}'</span></span></span></span> marks.txt <br></code></pre><h3 id="h3_10">AWK程序文件</h3>
<p>我们可以使用脚本文件提供AWK命令</p>
<pre class="hljs gradle"><code class="hljs gradle">awk [<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">options</span></span></span></span>] -f <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">file</span></span></span></span> ....<br></code></pre><p>首先，创建一个包含下面内容的文本文件 <em>command.awk</em></p>
<pre class="hljs lua"><code class="hljs lua">{<span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span>} <br></code></pre><p>现在，我们可以让AWK执行该文件中的命令，这里我们实现了和上例同样的结果</p>
<pre class="hljs bash"><code class="hljs bash">$ awk <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-f</span></span></span></span> command.awk marks.txt<br></code></pre><h3 id="h3_11">AWK标准选项</h3>
<p>AWK支持下列命令行标准选项</p>
<h4 id="h4_12"><code>-v</code> 变量赋值选项</h4>
<p>该选项将一个值赋予一个变量，它会在程序开始之前进行赋值，下面的例子描述了该选项的使用</p>
<pre class="hljs sql"><code class="hljs sql">$ awk -v name=Jerry '<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span>{printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Name = %s\n"</span></span></span></span>, <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">name</span></span></span></span>}<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'<br>Name = Jerry<br></span></span></span></span></code></pre><h4 id="h4_13"><code>--dump-variables[=file]</code> 选项</h4>
<p>该选项会输出排好序的全局变量列表和它们最终的值到文件中，默认的文件是 <strong>awkvars.out</strong>。</p>
<pre class="hljs groovy"><code class="hljs groovy">$ awk --dump-variables <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">''</span></span></span></span>
$ cat awkvars.out 
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">ARGC:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">ARGIND:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">ARGV:</span></span></span></span> array, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span> elements<br><span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">BINMODE:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">CONVFMT:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"%.6g"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">ERRNO:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">FIELDWIDTHS:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">FILENAME:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">FNR:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">FPAT:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"[^[:space:]]+"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">FS:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">" "</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">IGNORECASE:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">LINT:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">NF:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">NR:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">OFMT:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"%.6g"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">OFS:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">" "</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">ORS:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\n"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">RLENGTH:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">RS:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\n"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">RSTART:</span></span></span></span> <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">RT:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">SUBSEP:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\034"</span></span></span></span>
<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">TEXTDOMAIN:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"messages"</span></span></span></span>
</code></pre><h4 id="h4_14"><code>--help</code> 选项</h4>
<p>打印帮助信息。</p>
<pre class="hljs haml"><code class="hljs haml">$ awk --help<br>Usage: awk [POSIX or GNU style options] -f progfile [--] file ...<br>Usage: awk [POSIX or GNU style options] [--] 'program' file ...<br>POSIX options : GNU long options: (standard)<br>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">f progfile                --file=progfile<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">F fs                      --field-separator=fs<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">v var=val                 --assign=var=val<br></span></span></span></span>Short options : GNU long options: (extensions)<br>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">b                         --characters-as-bytes<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">c                         --traditional<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">C                         --copyright<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">d[file]                   --dump-variables[=file]<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">e </span></span></span><span class="hljs-string"><span class="ruby"><span class="hljs-string"><span class="ruby"><span class="hljs-string"><span class="ruby"><span class="hljs-string">'program-text'</span></span></span></span></span></span></span><span class="ruby"><span class="ruby"><span class="ruby">          --source=</span></span></span><span class="hljs-string"><span class="ruby"><span class="hljs-string"><span class="ruby"><span class="hljs-string"><span class="ruby"><span class="hljs-string">'program-text'</span></span></span></span></span></span></span><span class="ruby"><span class="ruby"><span class="ruby">
</span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">E file                    --exec=file<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">g                         --gen-pot<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">h                         --help<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">L [fatal]                 --lint[=fatal]<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">n                         --non-decimal-data<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">N                         --use-lc-numeric<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">O                         --optimize<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">p[file]                   --profile[=file]<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">P                         --posix<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">r                         --re-interval<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">S                         --sandbox<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">t                         --lint-old<br></span></span></span></span>   -<span class="ruby"><span class="ruby"><span class="ruby"><span class="ruby">V                         --version<br></span></span></span></span></code></pre><h4 id="h4_15"><code>--lint[=fatal]</code> 选项</h4>
<p>该选项允许检查程序的不兼容性或者模棱两可的代码，当提供参数 <strong>fatal</strong>的时候，它会对待Warning消息作为Error。</p>
<pre class="hljs groovy"><code class="hljs groovy">$ awk --lint <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">''</span></span></span></span> <span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/bin/</span></span></span></span>ls<br><span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">awk:</span></span></span></span> cmd. <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">line:</span></span></span></span><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>: <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">warning:</span></span></span></span> empty program text on command line<br><span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">awk:</span></span></span></span> cmd. <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">line:</span></span></span></span><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>: <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">warning:</span></span></span></span> source file does not end <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">in</span></span></span></span> newline<br><span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">awk:</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">warning:</span></span></span></span> no program text at all!<br></code></pre><h4 id="h4_16"><code>--posix</code> 选项</h4>
<p>该选项开启严格的POSIX兼容。</p>
<h4 id="h4_17"><code>--profile[=file]</code>选项</h4>
<p>该选项会输出一份格式化之后的程序到文件中，默认文件是 <em>awkprof.out</em>。</p>
<pre class="hljs ruby"><code class="hljs ruby">$ awk --profile <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN{printf"---|Header|--\n"} {print} <br>END{printf"---|Footer|---\n"}'</span></span></span></span> marks.txt &gt; <span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/dev/null</span></span></span></span> <br>$ cat awkprof.out<br>    <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># gawk 配置, 创建 Wed Oct 26 15:05:49 2016</span></span></span></span>

    <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># BEGIN 块</span></span></span></span>

    <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span> {<br>        printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"---|Header|--\n"</span></span></span></span>
    }

    <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># 规则</span></span></span></span>

    {
        print $0
    }

    <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># END 块</span></span></span></span>

    <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">END</span></span></span></span> {<br>        printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"---|Footer|---\n"</span></span></span></span>
    }
</code></pre><h4 id="h4_18"><code>--traditional</code> 选项</h4>
<p>该选项会禁止所有的gawk规范的扩展。</p>
<h4 id="h4_19"><code>--version</code> 选项</h4>
<p>输出版本号</p>
<pre class="hljs groovy"><code class="hljs groovy">$ awk --version<br>GNU Awk <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3.1</span></span></span></span><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">.7</span></span></span></span>
版权所有 © <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1989</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1991</span></span></span></span><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-2009</span></span></span></span> 自由软件基金会(FSF)。<br><br>该程序为自由软件，你可以在自由软件基金会发布的 GNU 通用公共许可证(GPL)第<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>版或以后版本下修改或重新发布。<br><br>该程序之所以被发布是因为希望他能对你有所用处，但我们不作任何担保。这包含<br>但不限于任何商业适售性以及针对特定目的的适用性的担保。详情参见 GNU 通用公<br>共许可证(GPL)。<br><br>你应该收到程序附带的一份 GNU 通用公共许可证(GPL)。如果没有收到，请参看 <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">http:</span></span></span></span><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment">//www.gnu.org/licenses/ 。</span></span></span></span>
You have <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span></span></span> mail <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">in</span></span></span></span> <span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span></span></span>spool<span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/mail/</span></span></span></span>root<br></code></pre><h2 id="h2_20">基本使用示例</h2>
<p>本部分会讲述一些有用的AWK命令和它们的使用示例，所有的例子都是以下面的文本文件 <em>marks.txt</em> 为基础的</p>
<pre class="hljs"><code class="hljs">1) Amit    Physics        80<br>2) Rahul    Maths        90<br>3) Shyam    Biology        87<br>4) Kedar    English        85<br>5) Hari    History        89<br></code></pre><h3 id="h3_21">打印某列或者字段</h3>
<p>AWK可以只打印输入字段中的某些列。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'{print $3 "\t" $4}'</span></span></span></span> marks.txt<br>Physics    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
Maths    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
Biology    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
English    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
History    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><p>在文件<em>marks.txt</em>中，第三列包含了科目名，第四列则是得分，上面的例子中，我们只打印出了这两列，<strong>$3</strong> 和 <strong>$4</strong> 代表了输入记录中的第三和第四个字段。</p>
<h3 id="h3_22">打印所有的行</h3>
<p>默认情况下，AWK会打印出所有匹配模式的行</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/a/ {print $0}'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>)  Rahul   Maths    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>)  Shyam   Biology  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>)  Kedar   English  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>)  Hari    History  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><p>上述命令会判断每一行中是否包含<code>a</code>，如果包含则打印该行，如果BODY部分缺失则默认会执行打印，因此，上述命令和下面这个是等价的</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/a/'</span></span></span></span> marks.txt<br></code></pre><h3 id="h3_23">打印匹配模式的列</h3>
<p>当模式匹配成功时，默认情况下AWK会打印该行，但是也可以让它只打印指定的字段。例如，下面的例子中，只会打印出匹配模式的第三和第四个字段。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/a/ {print $3 "\t" $4}'</span></span></span></span> marks.txt<br>Maths    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
Biology    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
English    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
History    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><h3 id="h3_24">任意顺序打印列</h3>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/a/ {print $4 "\t" $3}'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>    Maths<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>    Biology<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>    English<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>    History<br></code></pre><h3 id="h3_25">统计匹配模式的行数</h3>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/a/{++cnt} END {print "Count = ", cnt}'</span></span></span></span> marks.txt<br>Count =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>
</code></pre><h3 id="h3_26">打印超过18个字符的行</h3>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'length($0) &gt; 18'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>) Shyam   Biology   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>) Kedar   English   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
</code></pre><h2 id="h2_27">内建变量</h2>
<p>AWK提供了很多内置的变量，它们在开发AWK脚本的过程中起着非常重要的角色。</p>
<h3 id="h3_28">标准AWK变量</h3>
<h4 id="h4_29">ARGC 命令行参数个数</h4>
<p>命令行中提供的参数个数</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "Arguments =", ARGC}'</span></span></span></span> One Two Three Four<br>Arguments = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>
</code></pre><h4 id="h4_30">ARGV 命令行参数数组</h4>
<p>存储命令行参数的数组，索引范围从<strong>0</strong> - <strong>ARGC - 1</strong>。</p>
<pre class="hljs xml"><code class="hljs xml">$ awk 'BEGIN { <br>   for (i = 0; i <span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">&lt; </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGC</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">-</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">; ++</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">) { <br>      </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">printf</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> "</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[%</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">d</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] = </span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">%s\n</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">", </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">, </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] <br>   } <br>}' </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">one</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">two</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">three</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag"> </span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">four</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">
</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] = </span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">awk</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">
</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">1</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] = </span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">one</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">
</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">2</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] = </span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">two</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">
</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ARGV</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">[</span></span></span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">3</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">] = </span></span></span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">three</span></span></span></span></span></span></span><span class="hljs-tag"><span class="hljs-tag"><span class="hljs-tag">
</span></span></span></span></code></pre><h4 id="h4_31">CONVFMT 数字的约定格式</h4>
<p>代表了数字的约定格式，默认值是<strong>%.6g</strong></p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print "Conversion Format =", CONVFMT }'</span></span></span></span>
Conversion Format = %.<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">6</span></span></span></span>g<br></code></pre><h4 id="h4_32">ENVIRON 环境变量</h4>
<p>环境变量的关联数组</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print ENVIRON["USER"] }'</span></span></span></span>
mylxsw
</code></pre><h4 id="h4_33">FILENAME 当前文件名</h4>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'END {print FILENAME}'</span></span></span></span> marks.txt<br>marks.txt<br></code></pre><h4 id="h4_34">FS 输入字段的分隔符</h4>
<p>代表了输入字段的分隔符，默认值为<strong>空格</strong>，可以通过<code>-F</code>选项在命令行选项中修改它。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "FS = " FS}'</span></span></span></span> | cat -vte<br>FS =  <span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk -F , <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "FS = " FS}'</span></span></span></span> | cat -vte<br>FS = ,<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span></code></pre><h4 id="h4_35">NF 字段数目</h4>
<p>代表了当前行中的字段数目，例如下面例子打印出了包含大于两个字段的行</p>
<pre class="hljs bash"><code class="hljs bash">$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"One Two\nOne Two Three\nOne Two Three Four"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'NF &gt; 2'</span></span></span></span>
One Two Three
One Two Three Four
</code></pre><h4 id="h4_36">NR 行号</h4>
<pre class="hljs bash"><code class="hljs bash">$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"One Two\nOne Two Three\nOne Two Three Four"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'NR &lt; 3'</span></span></span></span>
One Two
One Two Three
</code></pre><h4 id="h4_37">FNR 行号（相对当前文件）</h4>
<p>与NR相似，不过在处理多文件时更有用，获取的行号相对于当前文件。</p>
<h4 id="h4_38">OFMT 输出格式数字</h4>
<p>默认值为<strong>%.6g</strong></p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "OFMT = " OFMT}'</span></span></span></span>
OFMT = %.<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">6</span></span></span></span>g<br></code></pre><h4 id="h4_39">OFS 输出字段分隔符</h4>
<p>输出字段分隔符，默认为空格</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "OFS = " OFS}'</span></span></span></span> | cat -vte<br>OFS =  <span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span></code></pre><h4 id="h4_40">ORS 输出行分隔符</h4>
<p>默认值为换行符</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "ORS = " ORS}'</span></span></span></span> | cat -vte<br>ORS = <span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span></code></pre><h4 id="h4_41">RLENGTH</h4>
<p>代表了 <strong>match</strong> 函数匹配的字符串长度。</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span></span></span>(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"One Two Three"</span></span></span></span>, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"re"</span></span></span></span>)) { print <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">RLENGTH</span></span></span></span> } }'<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>
</code></pre><h4 id="h4_42">RS 输入记录分隔符</h4>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {print "RS = " RS}'</span></span></span></span> | cat -vte<br>RS = <span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span></code></pre><h4 id="h4_43">RSTART</h4>
<p><strong>match</strong>函数匹配的第一次出现位置</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">match</span></span></span></span>(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"One Two Three"</span></span></span></span>, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Thre"</span></span></span></span>)) { print <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">RSTART</span></span></span></span> } }<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">9</span></span></span></span>
</code></pre><h4 id="h4_44">SUBSEP 数组子脚本的分隔符</h4>
<p>数组子脚本的分隔符，默认为<strong>\034</strong></p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print "SUBSEP = " SUBSEP }'</span></span></span></span> | cat -vte<br>SUBSEP = ^\<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$<br></span></span></span></span></code></pre><h4 id="h4_45"><strong>$ 0</strong> 代表了当前行</h4>
<p>代表了当前行</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'{print $0}'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>) Amit     Physics   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>) Rahul    Maths     <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>) Shyam    Biology   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>) Kedar    English   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>) Hari     History   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><h4 id="h4_46">$n</h4>
<p>当前行中的第n个字段</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'{print $3 "\t" $4}'</span></span></span></span> marks.txt<br>Physics   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
Maths     <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
Biology   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
English   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
History   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><h3 id="h3_47">GNU AWK的变量</h3>
<h4 id="h4_48">ARGIND</h4>
<p>当前被处理的ARGV的索引</p>
<pre class="hljs makefile"><code class="hljs makefile">$ awk '{ <br>   print "ARGIND   = ", ARGIND; print "Filename = ", ARGV[ARGIND] <br>}' junk1 junk2 junk3<br>ARGIND   =  1<br>Filename =  junk1<br>ARGIND   =  2<br>Filename =  junk2<br>ARGIND   =  3<br>Filename =  junk3<br></code></pre><h4 id="h4_49">BINMODE</h4>
<p>在非POSIX系统上指定对所有的文件I/O采用二进制模式。</p>
<h4 id="h4_50">ERRORNO</h4>
<p>一个代表了<strong>getline</strong>跳转失败或者是<strong>close</strong>调用失败的错误的字符串。</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { ret = getline &lt; <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"junk.txt"</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (ret == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-1</span></span></span></span>) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Error:"</span></span></span></span>, <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">ERRNO</span></span></span></span> }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Error</span></span></span></span>: <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">No</span></span></span></span> such file or directory<br></code></pre><h4 id="h4_51">FIELDWIDTHS</h4>
<p>设置了空格分隔的字段宽度变量列表的话，GAWK会将输入解析为固定宽度的字段，而不是使用<strong>FS</strong>进行分隔。</p>
<h4 id="h4_52">IGNORECASE</h4>
<p>设置了这个变量的话，AWK会忽略大小写。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN{IGNORECASE = 1} /amit/'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>) Amit  Physics   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
</code></pre><h4 id="h4_53">LINT</h4>
<p>提供了对<strong>--lint</strong>选项的动态控制。</p>
<pre class="hljs r"><code class="hljs r">$ awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN {LINT = 1; a}'</span></span></span></span>
awk: cmd. line:<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>: <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">warning</span></span></span></span>: reference to uninitialized variable `a'<br>awk: cmd. line:1: warning: statement has no effect<br></code></pre><h4 id="h4_54">PROCINFO</h4>
<p>包含进程信息的关联数组，例如UID，进程ID等</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print PROCINFO["pid"] }'</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4316</span></span></span></span>
</code></pre><h4 id="h4_55">TEXTDOMAIN</h4>
<p>代表了AWK的文本域，用于查找字符串的本地化翻译。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print TEXTDOMAIN }'</span></span></span></span>
messages
</code></pre><h2 id="h2_56">操作符</h2>
<p>与其它编程语言一样，AWK也提供了大量的操作符。</p>
<h3 id="h3_57">算数操作符</h3>
<p>算数操作符不多说，直接看例子，无非就是<strong>+-*/%</strong></p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 50; b = 20; print "(a + b) = ", (a + b) }'</span></span></span></span>
(a + b) =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">70</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 50; b = 20; print "(a - b) = ", (a - b) }'</span></span></span></span>
(a - b) =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">30</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 50; b = 20; print "(a * b) = ", (a * b) }'</span></span></span></span>
(a * b) =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1000</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 50; b = 20; print "(a / b) = ", (a / b) }'</span></span></span></span>
(a / b) =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2.5</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 50; b = 20; print "(a % b) = ", (a % b) }'</span></span></span></span>
(a % b) =  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>
</code></pre><h3 id="h3_58">增减运算符</h3>
<p>自增自减与C语言一致。</p>
<pre class="hljs haskell"><code class="hljs haskell">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = ++a; printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a = %d, b = %d\n"</span></span></span></span>, a, b }'<br><span class="hljs-title"><span class="hljs-title"><span class="hljs-title"><span class="hljs-title">a</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">11</span></span></span></span>, b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">11</span></span></span></span>

$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment">--a; printf "a = %d, b = %d\n", a, b }'</span></span></span></span>
<span class="hljs-title"><span class="hljs-title"><span class="hljs-title"><span class="hljs-title">a</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">9</span></span></span></span>, b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">9</span></span></span></span>

$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = a++; printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a = %d, b = %d\n"</span></span></span></span>, a, b }'<br><span class="hljs-title"><span class="hljs-title"><span class="hljs-title"><span class="hljs-title">a</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">11</span></span></span></span>, b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>

$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = a<span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment">--; printf "a = %d, b = %d\n", a, b }'</span></span></span></span>
<span class="hljs-title"><span class="hljs-title"><span class="hljs-title"><span class="hljs-title">a</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">9</span></span></span></span>, b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>
</code></pre><h3 id="h3_59">赋值操作符</h3>
<pre class="hljs swift"><code class="hljs swift">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { name = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Jerry"</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"My name is"</span></span></span></span>, name }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">My</span></span></span></span> name <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">is</span></span></span></span> <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Jerry</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; cnt += <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>; cnt -= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; cnt *= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>; cnt /= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>; cnt %= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">8</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>; cnt ^= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">16</span></span></span></span>
$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { cnt = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>; cnt **= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Counter ="</span></span></span></span>, cnt }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Counter</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">16</span></span></span></span>
</code></pre><h3 id="h3_60">关系操作符</h3>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a == b) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a == b"</span></span></span></span> }'<br>a == b<br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a != b) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a != b"</span></span></span></span> }'<br>a != b<br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a &lt; b) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a  &lt; b"</span></span></span></span> }'<br>a  &lt; b<br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a &lt;= b) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a &lt;= b"</span></span></span></span> }'<br>a &lt;= b<br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (b &gt; a ) print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"b &gt; a"</span></span></span></span> }'<br>b &gt; a<br></code></pre><h3 id="h3_61">逻辑操作符</h3>
<pre class="hljs swift"><code class="hljs swift">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>   num = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (num &gt;= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span> &amp;&amp; num &lt;= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">7</span></span></span></span>) printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"%d is in octal format\n"</span></span></span></span>, num<br>}'<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">is</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">in</span></span></span></span> octal format<br>$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>   ch = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\n"</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (ch == <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">" "</span></span></span></span> || ch == <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\t"</span></span></span></span> || ch == <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\n"</span></span></span></span>)<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Current character is whitespace."</span></span></span></span>
}'
<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Current</span></span></span></span> character <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">is</span></span></span></span> whitespace.<br>$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { name = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (! length(name)) <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"name is empty string."</span></span></span></span> }'<br>name <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">is</span></span></span></span> empty string.<br></code></pre><h3 id="h3_62">三元操作符</h3>
<pre class="hljs swift"><code class="hljs swift">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> { a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>; b = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; (a &gt; b) ? <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">max</span></span></span></span> = a : <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">max</span></span></span></span> = b; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Max ="</span></span></span></span>, <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">max</span></span></span></span>}'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Max</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>
</code></pre><h3 id="h3_63">一元操作符</h3>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = -10; a = +a; print "a =", a }'</span></span></span></span>
a = -<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>
<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = -10; a = -a; print "a =", a }'</span></span></span></span>
a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>
</code></pre><h3 id="h3_64">指数操作符</h3>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 10; a = a ^ 2; print "a =", a }'</span></span></span></span>
a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { a = 10; a ^= 2; print "a =", a }'</span></span></span></span>
a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>
</code></pre><h3 id="h3_65">字符串连接操作符</h3>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { str1 = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Hello, "</span></span></span></span>; str2 = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"World"</span></span></span></span>; str3 = str1 str2; print str3 }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Hello</span></span></span></span>, <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">World</span></span></span></span>
</code></pre><h3 id="h3_66">数组成员操作符</h3>
<pre class="hljs rust"><code class="hljs rust">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { <br>   arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>; arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>; arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">in</span></span></span></span> arr) printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"arr[%d] = %d\n"</span></span></span></span>, i, arr[i]<br>}'<br>arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>
arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>
arr[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>
</code></pre><h3 id="h3_67">正则表达式操作符</h3>
<p>正则表达式操作符使用 <strong>~</strong> 和 <strong>!~</strong> 分别代表匹配和不匹配。</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'$0 ~ 9'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>) Rahul   Maths    <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>) Hari    History  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>

<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'$0 !~ 9'</span></span></span></span> marks.txt<br><span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>) Amit     Physics   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">80</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">3</span></span></span></span>) Shyam    Biology   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">87</span></span></span></span>
<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>) Kedar    English   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>

<span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># 匹配正则表达式需要在表达式前后添加反斜线，与js类似吧</span></span></span></span>
<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>tail -n <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">40</span></span></span></span> /var/log/nginx/access.log | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'$0 ~ /ip\[127\.0\.0\.1\]/'</span></span></span></span>
</code></pre><blockquote>
<p>更多关于正则表达式请看后面的正则表达式部分</p>
</blockquote>
<h2 id="h2_68">正则表达式</h2>
<p>AWK在处理正则表达式方面是非常强大的，使用简单的正则表达式可以处理非常复杂的问题。</p>
<pre class="hljs bash"><code class="hljs bash">$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"cat\nbat\nfun\nfin\nfan"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/f.n/'</span></span></span></span>
fun
fin
fan

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"This\nThat\nThere\nTheir\nthese"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/^The/'</span></span></span></span>
There
Their

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"knife\nknow\nfun\nfin\nfan\nnine"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/n$/'</span></span></span></span>
fun
fin
fan

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Call\nTall\nBall"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/[CT]all/'</span></span></span></span>
Call
Tall

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Call\nTall\nBall"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/[^CT]all/'</span></span></span></span>
Ball

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Call\nTall\nBall\nSmall\nShall"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/Call|Ball/'</span></span></span></span>
Call
Ball

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Colour\nColor"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/Colou?r/'</span></span></span></span>
Colour
Color

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"ca\ncat\ncatt"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/cat*/'</span></span></span></span>
ca
cat
catt

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"111\n22\n123\n234\n456\n222"</span></span></span></span>  | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/2+/'</span></span></span></span>
22
123
234
222

$ <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span></span></span> <span class="hljs-_"><span class="hljs-_"><span class="hljs-_"><span class="hljs-_">-e</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Apple Juice\nApple Pie\nApple Tart\nApple Cake"</span></span></span></span> | awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'/Apple (Juice|Cake)/'</span></span></span></span>
Apple Juice
Apple Cake
</code></pre><h2 id="h2_69">数组</h2>
<p>AWK支持关联数组，也就是说，不仅可以使用数字索引的数组，还可以使用字符串作为索引，而且数字索引也不要求是连续的。数组不需要声明可以直接使用，语法如下：</p>
<pre class="hljs ini"><code class="hljs ini"><span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr">array_name[index]</span></span></span></span> = value<br></code></pre><p>创建数组的方式非常简单，直接为变量赋值即可</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {<br>   fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"mango"</span></span></span></span>] = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"yellow"</span></span></span></span>;<br>   fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>] = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>
   print fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>] <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"\n"</span></span></span></span> fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"mango"</span></span></span></span>]<br>}'<br>orange<br>yellow<br></code></pre><p>删除数组元素使用<code>delete</code>语句</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {<br>   fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"mango"</span></span></span></span>] = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"yellow"</span></span></span></span>;<br>   fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>] = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>;<br>   delete fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>];<br>   print fruits[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"orange"</span></span></span></span>]<br>}'<br></code></pre><p>在AWK中，只支持一维数组，但是可以通过一维数组模拟多维，例如我们有一个3x3的三维数组</p>
<pre class="hljs"><code class="hljs">100   200   300<br>400   500   600<br>700   800   900<br></code></pre><p>可以这样操作</p>
<pre class="hljs swift"><code class="hljs swift">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,0"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>;<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,1"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">200</span></span></span></span>;<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,2"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">300</span></span></span></span>;<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,0"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">400</span></span></span></span>;<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,1"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">500</span></span></span></span>;<br>   array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,2"</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">600</span></span></span></span>;<br><br>   # <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> array elements<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[0,0] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,0"</span></span></span></span>];<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[0,1] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,1"</span></span></span></span>];<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[0,2] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"0,2"</span></span></span></span>];<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[1,0] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,0"</span></span></span></span>];<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[1,1] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,1"</span></span></span></span>];<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"array[1,2] = "</span></span></span></span> array[<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"1,2"</span></span></span></span>];<br>}'<br>array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">100</span></span></span></span>
array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">200</span></span></span></span>
array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">300</span></span></span></span>
array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">400</span></span></span></span>
array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">500</span></span></span></span>
array[<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>,<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>] = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">600</span></span></span></span>
</code></pre><h2 id="h2_70">流程控制</h2>
<p>流程控制语句与大多数语言一样，基本格式如下</p>
<pre class="hljs lua"><code class="hljs lua"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (condition)<br>   action<br><br><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (condition) {<br>   action<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-1</span></span></span></span>
   action<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-1</span></span></span></span>
   .
   .
   action-n
}

<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (condition)<br>   action<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-1</span></span></span></span>
<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (condition2)<br>   action<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-2</span></span></span></span>
<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span>
   action<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">-3</span></span></span></span>
</code></pre><p>例如：</p>
<pre class="hljs swift"><code class="hljs swift">$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>   num = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">11</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (num % <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span> == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>) printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"%d is even number.\n"</span></span></span></span>, num; <br>      <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"%d is odd number.\n"</span></span></span></span>, num <br>}'<br><br>$ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>   a = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">30</span></span></span></span>;<br><br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a==<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>)<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a = 10"</span></span></span></span>;<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>)<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a = 20"</span></span></span></span>;<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (a == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">30</span></span></span></span>)<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"a = 30"</span></span></span></span>;<br>}'<br></code></pre><h2 id="h2_71">循环</h2>
<p>循环操作与其他C系语言一样，主要包括 <code>for</code>，<code>whlie</code>，<code>do...while</code>，<code>break</code>，<code>continue</code> 语句，当然，还有一个 <code>exit</code>语句用于退出脚本执行。</p>
<pre class="hljs lisp"><code class="hljs lisp">for (<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">initialisation</span></span></span></span><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment">; condition; increment/decrement)</span></span></span></span>
   action

while (<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">condition</span></span></span></span>)<br>   action<br><br>do<br>   action<br>while (<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">condition</span></span></span></span>)<br></code></pre><p>例子：</p>
<pre class="hljs rust"><code class="hljs rust">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>; ++i) print i }'<br><br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> (i &lt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">6</span></span></span></span>) { print i; ++i } }'<br><br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></span></span> { print i; ++i } <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> (i &lt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">6</span></span></span></span>) }'<br><br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {<br>   sum = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>; i &lt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; ++i) { <br>      sum += i; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (sum &gt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">50</span></span></span></span>) <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">break</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Sum ="</span></span></span></span>, sum <br>   } <br>}'<br><br>$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; ++i) {<br>      <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (i % <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span> == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>) print i ; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">continue</span></span></span></span>
   } 
}'

$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> {<br>   sum = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>; i &lt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>; ++i) {<br>      sum += i; <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (sum &gt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">50</span></span></span></span>) exit(<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>); <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span> print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Sum ="</span></span></span></span>, sum <br>   } <br>}'<br></code></pre><blockquote>
<p><code>exit</code>用于退出脚本，参数为退出的状态码，可以通过shell中的<code>$?</code>获取</p>
</blockquote>
<h2 id="h2_72">函数</h2>
<h3 id="h3_73">内建函数</h3>
<p>AWK提供了很多方便的内建函数供编程人员使用。由于函数比较多，个人觉得单纯看每个函数的使用也没有什么实际意义，比较容易遗忘，因此，这里只简单的列出常用的一些函数，只需要对其有个印象即可，使用的时候再去 <a href="https://www.gnu.org/software/gawk/manual/gawk.html#Built_002din">查手册</a> 效果会更好一些吧。</p>
<h4 id="h4_74">数学函数</h4>
<ul>
<li><code>atan2(y, x)</code> </li>
<li><code>cos(expr)</code> </li>
<li><code>exp(expr)</code> </li>
<li><code>int(expr)</code> </li>
<li><code>log(expr)</code> </li>
<li><code>rand</code> </li>
<li><code>sin(expr)</code> </li>
<li><code>sqrt(expr)</code> </li>
<li><code>srand([expr])</code> </li>
</ul>
<h4 id="h4_75">字符串函数</h4>
<ul>
<li><code>asort(arr [, d [, how] ])</code> </li>
<li><code>asorti(arr [, d [, how] ])</code> </li>
<li><code>gsub(regex, sub, string)</code> </li>
<li><code>index(str, sub)</code> </li>
<li><code>length(str)</code> </li>
<li><code>match(str, regex)</code> </li>
<li><code>split(str, arr, regex)</code> </li>
<li><code>sprintf(format, expr-list)</code> </li>
<li><code>strtonum(str)</code> </li>
<li><code>sub(regex, sub, string)</code> </li>
<li><code>substr(str, start, l)</code> </li>
<li><code>tolower(str)</code> </li>
<li><code>toupper(str)</code></li>
</ul>
<h4 id="h4_76">时间函数</h4>
<ul>
<li><code>systime</code> </li>
<li><code>mktime(datespec)</code> </li>
<li><code>strftime([format [, timestamp[, utc-flag]]])</code> </li>
</ul>
<h4 id="h4_77">字节操作函数</h4>
<ul>
<li><code>and</code> </li>
<li><code>compl</code> </li>
<li><code>lshift</code> </li>
<li><code>rshift</code> </li>
<li><code>or</code> </li>
<li><code>xor</code> </li>
</ul>
<h4 id="h4_78">其它</h4>
<ul>
<li><p><code>close(expr)</code> 关闭管道文件</p>
<p>  请看下面这段代码</p>
<pre class="hljs swift"><code class="hljs swift">  $ awk '<span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">BEGIN</span></span></span></span> {<br>     cmd = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"tr [a-z] [A-Z]"</span></span></span></span>
     <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"hello, world !!!"</span></span></span></span> |&amp; cmd<br><br>     close(cmd, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"to"</span></span></span></span>)<br>     cmd |&amp; getline out<br>     <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> out;<br><br>     close(cmd);<br>  }'<br>  <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">HELLO</span></span></span></span>, <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">WORLD</span></span></span></span> !!!<br></code></pre><p>  是不是感觉很难懂？让我来解释一下</p>
<ul>
<li>第一个语句<code>cmd = "tr [a-z] [A-Z]"</code>是我们在AWK中要用来建立双向连接的命令。</li>
<li>第二个语句<code>print</code>提供了<code>tr</code>命令的输入，使用 <strong>&amp;|</strong> 表名建立双向连接。</li>
<li>第三个语句<code>close(cmd, "to")</code>用于执行完成后关闭<strong>to</strong>进程</li>
<li>第四个语句<code>cmd |&amp; getline out</code>使用<code>getline</code>函数存储输出到<strong>out</strong>变量</li>
<li>接下来打印变量out的内容，然后关闭cmd</li>
</ul>
</li>
</ul>
<ul>
<li><code>delete</code>  用于删除数组元素</li>
<li><code>exit</code>  退出脚本执行，并返回状态码参数</li>
<li><code>fflush</code>  </li>
<li><p><code>getline</code> 该命令让awk读取下一行内容</p>
<p>  该命令让awk读取下一行内容，比如</p>
<pre class="hljs elixir"><code class="hljs elixir">  <span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'{getline; print $0}'</span></span></span></span> marks.txt<br>  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>) Rahul   Maths     <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">90</span></span></span></span>
  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">4</span></span></span></span>) Kedar   English   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">85</span></span></span></span>
  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">5</span></span></span></span>) Hari    History   <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">89</span></span></span></span>
</code></pre><p>  使用<code>getline var &lt; file</code>可以从file中读取输入，存储到变量var中</p>
<pre class="hljs clojure"><code class="hljs clojure">  {<br>       if (<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">NF</span></span></span></span> == <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span> &amp;&amp; $<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">1</span></span></span></span> == <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"@include"</span></span></span></span>) {<br>            while ((<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">getline</span></span></span></span> line &lt; $<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>) &gt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>)<br>                 print line<br>            # 这里的close确保如果文件中两个[@include](<span class="hljs-name"><span class="hljs-name"><span class="hljs-name"><span class="hljs-name">https://my.oschina.net/JLXINAO</span></span></span></span>)，可以让其读取两次<br>            close($<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2</span></span></span></span>)<br>       } else<br>            print<br>  }<br></code></pre><p>  命令的输出也可以通过管道输入到<code>getline</code>，使用<code>command | getline</code>这种方式。在这种情况下，字符串命令会作为shell命令执行，其标准输出会通过管道传递个awk作为其输入，这种形式的getline会从管道中一次读取一条记录。例如下面的命令会从输入中逐行读取，如果遇到<code>@execute</code>，则将该行作为命令执行，将命令的输出作为最终的输出内容</p>
<pre class="hljs perl"><code class="hljs perl">  {<br>       <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> ($1 == <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"@execute"</span></span></span></span>) {<br>            tmp = <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">substr</span></span></span></span>($0, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>)        <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Remove "@execute"</span></span></span></span>
            <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> ((tmp | getline) &gt; <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>)<br>                 <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># 这里实际上设置了$0为这一行的内容</span></span></span></span>
                 <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span>
            <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">close</span></span></span></span>(tmp)<br>       } <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span></span></span>
            <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span>
  }
</code></pre><p>  如果文件包含以下内容</p>
<pre class="hljs markdown"><code class="hljs markdown">  foo<br>  bar<br>  baz<br>  [<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">@execute</span></span></span></span>](<span class="hljs-link"><span class="hljs-link"><span class="hljs-link"><span class="hljs-link">https://my.oschina.net/u/1024735</span></span></span></span>) who<br>  bletch<br></code></pre><p>  则会输出</p>
<pre class="hljs css"><code class="hljs css">  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">foo</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bar</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">baz</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">arnold</span></span></span></span>     <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ttyv0</span></span></span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Jul</span></span></span></span> 13 14<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:22</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">miriam</span></span></span></span>     <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ttyp0</span></span></span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Jul</span></span></span></span> 13 14<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span></span></span>     (<span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">murphy</span></span></span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0)</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bill</span></span></span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">ttyp1</span></span></span></span>   <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Jul</span></span></span></span> 13 14<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:23</span></span></span></span>     (<span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">murphy</span></span></span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0)</span></span></span></span>
  <span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bletch</span></span></span></span>
</code></pre><p>  使用<code>command | getline var</code>可以实现将命令的输出写入到变量var。</p>
<pre class="hljs sql"><code class="hljs sql">  <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span> {<br>       <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"date"</span></span></span></span> | getline <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">current_time</span></span></span></span>
       <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">close</span></span></span></span>(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"date"</span></span></span></span>)<br>       print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Report printed on "</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">current_time</span></span></span></span>
  }
</code></pre><p>  <code>getline</code>使用管道读取输入是一种单向的操作，在某些场景下，你可能希望发送数据到另一个进程，然后从这个进程中读取处理后的结果，  这就用到了协同进程，我们可以使用<code>|&amp;</code>打开一个双向管道。</p>
<pre class="hljs lua"><code class="hljs lua">  <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"some query"</span></span></span></span> |&amp; <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"db_server"</span></span></span></span>
  <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"db_server"</span></span></span></span> |&amp; getline<br></code></pre><p>  同样，我们也可以使用<code>command |&amp; getline var</code>将协同进程的输出写入到变量var。</p>
</li>
<li><p><code>next</code> </p>
</li>
<li><code>nextfile</code> </li>
<li><p><code>return</code> </p>
<p>  用于用户自定义函数的返回值。
  首先，创建一个<strong>functions.awk</strong>文件，包含下面的awk命令</p>
<pre class="hljs lua"><code class="hljs lua">  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-function"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addition</span></span></span></span></span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num1, num2)</span></span></span></span></span></span></span></span> {<br>     result = num1 + num2<br>     <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span></span></span> result<br>  }<br>  BEGIN {<br>     res = addition(<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>)<br>     <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"10 + 20 = "</span></span></span></span> res<br>  }<br></code></pre><p>  执行上述代码，输出</p>
<pre class="hljs"><code class="hljs">  10 + 20 = 30<br></code></pre></li>
<li><p><code>system</code> </p>
<p>  该函数用于执行指定的命令并且返回它的退出状态，返回状态码0表示命令成功执行。</p>
<pre class="hljs scala"><code class="hljs scala">  $ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { ret = system(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"date"</span></span></span></span>); print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Return value = "</span></span></span></span> ret }'<br>  <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">2016</span></span></span></span>年 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>月 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">27</span></span></span></span>日 星期四 <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">22</span></span></span></span>:<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">08</span></span></span></span>:<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">36</span></span></span></span> <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">CST</span></span></span></span>
  <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">Return</span></span></span></span> value = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">0</span></span></span></span>
</code></pre></li>
</ul>
<h3 id="h3_79">用户自定义函数</h3>
<p>函数是程序基本的组成部分，AWK允许我们自己创建自定义的函数。一个大型的程序可以被划分为多个函数，每个函数之间可以独立的开发和测试，提供可重用的代码。</p>
<p>下面是用户自定义函数的基本语法</p>
<pre class="hljs actionscript"><code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-function"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function_name</span></span></span></span></span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(argument1, argument2, </span></span></span></span></span></span><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg"><span class="hljs-function"><span class="hljs-params"><span class="hljs-rest_arg">...) { <br>   function</span></span></span></span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> body<br>}<br></span></span></span></span></span></span></span></span></code></pre><p>例如，我们创建一个名为functions.awk的文件，包含下面的代码</p>
<pre class="hljs php"><code class="hljs php"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Returns minimum number</span></span></span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-function"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_min</span></span></span></span></span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num1, num2)</span></span></span></span></span></span></span></span>{<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (num1 &lt; num2)<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span></span></span> num1<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span></span></span> num2<br>}<br><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Returns maximum number</span></span></span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-function"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find_max</span></span></span></span></span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num1, num2)</span></span></span></span></span></span></span></span>{<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span></span></span> (num1 &gt; num2)<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span></span></span> num1<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span></span></span> num2<br>}<br><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Main function</span></span></span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span></span></span></span><span class="hljs-function"><span class="hljs-function"><span class="hljs-function"> </span></span></span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span></span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(num1, num2)</span></span></span></span></span></span></span></span>{<br>   <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Find minimum number</span></span></span></span>
   result = find_min(<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>)<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Minimum ="</span></span></span></span>, result<br><br>   <span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Find maximum number</span></span></span></span>
   result = find_max(<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>)<br>   <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Maximum ="</span></span></span></span>, result<br>}<br><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"><span class="hljs-comment"># Script execution starts here</span></span></span></span>
BEGIN {
   main(<span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>)<br>}<br></code></pre><p>执行上述代码，会得到下面的输出</p>
<pre class="hljs ini"><code class="hljs ini"><span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr">Minimum</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">10</span></span></span></span>
<span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr"><span class="hljs-attr">Maximum</span></span></span></span> = <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">20</span></span></span></span>
</code></pre><h2 id="h2_80">输出重定向</h2>
<h3 id="h3_81">重定向操作符</h3>
<p>到目前为止，我们所有的程序都是直接显示数据到了标准输出流，其实，我们也可以将输出重定向到文件。重定向操作符跟在<code>print</code>和<code>printf</code>函数的后面，与shell中的用法基本一致。</p>
<pre class="hljs gradle"><code class="hljs gradle"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span> DATA &gt; output-<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">file</span></span></span></span>
<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span></span></span> DATA &gt;&gt; output-<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">file</span></span></span></span>
</code></pre><p>例如，下面两条命令输出是一致的</p>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>echo <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Hello, World !!!"</span></span></span></span> &gt; <span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp"><span class="hljs-regexp">/tmp/message</span></span></span></span>.txt<br><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print "Hello, World !!!" &gt; "/tmp/message.txt" }'</span></span></span></span>
</code></pre><blockquote>
<p>与shell中一样，<code>&gt;</code>用于将输出写入到指定的文件中，如果文件中有内容则覆盖，而<code>&gt;&gt;</code>则为追加模式写入。</p>
</blockquote>
<pre class="hljs elixir"><code class="hljs elixir"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>awk <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'BEGIN { print "Hello, World !!!" &gt;&gt; "/tmp/message.txt" }'</span></span></span></span>
<span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable"><span class="hljs-variable">$ </span></span></span></span>cat /tmp/message.txt<br></code></pre><h3 id="h3_82">管道</h3>
<p>除了将输出重定向到文件之外，我们还可以将输出重定向到其它程序，与shell中一样，我们可以使用管道操作符<code>|</code>。</p>
<pre class="hljs scala"><code class="hljs scala">$ awk <span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol"><span class="hljs-symbol">'BEGIN</span></span></span></span> { print <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"hello, world !!!"</span></span></span></span> | <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"tr [a-z] [A-Z]"</span></span></span></span> }'<br><span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">HELLO</span></span></span></span>, <span class="hljs-type"><span class="hljs-type"><span class="hljs-type"><span class="hljs-type">WORLD</span></span></span></span> !!!<br></code></pre><p>AWK中可以使用<code>|&amp;</code>进行<strong>双向连接</strong>，那么什么是双向连接呢？一种常见的场景是我们发送数据到另一个程序处理，然后读取处理结果，这种场景下就需要打开一个到另外一个进程的双向管道了。第二个进程会与<strong>gawk</strong>程序并行执行，这里称其为 <strong>协作进程</strong>。与单向连接使用<code>|</code>操作符不同的是，双向连接使用<code>|&amp;</code>操作符。</p>
<pre class="hljs sql"><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></span></span> {<br>    print <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span></span></span> |&amp; <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"subprogram"</span></span></span></span>
    <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"subprogram"</span></span></span></span> |&amp; getline results<br>} <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> (<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">left</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">to</span></span></span></span> process)<br><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">close</span></span></span></span>(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"subprogram"</span></span></span></span>)<br></code></pre><p>第一次I/O操作使用了<code>|&amp;</code>操作符，gawk会创建一个到运行其它程序的子进程的双向管道，<code>print</code>的输出被写入到了<code>subprogram</code>的标准输入，而这个<code>subprogram</code>的标准输出在gawk中使用<code>getline</code>函数进行读取。</p>
<blockquote>
<p>注意：目前协同进程的标准错误输出将会和gawk的标准错误输出混杂在一起，无法单独获取标准错误输出。另外，I/O缓冲可能存在问题，gawk程序会自动的刷新所有输出到下游的协同进程的管道。但是，如果协同进程没有刷新其标准输出的话，gawk将可能会在使用<code>getline</code>函数从协同进程读取输出的时候挂起，这就可能引起死锁。</p>
</blockquote>
<p>我们可以使用<code>close</code>函数关闭双向管道的<strong>to</strong>或者<strong>from</strong>一端，这两个字符串值告诉gawk发送数据到协同进程完成时或者从协同进程读取完毕时关闭管道。在使用系统命令<code>sort</code>的时候是这样做是非常必要的，因为它必须等所有输出都读取完毕时才能进行排序。</p>
<pre class="hljs bash"><code class="hljs bash">BEGIN {<br>    <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span> = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"LC_ALL=C sort"</span></span></span></span>
    n = split(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"abcdefghijklmnopqrstuvwxyz"</span></span></span></span>, a, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">""</span></span></span></span>)<br><br>    <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span></span></span> (i = n; i &gt; 0; i--)<br>        <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> a[i] |&amp; <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span>
    close(<span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span>, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"to"</span></span></span></span>)<br><br>    <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> ((<span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span> |&amp; getline line) &gt; 0)<br>        <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"got"</span></span></span></span>, line<br>    close(<span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span>)<br>}<br></code></pre><p>例如，下面的例子中使用<code>tr</code>命令转换小写为大写。我们的<strong>command.awk</strong>文件包含以下内容</p>
<pre class="hljs go"><code class="hljs go">BEGIN {<br>   cmd = <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"tr [a-z] [A-Z]"</span></span></span></span>
   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"hello, world !!!"</span></span></span></span> |&amp; cmd<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">close</span></span></span></span>(cmd, <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"to"</span></span></span></span>)<br><br>   cmd |&amp; getline out<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> out;<br>   <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">close</span></span></span></span>(cmd);<br>}<br></code></pre><p>输出 </p>
<pre class="hljs"><code class="hljs">HELLO, WORLD !!!<br></code></pre><p>上例看起来有些复杂，我们逐行分析一下</p>
<ul>
<li>首先，第一行 <strong>cmd = "tr [a-z] [A-Z]"</strong> 是在AWK中要建立双向连接的命令</li>
<li>第二行的<strong>print</strong>命令用于为<strong>tr</strong>命令提供输入，而 <code>|&amp;</code> 用于指出要建立双向连接</li>
<li>第三行用于在上面的语句<strong>close(cmd, "to"),</strong>在执行完成后关闭其<strong>to</strong>进程</li>
<li>第四行 <strong>cmd |&amp; getline out</strong>使用getline函数存储输出到变量out中</li>
<li>最后一行使用<strong>close</strong>函数关闭命令</li>
</ul>
<h2 id="h2_83">美化输出</h2>
<p>到目前为止，我们已经使用过<code>print</code>和<code>printf</code>函数显示数据到标准输出，但是<code>printf</code>函数实际上要比我们之前使用的情况更加强大得多。该函数是从C语言中借鉴来的，在处理格式化的输出时非常有用。</p>
<pre class="hljs sql"><code class="hljs sql">$ awk '<span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span> { printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"Hello\nWorld\n"</span></span></span></span> }<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'<br>Hello<br>World<br><br>$ awk '</span></span></span></span><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span></span></span> { printf <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"ASCII value 65 = character %c\n"</span></span></span></span>, <span class="hljs-number"><span class="hljs-number"><span class="hljs-number"><span class="hljs-number">65</span></span></span></span> }<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">'<br>ASCII value 65 = character A<br></span></span></span></span></code></pre><blockquote>
<p>格式化输出标识有 <code>%c</code>， <code>%d</code>，<code>%s</code> 等，基本与C语言一致，这里就不多赘述了。</p>
</blockquote>
<h2 id="h2_84">执行shell命令</h2>
<p>在AWK中执行shell命令有两种方式</p>
<ul>
<li>使用<code>system</code>函数</li>
<li>使用管道</li>
</ul>
<h3 id="h3_85">使用system函数</h3>
<p><strong>system</strong>函数用于执行操作系统命令并且返回命令的退出码到awk。</p>
<pre class="hljs sql"><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">END</span></span></span></span> {<br>     <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">system</span></span></span></span>(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"date | mail -s 'awk run done' root"</span></span></span></span>)<br>}<br></code></pre><h3 id="h3_86">使用管道</h3>
<p>如果要执行的命令很多，可以将输出的命令直接用管道传递给<strong>"/bin/sh"</strong>执行</p>
<pre class="hljs bash"><code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span></span></span> (more stuff to <span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span></span></span>)<br>    <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">print</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in"><span class="hljs-built_in">command</span></span></span></span> | <span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"/bin/sh"</span></span></span></span>
close(<span class="hljs-string"><span class="hljs-string"><span class="hljs-string"><span class="hljs-string">"/bin/sh"</span></span></span></span>)<br></code></pre><h2 id="h2_87">参考</h2>
<ul>
<li><a href="https://www.tutorialspoint.com/awk/index.htm">AWK Tutorial</a></li>
<li><a href="https://www.gnu.org/software/gawk/manual/gawk.html">The GNU Awk User's Guide</a></li>
</ul>
<p>本文将会持续修正和更新，最新内容请参考我的 <a href="https://github.com/mylxsw">GITHUB</a> 上的 <a href="https://github.com/mylxsw/growing-up">程序猿成长计划</a> 项目，欢迎 Star。</p>
</div>
                            </div>
            <div class="blog-opr">
                <!-- 版权 -->
                <div class="blog-copyright">
                                            <span title="OSCHINA 博客文章版权属于作者，受法律保护。未经作者同意不得转载。">© 著作权归作者所有</span>
                                    </div>
                <!-- 分类、标签、字数 -->
                <div class="related-info">
                    <ul>
                                                    <li class="classify">分类：<span id="classify"><a href="https://my.oschina.net/agiledev/blog?catalog=311182">技术文章</a></span></li>
                                                <li class="Words">字数：<span id="Words">6928</span></li>
                                            </ul>
                </div>
                <div class="tags">
                                    </div>
            </div>
            <!-- 赞、收藏、分享 --><div class="reward-list hide">
                <div class="reward-list-title">
                    共有 <span id="reward-num"></span>  人打赏支持<span id="donate_money"></span>
                </div>
                                <div class="donate-user-list" id="donate_user_list">
                    <p></p>
                </div>
            </div>
                    </div>

        <!-- 个人名片 -->
        <div class="user-card">
            <div class="blog-wrapper"><br>
</div>
        </div>
        <!-- 相关博客 -->
                        <div class="blog-related">
            <div class="blog-wrapper"><br>
</div>
        </div>
                <!-- 评论 -->
        <div class="blog-comments">
            <div class="blog-wrapper"><br>
</div>
        </div>

        <!-- 微信分享二维码 -->
       <!--  <div class="float-share md-hide">
            <div class="weixin-share" id="weixin-share">
            </div>
            <span>微信分享</span>
        </div> -->

        <!-- 右侧工具条 -->
        <div class="tool-bar blog-tool-bar md-hide">
            <div class="item tool-top" style="display: none;">
                <a href="javascript:void(0);" class="over">
                    <div class="icon">
                        <i class="icon-svg icon-go-top"></i>
                    </div>
                    <div class="txt">顶部</div>
                </a>
            </div>
        </div>
    </div>
</div>
<div class="reward-popups" data-popups-for="reward">
    <span data-popups-close="true">×</span>
    <div data-popups="body">
        <form action="" method="post" id="blog_donate_form">
            <div class="form-wapper">
                <div class="blogger-info text-center">
                    <span class="icon">
                        <a href="https://my.oschina.net/agiledev/home" class="article_editor_head_img" target="_blank"><img src="index_files/170995_100.jpg" alt="管宜尧" title="管宜尧" class="LargePortrait" align="absmiddle"></a>
                    </span>
                    <div class="text">
                        如果觉得我的文章对您有用，请随意打赏。您的支持将鼓励我继续创作！
                    </div>
                </div>
                <div class="form-item">
                    <div class="form-label">
                        <span class="font-red">*</span>
                        金额(元)
                    </div>
                    <div class="form-ctrl">
                        <div>
                            <input name="payMoney" value="2" placeholder="请输入金额￥" type="text">
                            <input name="money" value="2" placeholder="请输入金额￥" type="hidden">
                        </div>
                        <div class="reward-money-box">
                            <span data-value="1" class="reward-money">￥1</span>
                            <span data-value="5" class="reward-money">￥5</span>
                            <span data-value="10" class="reward-money">￥10</span>
                            <span data-value="20" class="reward-money">￥20</span>
                            <span data-value="" class="reward-money other-money active">其他金额</span>
                        </div>
                    </div>
                </div>
                <div class="form-item">
                    <div class="form-label">
                        打赏人
                    </div>
                    <div class="form-ctrl">
                        <input name="donaterName" maxlength="100" placeholder="请输入姓名/昵称/邮箱" type="text">
                    </div>
                </div>
                <div class="form-item items-center">
                    <div class="form-label">
                        留言
                    </div>
                    <div class="form-ctrl">
                        <textarea maxlength="100" name="message" id="" cols="30" rows="3" placeholder="你想对TA说"></textarea>
                    </div>
                </div>

                <div class="form-item items-center">
                    <div class="form-label">
                        <span class="font-red">*</span>
                        支付类型
                    </div>
                    <div class="form-ctrl">
                        <div class="reward-way form-radios reward-alipay">
                            <input value="alipay" id="rewardAliPay" checked="checked" name="reward-way" type="radio">
                            <label for="rewardAliPay">
                                <span class="hide">支付宝支付</span>
                            </label>
                        </div>
                        <div class="reward-way form-radios reward-wechat">
                            <input value="wepay" id="rewardWechat" name="reward-way" type="radio">
                            <label for="rewardWechat">
                                <i class="icon-svg icon-wechat"></i>
                                <span class="">微信支付</span>
                            </label>
                        </div>
                    </div>
                </div>
                                <div class="hide">
                    <input name="objType" value="16344358" type="hidden">
                    <input name="objId" value="778891" type="hidden">
                    <input name="donater" value="0" type="hidden">
                    <input name="subject" maxlength="50" value="三十分钟学会AWK" type="hidden">
                    <input name="author" value="170995" type="hidden">
                    <input name="returnUrl" maxlength="900" value="https://my.oschina.net/agiledev/blog/778891" type="hidden">
                    <input name="notifyUrl" maxlength="900" value="https://my.oschina.net/action/blog/paySuccess" type="hidden">
                    <input name="sign" value="" type="hidden">
                </div>
                <div class="form-button text-right">
                    <input class="btn btn-orange" value="打赏" id="blog_donate_button" type="button">
                </div>
            </div>

            <div class="reward-status reward-wechat-box text-center">
                <span class="wechat-qr">
                    <i class="icon-svg icon-scan-green"></i>
                    微信扫码支付
                </span>
                <div class="wepay-amount">
                    打赏金额: <span class="h1 font-green">￥<em id="wepayAmount"></em></span>
                </div>
                <span class="wechat-qr-img" id="result_area">
                </span>
            </div>

            <div class="reward-status reward-success text-center">
                <span class="wechat-qr">
                    <i class="icon-svg icon-wechat"></i>
                    已支付成功
                </span>
                <div>
                    打赏金额: <span class="h1 font-green">￥<em id="wepayAmount"></em></span>
                </div>
            </div>
        </form>
    </div>
</div>
<div data-popups="mask">

</div>
    <script type="text/javascript" src="index_files/blog.js" defer="defer"></script>
    <script type="text/javascript" src="index_files/space.js"></script>

<val data-name="radar_chart_js_url" data-value="/dist/www/vendor/radarChart/radarChart.js?t=1475078300000"></val>
<script><!--

/* Script removed by snapshot save */

--></script>

            <script><!--

/* Script removed by snapshot save */

--></script>
    <script type="text/javascript"><!--

/* Script removed by snapshot save */

--></script>
            </div><script type="text/javascript" src="index_files/ga.js"></script>
                        <script type="text/javascript" src="index_files/common.min.js"></script>
            <script type="text/javascript" src="index_files/blog.min.js"></script><script type="text/javascript" src="index_files/radarChart.js"></script><script type="text/javascript" src="index_files/highlight.js"></script><script type="text/javascript" src="index_files/highlight-1.js"></script><script type="text/javascript" src="index_files/jquery.atwho.js"></script><script type="text/javascript" src="index_files/emoji_github.js"></script><br>
</body></html>