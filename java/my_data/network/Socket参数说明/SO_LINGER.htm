<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><!--
 Archive processed by SingleFile 
 url: http://192.168.2.113:8080/ts/a/9/SO_LINGER.htm 
 saved date: Wed Apr 29 2015 15:02:34 GMT+0800 (中国标准时间) 
--><head><title>SO_LINGER</title>
<style>.error{color:#FF0000;font-size:12px}</style>



<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style><link type="image/x-icon" rel="shortcut icon" href="data:text/html;charset=ISO-8859-1;base64,PGh0bWw+CjxoZWFkPgo8bWV0YSBodHRwLWVxdWl2PSJDb250ZW50LVR5cGUiIGNvbnRlbnQ9InRleHQvaHRtbDsgY2hhcnNldD1JU08tODg1OS0xIi8+Cjx0aXRsZT5FcnJvciA0MDQgTm90IEZvdW5kPC90aXRsZT4KPC9oZWFkPgo8Ym9keT48aDI+SFRUUCBFUlJPUiA0MDQ8L2gyPgo8cD5Qcm9ibGVtIGFjY2Vzc2luZyAvZmF2aWNvbi5pY28uIFJlYXNvbjoKPHByZT4gICAgTm90IEZvdW5kPC9wcmU+PC9wPjxociAvPjxpPjxzbWFsbD5Qb3dlcmVkIGJ5IEpldHR5Oi8vPC9zbWFsbD48L2k+PGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKPGJyLz4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKCjwvYm9keT4KPC9odG1sPgo="></head>

<body>

<center>

<div id="main" style="WIDTH: 996px" align="left">

<div class="stage">

<div class="stagepad">

<div style="WIDTH: 100%">

<div class="modbox" id="m_blog"><!--StartFragment--><div class="tit">关于SO_LINGER的使用说明</div>
<div class="date">2007-12-20 14:26</div>
<table style="TABLE-LAYOUT: fixed">
<tbody>
<tr>
<td>
<div class="cnt" id="blog_text">
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><span><font face="宋体" color="#0000ff">SO_LINGER</font></span></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span><span style="mso-spacerun: yes">&nbsp;&nbsp; 
</span></span>此选项指定函数<span>close</span>对面向连接的协议如何操作（如<span>TCP</span>）。缺省<span>close</span>操作是立即返回，如果有数据残留在套接口缓冲区中则系统将试着将这些数据发送给对方。</font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span>SO_LINGER</span>选项用来改变此缺省设置。使用如下结构：</font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><span><font face="宋体" color="#0000ff">struct linger {</font></span></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><span><font face="宋体"><font color="#0000ff"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>int l_onoff; /* 0 = 
off, nozero = on */</font></font></span></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><span><font face="宋体"><font color="#0000ff"><span style="mso-spacerun: yes">&nbsp;&nbsp;&nbsp;&nbsp; </span>int l_linger; /* 
linger time */</font></font></span></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><span><font face="宋体" color="#0000ff">};</font></span></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff">有下列三种情况：</font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span>l_onoff</span>为<span>0</span>，则该选项关闭，<span>l_linger</span>的值被忽略，等于缺省情况，<span>close</span>立即返回； 
</font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span>l_onoff</span>为非<span>0</span>，<span>l_linger</span>为<span>0</span>，则套接口关闭时<span>TCP</span>夭折连接，<span>TCP</span>将丢弃保留在套接口发送缓冲区中的任何数据并发送一个<span>RST</span>给对方，而不是通常的四分组终止序列，这避免了<span>TIME_WAIT</span>状态； 
</font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span>l_onoff 
</span>为非<span>0</span>，<span>l_linger</span>为非<span>0</span>，当套接口关闭时内核将拖延一段时间（由<span>l_linger</span>决定）。如果套接口缓冲区中仍残留数据，进程将处于睡眠状态，直 
到（<span>a</span>）所有数据发送完且被对方确认，之后进行正常的终止序列（描述字访问计数为<span>0</span>）或（<span>b</span>）延迟时间到。<font color="#800000"><span style="COLOR: blue"><font color="#800000">此种情况下，应用程序检查<span>close</span>的返回值是非常重要的，如果在数据发送完并被确认前时间到，<span>close</span>将返回<span>EWOULDBLOCK</span>错误且套接口发送缓冲区中的任何数据都丢失</font></span>。</font><span>close</span>的成功返回仅告诉我们发送的数据（和<span>FIN</span>）已由对方<span>TCP</span>确认，它并不能告诉我们对方应用进程是否已读了数据。如果套接口设为非阻塞的，它将不等待<span>close</span>完 
成。 </font></font></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"></p>
<p class="MsoPlainText" style="MARGIN: 0cm 0cm 0pt"><font face="宋体"><font color="#0000ff"><span>l_linger</span>的单位依赖于实现，<span>4.4BSD</span>假设其单位是时钟滴答（百分之一秒），但<span>Posix<!--?XML:NAMESPACE 
PREFIX = ST1 /--><st1:chmetcnv tcsc="0" numbertype="1" negative="False" hasspace="False" sourcevalue=".1" unitname="g">.1g</st1:chmetcnv></span>规定单位为秒。</font></font></p></div></td></tr></tbody></table><!--EndFragment--></div>
</div>
</div>
</div>
</div>
</center>

</body></html>