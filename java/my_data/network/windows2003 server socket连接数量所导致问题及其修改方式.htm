<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--
 Archive processed by SingleFile 
 url: http://www.blogjava.net/jialisoftwo/archive/2013/03/11/396272.html 
 saved date: Tue Mar 12 2013 14:28:07 GMT+0800 (中国标准时间) 
-->
<head id="Head">
<title>windows2003 server socket连接数量所导致问题及其修改方式</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta id="metaKeywords" name="keywords" content="windows2003 server socket连接数量所导致问题及其修改方式">
<style type="text/css" rel="stylesheet">
a.site_hot:visited, a.site_hot:active, a.site_hot:link {
	color: red;
	text-decoration: none;
}
a.site_hot:hover {
	color: red;
	text-decoration: underline;
}
a.site_blue:visited, a.site_blue:active, a.site_blue:link {
	color: blue;
	text-decoration: none;
}
a.site_blue:hover {
	color: red;
	text-decoration: underline;
}
</style>
<style id="MainCss" type="text/css" rel="stylesheet">
/*
tip from mark pilgrim:
http://diveintoaccessibility.org/day_26_using_relative_font_sizes.html
*/


p {
	font-size: 12px;
	color: #000;
	padding: 0;
	margin-top: 0px;
}
/*/*/a {
}
body p {
	font-size: x-small;
	voice-family: "\"}\"";
	voice-family: inherit;
	font-size: small;
	word-wrap: break-word;
}
html>body p {
	font-size: small;
}
/* */

html, body {
	margin: 0;
	padding: 0;
	background-color: #fff;
	color: #333;
	font-family: verdana, arial, helvetica, sans-serif;
	word-break: break-all;
}
h1, h2, h3, h4 {
	text-decoration: none;
	color: #006bad;
	background-color: #fff;
}
h1 {
	font-size: 30px;
}
h2 {
	font-size: 24px;
}
h3 {
	font-size: 16px;
}
h4 {
	font-size: 16px;
}
/* Start Layout and Page Formatting */

.pagelayout {
	background: #fff;
	position: absolute;
	top: 15px;
	margin: 5px 5px 5px 5px;/*
	left: 50%;	
	margin-left: -375px;
	margin-bottom: 25px;
	width: 750px;
	*/
}
.leftcolumn {
	width: 220px;
	float: left;
	margin-left: -1px;
	padding: 10px;
	text-align: left;
}
.rightcolumn {
	width: 220px;
	float: right;
	margin-right: -1px;
	padding: 10px;
	text-align: right;
}
.centercolumn {
	padding: 10px;
	margin-left: 230px;
}
.imageFrame {
	border: 0px;
	text-align: center;
}
/* End Layout and Formatting */

/* header section */
.header {
	background-color: #fff;
	color: #006;
	margin-bottom: 5px;
}
a.headermaintitle:link, a.headermaintitle:visited, a.headermaintitle:hover {
	color: #006bad;
	font-size: 24px;
	background-color: #fff
}
a.headersubtitle:link, a.headersubtitle:visited, a.headersubtitle:hover {
	text-decoration: none;
	color: #006bad;
	font-size: 18px;
	font-style: italic;
	font-weight: normal;
	background-color: #fff
}
/* end header section */


.footer {
	width: 100%;
	background-color: #fff;
	color: #006;
	border-top: 1px solid #006;
	font-size: 11px;
	text-align: center;
	padding: 2px 10px 0 0;
	clear: both;
}
.spacer {
	clear: both;
}
.datetitle {
	text-align: left;
	padding-right: 2px;
	margin-top: 0;
	padding-left: 2px;
	font-weight: bold;
	font-size: 12px;
	background: #7ba5ce;
	margin-bottom: 1px;
	padding-bottom: 2px;
	color: #fff;
	line-height: 14px;
	padding-top: 2px;
	border-bottom: #999 1px solid;
	letter-spacing: 0.2em;
	text-align: left
}
.listtitle {
	padding-right: 2px;
	margin-top: 0;
	padding-left: 2px;
	font-weight: bold;
	font-size: 12px;
	background: #7ba5ce;
	margin-bottom: 1px;
	padding-bottom: 2px;
	color: #fff;
	line-height: 14px;
	padding-top: 2px;
	letter-spacing: 0.2em;
	text-align: left
}
h3 {
	padding-right: 2px;
	margin-top: 0;
	padding-left: 2px;
	font-weight: bold;
	font-size: 12px;
	background: #7ba5ce;
	margin-bottom: 1px;
	padding-bottom: 2px;
	color: #fff;
	line-height: 14px;
	padding-top: 2px;
	letter-spacing: 0.2em;
	text-align: left
}
.list {
	border: 1px #aaaaaa dotted;
	border-top: 0px;
	margin-bottom: 15px;
	padding-left: 5px;
	padding-right: 5px;
}
.postlist {
	border: 1px #aaaaaa dotted;
	border-top: 0px;
	margin-bottom: 15px;
	padding-left: 5px;
	padding-right: 5px;
}
.singlepost {
	border: 0px;
	background-color: #fff;
	color: #006;
	border-bottom: 1px solid #006;
	margin-bottom: 15px;
	padding-left: 5px;
	padding-right: 5px;
}
.itemdesc {
	background-color: #fff;
	color: #000;
	font-size: 11px;
	text-align: left;
	padding-bottom: 5px;
}
.posttitle {
	padding: 5px 0px 5px 0px;
}
a.posttitle:link, a.posttitle:visited, a.posttitle:hover {
	text-decoration: underline;
	color: #006bad;
	font-size: 16px;
	background-color: #fff;
	font-weight: bold;
}
.singleposttitle {
	text-decoration: underline;
	color: #006bad;
	font-size: 22px;
	background-color: #fff;
	font-weight: bold;
}
a.singleposttitle:link, a.singleposttitle:visited, a.singleposttitle:hover {
	text-decoration: underline;
	color: #006bad;
	font-size: 22px;
	background-color: #fff;
	font-weight: bold;
}
a.itemdesc:link, a.itemdesc:active, a.itemdesc:visited {
	text-decoration: none;
	color: #006bad;
	font-size: 11px;
	background-color: #fff;
	font-weight: normal;
}
a.itemdesc:hover {
	text-decoration: underline;
	background-color: #fff;
	color: #006bad;
}
ul.entrylist {
	list-style: none;
	color: #000;
	font-size: 12px;
border: 0px border-top: 0px;
	margin-top: 0;
	margin-left: 0px; /* for mozilla  */
	margin-right: 0px;
	padding-left: 0;
	padding-right: 0;/* border: 1px #aaaaaa dotted;*/
}
li.entrylistitem {
	padding: 5px 0px 5px 0px;
	margin: 3px 0px 3px 0px;
	text-align: left;
}
a.entrylisttitle:link, a.entrylisttitle:visited, a.entrylisttitle:active, a.entrylisttitle:hover {
	text-decoration: underline;
	color: #006bad;
	font-size: 13px;
	font-weight: bold;
	background-color: #fff
}
ul.list {
	list-style: none;
	color: #000;
	font-size: 12px;
	border: 1px #aaaaaa dotted;
	border-top: 0px;
	margin-top: 0;
	margin-left: 0px; /* for mozilla  */
	margin-right: 0px;
	padding-left: 0;
	padding-right: 0;/* border: 1px #aaaaaa dotted;*/

}
ul {
	list-style: none;
	color: #000;
	font-size: 12px;
	border: 1px #aaaaaa dotted;
	border-top: 0px;
	margin-top: 0;
	margin-left: 0px; /* for mozilla  */
	margin-right: 0px;
	padding-left: 0;
	padding-right: 0;/* border: 1px #aaaaaa dotted;*/

}
li {
	padding-left: 0;
	padding-right: 0;
	margin-left: 5px;
	text-align: left;
}
li.listitem {
	padding-left: 0;
	padding-right: 0;
	margin-left: 5px;
	text-align: left;
}
a.listitem, a.listitem:link, a.listitem:visited, a.listitem:active {
	text-decoration: none;
	color: #006bad;
	font-size: 14px;
	background-color: #fff;
	font-weight: normal;
}
a.listitem:hover {
	background-color: #fff;
	color: #006bad;
	text-decoration: underline;
}
blockquote {
	background: #E1EBF4;
	border: 2px solid #666;
	margin: 0px 15px 10px 15px;
	padding: 5px 5px 5px 8px;
}
img {
	border: none;
}
div.seperator {
	background-color: #fff;
	border-top: 1px solid #006bad;
	padding: 0 0 0 0;
	margin: 5px 0 0 0;
	height: 1px;
	width: 95%;
}
a:link, a:visited, a:active {
	font-weight: bold;
	color: #006bad;
	text-decoration: none
}
a:hover {
	background: #000;
	color: #fff
}
.commentform {
	text-align: left;
}
.moreinfotitle {
	font-weight: bold;
	font-size: 12px;
	line-height: 14px;
	margin: 0 0 0 0;
	padding: 0 0 0 0;/*border-bottom: #999 1px solid; */
	
}
.moreinfo {
	border: 0;
	background-color: #fff;
	margin: 15px 0px 15px 0px;
}
ul.morelist {
	list-style: none;
	border: 0px;
	border-top: 0px;
	margin-top: 0;
	margin-left: 0px; /* for mozilla  */
	margin-right: 0px;
	padding-left: 0;
	padding-right: 0;
	font-size: 12px;/* border: 1px #aaaaaa dotted;*/
}
li.morelistitem {
	padding-left: 0;
	padding-right: 0;
	margin-left: 0px;
	text-align: left;
	font-size: 12px;
}
a.printlink:link, a.printlink:visited {
	text-decoration: none;
	color: #006bad;
	background-color: #fff;
	font-weight: normal;
}
a.printlink:hover {
	text-decoration: underline;
}
.Cal {
	border : 1px solid #999999;
	width: 200px;
	font-family: Arial;
	font-size: 12px;
	margin-top: 10px;
	margin-bottom: 10px;
	height: 180px;
	background-color: #EEEEEE;
}
.CalTitle {
	background-color : #7ba5ce;
	border-color: #ADF;
	font-family: Arial;
	font-size: 13px;
	color : #FFF;
	margin-left : 0px;
	padding : 0px;
	height: 100%;
	font-weight: bold;
}
.CalOtherMonthDay {
	color: #808080;
}
.CalSelector {
}
a.CalNextPrev, a.CalNextPrev:link, a.CalNextPrev:visited, a.CalNextPrev:active {
	color: #FFF;
}
.CalNextPrev {
	color: #FFF;
}
.CalDayHeader {
	background-color: #CCCCCC;
}
.CalSelectedDay {
}
.CalWeekendDay {
}
.CalTodayDay {
	background-color: #CCCCCC;
}
</style>
<link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://www.blogjava.net/jialisoftwo/rss.aspx">
<link type="image/x-icon" rel="shortcut icon" href="data:text/plain; charset=x-user-defined;base64,PEhUTUw+DQoJPHRpdGxlPsv5t8POyrXE18rUtLK7tObU2jwvdGl0bGU+DQoJPE1FVEEgaHR0cC1lcXVpdj0iQ29udGVudC1UeXBlIiBjb250ZW50PSJ0ZXh0L2h0bWw7IGNoYXJzZXQ9R0IyMzEyIj4NCgk8TUVUQSBOQU1FPSJST0JPVFMiIENPTlRFTlQ9Ik5PSU5ERVgsIE5PRk9MTE9XIj4NCgk8c3R5bGU+DQoJCUJPRFkgeyBQQURESU5HLVJJR0hUOiAzMnB4OyBQQURESU5HLUxFRlQ6IDMycHg7IEZPTlQtU0laRTogMTNweDsgQkFDS0dST1VORDogI2VlZTsgUEFERElORy1CT1RUT006IDMycHg7IE1BUkdJTi1MRUZUOiBhdXRvOyBXSURUSDogODAlOyBDT0xPUjogIzAwMDsgTUFSR0lOLVJJR0hUOiBhdXRvOyBQQURESU5HLVRPUDogMzJweDsgRk9OVC1GQU1JTFk6IHZlcmRhbmEsIGFyaWFsLCBzYW5zLXNlcmlmIH0NCgkJRElWIHsgQk9SREVSLVJJR0hUOiAjYmJiIDFweCBzb2xpZDsgUEFERElORy1SSUdIVDogMzJweDsgQk9SREVSLVRPUDogI2JiYiAxcHggc29saWQ7IFBBRERJTkctTEVGVDogMzJweDsgQkFDS0dST1VORDogI2ZmZjsgUEFERElORy1CT1RUT006IDMycHg7IEJPUkRFUi1MRUZUOiAjYmJiIDFweCBzb2xpZDsgUEFERElORy1UT1A6IDMycHg7IEJPUkRFUi1CT1RUT006ICNiYmIgMXB4IHNvbGlkIH0NCgkJSDEgeyBQQURESU5HLVJJR0hUOiAwcHg7IFBBRERJTkctTEVGVDogMHB4OyBGT05ULVdFSUdIVDogYm9sZDsgRk9OVC1TSVpFOiAxMjAlOyBQQURESU5HLUJPVFRPTTogMjBweDsgTUFSR0lOOiAwcHg7IENPTE9SOiAjOTA0OyBQQURESU5HLVRPUDogMHB4OyBGT05ULUZBTUlMWTogInRyZWJ1Y2hldCBtcyIsICIibHVjaWRhIGdyYW5kZSIiLCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZiB9DQoJCUgyIHsgUEFERElORy1SSUdIVDogMHB4OyBQQURESU5HLUxFRlQ6IDBweDsgRk9OVC1XRUlHSFQ6IGJvbGQ7IEZPTlQtU0laRTogMTA1JTsgUEFERElORy1CT1RUT006IDBweDsgTUFSR0lOOiAwcHggMHB4IDhweDsgVEVYVC1UUkFOU0ZPUk06IHVwcGVyY2FzZTsgQ09MT1I6ICM5OTk7IFBBRERJTkctVE9QOiAwcHg7IEJPUkRFUi1CT1RUT006ICNkZGQgMXB4IHNvbGlkOyBGT05ULUZBTUlMWTogInRyZWJ1Y2hldCBtcyIsICIibHVjaWRhIGdyYW5kZSIiLCB2ZXJkYW5hLCBhcmlhbCwgc2Fucy1zZXJpZiB9DQoJCVAgeyBQQURESU5HLVJJR0hUOiAwcHg7IFBBRERJTkctTEVGVDogMHB4OyBQQURESU5HLUJPVFRPTTogNnB4OyBNQVJHSU46IDBweDsgUEFERElORy1UT1A6IDZweCB9DQoJCUE6bGluayB7IENPTE9SOiAjMDAyYzk5OyBURVhULURFQ09SQVRJT046IG5vbmUgfQ0KCQlBOnZpc2l0ZWQgeyBDT0xPUjogIzAwMmM5OTsgVEVYVC1ERUNPUkFUSU9OOiBub25lIH0NCgkJQTpob3ZlciB7IENPTE9SOiAjY2MwMDY2OyBCQUNLR1JPVU5ELUNPTE9SOiAjZjVmNWY1OyBURVhULURFQ09SQVRJT046IHVuZGVybGluZSB9DQoJPC9zdHlsZT4NCgk8Ym9keT4NCgkJPGZvcm0gaWQ9ImZybU1haW4iIG1ldGhvZD0icG9zdCIgcnVuYXQ9InNlcnZlciI+DQoJCQk8ZGl2Pg0KCQkJCTxoMT6xp8e4IbeiyfrBy7TtzvM8L2gxPg0KCQkJCTxoMj5EZXRhaWxzPC9oMj4NCgkJCQk8cD7L+bfDzsq1xNfK1LSyu7Tm1NosIMfryLfIz8rkyOu1xLXY1rfKx7fx1f3ItywgyOe5+8jUyLu05tTazsrM4iwgx+u3otPKvP7WwWNuYmxvZ3NAMTI2LmNvbdPrudzA7dSxwarPtaGjPC9wPg0KCQkJCTxwIHN0eWxlPSJNQVJHSU4tVE9QOiAyNHB4Ij48YSBocmVmPSIvIj63tbvYzfjVvsrX0rM8L2E+PC9wPg0KCQkJPC9kaXY+DQoJCTwvZm9ybT4NCgk8L2JvZHk+DQo8L0hUTUw+">
</head>
<body>
<div class="singlepost">
  <div class="posttitle"> <a id="viewpost1_TitleUrl" class="singleposttitle" href="http://www.blogjava.net/jialisoftwo/archive/2013/03/11/396272.html">windows2003 server socket连接数量所导致问题及其修改方式</a> </div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">今天下午刚从客户坐车回来，晚上洗完澡，闷热的天气让人睡不着觉，就和大家分享一下windows2003 server socket端口的默认5000的数量修改方式。</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp;导致问题：从项目上线之后，客户说一个月就会宕机一次，系统用户无法正常登陆，后台报异常，无法连接，而整个集团的并发数并没有到一个很大的数量级，每次宕机，单纯的重启web服务器以及数据库服务无法到达解决问题的办法，必须要重启电脑，因此思路就转向了承载web服务器本身的服务器2003，每次都是按照socket来进行数据的读取，而每Socket.close()是不马上释放连接的，而是设置为time_wait状态，这个时间默认是240S，这个就是有点太长，可以设定为最小值，30s，而设定最小值之前必须要进行下面解决方式的第一步，而后进行第二步30s的设置，下面解决socket的问题，下面把解决方式贴出来。</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp;解决方式：</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; 第一步：启动注册表编辑器HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; 第二步：新建</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; 值名称：MaxUserPort</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 值类型： DWORD</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 值数据： 65534（用十进制的方法写进去就可以）</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 有效范围： 5000 - 65534 (十进制)</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 默认： 0x1388 5000 （十进制）</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; 第三步：新建</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;值名称：TCPTimedWaitDelay</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;值类型： DWORD</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;值数据： 0000001e（也就是30，这个表示TIME_WAIT的秒数）</div>
  <div style="margin: 0px; border: 0px; color: #222222; font-family: Arial, 宋体; font-size: 14px; line-height: 25px; background-color: #ffffff;">重启电脑，问题解决<br>
  </div>
</div>
</body>
</html>