<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html><head id="Head">
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><title>
	Android后台保活实践总结：即时通讯应用无法根治的“顽疾” - Jack Jiang - BlogJava
</title><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta id="metaKeywords" name="keywords" content="Android后台保活实践总结：即时通讯应用无法根治的“顽疾”"><link type="text/css" rel="stylesheet" href="index_files/common.css"><link id="MainCss" type="text/css" rel="stylesheet" href="index_files/style.css"><link id="SecondaryCss" type="text/css" rel="stylesheet" href="index_files/customcss.aspx.css"><link id="RSSLink" title="RSS" type="application/rss+xml" rel="alternate" href="http://www.blogjava.net/jb2011/rss.aspx"></head>
<body>
    <form name="Form1" method="post" action="#" onsubmit="" id="Form1">
<div>
<input name="__EVENTTARGET" id="__EVENTTARGET" value="" type="hidden">
<input name="__EVENTARGUMENT" id="__EVENTARGUMENT" value="" type="hidden">
<input name="__VIEWSTATE" id="
__VIEWSTATE" value="" type="hidden">
</div>

<script src="index_files/ga.js" async="" type="text/javascript"></script><script src="index_files/gpt.js" type="text/javascript" async=""></script><script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>


<script src="index_files/WebResource.axd.js" type="text/javascript"></script>

<script language="JavaScript"><!--
/* Script removed by snapshot save */
--></script>
												<script language="JavaScript"><!--
/* Script removed by snapshot save */
--></script>
<script src="index_files/ScriptResource.axd.js" type="text/javascript"></script>
<script src="index_files/ScriptResource.axd-1.js" type="text/javascript"></script>
<script src="index_files/ScriptResource.axd-2.js" type="text/javascript"></script>
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>

        <a href="http://git.oschina.net/jackjiang/MobileIMSDK" target="_blank" title="点击进入作者的MobileIMSDK工程！"><img src="index_files/github_header_logo_h.png"></a>          <a href="http://git.oschina.net/jackjiang/beautyeye" target="_blank" title="点击进入作者的BeautyEye工程！"><img src="index_files/beautyeye_logo_h.png"></a>

<table class="Framework" cellpadding="0" cellspacing="0" width="100%">
	<tbody><tr>
		<td colspan="2">
			
<div id="top">
<table cellpadding="8" cellspacing="0" width="100%">
	<tbody><tr>
		<td nowrap="nowrap">
			<h1><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.blogjava.net/jb2011/">Jack Jiang</a></h1>
			我的最新工程MobileIMSDK：http://git.oschina.net/jackjiang/MobileIMSDK
		</td>
	</tr>
</tbody></table>
</div>
<div id="sub">
<div class="BlogStats">posts - 13, comments - 12, trackbacks - 0, articles - 0</div></div>


</td>
	</tr>
	<tr>
		<td class="LeftCell">
			<div id="leftmenu" style="display: inline;">
				
					
<h3>导航</h3>
<ul>
	<li>
		<a id="MyLinks1_HomeLink" href="http://www.blogjava.net/">BlogJava</a>
	</li><li>
		<a id="MyLinks1_MyHomeLink" href="http://www.blogjava.net/jb2011/">首页</a>
	</li><li>
		<a id="MyLinks1_NewPostLink" href="http://www.blogjava.net/jb2011/admin/EditPosts.aspx?opt=1">新随笔</a>
	</li><li>
		<a id="MyLinks1_ContactLink" accesskey="9" href="http://www.blogjava.net/jb2011/contact.aspx?id=1">联系</a>
	</li><li>
		<a id="MyLinks1_XMLLink" href="http://www.blogjava.net/jb2011/rss"><img src="index_files/xml.gif" alt="RSS 2.0 Feed" style="border-width:0px;"></a><a id="MyLinks1_Syndication" href="http://www.blogjava.net/jb2011/rss">聚合</a>
	</li><li>
		<a id="MyLinks1_Admin" href="http://www.blogjava.net/jb2011/admin/EditPosts.aspx">管理</a></li>
</ul>

					
<h3>公告</h3>
	<br>
<ul class="panel_body">
<div style="margin-top: 2px; margin-bottom: 5px; color: #000000; line-height: 24px;">
<strong>
<font color="#FF1493">
① 即时通讯开发社区
</font><br>
地址：
<a target="_blank" href="http://www.52im.net/">
<font color="#0078fe">52im.net</font></a>
<br></strong>
<font color="#999999">专业的资料、社区</font>
<br>
<br>
<strong>
<font color="#FF1493">
② 移动端IM/推送 </font><br>
Q群：
<a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=4cc788473d261129ab3ded26fbb22168d0fa52c799d28f92a8f193dc36865bcb">
<font color="#0078fe">215891622</font></a>
<br></strong>
<font color="#999999">让技术不再封闭</font>
<br>
<br>
<strong>
<font color="#FF1493">
③ 我的Github
</font><br>
地址：
<a target="_blank" href="https://github.com/JackJiang2011">
<font color="#0078fe">点此进入</font></a>
<br></strong>
<font color="#999999">好代码，与大家分享</font>
</div>
</ul>

					<table id="Calendar1_entryCal" class="Cal" title="日历" style="border-width:1px;border-style:solid;border-collapse:collapse;" border="0" cellpadding="0" cellspacing="0">
	<tbody><tr><td colspan="7" style="background-color:Silver;"><table class="CalTitle" style="width:100%;border-collapse:collapse;" border="0" cellspacing="0">
		<tbody><tr><td class="CalNextPrev" style="width:15%;"><a href="javascript:void(0);" style="color:Black" title="转到上一个月">&lt;</a></td><td style="width:70%;" align="center">2016年8月</td><td class="CalNextPrev" style="width:15%;" align="right"><a href="javascript:void(0);" style="color:Black" title="转到下一个月">&gt;</a></td></tr>
	</tbody></table></td></tr><tr><th class="CalDayHeader" abbr="日" scope="col" align="center">日</th><th class="CalDayHeader" abbr="一" scope="col" align="center">一</th><th class="CalDayHeader" abbr="二" scope="col" align="center">二</th><th class="CalDayHeader" abbr="三" scope="col" align="center">三</th><th class="CalDayHeader" abbr="四" scope="col" align="center">四</th><th class="CalDayHeader" abbr="五" scope="col" align="center">五</th><th class="CalDayHeader" abbr="六" scope="col" align="center">六</th></tr><tr><td class="CalOtherMonthDay" style="width:14%;" align="center">31</td><td style="width:14%;" align="center">1</td><td style="width:14%;" align="center"><a href="http://www.blogjava.net/jb2011/archive/2016/08/02.html"><u>2</u></a></td><td class="CalTodayDay" style="width:14%;" align="center">3</td><td style="width:14%;" align="center">4</td><td style="width:14%;" align="center">5</td><td class="CalWeekendDay" style="width:14%;" align="center">6</td></tr><tr><td class="CalWeekendDay" style="width:14%;" align="center">7</td><td style="width:14%;" align="center">8</td><td style="width:14%;" align="center">9</td><td style="width:14%;" align="center">10</td><td style="width:14%;" align="center">11</td><td style="width:14%;" align="center">12</td><td class="CalWeekendDay" style="width:14%;" align="center">13</td></tr><tr><td class="CalWeekendDay" style="width:14%;" align="center">14</td><td style="width:14%;" align="center">15</td><td style="width:14%;" align="center">16</td><td style="width:14%;" align="center">17</td><td style="width:14%;" align="center">18</td><td style="width:14%;" align="center">19</td><td class="CalWeekendDay" style="width:14%;" align="center">20</td></tr><tr><td class="CalWeekendDay" style="width:14%;" align="center">21</td><td style="width:14%;" align="center">22</td><td style="width:14%;" align="center">23</td><td style="width:14%;" align="center">24</td><td style="width:14%;" align="center">25</td><td style="width:14%;" align="center">26</td><td class="CalWeekendDay" style="width:14%;" align="center">27</td></tr><tr><td class="CalWeekendDay" style="width:14%;" align="center">28</td><td style="width:14%;" align="center">29</td><td style="width:14%;" align="center">30</td><td style="width:14%;" align="center">31</td><td class="CalOtherMonthDay" style="width:14%;" align="center">1</td><td class="CalOtherMonthDay" style="width:14%;" align="center">2</td><td class="CalOtherMonthDay" style="width:14%;" align="center">3</td></tr><tr><td class="CalOtherMonthDay" style="width:14%;" align="center">4</td><td class="CalOtherMonthDay" style="width:14%;" align="center">5</td><td class="CalOtherMonthDay" style="width:14%;" align="center">6</td><td class="CalOtherMonthDay" style="width:14%;" align="center">7</td><td class="CalOtherMonthDay" style="width:14%;" align="center">8</td><td class="CalOtherMonthDay" style="width:14%;" align="center">9</td><td class="CalOtherMonthDay" style="width:14%;" align="center">10</td></tr>
</tbody></table>

					
<h3>常用链接</h3>
<ul>
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl01_lnkLinkItem" href="http://www.blogjava.net/jb2011/MyPosts.html">我的随笔</a></li>
	
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl02_lnkLinkItem" href="http://www.blogjava.net/jb2011/MyComments.html">我的评论</a></li>
	
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl03_lnkLinkItem" href="http://www.blogjava.net/jb2011/OtherPosts.html">我的参与</a></li>
	
		<li><a id="SingleColumn1_ctl00_repeaterLinks_ctl04_lnkLinkItem" href="http://www.blogjava.net/jb2011/RecentComments.html">最新评论</a></li>
	</ul>
<h3>留言簿</h3>
<ul>
	<li>
		<a id="SingleColumn1_ctl01_lnkMessages" href="http://www.blogjava.net/jb2011/Contact.aspx?id=1">给我留言</a>
	</li><li>
		<a id="SingleColumn1_ctl01_lnkPublicMsgView" href="http://www.blogjava.net/jb2011/default.aspx?opt=msg">查看公开留言</a>
	</li><li>
		<a id="SingleColumn1_ctl01_lnkPrivateMsgView" href="http://www.blogjava.net/jb2011/admin/MyMessages.aspx">查看私人留言</a>
	</li>
</ul>

		<h3>随笔档案</h3>
		
				<ul>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl01_Link" href="http://www.blogjava.net/jb2011/archive/2016/08.html">2016年8月 (1)</a></li>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl02_Link" href="http://www.blogjava.net/jb2011/archive/2016/07.html">2016年7月 (4)</a></li>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl03_Link" href="http://www.blogjava.net/jb2011/archive/2016/06.html">2016年6月 (4)</a></li>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl04_Link" href="http://www.blogjava.net/jb2011/archive/2015/12.html">2015年12月 (2)</a></li>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl05_Link" href="http://www.blogjava.net/jb2011/archive/2012/10.html">2012年10月 (1)</a></li>
			
				<li><a id="SingleColumn1_Categories_CatList_ctl00_LinkList_ctl06_Link" href="http://www.blogjava.net/jb2011/archive/2012/09.html">2012年9月 (1)</a></li>
			
				</ul>
			
	

<script language="JavaScript"><!--
/* Script removed by snapshot save */
--></script>
<h3>搜索</h3>
<ul>
	<li>
		</li><li><input style="WIDTH: 130px" name="q" id="q" onkeydown="" type="text"> <input onclick="" value="搜索" name="sa" type="button">
	</li>
</ul>

<h3>最新评论
	<a id="SingleColumn1__2b8cb31_RSSHyperlink1" href="http://www.blogjava.net/jb2011/CommentsRSS.aspx"><img src="index_files/xml.gif" style="border-width:0px;"></a></h3>
<div class="RecentComment">
	
			<ul>
		
			<li style="word-break:break-all">
				<a id="SingleColumn1__2b8cb31_CommentList_ctl01_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2016/07/19/431214.html#431243">1. re: Web端即时通讯技术盘点：短轮询、Comet、Websocket、SSE</a>
			</li>
			<li style="word-break:break-all">
				谢谢楼主精彩分享。。。
			</li>
			<li style="text-align:right;margin-right:4px">
				--中国演员网</li>
		
			<li style="word-break:break-all">
				<a id="SingleColumn1__2b8cb31_CommentList_ctl02_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2016/07/16/431214.html#431220">2. re: Web端即时通讯技术盘点：短轮询、Comet、Websocket、SSE</a>
			</li>
			<li style="word-break:break-all">
				评论内容较长,点击标题查看
			</li>
			<li style="text-align:right;margin-right:4px">
				--Dhiya</li>
		
			<li style="word-break:break-all">
				<a id="SingleColumn1__2b8cb31_CommentList_ctl03_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2015/12/04/428456.html#428521">3. re: 【原创】轻量级移动端即时通讯技术 MobileIMSDK 发布了</a>
			</li>
			<li style="word-break:break-all">
				@colin<br>包含。
			</li>
			<li style="text-align:right;margin-right:4px">
				--Jack Jiang</li>
		
			<li style="word-break:break-all">
				<a id="SingleColumn1__2b8cb31_CommentList_ctl04_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2015/12/04/428456.html#428515">4. re: 【原创】轻量级移动端即时通讯技术 MobileIMSDK 发布了[未登录]</a>
			</li>
			<li style="word-break:break-all">
				包含服务端吗？
			</li>
			<li style="text-align:right;margin-right:4px">
				--colin</li>
		
			<li style="word-break:break-all">
				<a id="SingleColumn1__2b8cb31_CommentList_ctl05_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2014/12/10/387782.html#421256">5. re: 【原创】符合当前主流审美的原创Swing外观 - BeautyEye L&amp;F 正式发布</a>
			</li>
			<li style="word-break:break-all">
				下不了。呜呜~~~~~
			</li>
			<li style="text-align:right;margin-right:4px">
				--agirls</li>
		
			</ul>
		
</div>

<h3>阅读排行榜</h3>
<div class="RecentComment">
	
			<ul style="word-break:break-all">
		
			<li>
				<a id="SingleColumn1__2c0e345_TopList_ctl01_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2012/09/15/387782.html">1. 【原创】符合当前主流审美的原创Swing外观 - BeautyEye L&amp;F 正式发布(2833)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__2c0e345_TopList_ctl02_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2015/12/01/428456.html">2. 【原创】轻量级移动端即时通讯技术 MobileIMSDK 发布了(2669)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__2c0e345_TopList_ctl03_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2015/12/14/428642.html">3. 【原创】轻量级移动端即时通讯技术MobileIMSDK的常见问题解答(2335)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__2c0e345_TopList_ctl04_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2012/10/31/390545.html">4. 【原创】项目管理杂谈(1)：代码评审这点事，元芳你怎么看(1613)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__2c0e345_TopList_ctl05_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2016/06/20/430973.html">5. 【原创】NIO框架入门(一)：服务端基于Netty4的UDP双向通信Demo演示(892)</a>
			</li>
		
			</ul>
		
</div>

<h3>评论排行榜</h3>
<div class="RecentComment">
	
			<ul style="word-break:break-all">
		
			<li>
				<a id="SingleColumn1__3cf0d25_TopList_ctl01_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2012/09/15/387782.html">1. 【原创】符合当前主流审美的原创Swing外观 - BeautyEye L&amp;F 正式发布(8)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__3cf0d25_TopList_ctl02_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2016/07/15/431214.html">2. Web端即时通讯技术盘点：短轮询、Comet、Websocket、SSE(2)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__3cf0d25_TopList_ctl03_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2015/12/01/428456.html">3. 【原创】轻量级移动端即时通讯技术 MobileIMSDK 发布了(2)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__3cf0d25_TopList_ctl04_Hyperlink1" href="http://www.blogjava.net/jb2011/archive/2012/10/31/390545.html">4. 【原创】项目管理杂谈(1)：代码评审这点事，元芳你怎么看(0)</a>
			</li>
		
			<li>
				<a id="SingleColumn1__3cf0d25_TopList_ctl05_Hyperlink1" href="#">5. Android后台保活实践总结：即时通讯应用无法根治的“顽疾”(0)</a>
			</li>
		
			</ul>
		
</div>

				
			</div>
		</td>
		<td class="MainCell" width="100%">
			<div id="main">
				
					
	<div class="post">
		<div class="posthead">
			<h2>
				<a id="viewpost1_TitleUrl" class="singleposttitle" href="#">Android后台保活实践总结：即时通讯应用无法根治的“顽疾”</a>
			</h2>
 			Posted on 2016-08-02 22:43 <a href="http://www.blogjava.net/jb2011/">Jack Jiang</a> 阅读(139) <a href="#Post">评论(0)</a>  <a href="http://www.blogjava.net/jb2011/admin/EditPosts.aspx?postid=431434">编辑</a>  <a href="http://www.blogjava.net/jb2011/AddToFavorite.aspx?id=431434">收藏</a>  
			<img src="index_files/431434.html.jpg" height="1" width="1">
			
<!--
<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
<rdf:Description
rdf:about="http://www.blogjava.net/jb2011/archive/2016/08/02/431434.html"
dc:identifier="http://www.blogjava.net/jb2011/archive/2016/08/02/431434.html"
dc:title="Android后台保活实践总结：即时通讯应用无法根治的“顽疾”"
trackback:ping="http://www.blogjava.net/jb2011/services/trackbacks/431434.aspx" />
</rdf:RDF>
-->

		</div>
		<div class="postbody"><h1 class="dc_h2head" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">前言</h1><h1><div style="display: inline-block;"><div id="cnblogs_post_body" style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">Android进程和Service的保活，是困扰Android开发人员的一大顽疾。因涉及到省电和内存管理策略，各厂商基于自家的理解，在自已ROOM发布于都对标准Android发行版作为或多或少的改动，使得应用层程序在处理进程和Service保活问题上变的异常复杂，且很难兼容，因为说不定哪款手机或者哪个版本的省电策略发生改变，那么随之而来的就是进程和Service保活的差异。<br><br>在应用场景上，由于即时通讯应用（包括IM聊天应用、消息推送服务等）为了保证消息的全时、实时送达能力，必须要实现进程或Service的保活。而就这一看似不起眼的问题，实际处理起来，因为众多Android手机和Android系统版本的差异，让问题的处理充满了不确定性。<br><br>本文基于作者的实践以及相关资料的整理，总结了自已对Android进程和Service保活的理解，希望能为你的应用开发带来启发。<span style="line-height: 25.2px; color: #888888;">（本文同步发布于：</span><a href="http://www.52im.net/thread-429-1-1.html" style="line-height: 25.2px; color: #1d58d1; text-decoration: none;">http://www.52im.net/thread-429-1-1.html</a><span style="line-height: 25.2px; color: #888888;">）</span></p></div></div></h1><h1 style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">学习交流</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">- 更多即时通讯技术资料：<a href="http://www.52im.net/forum.php?mod=collection&amp;op=all" rel="nofollow" target="_blank" style="color: #1d58d1; text-decoration: none;">http://www.52im.net/forum.php?mod=collection&amp;op=all</a></p><p style="margin: 10px auto; text-indent: 0px;">- 即时通讯开发交流群：<img src="index_files/848699-20160715181415061-1759908109.png" alt="" style="border: 0px; max-width: 900px;"> <a href="http://shang.qq.com/wpa/qunwpa?idkey=4cc788473d261129ab3ded26fbb22168d0fa52c799d28f92a8f193dc36865bcb" rel="nofollow" target="_blank" style="color: #1d58d1; text-decoration: none;">215891622</a> <span style="font-size: 12px;">[<span style="color: #ff0000;">推荐</span>]</span></p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">概述</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">近期做了一个Android项目，涉及到了后台进程和Service保活的问题，网上找了很多资料，基本的保活方法都测试了。结果是：不同的手机，不同的Android版本保活效果各有差异。最难绕过的是个厂商对“后台程序保活”管理。<br><br>本文主要把相应的实践结果和保活方法进行总结。然而，因笔者可用的测试真机有限，可能存有不完整的地方，还请及时提出指正并补充，大家共同进步。</p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">手机QQ、微信这样的大型IM是如何解决保活问题的？</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">以小米手机为例，MIUI的神隐模式让很多IM和推送开发同行纠结不已：在MIUI深度休眠之后,默认会彻底断开后台应用的socket。但微信、QQ这样的应用，MIUI官方的帖子说了:给这2个应用特殊照顾。好吧，特殊照顾，普通的APP只能继续折腾了。<br><br><span style="color: gray;">（关于MIUI的神隐模式的讨论，见此贴的回复：</span><a href="http://www.52im.net/thread-354-1-1.html" target="_blank" style="color: #1d58d1; text-decoration: none;">http://www.52im.net/thread-354-1-1.html</a><span style="color: gray;">）</span></p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">本文实践涉及到的真机型号和版本</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">手机：三星9100-4.1.2，三星9300-4.3，华为G730-4.1.2，华为TL00H-EMUI3.1(android 5.1.1)，魅族MX4-Flyme4.2.8.2c(android 4.4.2)。<br><br>手头能用的测试机就这些了。主要测试的service是一个最基本的service，在相应的生命周期的触发函数上做了输出。测试时都没有添加到后台保护中，注：三星的机子没找到有后台保护设置的地方。</p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">为什么我们的后台进程/Service会被结束掉？</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">我想到的是有三个方面：</p><ul class="litype_1" style="margin-left: 30px; padding-left: 0px;" type="1"><li style="list-style-type: disc;">Android系统内存回收机制；</li><li style="list-style-type: disc;">各厂商对后台程序的一个管理制度（就是允许程序后台运行那个）；</li><li style="list-style-type: disc;">第三方软件的清理(360什么的)。</li></ul><p style="margin: 10px auto; text-indent: 0px;"><br>其中有的后台程序保护把程序结束的同时会把程序弄成停止状态，导致无法接收广播！</p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">我们的保活方案有哪些？</h1><h4 class="dc_h3" style="font-size: 16px; font-weight: normal; line-height: 1.5; padding-left: 10px; margin-left: 10px; margin-right: 10px;"><strong>1）控制onStartCommand函数的返回值：</strong></h4><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">我对这个函数的理解是：当服务被异常终止时，是否重启服务?有些文章里面在用这个做保活时，修改的是flag，在我实际测试中是无效。有效的做法是直接返回参数。另外默认的flags值为0，是START_STICKY_COMPATIBILITY。<br><br>具体代码如下：</p><div><div><div id="highlighter_313768" class="syntaxhighlighter notranslate java" style="width: 946px; margin: 1em 0px !important; position: relative !important; overflow: auto !important; font-size: 1em !important; background-color: #ffffff !important;"><table style="border-radius: 0px !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: 946px; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; border-collapse: collapse; word-break: break-word; background: none !important;" border="0" cellpadding="0" cellspacing="0"><tbody style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; background: none !important;"><tr style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; background: none !important;"><td class="gutter" style="font-size: 12px !important; border-radius: 0px !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 3px; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: 35px !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; min-height: auto !important; color: #afafaf !important; border-collapse: collapse; background: none !important;"><div class="line number1 index0 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;">1</div><div class="line number2 index1 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;">2</div><div class="line number3 index2 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;">3</div><div class="line number4 index3 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;">4</div><div class="line number5 index4 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;">5</div><div class="line number6 index5 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 0.5em !important; position: static !important; right: auto !important; text-align: right !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;">6</div></td><td class="code" style="font-size: 12px !important; border-radius: 0px !important; border: 1px solid silver; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 3px; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; min-height: auto !important; border-collapse: collapse; background: none !important;"><div class="container" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.1em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: relative !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; background: none !important;"><div class="line number1 index0 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;"><code class="java color1" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: gray !important; background: none !important;">@Override</code></div><div class="line number2 index1 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;"><code class="java plain" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: #000000 !important; background: none !important;">publicintonStartCommand(Intent intent,intflags,intstartId) {</code></div><div class="line number3 index2 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;"><code class="java spaces" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; background: none !important;">    </code><code class="java comments" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: #008200 !important; background: none !important;">// TODO Auto-generated method stub</code></div><div class="line number4 index3 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;"><code class="java spaces" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; background: none !important;">    </code><code class="java plain" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: #000000 !important; background: none !important;">returnSTART_STICKY;</code></div><div class="line number5 index4 alt2" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #f4f4f4 !important;"><code class="java spaces" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; background: none !important;">    </code><code class="java comments" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: #008200 !important; background: none !important;">//return super.onStartCommand(intent, flags, startId);</code></div><div class="line number6 index5 alt1" style="border-radius: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px 1em !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: normal !important; background: none #ffffff !important;"><code class="java plain" style="border-radius: 0px !important; border: 0px !important; bottom: auto !important; float: none !important; height: auto !important; left: auto !important; line-height: 1.8em !important; margin: 0px !important; outline: 0px !important; overflow: visible !important; padding: 0px !important; position: static !important; right: auto !important; text-align: left !important; top: auto !important; vertical-align: baseline !important; width: auto !important; box-sizing: content-box !important; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-weight: normal !important; font-style: normal !important; font-size: 12px !important; min-height: auto !important; white-space: pre-wrap; color: #000000 !important; background: none !important;">}</code></div></div></td></tr></tbody></table></div></div></div><p style="margin: 10px auto; text-indent: 0px;"><br>测试结果：<br>魅族的机子无效，不管默认还是修改参数，在DDMS里面直接结束进程后都不会重启服务。其它三台机子（9100没测）：默认参数的情况下就会重启服务，return START_STICKY 会重启，return START_NOT_STICKY 不会重启。<br><br>另外：用360一键清理，或者360超级ROOT的手机优化，会杀死进程，过会儿还是会重启，只是会慢很多，大概是在排队重启服务。<br><br></p></div></div></h1><h4 class="dc_h3" style="font-size: 16px; font-weight: normal; line-height: 1.5; padding-left: 10px; margin-left: 10px; margin-right: 10px;"><strong>2）在service 的onDestory里面重启服务：</strong></h4><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">这个在所有能触发onDestory的情况下都是有效的。4台测试机都测试过。直接startService 或者发送广播重启都可以 。<br><br>但能触发onDestory的情况，我不知道内存回收会不会触发。另外两种情况（2，3）是不触发的。我的测试方法是在“设置”-&gt; 应用管理-&gt; 正在运行-&gt; 停止服务。（这个是正常停止服务，会触发onDestory，所以上面的onStartCommand效果不会触发。）<br><br></p></div></div></h1><h4 class="dc_h3" style="font-size: 16px; font-weight: normal; line-height: 1.5; padding-left: 10px; margin-left: 10px; margin-right: 10px;"><strong>3）提高服务的优先级：</strong></h4><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">这个主要是针对第一种kill服务的情况，内存回收机制。由于这个测试比较难搭建。360清理什么把后台的进程都杀的，体现不出优先级这样的概念。我的建议是能提高就提高，下面几个实验。<br><br>[1] 前台service：<br>创建一个通知使自己成为前台service<br>测试结果：<br>360一键清理和手机优化，不会把该service结束掉。<br><br>[2] 对于后台保护：<br>华为G730不结束service，魅族和华为TL00H都会结束service。通知栏的保活效果还是可以的，一般的应用要求基本能满足了。<br><br>[3] 若有root权限：<br>android:persistent="true",并放入system/app中<br>测试结果：<br>效果一般，三星9100上用360等清理工具杀不掉进程，在华为G730上没什么效果.（这个测试跟onStartCommand有点干扰）。<br><br></p></div></div></h1><h4 class="dc_h3" style="font-size: 16px; font-weight: normal; line-height: 1.5; padding-left: 10px; margin-left: 10px; margin-right: 10px;"><strong>4）守护进程：</strong></h4><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">双服务：360会同时杀掉两个服务，分两个apk也一样。<br>native守护进程：360不会杀掉native的守护进程，但在魅族和华为TL00H中待机一段时间后还是会被杀掉。<br><br>结论和待续：<br>1. 一般的应用添加到后台保护进程后，改个onStartCommand返回值，再加个通知。基本上大部分都能保活了。<br>2. 双服务我觉得没有native守护进程来的好，虽然360，微信什么的都有几个进程服务，但如果不添加到后台保活的话，效果一样不能保活，也会进入停止状态。<br>3. 但是.360手机助手会创建双natice守护进程做相互的看守。存活的效果会高一点点。“没添加到后台保活”一般只会杀一次，（魅族是屏幕关闭后5分钟，华为TL00H是屏幕关闭时）。<br><br>附个native守护进程：利用socket来判断服务是否存在，需要在被保活的服务里创建一个监听socket。调试信息会在SD卡目录下创建一个daemon.log。使用方法：NDKFork port包名/.服务名。具体下载链接：<br><a href="http://download.csdn.net/detail/pvlking/9412815" target="_blank" style="color: #1d58d1; text-decoration: none;">http://download.csdn.net/detail/pvlking/9412815</a></p></div></div></h1><h1 style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">Android应用实现保活的基本原理总结</h1><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">都是通过双进程互拉以及设置进程的重要性，除非你root后，把自己的进程设置成系统进程。<br><br>互拉的方式有很多种：</p><ul class="litype_1" style="margin-left: 30px; padding-left: 0px;" type="1"><li style="list-style-type: disc;">可以通过监听系统广播来把自己拉起来</li><li style="list-style-type: disc;">可以多个app相互拉</li><li style="list-style-type: disc;">可以把自己的服务搞成前台服务</li><li style="list-style-type: disc;">在service的onstart方法里返回 STATR_STICK</li><li style="list-style-type: disc;">添加Manifest文件属性值为android:persistent=“true”</li><li style="list-style-type: disc;">覆写Service的onDestroy方法</li><li style="list-style-type: disc;">服务互相绑定</li><li style="list-style-type: disc;">设置闹钟，定时唤醒</li><li style="list-style-type: disc;">自己的app在native层fork一个子进程来与主进程互拉。</li></ul><p style="margin: 10px auto; text-indent: 0px;"><br>综上所述，总结下来就是，目前实现Android后台保活没有完美实现，只能针对不同的机型综合使用上面列举的方法，同时祈祷自已APP的用户不要遇到奇葩机型的保活问题。</p></div></div></h1><h1 class="dc_h2" style="margin: 0px 0px 0px 5px; padding-top: 5px; font-size: 28px; font-weight: bold;">推荐一个开源的解决方案 </h1><h3 class="dc_h3" style="font-size: 18px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #aaaaaa; font-weight: bold; padding-left: 10px; margin-left: 10px; margin-right: 10px;">1）源码托管地址</h3><h1><div style="display: inline-block;"><div style="margin-bottom: 20px; word-break: break-word; color: #000000; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-style: normal; font-variant: normal; font-weight: normal; letter-spacing: normal; line-height: 25.2px; orphans: auto; text-align: start; text-indent: 0px; text-transform: none; white-space: normal; widows: 1; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: #ffffff;"><p style="margin: 10px auto; text-indent: 0px;">源码托管地址是：<a href="https://github.com/52im/MarsDaemon" target="_blank" style="color: #1d58d1; text-decoration: none;">https://github.com/52im/MarsDaemon</a>。<br><br></p></div></div></h1><h3 class="dc_h3" style="font-size: 18px; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #aaaaaa; font-weight: bold; padding-left: 10px; margin-left: 10px; margin-right: 10px;">2）实现原理</h3><h1><div style="margin-bottom: 20px; word-break: break-word; font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-weight: normal; line-height: 25.2px; background-color: #ffffff;"><p style="margin-top: 10px; margin-bottom: 10px;"><span style="color: #a0522d;">原理：</span>使用Jni,在 c端 fork进程，检测Service是否存活，若Service已被杀死，则进行重启Service.  至于检测方式，可以轮询获取子进程Pid,若为1, 则说明子进程被Init进程所领养,已经成为了孤儿进程.    但是这种方式比较消耗电量，并且由于不同手机系统定制的改变，当应用被强制停止时，父进程并不一定被真正杀死，因此在一些特定机型上是无法通过此方式进行判断. 这里推荐使用liunx socket的方式进行类似心跳包的检测，并且当触发检测Service是否被杀死之前，需要判断应用是否已经被卸载，如果应用已经被卸载，则不再进行检测Service行为，直接调用exit(0)退出子进程，避免浪费系统资源和消耗电量.<br><br><span style="color: #a0522d;">注意:</span> 目前在Android 5.0系统上会把fork出来的进程放到一个进程组里， 当程序主进程挂掉后，也会把整个进程组杀掉,因此用fork的方式也无法在Android5.0及以上系统实现守护进程. 这个是系统层面的限制，当然也是为了优化整个的系统环境,守护进程给手机带来的体验并不好<br><br><span style="color: #a0522d;">具体见源码：</span><br><a href="http://androidxref.com/5.0.0_r2/xref/frameworks/base/services/core/java/com/android/server/am/ProcessRecord.java" target="_blank" style="color: #1d58d1; text-decoration: none;">http://androidxref.com/5.0.0_r2/ ... /ProcessRecord.java</a><br><img id="aimg_1264" title="Android后台保活实践总结：即时通讯应用无法根治的“顽疾”_1809710-8f67dfa36f847c43.png" src="index_files/173822mtblaqqjlb76b1c6.png" alt="Android后台保活实践总结：即时通讯应用无法根治的“顽疾”_1809710-8f67dfa36f847c43.png" style="border: 0px; max-width: 900px;" width="797"> <br><br><span style="color: #a0522d;">好消息：</span><br>Android5.0 以上目前已在 <a href="https://github.com/52im/MarsDaemon" target="_blank" style="color: #1d58d1; text-decoration: none;">https://github.com/52im/MarsDaemon</a> 中被黑科技攻克，部分机型可能无法起到作用，但思路很值得借鉴，代码结构也不错, 具体方案请见源码哦。</p><p style="margin-top: 10px; margin-bottom: 10px;"> </p><p style="margin-top: 10px; margin-bottom: 10px;"><span style="color: #888888;">（本文同步发布于：<a href="http://www.52im.net/thread-429-1-1.html" style="color: #1d58d1; text-decoration: none;">http://www.52im.net/thread-429-1-1.html</a>）</span></p></div><div id="MySignature" style="font-family: Verdana, Arial, Helvetica, sans-serif; font-size: 14px; font-weight: normal; line-height: 25.2px; background-color: #ffffff;"><div id="AllanboltSignature"><p id="PSignature" style="margin: 0px; border: 1px dashed #e0e0e0; padding: 25px 10px 25px 160px; font-family: 微软雅黑; font-size: 11px; background: url(&quot;index_files/js3.png&quot;) 1% 50% no-repeat #e5f1f4;"><strong>作者：</strong><a href="https://github.com/JackJiang2011" target="_blank" style="color: #1d58d1; text-decoration: none;">Jack Jiang</a> (点击作者姓名进入Github) <br><strong>出处：</strong><a href="http://www.52im.net/space-uid-1.html" target="_blank" style="color: #1d58d1; text-decoration: none;">http://www.52im.net/space-uid-1.html</a> <br><strong>交流：</strong>欢迎加入即时通讯开发交流群 <a href="http://shang.qq.com/wpa/qunwpa?idkey=4cc788473d261129ab3ded26fbb22168d0fa52c799d28f92a8f193dc36865bcb" target="_blank" style="color: #1d58d1; text-decoration: none;">215891622</a> <br><strong>讨论：</strong><a href="http://www.52im.net/" target="_blank" style="color: #1d58d1; text-decoration: none;">http://www.52im.net/</a> <br><strong>Jack Jiang同时是</strong><a href="http://git.oschina.net/jackjiang/beautyeye/" target="_blank" style="color: #1d58d1;">【原创Java Swing外观工程BeautyEye】</a>和<a href="http://git.oschina.net/jackjiang/beautyeye/" target="_blank" style="color: #1d58d1; text-decoration: none;">【轻量级移动端即时通讯框架MobileIMSDK】</a>的作者，可前往下载交流。<br>本博文 欢迎转载，转载请注明出处（也可前往 <a href="http://www.52im.net/" style="color: #1d58d1; text-decoration: none;">我的52im.net</a> 找到我）。 </p></div></div></h1></div>
	</div><script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>

<div id="AjaxHolder_UpdatePanel1">
	    
    
<style><!--
/* Effective stylesheet produced by snapshot save */
td { font-size: 12px; }
.commentTextBox { font-family: Verdana; font-size: 13px; }
--></style>
<!--Beging Temp Save-->
<style><!--
/* Effective stylesheet produced by snapshot save */
.userData {  }
--></style>
<div class="userData" id="CommentsPersistDiv"></div>

<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>
<!--Ene TempSave-->
<div id="divRefreshComments" style="text-align:right;margin-right:10px;margin-bottom:5px;font-size:12px"><a href="http://www.blogjava.net/RequireRegister.aspx">新用户注册</a>  <a id="AjaxHolder_PostComment_refreshList" href="javascript:void(0);">刷新评论列表</a>  </div>
<div class="commentform">
<span id="AjaxHolder_PostComment_ltSubmitMsg" style="color:Red;"></span>
<br>
<a name="Feedback"></a>
	<div id="AjaxHolder_PostComment_divCommnentArea">
		</div><table border="0" cellpadding="1" cellspacing="1">	
		<tbody><tr>
		<td id="AjaxHolder_PostComment_tdOnCommentForm" colspan="3" style="line-height:1.5">		
		</td>
	
		</tr>
		<tr>
			<td colspan="3"></td>
		</tr>
		<tr>
			<td width="75"></td>
			<td></td>
			<td></td>
		</tr>
		<tr>
			<td></td>
			<td colspan="2">
			<a href="http://job.cnblogs.com/" target="_blank">找优秀程序员，就在博客园</a>
			<!--<a href="http://www.cnblogs.com" target="_blank">博客园</a>&nbsp;  <a href="http://q.cnblogs.com/" target="_blank">博问</a>&nbsp; <a href="http://news.cnblogs.com" target="_blank">IT新闻</a>&nbsp; <a href="http://job.cnblogs.com/cate-java_programmer/" target="_blank">Java程序员招聘</a>-->
			</td>
		</tr>
		<tr>
			<td width="55">标题</td>
			<td><input name="AjaxHolder$PostComment$tbTitle" value="re: Android后台保活实践总结：即时通讯应用无法根治的“顽疾”" id="AjaxHolder_PostComment_tbTitle" class="commenttb" style="width:320" type="text"></td>
			<td><span id="AjaxHolder_PostComment_RequiredFieldValidator1" style="color:Red;visibility:hidden;">请输入标题</span></td>
		</tr>
		<tr>
			<td>姓名</td>
			<td><input name="AjaxHolder$PostComment$tbName" id="AjaxHolder_PostComment_tbName" class="commenttb" style="width:320" type="text"></td>
			<td><span id="AjaxHolder_PostComment_RequiredFieldValidator2" style="color:Red;visibility:hidden;">请输入你的姓名</span></td>
		</tr>
		<tr>
			<td>主页</td>
			<td><input name="AjaxHolder$PostComment$tbUrl" id="AjaxHolder_PostComment_tbUrl" class="commenttb" style="width:320" type="text"></td>
			<td><font face="宋体"></font></td>
		</tr>
		<tr>
			<td colspan="3" align="left">
				<table id="AjaxHolder_PostComment_tbCaptchaImage" class="CommentForm" border="0" cellpadding="0" cellspacing="0">
		<tbody><tr>
			<td colspan="3">
							<span id="AjaxHolder_PostComment_Requiredfieldvalidator4" style="color:Red;display:none;">请输入验证码</span>
							<span id="AjaxHolder_PostComment_lblImage" style="color:Red;font-weight:bold;"></span>
						</td>
		</tr>
		<tr>
			<td width="78">验证码</td>
			<td><input name="AjaxHolder$PostComment$CodeNumberTextBox" id="AjaxHolder_PostComment_CodeNumberTextBox" type="text">*  <img src="index_files/JpegImage.aspx.jpg"></td>
			<td align="left"></td>
		</tr>
	</tbody></table>
	
			</td>
		</tr>
		<tr>
			<td colspan="3">内容(请不要发表任何与政治相关的内容)
				<span id="AjaxHolder_PostComment_RequiredFieldValidator3" style="color:Red;visibility:hidden;">请输入评论内容</span><br>
				<textarea name="AjaxHolder$PostComment$tbComment" rows="10" cols="50" id="AjaxHolder_PostComment_tbComment" class="commentTextBox" onkeydown="ctlent(event,'AjaxHolder_PostComment_tbComment')" style="Width:480;Height:220"></textarea></td>
		</tr>
		<tr>
			<td colspan="3">
		<span id="AjaxHolder_PostComment_Message" style="color:Red;"></span>
		</td>
		</tr><tr>
			<td colspan="3"><input id="AjaxHolder_PostComment_chkRemember" name="AjaxHolder$PostComment$chkRemember" checked="checked" tabindex="-1" type="checkbox"><label for="AjaxHolder_PostComment_chkRemember">Remember Me?</label></td>
		</tr>
		<tr>
			<td height="23"><input name="AjaxHolder$PostComment$btnSubmit" value="提交" onclick="" id="AjaxHolder_PostComment_btnSubmit" class="commentButton" type="submit">
				</td>
			<td colspan="2" height="23"> 
				<a id="AjaxHolder_PostComment_lnkLogin" href="http://www.blogjava.net/login.aspx?ReturnURL=http://www.blogjava.net/jb2011/archive/2016/08/02/431434.html&amp;SourceURL=/jb2011/archive/2016/08/02/431434.html">登录</a>  <!--<a id="AjaxHolder_PostComment_linkLoginComment" OnClick="if(document.getElementById('AjaxHolder_PostComment_tbComment').value != '') return confirm('未提交的评论内容将会丢失, 你真的要进入高级评论吗?');" href="http://www.blogjava.net/jb2011/archive/2016/08/02/431434.html?login=1#Post">使用高级评论</a>&nbsp;&nbsp;<a href="http://www.blogjava.net/RequireRegister.aspx">新用户注册</a>&nbsp;&nbsp;<A href="#Top">返回页首</A>&nbsp;&nbsp;<a id="AjaxHolder_PostComment_lbRestore" OnClick="Restore('AjaxHolder_PostComment_tbComment'); return false;" href="/jb2011/archive/2016/08/02/431434.html#Post">恢复上次提交</a>&nbsp;&nbsp;-->    
				</td>
		</tr>
		<tr>
			<td colspan="3"><label class="CtrlEnter">[使用Ctrl+Enter键可以直接提交]</label></td>
		</tr>
		
		
		<tr>
			<td colspan="3"><!----></td>
		</tr>
		<!--
		<TR>
			<TD colSpan="3" height="5"></TD>
		</TR>	
		-->	
		<tr>
		<td colspan="3">
		
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>

<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>
<!-- blogjava_blogpost_bottom -->
<div id="div-gpt-ad-1364133350381-0" style="width:300px; height:250px;">
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>
</div>
<br>

		</td>
		</tr>
		<tr>			
		<td colspan="3">
		
		</td>
		</tr>
		<tr>
		<td colspan="3"></td>
		</tr>
		<tr>
			<td colspan="3" height="1">网站导航:<div id="blogsite">
			<a href="http://www.cnblogs.com/" title="开发者的网上家园">博客园</a>  
			<a href="http://news.cnblogs.com/">IT新闻</a>  
			<a href="http://kb.cnblogs.com/">知识库</a>  
			<a href="http://www.cppblog.com/">C++博客</a>  
			<a href="http://job.cnblogs.com/">程序员招聘</a>  
			<a href="http://www.blogjava.net/jb2011/archive/2016/08/02/431434.html?opt=admin">管理</a>
			</div>
		</td>
		</tr>
		<tr>
			<td colspan="3" height="5"></td>
		</tr>	
		<tr>
			<td colspan="3"> </td>
		</tr>
		<tr>
			<td colspan="3" height="5"></td>
		</tr>
		<tr>
			<td colspan="3">
				</td>
		</tr>		
	</tbody></table>	
</div>
<div id="AjaxHolder_PostComment_ValidationSummary1" style="color:Red;display:none;">

	</div>

</div>

				
			</div>
		</td>
	</tr>
	<tr>
		<td colspan="2" class="FooterCell">
			
<p id="footer">
	Powered by: 
	<br>
	
	<a id="Footer1_Hyperlink3" name="Hyperlink1" href="http://www.blogjava.net/" style="font-family:Verdana;font-size:12px;">BlogJava</a>
	<br>
	Copyright © Jack Jiang
</p>
		</td>
	</tr>
</tbody></table>

Jack Jiang的 Mail: jb2011@163.com, 联系QQ: 413980957， 微信: hellojackjiang
    
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>

<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>


<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>
</form>
    <script type="text/javascript" src="index_files/ShowHidden.js"></script>
	<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>


</body></html>