<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">

<HTML dir=ltr xml:lang="zh-CN" 
xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<title>SpringLDAP Quick Start</title>
<LINK 
rel="shortcut icon" type=image/x-icon href="favicon.ico">
<LINK 
title=JavaEye论坛 rel=alternate type=application/rss+xml 
href="Java">
<LINK title=JavaEye rel=search 
type=application/opensearchdescription+xml href="open_search.xml">
<LINK 
rel=stylesheet type=text/css 
href="forum.css_1300693847" media=screen>
<SCRIPT type=text/javascript 
src="application.js_1299226978"></SCRIPT>
<SCRIPT id=__onDOMContentLoaded defer src="http://:/"></SCRIPT>
<LINK rel=stylesheet type=text/css 
href="SyntaxHighlighter.css_1299226978" 
media=screen>
<SCRIPT type=text/javascript 
src="hotkey.js_1299226978"></SCRIPT>
<SCRIPT type=text/javascript 
src="code_favorites.js_1300153098"></SCRIPT>
<SCRIPT type=text/javascript 
src="dragdrop.js_1299226978"></SCRIPT>
<STYLE type=text/css>
.dp-xml .cdata {
	COLOR: #ff1493
}
.dp-xml .tag {
	COLOR: #069;
	FONT-WEIGHT: bold
}
.dp-xml .tag-name {
	COLOR: #069;
	FONT-WEIGHT: bold
}
.dp-xml .attribute {
	COLOR: red
}
.dp-xml .attribute-value {
	COLOR: blue
}
</STYLE>
<STYLE type=text/css>
.dp-j .annotation {
	COLOR: #646464
}
.dp-j .number {
	COLOR: #c00000
}
</STYLE>
<STYLE type=text/css>
.dp-j .annotation {
	COLOR: #646464
}
.dp-j .number {
	COLOR: #c00000
}
</STYLE>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>

<BODY>
<DIV id=page>
  <DIV id=content class=clearfix>
    <DIV id=main>
      <TABLE id=forum_main cellSpacing=1>
        <TBODY id=posts>
          <TR id=794218>
            <TD class=postcontent><!--StartFragment-->
              
              <DIV class="postbody clearfix"><STRONG>1：前言</STRONG> <BR>
                本例只在spring-ldap-1.2-RC1.jar下测试通过，sping下的LDAP配置和操作，都类似于JdbcTemplate，所以只要熟悉JdbcTemplate,那么LDAP的配置就显得非常简单。LDAP本身不提供事务，但是Spring使用删除操作来模仿事务。 <BR>
                <BR>
                <STRONG>2：配置LDAP数据源和LdapTemplate</STRONG> <BR>
                <DIV class=dp-highlighter>
                  <DIV class=bar>
                    <DIV class=tools>Xml代码 <A title=复制代码 
onclick="dp.sh.Toolbar.CopyToClipboard(this);return false;" href="http://www.javaeye.com/topic/295136#"><IMG 
alt=复制代码 src="icon_copy.gif"></A>&nbsp;<A onclick="code_favorites_do_favorite(this);return 
&#13;&#10;&#13;&#10;false;" title 
=收藏这段代码 href="javascript:void()" ><IMG class=star alt=收藏代码 
src="icon_star.png"><IMG class=spinner style ="DISPLAY: 
none" src="spinner.gif" ></A></DIV>
                  </DIV>
                  <OL class=dp-xml>
                    <LI><SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>bean</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>id</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"ldapSource"</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>class</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"org.springframework.ldap.core.support.LdapContextSource"</SPAN><SPAN 
class=tag>&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>property</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>name</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"url"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>value</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"ldap://192.168.16.79:10000"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>property</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>name</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"base"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>value</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"dc=somc,dc=com"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>property</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>name</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"userDn"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>value</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"cn=admin"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>property</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>name</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"password"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>value</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"19820914"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;/</SPAN><SPAN 
class=tag-name>bean</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>bean</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>id</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"ldapTemplate"</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=attribute>class</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"org.springframework.ldap.core.LdapTemplate"</SPAN><SPAN 
class=tag>&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>constructor-arg</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>ref</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"ldapSource"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;/</SPAN><SPAN 
class=tag-name>bean</SPAN><SPAN class=tag>&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=tag>&lt;</SPAN><SPAN 
class=tag-name>bean</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>id</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"userDaoLdapImpl"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=attribute>class</SPAN><SPAN>=</SPAN><SPAN 
class=attribute-value>"UserDaoLdapImpl"</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=tag>/&gt;</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN></LI>
                  </OL>
                </DIV>
                <PRE style="DISPLAY: none" class=XML title="SpringLDAP Quick Start" name="code" source_pre_ codeable_ type="Post" id="794218" url="http://www.javaeye.com/topic/295136#794218" index="0" codeable_>&lt;bean id="ldapSource"
		class="org.springframework.ldap.core.support.LdapContextSource"&gt;
		&lt;property name="url" value="ldap://192.168.16.79:10000" /&gt;
		&lt;property name="base" value="dc=somc,dc=com" /&gt;
		&lt;property name="userDn" value="cn=admin" /&gt;
		&lt;property name="password" value="19820914" /&gt;
	&lt;/bean&gt;

	&lt;bean id="ldapTemplate"
		class="org.springframework.ldap.core.LdapTemplate"&gt;
		&lt;constructor-arg ref="ldapSource" /&gt;
	&lt;/bean&gt;
	&lt;bean id="userDaoLdapImpl" class="UserDaoLdapImpl" /&gt;
</PRE>
                <BR>
                <BR>
                <BR>
                <STRONG>3：查询代码</STRONG> <BR>
                <DIV class=dp-highlighter>
                  <DIV class=bar>
                    <DIV class=tools>Java代码 <A title=复制代码 
onclick="dp.sh.Toolbar.CopyToClipboard(this);return false;" href="http://www.javaeye.com/topic/295136#"><IMG 
alt=复制代码 src="icon_copy.gif"></A>&nbsp;<A onclick="code_favorites_do_favorite(this);return 
&#13;&#10;&#13;&#10;false;" title 
=收藏这段代码 href="javascript:void()" ><IMG class=star alt=收藏代码 
src="icon_star.png"><IMG class=spinner style ="DISPLAY: 
none" src="spinner.gif" ></A></DIV>
                  </DIV>
                  <OL class=dp-j>
                    <LI><SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;javax.naming.directory.Attributes; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.ldap.core.AttributesMapper; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.ldap.core.LdapTemplate; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.ldap.transaction.compensating.manager.ContextSourceTransactionManager; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.transaction.TransactionStatus; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.transaction.support.TransactionCallbackWithoutResult; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;org.springframework.transaction.support.TransactionTemplate; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN></SPAN><SPAN class=comment>/** </SPAN>&nbsp;</SPAN>
                    <LI><SPAN><SPAN class=comment>&nbsp;*&nbsp; </SPAN>&nbsp;</SPAN>
                    <LI><SPAN><SPAN class=comment>&nbsp;*&nbsp; </SPAN>&nbsp;</SPAN>
                    <LI><SPAN><SPAN class=comment>&nbsp;*&nbsp;@author&nbsp;kiral </SPAN>&nbsp;</SPAN>
                    <LI><SPAN><SPAN class=comment>&nbsp;*&nbsp;@date&nbsp;2008-12-16 </SPAN>&nbsp;</SPAN>
                    <LI><SPAN><SPAN class=comment>&nbsp;*/</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN></SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>class</SPAN><SPAN>&nbsp;UserDaoLdapImpl&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>private</SPAN><SPAN>&nbsp;LdapTemplate&nbsp;ldapTemplate; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>private</SPAN><SPAN>&nbsp;ContextSourceTransactionManager&nbsp;transactionManager; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>void</SPAN><SPAN>&nbsp;setTransactionManager(ContextSourceTransactionManager&nbsp;transactionManager)&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>this</SPAN><SPAN>.transactionManager&nbsp;=&nbsp;transactionManager; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>void</SPAN><SPAN>&nbsp;setLdapTemplate(LdapTemplate&nbsp;ldapTemplate)&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>this</SPAN><SPAN>.ldapTemplate&nbsp;=&nbsp;ldapTemplate; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>public</SPAN><SPAN>&nbsp;Person&nbsp;getPersonByDn(String&nbsp;dn)&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>new</SPAN><SPAN>&nbsp;TransactionTemplate(transactionManager) 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.execute(</SPAN><SPAN 
class=keyword>new</SPAN><SPAN>&nbsp;TransactionCallbackWithoutResult()&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=annotation>@Override</SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>protected</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>void</SPAN><SPAN>&nbsp;doInTransactionWithoutResult(TransactionStatus&nbsp;status)&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=comment>//&nbsp;TODO&nbsp;Auto-generated&nbsp;method&nbsp;stub </SPAN><SPAN>&nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}); &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>return</SPAN><SPAN>&nbsp;(Person)&nbsp;ldapTemplate.lookup(dn,&nbsp;</SPAN><SPAN 
class=keyword>new</SPAN><SPAN>&nbsp;PersonAttributesMapper()); &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>private</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>class</SPAN><SPAN>&nbsp;PersonAttributesMapper&nbsp;</SPAN><SPAN 
class=keyword>implements</SPAN><SPAN>&nbsp;AttributesMapper&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>public</SPAN><SPAN>&nbsp;Object&nbsp;mapFromAttributes(Attributes&nbsp;attrs) 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>throws</SPAN><SPAN>&nbsp;javax.naming.NamingException&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Person&nbsp;person&nbsp;=&nbsp;</SPAN><SPAN 
class=keyword>new</SPAN><SPAN>&nbsp;Person(); &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;person.setUserCode((String)&nbsp;attrs.get(</SPAN><SPAN 
class=string>"userCode"</SPAN><SPAN>).get()); &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>return</SPAN><SPAN>&nbsp;person; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>}&nbsp;&nbsp;</SPAN></LI>
                  </OL>
                </DIV>
                <PRE style="DISPLAY: none" class=java title="SpringLDAP Quick Start" name="code" source_pre_ codeable_ type="Post" id="794218" url="http://www.javaeye.com/topic/295136#794218" index="1" codeable_>
import javax.naming.directory.Attributes;

import org.springframework.ldap.core.AttributesMapper;
import org.springframework.ldap.core.LdapTemplate;
import org.springframework.ldap.transaction.compensating.manager.ContextSourceTransactionManager;
import org.springframework.transaction.TransactionStatus;
import org.springframework.transaction.support.TransactionCallbackWithoutResult;
import org.springframework.transaction.support.TransactionTemplate;

/**
 * 
 * 
 * @author kiral
 * @date 2008-12-16
 */
public class UserDaoLdapImpl {

	private LdapTemplate ldapTemplate;

	private ContextSourceTransactionManager transactionManager;

	public void setTransactionManager(ContextSourceTransactionManager transactionManager) {
		this.transactionManager = transactionManager;
	}

	public void setLdapTemplate(LdapTemplate ldapTemplate) {
		this.ldapTemplate = ldapTemplate;
	}

	public Person getPersonByDn(String dn) {
		
		new TransactionTemplate(transactionManager)
		.execute(new TransactionCallbackWithoutResult() {

			@Override
			protected void doInTransactionWithoutResult(TransactionStatus status) {
				// TODO Auto-generated method stub
				
			}
			
		});
		
		return (Person) ldapTemplate.lookup(dn, new PersonAttributesMapper());
	}

	private class PersonAttributesMapper implements AttributesMapper {

		public Object mapFromAttributes(Attributes attrs)
				throws javax.naming.NamingException {
			Person person = new Person();
			person.setUserCode((String) attrs.get("userCode").get());
			return person;
		}

	}

}
</PRE>
                <BR>
                <BR>
                <STRONG>4：测试代码</STRONG> <BR>
                <DIV class=dp-highlighter>
                  <DIV class=bar>
                    <DIV class=tools>Java代码 <A title=复制代码 
onclick="dp.sh.Toolbar.CopyToClipboard(this);return false;" href="http://www.javaeye.com/topic/295136#"><IMG 
alt=复制代码 src="icon_copy.gif"></A>&nbsp;<A onclick="code_favorites_do_favorite(this);return 
&#13;&#10;&#13;&#10;false;" title 
=收藏这段代码 href="javascript:void()" ><IMG class=star alt=收藏代码 
src="icon_star.png"><IMG class=spinner style ="DISPLAY: 
none" src="spinner.gif" ></A></DIV>
                  </DIV>
                  <OL class=dp-j>
                    <LI><SPAN><SPAN 
class=keyword>import</SPAN><SPAN>&nbsp;com.ultrapower.somc.managerdashboard.test.DaoTestCase; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN></SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>class</SPAN><SPAN>&nbsp;UserDaoLdapImplTest&nbsp;</SPAN><SPAN 
class=keyword>extends</SPAN><SPAN>&nbsp;DaoTestCase&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>private</SPAN><SPAN>&nbsp;UserDaoLdapImpl&nbsp;userDaoLdapImpl; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>void</SPAN><SPAN>&nbsp;setUserDaoLdapImpl(UserDaoLdapImpl&nbsp;userDaoLdapImpl)&nbsp;{ 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN 
class=keyword>this</SPAN><SPAN>.userDaoLdapImpl&nbsp;=&nbsp;userDaoLdapImpl; 
                      &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><SPAN class=keyword>public</SPAN><SPAN>&nbsp;</SPAN><SPAN 
class=keyword>void</SPAN><SPAN>&nbsp;testAll()&nbsp;{ &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;dn&nbsp;=&nbsp;</SPAN><SPAN 
class=string>"userCode=user001,ou=somcUser"</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;String&nbsp;userCode&nbsp;=&nbsp;</SPAN><SPAN 
class=string>"user001"</SPAN><SPAN>; &nbsp;&nbsp;</SPAN></SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Person&nbsp;person&nbsp;=&nbsp;userDaoLdapImpl.getPersonByDn(dn); 
                      &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;assertTrue(userCode.equals(person.getUserCode())); 
                      &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>&nbsp;&nbsp;&nbsp;&nbsp;} &nbsp;&nbsp;</SPAN>
                    <LI><SPAN>}&nbsp;&nbsp;</SPAN></LI>
                  </OL>
                </DIV>
                <PRE style="DISPLAY: none" class=java title="SpringLDAP Quick Start" name="code" source_pre_ codeable_ type="Post" id="794218" url="http://www.javaeye.com/topic/295136#794218" index="2" codeable_>import com.ultrapower.somc.managerdashboard.test.DaoTestCase;

public class UserDaoLdapImplTest extends DaoTestCase {

	private UserDaoLdapImpl userDaoLdapImpl;

	public void setUserDaoLdapImpl(UserDaoLdapImpl userDaoLdapImpl) {
		this.userDaoLdapImpl = userDaoLdapImpl;
	}

	public void testAll() {
		String dn = "userCode=user001,ou=somcUser";
		String userCode = "user001";
		Person person = userDaoLdapImpl.getPersonByDn(dn);
		assertTrue(userCode.equals(person.getUserCode()));
	}
}
</PRE>
              </DIV>
              <DIV class=attachments>
                  <LI>  </LI>
              </DIV><!--EndFragment--></TD>
          </TR>
        </TBODY>
      </TABLE>
    </DIV>
  </DIV>
</DIV>
</BODY>
</HTML>