<!DOCTYPE html><!--
 ______________ 
< TUICOOL.COM >
 -------------- 
        \   ^__^
         \  (**)\__$__$__
            (__)\       )\/\
             U  ||------|
                ||     ||
--><html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="authenticity_token" name="csrf-param">
<meta content="/4bskBC/CT+4EEcvJLFSJPBXbjmc9rWoxN/ordI08js=" name="csrf-token">
    <title>
            Java实现的Bloom Filter - 推酷
   </title>
    <meta name="description" content="Java实现的Bloom Filter">
  <link rel="shortcut icon" href="index_files/favicon.ico" type="image/x-icon">
  <link href="index_files/application-bc9f103ffac633f3e0506001890d1135.css" media="screen" rel="stylesheet" type="text/css">
  <link href="index_files/font-awesome.min.css" rel="stylesheet">
  <script src="index_files/application-9d8e2864bc094ddf228d2147120a4b1f.js" type="text/javascript"></script>

  <!--[if IE 7]>
  <link rel="stylesheet" href="http://assets.tuicool.com/assets/font-awesome-ie7.min.css">
  <![endif]--> 
    <script type="text/javascript" src="index_files/tip.js"></script>
  
  <script type="text/javascript" src="index_files/m.js"></script>
<script src="index_files/ds.js"></script>
<script type="text/javascript" src="index_files/spin.min.js"></script><style type="text/css"></style>
<link rel="stylesheet" href="index_files/github.css">

<script src="index_files/share.js"></script><link href="index_files/share_style1_24.css" rel="stylesheet"></head>
<body>
  <div class="container-fluid">  
      
  <div class="row-fluid article_row_fluid">
    <div class="span8 contant article_detail_bg">
        <h1>Java实现的Bloom Filter</h1>
        <div class="article_meta">
            <div style="margin-bottom: 5px;">
            <span class="timestamp">时间 2015-12-23 13:42:17
            </span>
            <span class="from">
                <i class="icon-globe"></i>
                    <a class="cut cut28 from" href="http://www.tuicool.com/sites/QZZ7fi" target="_blank">搜不狐
                    </a>
            </span>
            </div>
            <div class="source">
                <i style="float:left;">原文</i>  
                <a class="cut cut70" href="http://sobuhu.com/algorithm/2013/03/04/java-bloom-filter.html?utm_source=tuicool&amp;utm_medium=referral" style="display:inline-block;">http://sobuhu.com/algorithm/2013/03/04/java-bloom-filter.html</a>
            </div>
            <div>
                <span>主题</span>
                <a href="http://www.tuicool.com/topics/11110045" target="_blank">
                    <span class="new-label">布隆过滤器</span>
                </a>
                <a href="http://www.tuicool.com/topics/11000072" target="_blank">
                    <span class="new-label">Java</span>
                </a>
            </div>
        </div>
        <div class="article_body" id="nei">
            <div> 
 <h2>Java实现简单的Bloom Filter</h2> 
 <p>布隆过滤器在信息去重，比如网页的去重、邮件去重以及URL去重上很常用，其原理也相对简单，主要是通过多个哈希函数来设置bit位作为某条记录的指纹，查询和空间效率都非常不错。</p> 
 <h3>一、基本原理</h3> 
 <p>这篇博客讲的非常好，我就不再狗尾续貂了：</p> 
 <p> <a href="http://www.cnblogs.com/haippy/archive/2012/07/13/2590351.html" rel="nofollow,noindex" target="_blank">http://www.cnblogs.com/haippy/archive/2012/07/13/2590351.html</a> </p> 
 <p> <img src="index_files/2UbUZrj.png%21web.png" class="alignCenter"> </p> 
 <p>简单来说，就是对数据库中的记录$X，Y，Z$分别使用多个（图中为3个）哈希函数，映射到对应的比特位，将比特位置1，如果下一个数据使用相同三个哈希后对应的比特位全为1，则该数据已存在数据库中。</p> 
 <h4>推导结论为(m为bit位个数，n为待添加的记录数，p为冲突概率)</h4> 
 <p>如果已经限定了bitset容量和待添加的记录数，则最优的哈希函数的个数k为</p> 
 <p>此时冲突率为：</p> 
 <p>如果已经限定了冲突概率，则bit数组的大小最优为：</p> 
 <h3>二、构造函数</h3> 
 <pre class="prettyprint java"><code data-lang="java"><span><span class="keyword">public</span></span> <span><span class="class"><span class="keyword">class</span></span></span><span class="class"> <span><span class="title">Bloomfilter</span></span> <span>{</span></span><span></span>
    <span><span class="keyword">private</span></span> <span>BitSet</span> <span>bitSet</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>bitSetSize</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>addedElements</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>hashFunctionNumber</span><span>;</span>
    <span><span class="javadoc">/**</span></span><span class="javadoc">
<span>     * 构造一个布隆过滤器，过滤器的容量为c * n 个bit.</span>
<span>     * <span class="javadoctag">@param</span> c 当前过滤器预先开辟的最大包含记录,通常要比预计存入的记录多一倍.</span>
<span>     * <span class="javadoctag">@param</span> n 当前过滤器预计所要包含的记录.</span>
<span>     * <span class="javadoctag">@param</span> k 哈希函数的个数，等同每条记录要占用的bit数.</span>
<span>     */</span></span><span></span>
    <span><span class="keyword">public</span></span> <span>Bloomfilter</span><span>(</span><span><span class="keyword">int</span></span> <span>c</span><span>,</span> <span><span class="keyword">int</span></span> <span>n</span><span>,</span> <span><span class="keyword">int</span></span> <span>k</span><span>)</span> <span>{</span>
        <span><span class="keyword">this</span></span><span>.</span><span>hashFunctionNumber</span> <span>=</span> <span>k</span><span>;</span>
        <span><span class="keyword">this</span></span><span>.</span><span>bitSetSize</span> <span>=</span> <span>(</span><span><span class="keyword">int</span></span><span>)</span> <span>Math</span><span>.</span><span>ceil</span><span>(</span><span>c</span> <span>*</span> <span>k</span><span>);</span>
        <span><span class="keyword">this</span></span><span>.</span><span>addedElements</span> <span>=</span> <span>n</span><span>;</span>
        <span><span class="keyword">this</span></span><span>.</span><span>bitSet</span> <span>=</span> <span><span class="keyword">new</span></span> <span>BitSet</span><span>(</span><span><span class="keyword">this</span></span><span>.</span><span>bitSetSize</span><span>);</span>
    <span>}</span></code></pre> 
 <p>通常我们要预设一个相对大一点的bit空间，这样冲突才会比较小，哈希函数的数量K也是越多越好，但是通常8个以上就行了，要看能接受的冲突阈值。</p> 
 <p>代码中也提供了获得当前冲突率的函数。</p> 
 <h3>三、完整代码</h3> 
 <p>完整代码包括两个类，一个哈希函数库（从网上搜的8个hash函数），和过滤器类：</p> 
 <pre class="prettyprint java"><code data-lang="java"><span><span class="keyword">package</span></span> <span>crawler</span><span>.</span><span>analysis</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.io.BufferedReader</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.io.FileReader</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.io.IOException</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.util.ArrayList</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.util.BitSet</span><span>;</span>
<span><span class="keyword">import</span></span> <span>java.util.List</span><span>;</span>
<span><span class="keyword">public</span></span> <span><span class="class"><span class="keyword">class</span></span></span><span class="class"> <span><span class="title">Bloomfilter</span></span> <span>{</span></span><span></span>
    <span><span class="keyword">private</span></span> <span>BitSet</span> <span>bitSet</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>bitSetSize</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>addedElements</span><span>;</span>
    <span><span class="keyword">private</span></span> <span><span class="keyword">int</span></span> <span>hashFunctionNumber</span><span>;</span>
    <span><span class="javadoc">/**</span></span><span class="javadoc">
<span>     * 构造一个布隆过滤器，过滤器的容量为c * n 个bit.</span>
<span>     * <span class="javadoctag">@param</span> c 当前过滤器预先开辟的最大包含记录,通常要比预计存入的记录多一倍.</span>
<span>     * <span class="javadoctag">@param</span> n 当前过滤器预计所要包含的记录.</span>
<span>     * <span class="javadoctag">@param</span> k 哈希函数的个数，等同每条记录要占用的bit数.</span>
<span>     */</span></span><span></span>
    <span><span class="keyword">public</span></span> <span>Bloomfilter</span><span>(</span><span><span class="keyword">int</span></span> <span>c</span><span>,</span> <span><span class="keyword">int</span></span> <span>n</span><span>,</span> <span><span class="keyword">int</span></span> <span>k</span><span>)</span> <span>{</span>
        <span><span class="keyword">this</span></span><span>.</span><span>hashFunctionNumber</span> <span>=</span> <span>k</span><span>;</span>
        <span><span class="keyword">this</span></span><span>.</span><span>bitSetSize</span> <span>=</span> <span>(</span><span><span class="keyword">int</span></span><span>)</span> <span>Math</span><span>.</span><span>ceil</span><span>(</span><span>c</span> <span>*</span> <span>k</span><span>);</span>
        <span><span class="keyword">this</span></span><span>.</span><span>addedElements</span> <span>=</span> <span>n</span><span>;</span>
        <span><span class="keyword">this</span></span><span>.</span><span>bitSet</span> <span>=</span> <span><span class="keyword">new</span></span> <span>BitSet</span><span>(</span><span><span class="keyword">this</span></span><span>.</span><span>bitSetSize</span><span>);</span>
    <span>}</span>
    <span><span class="javadoc">/**</span></span><span class="javadoc">
<span>     * 通过文件初始化过滤器.</span>
<span>     * <span class="javadoctag">@param</span> file</span>
<span>     */</span></span><span></span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">void</span></span> <span>init</span><span>(</span><span>String</span> <span>file</span><span>)</span> <span>{</span>
        <span>BufferedReader</span> <span>reader</span> <span>=</span> <span><span class="keyword">null</span></span><span>;</span>
        <span><span class="keyword">try</span></span> <span>{</span>
            <span>reader</span> <span>=</span> <span><span class="keyword">new</span></span> <span>BufferedReader</span><span>(</span><span><span class="keyword">new</span></span> <span>FileReader</span><span>(</span><span>file</span><span>));</span>
            <span>String</span> <span>line</span> <span>=</span> <span>reader</span><span>.</span><span>readLine</span><span>();</span>
            <span><span class="keyword">while</span></span> <span>(</span><span>line</span> <span>!=</span> <span><span class="keyword">null</span></span> <span>&amp;&amp;</span> <span>line</span><span>.</span><span>length</span><span>()</span> <span>&gt;</span> <span><span class="number">0</span></span><span>)</span> <span>{</span>
                <span><span class="keyword">this</span></span><span>.</span><span>put</span><span>(</span><span>line</span><span>);</span>
                <span>line</span> <span>=</span> <span>reader</span><span>.</span><span>readLine</span><span>();</span>
            <span>}</span>
        <span>}</span> <span><span class="keyword">catch</span></span> <span>(</span><span>Exception</span> <span>e</span><span>)</span> <span>{</span>
            <span>e</span><span>.</span><span>printStackTrace</span><span>();</span>
        <span>}</span> <span><span class="keyword">finally</span></span> <span>{</span>
            <span><span class="keyword">try</span></span> <span>{</span>
                <span><span class="keyword">if</span></span> <span>(</span><span>reader</span> <span>!=</span> <span><span class="keyword">null</span></span><span>)</span> <span>reader</span><span>.</span><span>close</span><span>();</span>
            <span>}</span> <span><span class="keyword">catch</span></span> <span>(</span><span>IOException</span> <span>e</span><span>)</span> <span>{</span>
                <span>e</span><span>.</span><span>printStackTrace</span><span>();</span>
            <span>}</span>
        <span>}</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">void</span></span> <span>put</span><span>(</span><span>String</span> <span>str</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span><span>[]</span> <span>positions</span> <span>=</span> <span>createHashes</span><span>(</span><span>str</span><span>.</span><span>getBytes</span><span>(),</span> <span>hashFunctionNumber</span><span>);</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>positions</span><span>.</span><span>length</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span><span class="keyword">int</span></span> <span>position</span> <span>=</span> <span>Math</span><span>.</span><span>abs</span><span>(</span><span>positions</span><span>[</span><span>i</span><span>]</span> <span>%</span> <span>bitSetSize</span><span>);</span>
            <span>bitSet</span><span>.</span><span>set</span><span>(</span><span>position</span><span>,</span> <span><span class="keyword">true</span></span><span>);</span>
        <span>}</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">boolean</span></span> <span>contains</span><span>(</span><span>String</span> <span>str</span><span>)</span> <span>{</span>
        <span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span> <span>=</span> <span>str</span><span>.</span><span>getBytes</span><span>();</span>
        <span><span class="keyword">int</span></span><span>[]</span> <span>positions</span> <span>=</span> <span>createHashes</span><span>(</span><span>bytes</span><span>,</span> <span>hashFunctionNumber</span><span>);</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>:</span> <span>positions</span><span>)</span> <span>{</span>
            <span><span class="keyword">int</span></span> <span>position</span> <span>=</span> <span>Math</span><span>.</span><span>abs</span><span>(</span><span>i</span> <span>%</span> <span>bitSetSize</span><span>);</span>
            <span><span class="keyword">if</span></span> <span>(!</span><span>bitSet</span><span>.</span><span>get</span><span>(</span><span>position</span><span>))</span> <span>{</span>
                <span><span class="keyword">return</span></span> <span><span class="keyword">false</span></span><span>;</span>
            <span>}</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span><span class="keyword">true</span></span><span>;</span>
    <span>}</span>
    <span><span class="javadoc">/**</span></span><span class="javadoc">
<span>     * 得到当前过滤器的错误率.</span>
<span>     * <span class="javadoctag">@return</span></span>
<span>     */</span></span><span></span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">double</span></span> <span>getFalsePositiveProbability</span><span>()</span> <span>{</span>
        <span><span class="comment">// (1 - e^(-k * n / m)) ^ k</span></span>
        <span><span class="keyword">return</span></span> <span>Math</span><span>.</span><span>pow</span><span>((</span><span><span class="number">1</span></span> <span>-</span> <span>Math</span><span>.</span><span>exp</span><span>(-</span><span>hashFunctionNumber</span> <span>*</span> <span>(</span><span><span class="keyword">double</span></span><span>)</span> <span>addedElements</span> <span>/</span> <span>bitSetSize</span><span>)),</span>
                <span>hashFunctionNumber</span><span>);</span>
    <span>}</span>
    <span><span class="javadoc">/**</span></span><span class="javadoc">
<span>     * 将字符串的字节表示进行多哈希编码.</span>
<span>     * <span class="javadoctag">@param</span> bytes 待添加进过滤器的字符串字节表示.</span>
<span>     * <span class="javadoctag">@param</span> hashNumber 要经过的哈希个数.</span>
<span>     * <span class="javadoctag">@return</span> 各个哈希的结果数组.</span>
<span>     */</span></span><span></span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span><span>[]</span> <span>createHashes</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>,</span> <span><span class="keyword">int</span></span> <span>hashNumber</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span><span>[]</span> <span>result</span> <span>=</span> <span><span class="keyword">new</span></span> <span><span class="keyword">int</span></span><span>[</span><span>hashNumber</span><span>];</span>
        <span><span class="keyword">int</span></span> <span>k</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">while</span></span> <span>(</span><span>k</span> <span>&lt;</span> <span>hashNumber</span><span>)</span> <span>{</span>
            <span>result</span><span>[</span><span>k</span><span>]</span> <span>=</span> <span>HashFunctions</span><span>.</span><span>hash</span><span>(</span><span>bytes</span><span>,</span> <span>k</span><span>);</span>
            <span>k</span><span>++;</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>result</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">void</span></span> <span>main</span><span>(</span><span>String</span><span>[]</span> <span>args</span><span>)</span> <span><span class="keyword">throws</span></span> <span>Exception</span> <span>{</span>
        <span>Bloomfilter</span> <span>bloomfilter</span> <span>=</span> <span><span class="keyword">new</span></span> <span>Bloomfilter</span><span>(</span><span><span class="number">30000000</span></span><span>,</span> <span><span class="number">10000000</span></span><span>,</span> <span><span class="number">8</span></span><span>);</span>
        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span><span class="string">"Bloom Filter Initialize ... "</span></span><span>);</span>
        <span>bloomfilter</span><span>.</span><span>init</span><span>(</span><span><span class="string">"data/base.txt"</span></span><span>);</span>
        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span><span class="string">"Bloom Filter Ready"</span></span><span>);</span>
        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span><span class="string">"False Positive Probability : "</span></span>
                <span>+</span> <span>bloomfilter</span><span>.</span><span>getFalsePositiveProbability</span><span>());</span>
        <span><span class="comment">// 查找新数据</span></span>
        <span>List</span><span>&lt;</span><span>String</span><span>&gt;</span> <span>result</span> <span>=</span> <span><span class="keyword">new</span></span> <span>ArrayList</span><span>&lt;</span><span>String</span><span>&gt;();</span>
        <span><span class="keyword">long</span></span> <span>t1</span> <span>=</span> <span>System</span><span>.</span><span>currentTimeMillis</span><span>();</span>
        <span>BufferedReader</span> <span>reader</span> <span>=</span> <span><span class="keyword">new</span></span> <span>BufferedReader</span><span>(</span><span><span class="keyword">new</span></span> <span>FileReader</span><span>(</span><span><span class="string">"data/input.txt"</span></span><span>));</span>
        <span>String</span> <span>line</span> <span>=</span> <span>reader</span><span>.</span><span>readLine</span><span>();</span>
        <span><span class="keyword">while</span></span> <span>(</span><span>line</span> <span>!=</span> <span><span class="keyword">null</span></span> <span>&amp;&amp;</span> <span>line</span><span>.</span><span>length</span><span>()</span> <span>&gt;</span> <span><span class="number">0</span></span><span>)</span> <span>{</span>
            <span><span class="keyword">if</span></span> <span>(!</span><span>bloomfilter</span><span>.</span><span>contains</span><span>(</span><span>line</span><span>))</span> <span>{</span>
                <span>result</span><span>.</span><span>add</span><span>(</span><span>line</span><span>);</span>
            <span>}</span>
            <span>line</span> <span>=</span> <span>reader</span><span>.</span><span>readLine</span><span>();</span>
        <span>}</span>
        <span>reader</span><span>.</span><span>close</span><span>();</span>
        <span><span class="keyword">long</span></span> <span>t2</span> <span>=</span> <span>System</span><span>.</span><span>currentTimeMillis</span><span>();</span>
        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span><span class="string">"Parse 9900000 items, Time : "</span></span> <span>+</span> <span>(</span><span>t2</span> <span>-</span> <span>t1</span><span>)</span> <span>+</span> <span><span class="string">"ms , find "</span></span>
                <span>+</span> <span>result</span><span>.</span><span>size</span><span>()</span> <span>+</span> <span><span class="string">" new items."</span></span><span>);</span>
        <span>System</span><span>.</span><span>out</span><span>.</span><span>println</span><span>(</span><span><span class="string">"Average : "</span></span> <span>+</span> <span><span class="number">9900000</span></span> <span>/</span> <span>((</span><span>t2</span> <span>-</span> <span>t1</span><span>)</span> <span>/</span> <span><span class="number">1000</span></span><span>)</span> <span>+</span> <span><span class="string">" items/second"</span></span><span>);</span>
    <span>}</span>
<span>}</span>
<span><span class="class"><span class="keyword">class</span></span></span><span class="class"> <span><span class="title">HashFunctions</span></span> <span>{</span></span><span></span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>hash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>,</span> <span><span class="keyword">int</span></span> <span>k</span><span>)</span> <span>{</span>
        <span><span class="keyword">switch</span></span> <span>(</span><span>k</span><span>)</span> <span>{</span>
            <span><span class="keyword">case</span></span> <span><span class="number">0</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>RSHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">1</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>JSHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">2</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>ELFHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">3</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>BKDRHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">4</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>APHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">5</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>DJBHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">6</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>SDBMHash</span><span>(</span><span>bytes</span><span>);</span>
            <span><span class="keyword">case</span></span> <span><span class="number">7</span></span><span>:</span>
                <span><span class="keyword">return</span></span> <span>PJWHash</span><span>(</span><span>bytes</span><span>);</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span><span class="number">0</span></span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>RSHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>magic</span> <span>=</span> <span><span class="number">63689</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>hash</span> <span>*</span> <span>magic</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>];</span>
            <span>magic</span> <span>=</span> <span>magic</span> <span>*</span> <span><span class="number">378551</span></span><span>;</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>JSHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">1315423911</span></span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>bytes</span><span>.</span><span>length</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>^=</span> <span>((</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">5</span></span><span>)</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>]</span> <span>+</span> <span>(</span><span>hash</span> <span>&gt;&gt;</span> <span><span class="number">2</span></span><span>));</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>ELFHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>x</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>(</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">4</span></span><span>)</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>];</span>
            <span><span class="keyword">if</span></span> <span>((</span><span>x</span> <span>=</span> <span>hash</span> <span>&amp;</span> <span><span class="number">0xF0000000</span></span><span>)</span> <span>!=</span> <span><span class="number">0</span></span><span>)</span> <span>{</span>
                <span>hash</span> <span>^=</span> <span>(</span><span>x</span> <span>&gt;&gt;</span> <span><span class="number">24</span></span><span>);</span>
                <span>hash</span> <span>&amp;=</span> <span>~</span><span>x</span><span>;</span>
            <span>}</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>BKDRHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>seed</span> <span>=</span> <span><span class="number">131</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>(</span><span>hash</span> <span>*</span> <span>seed</span><span>)</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>];</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>APHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span><span class="keyword">if</span></span> <span>((</span><span>i</span> <span>&amp;</span> <span><span class="number">1</span></span><span>)</span> <span>==</span> <span><span class="number">0</span></span><span>)</span> <span>{</span>
                <span>hash</span> <span>^=</span> <span>((</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">7</span></span><span>)</span> <span>^</span> <span>bytes</span><span>[</span><span>i</span><span>]</span> <span>^</span> <span>(</span><span>hash</span> <span>&gt;&gt;</span> <span><span class="number">3</span></span><span>));</span>
            <span>}</span> <span><span class="keyword">else</span></span> <span>{</span>
                <span>hash</span> <span>^=</span> <span>(~((</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">11</span></span><span>)</span> <span>^</span> <span>bytes</span><span>[</span><span>i</span><span>]</span> <span>^</span> <span>(</span><span>hash</span> <span>&gt;&gt;</span> <span><span class="number">5</span></span><span>)));</span>
            <span>}</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>DJBHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">5381</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>((</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">5</span></span><span>)</span> <span>+</span> <span>hash</span><span>)</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>];</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>SDBMHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">int</span></span> <span>len</span> <span>=</span> <span>bytes</span><span>.</span><span>length</span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>len</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>bytes</span><span>[</span><span>i</span><span>]</span> <span>+</span> <span>(</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">6</span></span><span>)</span> <span>+</span> <span>(</span><span>hash</span> <span>&lt;&lt;</span> <span><span class="number">16</span></span><span>)</span> <span>-</span> <span>hash</span><span>;</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
    <span><span class="keyword">public</span></span> <span><span class="keyword">static</span></span> <span><span class="keyword">int</span></span> <span>PJWHash</span><span>(</span><span><span class="keyword">byte</span></span><span>[]</span> <span>bytes</span><span>)</span> <span>{</span>
        <span><span class="keyword">long</span></span> <span>BitsInUnsignedInt</span> <span>=</span> <span>(</span><span><span class="number">4</span></span> <span>*</span> <span><span class="number">8</span></span><span>);</span>
        <span><span class="keyword">long</span></span> <span>ThreeQuarters</span> <span>=</span> <span>((</span><span>BitsInUnsignedInt</span> <span>*</span> <span><span class="number">3</span></span><span>)</span> <span>/</span> <span><span class="number">4</span></span><span>);</span>
        <span><span class="keyword">long</span></span> <span>OneEighth</span> <span>=</span> <span>(</span><span>BitsInUnsignedInt</span> <span>/</span> <span><span class="number">8</span></span><span>);</span>
        <span><span class="keyword">long</span></span> <span>HighBits</span> <span>=</span> <span>(</span><span><span class="keyword">long</span></span><span>)</span> <span>(</span><span><span class="number">0xFFFFFFFF</span></span><span>)</span> <span>&lt;&lt;</span> <span>(</span><span>BitsInUnsignedInt</span> <span>-</span> <span>OneEighth</span><span>);</span>
        <span><span class="keyword">int</span></span> <span>hash</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">long</span></span> <span>test</span> <span>=</span> <span><span class="number">0</span></span><span>;</span>
        <span><span class="keyword">for</span></span> <span>(</span><span><span class="keyword">int</span></span> <span>i</span> <span>=</span> <span><span class="number">0</span></span><span>;</span> <span>i</span> <span>&lt;</span> <span>bytes</span><span>.</span><span>length</span><span>;</span> <span>i</span><span>++)</span> <span>{</span>
            <span>hash</span> <span>=</span> <span>(</span><span>hash</span> <span>&lt;&lt;</span> <span>OneEighth</span><span>)</span> <span>+</span> <span>bytes</span><span>[</span><span>i</span><span>];</span>
            <span><span class="keyword">if</span></span> <span>((</span><span>test</span> <span>=</span> <span>hash</span> <span>&amp;</span> <span>HighBits</span><span>)</span> <span>!=</span> <span><span class="number">0</span></span><span>)</span> <span>{</span>
                <span>hash</span> <span>=</span> <span>(</span><span><span class="keyword">int</span></span><span>)</span> <span>((</span><span>hash</span> <span>^</span> <span>(</span><span>test</span> <span>&gt;&gt;</span> <span>ThreeQuarters</span><span>))</span> <span>&amp;</span> <span>(~</span><span>HighBits</span><span>));</span>
            <span>}</span>
        <span>}</span>
        <span><span class="keyword">return</span></span> <span>hash</span><span>;</span>
    <span>}</span>
<span>}</span></code></pre> 
 <p>直接运行代码，可以得到：</p> 
 <pre class="prettyprint php"><code data-lang="java"><span>Bloom</span> <span>Filter</span> <span>Initialize</span> <span>...</span>
<span>Bloom</span> <span>Filter</span> <span>Ready</span>
<span><span class="keyword">False</span></span> <span>Positive</span> <span>Probability</span> <span>:</span> <span><span class="number">4.169085162009671</span></span><span class="number"><span>E</span><span>-</span><span>5</span></span><span></span>
<span>Parse</span> <span><span class="number">9900000</span></span> <span>items</span><span>,</span> <span>Time</span> <span>:</span> <span><span class="number">17288</span></span><span>ms</span> <span>,</span> <span>find</span> <span><span class="number">100</span></span> <span><span class="keyword">new</span></span> <span>items</span><span>.</span>
<span>Average</span> <span>:</span> <span><span class="number">582352</span></span> <span>items</span><span>/</span><span>second</span></code></pre> 
</div>
        </div>
        <div class="article_social">
          <div id="share_weixin_image">
            <img src="index_files/qrcode.php.png" height="100px" width="100px">
        </div>
        <script type="text/javascript"><!--

/* Script removed by snapshot save */

--></script>


            <div class="bottom_ad huodong-detail-ad-banner clearfix">
            <script type="text/javascript"><!--

/* Script removed by snapshot save */

--></script>
<script src="index_files/c.js" type="text/javascript"></script>

            </div>
        </div>
        <div id="article_weibo" style="display:none;">
            <div class="article-part-title">
                <span>相关微博</span>
                <sub>
                    <a href="http://www.tuicool.com/articles/weibo_list/fa6VVji" target="_blank">(<i id="weibo_num"></i>)</a> 
               </sub>
            </div>
            <div class="related-weibo-list"></div>
        </div>
    </div>
  </div>

<div class="read-later-alert">
</div>
<div>
   <a href="#add-article-to-kan" id="add-article-to-kan-btn" class="btn" data-toggle="modal" style="display:none;">添加到推刊</a>
   <!-- add_article to kan -->
<div id="add-article-to-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <span class="add-title">收藏到推刊</span>
    <a href="#new-kan" class="btn pull-right" data-toggle="modal">创建推刊</a>
    <i class="clearfix"></i>
  </div>
  <div class="modal-body">
    <ul id="add-kan-list">
    </ul>
  </div>
  <div class="modal-footer">
    <input value="fa6VVji" class="article-id" type="hidden"> 
    <button class="btn btn-primary pull-left add-to-btn">  收 藏  </button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">取消</button>
  </div>
</div>
<div class="add-article-to-kan-alert">
  已收藏到推刊！
</div>

   <div id="new-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-body">
    <input name="name" id="new-kan-name" placeholder="推刊名(必填)" required data-validation-required-message="请填写推刊名" type="text">
    <span class="new-ness-name">请填写推刊名</span>
    <br>
    <textarea name="desc" id="desc" rows="6" placeholder="推刊描述"></textarea>
    <span class="new-ness-desc">描述不能大于100个字符!</span>
    <br>
    权限设置：<input name="type" value="1" checked="checked" type="radio"> 公开
    <input name="type" value="0" type="radio"> 仅自己可见
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-left create-kan-btn" disabled="disabled">创建</button>
    <button class="btn dismiss-new-kan" data-dismiss="modal" aria-hidden="true">取消</button>
  </div>
</div>


</div>
<div id="article-correct-modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3>文章纠错</h3>
    </div>
    <div class="modal-body">
        <input value="fa6VVji" id="article-correct-source" type="hidden">
        <div>
            <label for="article-correct-email">
                邮箱地址
            </label>
            <input id="article-correct-email" class="input-large" type="email">
        </div>
        <div>
            <label for="article-correct-select">
                错误类型
            </label>
            <select id="article-correct-select">
                <option selected="selected" value="正文不准确">正文不准确</option>
                <option value="排版有问题">排版有问题</option>
                <option value="没有分页内容">没有分页内容</option>
                <option value="视频无法显示">视频无法显示</option>
                <option value="图片无法显示">图片无法显示</option>
            </select>
        </div>
        <div>
            <label for="article-correct-other">
                补充信息
            </label>
            <textarea id="article-correct-other" class="span6"></textarea>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right huodong_correct_submit" id="article-correct-submit">
              提交  
        </button>
    </div>
</div>

<style type="text/css"><!--

/* Effective stylesheet produced by snapshot save */

.load-fail { display: none; }

--></style>
<script src="index_files/highlight.pack.js"></script>
<script type="text/javascript"><!--

/* Script removed by snapshot save */

--></script>


</div>

    <div class="footer"></div>

<div style="display:none;">
   <script src="index_files/stat.php.js" language="JavaScript"></script><script src="index_files/core.php.js" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=5541078" target="_blank" title="站长统计"><img src="index_files/pic.gif" border="0" hspace="0" vspace="0"></a>
</div>




<div style="display: none;" title="返回顶部" class="return"></div></body></html>