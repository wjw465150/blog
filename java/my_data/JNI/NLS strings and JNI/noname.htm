<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">

<HTML lang=en-US xml:lang="en-US" 
xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<TITLE>NLS strings and JNI</TITLE>
<LINK 
href="" rel=schema.DC>
<LINK 
href="favicon.ico" rel="SHORTCUT ICON">
<!-- <meta name="IBM.SpecialPurpose" content="SP001" />
<meta name="IBM.PageAttributes" content="sid=1003"/> --><!-- STYLESHEETS/SCRIPTS --><!-- for tables -->
<LINK 
media=screen,print href="table.css" type=text/css 
rel=stylesheet>
<!-- end for tables -->
<LINK href="/developerworks/css/ie6v14.css" type=text/css rel=stylesheet>
<LINK 
href="main.css" type=text/css rel=stylesheet>
<LINK 
media=all href="screen.css" type=text/css 
rel=stylesheet>
<LINK media=print href="print.css" 
type=text/css rel=stylesheet>
<LINK media=screen href="ie2_screen.css" type=text/css 
rel=stylesheet>

<!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</HEAD>

<BODY>
<!--StartFragment--><!--MASTHEAD_BEGIN-->
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
  <TBODY>
    <TR vAlign=top>
      <TD class=bbg width=110><A href="http://www.ibm.com/"><IMG height=52 alt=IBM? 
src="ibm-logo.gif" width=110 border=0></A></TD>
      <TD class=bbg><IMG height=1 alt="" src="c.gif" width=1 
border=0></TD>
      <TD class=mbbg align=right width=650><TABLE cellSpacing=0 cellPadding=0 align=right border=0>
          <TBODY>
            <TR class=cty-tou>
              <TD class=upper-masthead-corner width=17 rowSpan=2><A href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#main"><IMG height=1 
alt="Skip to main content" src="c.gif" width=1 
border=0></A></TD>
              <TD align=left><TABLE cellSpacing=0 cellPadding=0 align=left border=0>
                  <TBODY>
                    <TR>
                      <TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><B class=country>Country/region</B><SPAN 
class=spacer>&nbsp;[</SPAN><A class=ur-link 
href="">select</A><SPAN 
class=spacer>]</SPAN></TD>
                      <TD class=upper-masthead-divider width=29>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
                      <TD align=left><A class=ur-link href="http://www.ibm.com/legal/">Terms of 
                        use</A></TD>
                    </TR>
                  </TBODY>
              </TABLE></TD>
              <TD width=40>&nbsp;</TD>
            </TR>
            <TR>
              <TD class=cty-tou-border colSpan=2 height=1><IMG height=1 alt="" 
src="c.gif" width=1></TD>
            </TR>
            <TR>
              <TD colSpan=3><IMG height=8 alt="" src="c.gif" 
width=1></TD>
            </TR>
            <TR>
              <TD>&nbsp;</TD>
              <TD align=middle colSpan=2><TABLE cellSpacing=0 cellPadding=0 border=0>
                  <TBODY>
                    <TR>
                      <FORM id=form1 name=form1 
action=//www.ibm.com/developerworks/search/searchResults.jsp method=get>
                        <INPUT 
type=hidden value=1 name=searchType>
                        <INPUT type=hidden value=dW name=searchSite>
                        <TD width=18><LABEL for=q><IMG height=1 alt="Search in:" 
src="c.gif" width=1></LABEL></TD>
                        <TD align=right><SELECT class=input-local id=sq size=1 name=searchScope>
                            <OPTION 
value=dW selected>All of dW</OPTION>
                            <OPTION value=dW>-----------------</OPTION>
                            <OPTION value=aixunix>&nbsp;&nbsp;AIX and UNIX</OPTION>
                            <OPTION value=eserver>&nbsp;&nbsp;IBM 
                            Systems</OPTION>
                            <OPTION value=db2>&nbsp;&nbsp;Information Mgmt</OPTION>
                            <OPTION 
value=lotus>&nbsp;&nbsp;Lotus</OPTION>
                            <OPTION value=rdd>&nbsp;&nbsp;Rational</OPTION>
                            <OPTION 
value=tivoli>&nbsp;&nbsp;Tivoli</OPTION>
                            <OPTION value=WSDD>&nbsp;&nbsp;WebSphere</OPTION>
                            <OPTION 
value=dW>-----------------</OPTION>
                            <OPTION value=archZ>&nbsp;&nbsp;Architecture</OPTION>
                            <OPTION value=acZ>&nbsp;&nbsp;Autonomic computing</OPTION>
                            <OPTION value=gridZ>&nbsp;&nbsp;Grid 
                            computing</OPTION>
                            <OPTION value=javaZ>&nbsp;&nbsp;Java technology</OPTION>
                            <OPTION 
value=linuxZ>&nbsp;&nbsp;Linux</OPTION>
                            <OPTION value=opensrcZ>&nbsp;&nbsp;Open source</OPTION>
                            <OPTION value=paZ>&nbsp;&nbsp;Power Architecture</OPTION>
                            <OPTION value=webservZ>&nbsp;&nbsp;SOA 
                            &amp; Web services</OPTION>
                            <OPTION value=webarchZ>&nbsp;&nbsp;Web development</OPTION>
                            <OPTION value=xmlZ>&nbsp;&nbsp;XML</OPTION>
                            <OPTION value=dW>-----------------</OPTION>
                            <OPTION value=forums>&nbsp;&nbsp;dW forums</OPTION>
                            <OPTION 
value=dW>-----------------</OPTION>
                            <OPTION value=aW>alphaWorks</OPTION>
                            <OPTION 
value=dW>-----------------</OPTION>
                            <OPTION value=all>All of 
                            IBM</OPTION>
                        </SELECT></TD>
                        <TD align=right width=7><LABEL for=q><IMG height=1 alt="Search for:" 
src="c.gif" width=1></LABEL>
                        &nbsp;&nbsp;</TD>
                        <TD align=right><INPUT class=input id=q maxLength=100 size=15 name=query></TD>
                        <TD width=7>&nbsp;</TD>
                        <TD width=90><INPUT type=image alt=Search src="search.gif" 
value=Search 
name=Search></TD>
                        <!-- <td width="20">&nbsp;</td> -->
                      </FORM>
                    </TR>
                  </TBODY>
              </TABLE></TD>
            </TR>
          </TBODY>
      </TABLE></TD>
    </TR>
    <TR>
      <TD class=blbg colSpan=3><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
          <TBODY>
            <TR>
              <TD><TABLE cellSpacing=0 cellPadding=0 border=0>
                  <TBODY>
                    <TR>
                      <TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></TD>
                      <TD><A class=masthead-mainlink href="http://www.ibm.com/">Home</A></TD>
                      <TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
                      <TD><A class=masthead-mainlink 
href="">Products</A></TD>
                      <TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
                      <TD><A class=masthead-mainlink 
href="">Services &amp; industry 
                        solutions</A></TD>
                      <TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
                      <TD><A class=masthead-mainlink href="http://www.ibm.com/support/">Support &amp; 
                        downloads</A></TD>
                      <TD class=masthead-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
                      <TD><A class=masthead-mainlink href="http://www.ibm.com/account/">My 
                        IBM</A></TD>
                      <TD><SPAN 
class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN></TD>
                    </TR>
                  </TBODY>
              </TABLE></TD>
            </TR>
          </TBODY>
      </TABLE></TD>
    </TR>
  </TBODY>
</TABLE>
<IMG id=print-masthead height=32 alt="" 
src="print-header.gif" width=510><!--MASTHEAD_END--><!-- CMA ID for this content is: 10433 -->
<TABLE id=v14-body-table cellSpacing=0 cellPadding=0 width="100%" border=0>
    <TBODY>
  
  <TR vAlign=top><!--LEFTNAV_BEGIN-->
    <TD id=navigation width=150><TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
        <TBODY>
          <TR>
            <TD class=left-nav-spacer><A class=left-nav-overview 
href="http://www.ibm.com/developerworks">&nbsp;</A></TD>
          </TR>
        </TBODY>
      </TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
        <TBODY>
          <TR>
            <TD class=left-nav-overview colSpan=2><A class=left-nav-overview 
href="http://www.ibm.com/developerworks">developerWorks</A></TD>
          </TR>
        </TBODY>
      </TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
        <TBODY>
          <TR>
            <TD class=left-nav-highlight colSpan=2><A class=left-nav href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#">In this 
              article:</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#h0">Introduction</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#h1">Java String in Windows</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#h2">Windows string in Java</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#h3">Summary</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#author">About the author</A></TD>
          </TR>
          <TR class=left-nav-child-highlight>
            <TD><IMG height=8 alt="" src="cl-bullet.gif" width=2></TD>
            <TD><A class=left-nav-child href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#rate">Rate this page</A></TD>
          </TR>
          <TR class=left-nav-last>
            <TD width=14><IMG class=display-img height=1 alt="" src="c.gif" 
width=14></TD>
            <TD width=136><IMG class=display-img height=19 alt="" 
src="left-nav-corner.gif" 
width=136></TD>
          </TR>
        </TBODY>
      </TABLE>
      <BR>
      <TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
        <TBODY>
          <TR>
            <TD class=related colSpan=2><B class=related>Related links</B></TD>
          </TR>
          <TR class=rlinks>
            <TD><IMG height=8 alt="" src="rl-bullet.gif" width=2></TD>
            <TD><A class=rlinks 
href="http://www.ibm.com/developerworks/views/java/library.jsp">Java technology 
              technical library</A></TD>
          </TR>
          <!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- No content currently --><!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
          <TR>
            <TD width=14><IMG class=display-img height=1 alt="" src="c.gif" 
width=14></TD>
            <TD width=136><IMG class=display-img height=19 alt="" 
src="c.gif" width=136></TD>
          </TR>
        </TBODY>
      </TABLE>
      <!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- Next Steps Area:  Start --><!-- Commented out the include call in the dwmaster version of this file to prevent ajax calls
     being made during article previews and testing.  Live site has uncommented copy of this file (jpp) --><!-- Call Next Steps Servlet --> 
      <!-- Display Next Steps Result -->
      
      <DIV id=nextsteps>
        <TABLE cellSpacing=0 cellPadding=0 width="70%" border=0>
          <TBODY>
            <TR>
              <TD><IMG height=1 alt="" src="c.gif" 
width=1></TD>
            </TR>
          </TBODY>
        </TABLE>
      </DIV>
      <!-- Initiate Next Steps Call --> 
      <!-- Next Steps Area:  End --><!--END RESERVED FOR FUTURE USE INCLUDE FILES--></TD>
    <!--LEFTNAV_END-->
    <TD width="100%"><TABLE id=content-table cellSpacing=0 cellPadding=0 width="100%" border=0>
        <TBODY>
          <TR vAlign=top>
            <TD width="100%"><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                <TBODY>
                  <TR>
                    <TD><A name=main><IMG height=1 alt="skip to main content" 
src="c.gif" width=592 border=0></A></TD>
                  </TR>
                </TBODY>
              </TABLE>
              <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                <TBODY>
                  <TR vAlign=top>
                    <TD width=10 height=18><IMG height=18 alt="" src="c.gif" 
width=10></TD>
                    <TD width="100%"><IMG height=6 alt="" src="c.gif" width=1><BR>
                      <A 
class=bctl href="http://www.ibm.com/developerworks/">developerWorks</A><SPAN 
class=bct>&nbsp;&nbsp;&gt;&nbsp;&nbsp;</SPAN><A class=bctl 
href="http://www.ibm.com/developerworks/java/">Java technology</A><SPAN 
class=bct>&nbsp;&nbsp;&gt;</SPAN><IMG height=1 alt="" src="c.gif" 
width=1><BR>
                      <H1>NLS strings and JNI</H1>
                    <IMG class=display-img height=6 alt="" 
src="c.gif" width=1></TD>
                    <TD class=no-print width=192><A href="http://www.ibm.com/developerworks/"><IMG 
height=18 alt=developerWorks src="dw.gif" width=192 
border=0></A></TD>
                  </TR>
                </TBODY>
            </TABLE></TD>
          </TR>
        </TBODY>
      </TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
          <TBODY>
        
        <TR vAlign=top>
          <TD width=10><IMG height=1 alt="" src="c.gif" width=10></TD>
          <TD width="100%"><TABLE class=no-print cellSpacing=0 cellPadding=0 width=160 align=right 
border=0>
                <TBODY>
              
              <TR>
                <TD width=10><IMG height=1 alt="" src="c.gif" width=10></TD>
                <TD><TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
                    <TBODY>
                      <TR>
                        <TD class=v14-header-1-small>Document options</TD>
                      </TR>
                    </TBODY>
                  </TABLE>
                  <TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 border=0>
                      <TBODY>
                    
                    <TR>
                      <TD class=no-padding width=150><TABLE cellSpacing=0 cellPadding=0 width=143 border=0>
<TBODY>
                            <TR vAlign=top>
                              <TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
                              <TD width=16><IMG height=16 alt="Set printer orientation to landscape mode" 
src="printer.gif" width=16 vspace=3></TD>
                              <TD width=122><P><B><A class=smallplainlink href="javascript:print()">Print this 
                                  page</A></B></P></TD>
                            </TR>
                          <NOSCRIPT>
                          </NOSCRIPT>
<TR vAlign=top>
                            <TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
                            <TD width=16><IMG height=16 alt="Email this page" 
src="em.gif" width=16 vspace=3></TD>
                            <TD width=122><P><A class=smallplainlink href="javascript:void newWindow()"><B>E-mail this 
                                page</B></A></P></TD>
                          </TR>
                          <NOSCRIPT>
                          <tr valign="top">
                            <td width="8"><img alt="" height="1" width="8" src="c.gif"/></td>
                            <td width="16"><img alt="" width="16" height="16" src="c.gif"/></td>
                            <td class="small" width="122"><p><span class="ast">Document options requiring JavaScript are not displayed</span></p></td>
                          </tr>
                          </NOSCRIPT>
                            </TBODY>
                      </TABLE></TD>
                    </TR>
                      </TBODY>
                  </TABLE>
                  <!--START RESERVED FOR FUTURE USE INCLUDE FILES--><!-- 08/14/07 refreshed by gem, per MOC --><BR>
                  <TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
                    <TBODY>
                      <TR>
                        <TD class=v14-header-2-small>developerWorks spaces</TD>
                      </TR>
                    </TBODY>
                  </TABLE>
                  <TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 border=0>
                    <TBODY>
                      <TR>
                        <TD class=no-padding width=150><TABLE cellSpacing=0 cellPadding=0 width=143 border=0>
                            <TBODY>
                              <TR vAlign=top>
                                <TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
                                <TD><IMG height=16 alt="" src="fw_bold.gif" width=16 
vspace=3 border=0></TD>
                                <TD width=125><P><A class=smallplainlink 
href="">More 
                                    options, more ways to get involved (coming soon)</A> </P></TD>
                              </TR>
                            </TBODY>
                        </TABLE></TD>
                      </TR>
                    </TBODY>
                  </TABLE>
                  <!--END RESERVED FOR FUTURE USE INCLUDE FILES--><BR>
                  <TABLE cellSpacing=0 cellPadding=0 width=150 border=0>
                    <TBODY>
                      <TR>
                        <TD class=v14-header-2-small>Rate this page</TD>
                      </TR>
                    </TBODY>
                  </TABLE>
                  <TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 border=0>
                    <TBODY>
                      <TR>
                        <TD class=no-padding width=150><TABLE cellSpacing=0 cellPadding=0 width=143 border=0>
                            <TBODY>
                              <TR vAlign=top>
                                <TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
                                <TD><IMG height=16 alt="" src="d_bold.gif" width=16 
vspace=3 border=0></TD>
                                <TD width=125><P><A class=smallplainlink href="#rate"><B>Help us improve this 
                                    content</B></A></P></TD>
                              </TR>
                            </TBODY>
                        </TABLE></TD>
                      </TR>
                    </TBODY>
                  </TABLE>
                <BR></TD>
              </TR>
                </TBODY>
            </TABLE>
            <P>Level: Introductory</P>
            <P><A href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#author">David Wendt</A> (<A 
href="mailto:wendt@us.ibm.com%3Fsubject=NLS%20strings%20and%20JNI">wendt@us.ibm.com</A>), 
              WebSphere programmer, IBM<BR>
            </P>
            <P>01 May 1999</P>
            <BLOCKQUOTE>This report presents information and examples for handling national 
              language strings with the Java Native Interface (JNI) for 32-bit Windows 
              platforms.
              <P>The examples is this paper use the Java Development Kit (JDK) version 1.1.6 
                and the <A href="http://java.sun.com/j2se/1.5.0/docs/guide/jni/index.html">Java 
                Native Interface (JNI) Specification</A> created by Sun Microsystems. The native 
                code written in C is compiled and built with the Microsoft Visual C++ 
                compiler.</P>
            </BLOCKQUOTE>
            <!--START RESERVED FOR FUTURE USE INCLUDE FILES--> 
            <!--END RESERVED FOR FUTURE USE INCLUDE FILES-->
            
            <P><A name=h0><SPAN class=atitle>Introduction</SPAN></A></P>
            <P>Java applications are intended to be national language independent, just as 
              they are intended to be operating system independent. If native methods are 
              required on Windows, the Java application which implements the JNI methods will 
              require special code when handling strings. Strings in Java are managed in 
              Unicode. In Windows, strings are displayed and inputted in the current code 
              page. Therefore, conversions are necessary if user input or output is required 
              in a native method.</P>
            <P>There are two JNI APIs to access Java strings from Windows native 
              methods:</P>
            <UL type=disc>
              <LI>GetStringUTFChars
              <LI>GetStringChars </LI>
            </UL>
            <P>The UTF format is defined by Java and matches the first 127 characters of the 
              ASCII table. The UTF methods cannot generally be used because other national 
              language characters in the UTF format cannot be understood by Windows APIs. 
              However, these methods are very convenient for simple strings, such as debug 
              messages, where a user is not required to convert Java strings directly to and 
              from the C-style <I>char*</I> type.</P>
            <P>The non-UTF (Unicode) JNI methods can be used but require special Windows 
              APIs to convert them for display. The data produced by the Unicode methods is 
              called wide-char or <I>wchar*</I> in Windows. The following Windows APIs are 
              used to convert these strings:</P>
            <UL type=disc>
              <LI>WideCharToMultiByte
              <LI>MultiByteToWideChar </LI>
            </UL>
            <P>This paper will develop simple examples showing how these methods are 
              used.</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"></TD>
                </TR>
              </TBODY>
            </TABLE>
            <TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
              <TBODY>
                <TR align=right>
                  <TD><TABLE cellSpacing=0 cellPadding=0 border=0>
                      <TBODY>
                        <TR>
                          <TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
                          <TD vAlign=top align=right><A class=fbox href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#main"><B>Back to 
                            top</B></A></TD>
                        </TR>
                      </TBODY>
                  </TABLE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <BR>
            <P><A name=h1><SPAN class=atitle>Java String in Windows</SPAN></A></P>
            <P>In this section, we will create a test Java class with a native method 
              displaying string arguments in a Windows message box. There is no reason for 
              this function to be a native method, but it provides a simple example to 
              illustrate how Java strings are displayed.</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>import java.awt.*;
import java.awt.event.*;
public class StringTest extends Frame implements ActionListener
{
  private TextField input = new TextField("",20);
  private Button sendButton = new Button( "Send" );
  public StringTest()
  {
    super("String Test");
    setLayout( new FlowLayout() );
    add( input );
    add( sendButton );
    sendButton.addActionListener( this );
  }
  public void actionPerformed( ActionEvent evt )
  {
    if( evt.getSource()==sendButton )
    {
      String s = input.getText();
      showParms( s, s );
    }
  }
  public void showParms( String s1, String s2 )
  {
    showParms0( s1, s2 );
  }
  public native void showParms0( String s1, String s2 );
  static
  {
    System.loadLibrary( "StringTest" );
  }
  public static void main( String args[] )
  {
    StringTest frame = new StringTest();
    frame.addWindowListener(new WindowAdapter() {
      public void windowClosing(WindowEvent e) {System.exit(0);}
    });
    frame.setSize(180, 200);
    frame.setVisible(true);
  }
}</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>For more information on JNI see the <A 
href="http://java.sun.com/j2se/1.5.0/docs/guide/jni/index.html">JNI 
              Specification</A> available from Sun Microsystems. The example above is the 
              complete test program including the native method, <I>showParms0</I>. This 
              method will receive two strings which it will display in a Windows message 
              box.</P>
            <P>The native method is implemented in C in file, StringTest.c:</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include "StringTest.h"
char* jstringToWindows( JNIEnv* env, jstring jstr );
JNIEXPORT void JNICALL Java_StringTest_showParms0
  (JNIEnv *env, jobject obj, jstring s1, jstring s2)
{
  const char* szStr1 = (*env)-&gt;GetStringUTFChars( env, s1, 0 );
  const char* szStr2 = jstringToWindows( env, s2 );
  MessageBox( HWND_DESKTOP, (LPCSTR)szStr1, (LPCSTR)"String1", 0 );
  MessageBox( HWND_DESKTOP, (LPCSTR)szStr2, (LPCSTR)"String2", 0 );
  (*env)-&gt;ReleaseStringUTFChars( env, s1, szStr1 );
}
char* jstringToWindows( JNIEnv* env, jstring jstr )
{
  int length = (*env)-&gt;GetStringLength( env, jstr );
  const jchar* jcstr = (*env)-&gt;GetStringChars( env, jstr, 0 );
  char* rtn = (char*)malloc( length*2+1 );
  int size = 0;
  size = WideCharToMultiByte( CP_ACP, 0, (LPCWSTR)jcstr, length, rtn,
                           (length*2+1), NULL, NULL );
  if( size &lt;= 0 )
    return NULL;
  (*env)-&gt;ReleaseStringChars( env, jstr, jcstr );
  rtn[size] = 0;
  return rtn;
}</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>The JNI API, <CODE>GetStringUTFChars</CODE> is used to create a C string from 
              the Java string or <I>jstring</I> argument. The <I>GetStringChars</I> method 
              creates a <I>jchar</I> array (Unicode characters) from the Java string.</P>
            <P>The StringTest.dll is created by compiling the C source. The following 
              compile statement uses the Microsoft Visual C++ compiler:</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>
cl -Ic:\jdk1.1.6\include -Ic:\jdk1.1.6\include\win32 -LD StringTest.c 
    -FeStringTest.dll user32.lib</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>where c:\jdk1.1.6 is the path for the installed JDK.</P>
            <P>The <I>showParms0</I> function is passed the same string on both parameters. 
              The reason for this is to show the difference between using the UTF methods and 
              using the Unicode methods for converting strings. The class is run using the 
              Java interpreter and the output is as follows:</P>
            <PRE>   java StringTest </PRE>
            <P>This will show a window with an entry field, a pushbutton, and a listbox. As 
              a test, some non-English national language characters are entered along with the 
              word HELLO as follows:</P>
            <BR>
            <IMG height=201 alt="" src="3665a2b4.jpg" 
width=180 border=0 valign="bottom"><BR>
            <P>Clicking "Send" calls the <I>showParms0</I> native method which shows two 
              message boxes.</P>
            <BR>
            <IMG height=101 alt="" src="3665a2b5.jpg" width=206 
border=0 valign="bottom"><BR>
            <P>The string characters from the message box were converted using the UTF 
              method. Only the HELLO characters are correct. The second message box displays 
              strings from the Unicode methods.</P>
            <BR>
            <IMG height=101 alt="" 
src="3665a2b6.jpg" width=140 border=0 valign="bottom"><BR>
            <P>All characters are displayed correctly.</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"></TD>
                </TR>
              </TBODY>
            </TABLE>
            <TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
              <TBODY>
                <TR align=right>
                  <TD><TABLE cellSpacing=0 cellPadding=0 border=0>
                      <TBODY>
                        <TR>
                          <TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
                          <TD vAlign=top align=right><A class=fbox href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#main"><B>Back to 
                            top</B></A></TD>
                        </TR>
                      </TBODY>
                  </TABLE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <BR>
            <P><A name=h2><SPAN class=atitle>Windows string in Java</SPAN></A></P>
            <P>This example will accept command line parameters and display them in the <I>Label</I> of the <I>Frame</I> of the Java application. The Java code is 
              written to show the argument strings:</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>import java.awt.*;
import java.awt.event.*;
public class MyApp extends Frame
{
  public MyApp( String[] msgs )
  {
    super( "My Java App" );
    Label label = new Label();
    String labelMsg = new String();
    for( int i=0; i &lt; msgs.length; i++ )
      labelMsg += msgs[i] + " ";
    label.setText( labelMsg );
    add( label );
  }
  public static void main( String[] args )
  {
    MyApp frame = new MyApp( args );
    frame.addWindowListener( new WindowAdapter()
    {
      public void windowClosing(WindowEvent e) {System.exit(0);}
    });
    frame.setSize(200,200);
    frame.setVisible(true);
  }
}</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>The application can be executed using the java.exe interpreter:</P>
            <PRE>   java MyApp First second last </PRE>
            <P>which shows the frame window with the string parameters:</P>
            <BR>
            <IMG 
height=201 alt="" src="3665a2b7.jpg" width=201 border=0 valign="bottom"><BR>
            <P>Passing parameters to the Java class main from C requires creating a string 
              array from the parameters and passing the array to <CODE>CallStaticVoidMethod</CODE>. The following code will launch a Java 
              application from a Windows .EXE and passes command line parameters to the Java 
              program.</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;jni.h&gt;
#define MAIN_CLASS  "MyApp"
int APIENTRY WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, 
    LPSTR lpCmdLine, int nCmdShow)
{
  JNIEnv*        env;
  JavaVM*        jvm;
  JDK1_1InitArgs vmargs;
  jint           rc;
  jclass         cls;
  jmethodID      mainId;
  /* get CLASSPATH environment variable setting */
  char* szClasspath = getenv( "CLASSPATH" );
  vmargs.version = 0x00010001;  /* version 1.1 */
  JNI_GetDefaultJavaVMInitArgs( &amp;vmargs );  /* init vmargs */
  /* the classpath returned by JNI_GetDefaultJavaVMInitArgs is wrong */
  vmargs.classpath = szClasspath;
  rc = JNI_CreateJavaVM( &amp;jvm, &amp;env, &amp;vmargs );  /* create JVM */
  if( rc &lt; 0 )
    return 1;
  /* load the class containing the static main() method */
  cls = (*env)-&gt;FindClass( env, MAIN_CLASS );
  if( cls == 0 )
    return 1;
  /* find the main() method */
  mainId = (*env)-&gt;GetStaticMethodID(env, cls, "main", 
    "([Ljava/lang/String;)V");
  if( mainId == 0 )
    return 1; /* error */
  /* setup the parameters to pass to main() */
  {
    jstring        str;
    jobjectArray   args;
    int i=0;
    args = (*env)-&gt;NewObjectArray(env, __argc-1, 
        (*env)-&gt;FindClass(env, "java/lang/String"), 0);
    for( i=1; i&lt;__argc; i++ )
    {
      str = (*env)-&gt;NewStringUTF( env, __argv[i] );
      (*env)-&gt;SetObjectArrayElement(env, args, i-1, str);
    }
    (*env)-&gt;CallStaticVoidMethod(env, cls, mainId, args); /* call main() */
  }
  (*jvm)-&gt;DestroyJavaVM( jvm );  /* kill JVM */
  return 0;
}</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>The <I>__argc</I> and <I>__argv</I> variables are convenient for accessing 
              the command line parameters in a <CODE>WinMain</CODE> .EXE and are equivalent to <I>argc</I> and <I>argv</I> in a regular <CODE>main</CODE> .EXE. </P>
            <P>The MyApp.exe is built using the following command line for Microsoft Visual 
              C++:</P>
            <PRE>  cl -Ic:\jdk1.1.6\include -Ic:\jdk1.1.6\include\win32 -MT MyApp.c c:\jdk1.1.6\lib\javai.lib </PRE>
            <P>c:\jdk1.1.6 is where the JDK is installed. If MyApp.exe is executed from a 
              Windows command line, any parameters are displayed in the Java window.</P>
            <P>In the methods presented above, the UTF strings methods are used to access 
              and create Java strings. These methods cannot be used for other national 
              language character sets like the double-byte character set (DBCS) or other 
              national language characters. For example, if the previous example's MyApp.exe 
              is executed from the command line as follows:</P>
            <PRE>  MyApp d?os?enregistr?</PRE>
            <P>The following is shown in the GUI:</P>
            <BR>
            <IMG height=201 alt="" 
src="3665a2b8.jpg" width=201 border=0 valign="bottom"><BR>
            <P>The accented e's are not shown correctly because they are above 127 in the 
              ASCII table. Using Unicode along with the appropriate JNI and Windows APIs will 
              correct this problem.</P>
            <P>Java strings can be converted to and from Unicode character arrays using the 
              appropriate JNI APIs. Once the Java Strings are obtained in Unicode, the API <CODE>MultiByteToWideChar</CODE> converts a Windows string to a Unicode 
              character array. The following function can be used to create a Java String from 
              a multi-byte string.</P>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD class=code-outline><PRE class=displaycode>
jstring WindowsTojstring( JNIEnv* env, char* str )
{
  jstring rtn = 0;
  int slen = strlen(str);
  wchar_t* buffer = 0;
  if( slen == 0 )
    rtn = (*env)-&gt;NewStringUTF( env, str ); //UTF ok since empty string
  else
  {
    int length = 
      MultiByteToWideChar( CP_ACP, 0, (LPCSTR)str, slen, NULL, 0 );
    buffer = malloc( length*2 + 1 );
    if( MultiByteToWideChar( CP_ACP, 0, (LPCSTR)str, slen, 
        (LPWSTR)buffer, length ) &gt;0 )
      rtn = (*env)-&gt;NewString( env, (jchar*)buffer, length );
  }
  if( buffer )
   free( buffer );
  return rtn;
}</PRE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <P>In the above function, <CODE>MultiByteToWideChar</CODE> is called twice. The 
              first call determines the number of Unicode characters, which is then used to 
              compute the size of the memory allocation to hold the character array. The 
              second call performs the conversion into that array. The Java string is created 
              from the array by calling the <CODE>NewString</CODE> method. Now the function 
              will be used to correct the problem of displaying the wrong characters 
              introduced in the example. The above <CODE>WindowsTojstring</CODE> function is 
              added to the C code and the following line is changed from:</P>
            <PRE>   str = (*env)-&gt;NewStringUTF( env, __argv[i] ); 
   to:
   str = Windows2jstring( env, __argv[i] ); </PRE>
            <P>A recompile and re-execute now shows the parameters correctly.</P>
            <BR>
            <IMG 
height=201 alt="" src="3665a2b9.jpg" width=201 border=0 valign="bottom"><BR>
            <BR>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD><IMG height=1 alt="" src="blue_rule.gif" 
width="100%"></TD>
                </TR>
              </TBODY>
            </TABLE>
            <TABLE class=no-print cellSpacing=0 cellPadding=0 align=right>
              <TBODY>
                <TR align=right>
                  <TD><TABLE cellSpacing=0 cellPadding=0 border=0>
                      <TBODY>
                        <TR>
                          <TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
                          <TD vAlign=top align=right><A class=fbox href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#main"><B>Back to 
                            top</B></A></TD>
                        </TR>
                      </TBODY>
                  </TABLE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <BR>
            <P><A name=h3><SPAN class=atitle>Summary</SPAN></A></P>
            <P>This paper presented examples for implementing native methods dealing with 
              conversion of strings for an NLS-enabled Java program environment. Strings are 
              maintained in Unicode in Java and must be converted appropriately using the 
              following JNI APIs:</P>
            <UL type=disc>
              <LI>NewString
              <LI>GetStringChars
              <LI>ReleaseStringChars
              <LI>GetStringLength </LI>
            </UL>
            <P>and the following Windows APIs:</P>
            <UL type=disc>
              <LI>MultiByteToWideChar
              <LI>WideCharToMultiByte </LI>
            </UL>
            <P>See the <A 
href="http://java.sun.com/j2se/1.5.0/docs/guide/jni/index.html">Java Native 
              Interface Specification</A> available from Sun Microsystems for more information 
              on JNI.</P>
            <BR>
            <BR>
            <P><A name=author><SPAN class=atitle>About the author</SPAN></A></P>
            <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
              <TBODY>
                <TR>
                  <TD colSpan=3><IMG height=5 alt="" src="c.gif" 
width="100%"></TD>
                </TR>
                <TR vAlign=top align=left>
                  <TD><P></P></TD>
                  <TD><IMG height=5 alt="" src="c.gif" width=4></TD>
                  <TD width="100%"><P>David Wendt is an IBM Programmer for WebSphere Studio in Research Triangle 
                      Park, NC. He can be reached at 
                      wendt@us.ibm.com.</P></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <BR>
            <BR>
            <P class=no-print><SPAN class=atitle><A name=rate>Rate this 
              page</A></SPAN></P>
            <SPAN class=no-print>
            <FORM action=http://www-128.ibm.com/developerworks/utils/RatingsHandler 
method=post>
              <INPUT type=hidden value=1 name=SITE_ID>
              <INPUT type=hidden 
value="NLS strings and JNI" name=ArticleTitle>
              <INPUT type=hidden 
value="Java technology" name=Zone>
              <INPUT type=hidden 
value=http://www.ibm.com/developerworks/thankyou/feedback-thankyou.html 
name=RedirectURL>
              <INPUT type=hidden value=10433 name=ArticleID>
              <INPUT 
type=hidden value=05011999 name=publish-date>
              <INPUT type=hidden 
value=wendt@us.ibm.com name=author1-email>
              <INPUT type=hidden 
name=author1-email-cc>
<INPUT type=hidden 
value=http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html 
name=url>
              <IMG height=1 alt="" src="gray_rule.gif" 
width="100%"><BR>
              <TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 width="100%" 
border=0>
                <TBODY>
                  <TR>
                    <TD width="100%"><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                        <TBODY>
                          <TR>
                            <TD colSpan=3><P>Please take a moment to complete this form to help us better serve 
                                you.</P></TD>
                          </TR>
                          <TR vAlign=top>
                            <TD width=140><IMG height=1 alt="" src="c.gif" width=140><BR>
                              <P>
                                <LABEL for=Goal>Did the information help you to achieve your 
                                  goal?</LABEL>
                            </P></TD>
                            <TD width=303><IMG height=6 alt="" src="c.gif" width=303><BR>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                                <TBODY>
                                  <TR>
                                    <TD><INPUT id=Goal type=radio value=Yes name=Goal>
                                      Yes</TD>
                                    <TD><INPUT id=Goal type=radio value=No name=Goal>
                                      No</TD>
                                    <TD><INPUT id=Goal type=radio value="Don't know" name=Goal>
                                      Don't 
                                      know</TD>
                                  </TR>
                                </TBODY>
                            </TABLE></TD>
                            <TD width="100%">&nbsp;</TD>
                          </TR>
                          <TR>
                            <TD colSpan=3><IMG height=12 alt="" src="c.gif" 
width=8></TD>
                          </TR>
                          <TR vAlign=top>
                            <TD width=140><IMG height=1 alt="" src="c.gif" width=140><BR>
                              <P>
                                <LABEL for=Comments>Please provide us with comments to help improve this 
                                  page:</LABEL>
                            </P></TD>
                            <TD width=303><IMG height=6 alt="" src="c.gif" width=303><BR>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                                <TBODY>
                                  <TR>
                                    <TD><TEXTAREA class=iform id=Comments name=Comments rows=5 wrap=virtual cols=35>&nbsp;</TEXTAREA></TD>
                                  </TR>
                                </TBODY>
                            </TABLE></TD>
                            <TD width="100%">&nbsp;</TD>
                          </TR>
                          <TR>
                            <TD colSpan=3><IMG height=12 alt="" src="c.gif" 
width=8></TD>
                          </TR>
                          <TR vAlign=top>
                            <TD width=140><IMG height=1 alt="" src="c.gif" width=140><BR>
                              <P>
                                <LABEL for=Rating>How useful is the information?</LABEL>
                            </P></TD>
                            <TD width=303><IMG height=6 alt="" src="c.gif" width=303><BR>
                              <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                                <TBODY>
                                  <TR>
                                    <TD align=left width=60><INPUT id=Rating type=radio value=1 name=Rating>
                                      1</TD>
                                    <TD align=left width=60><INPUT id=Rating type=radio value=2 name=Rating>
                                      2</TD>
                                    <TD align=left width=60><INPUT id=Rating type=radio value=3 name=Rating>
                                      3</TD>
                                    <TD align=left width=60><INPUT id=Rating type=radio value=4 name=Rating>
                                      4</TD>
                                    <TD align=left width=63><INPUT id=Rating type=radio value=5 
name=Rating>
                                      5</TD>
                                  </TR>
                                  <TR>
                                    <TD align=left width=60><SPAN class=greytext>Not</SPAN><BR>
                                    <SPAN 
class=greytext>useful</SPAN></TD>
                                    <TD align=left width=60><IMG height=1 alt="" src="c.gif" 
width=1></TD>
                                    <TD align=left width=60><IMG height=1 alt="" src="c.gif" 
width=1></TD>
                                    <TD align=left width=60><IMG height=1 alt="" src="c.gif" 
width=1></TD>
                                    <TD align=left width=63><SPAN 
class=greytext>Extremely<BR>
                                      useful</SPAN></TD>
                                  </TR>
                                </TBODY>
                            </TABLE></TD>
                            <TD width="100%">&nbsp;</TD>
                          </TR>
                        </TBODY>
                    </TABLE></TD>
                  </TR>
                </TBODY>
              </TABLE>
              <TABLE class=v14-gray-table-border cellSpacing=0 cellPadding=0 width="100%" 
border=0>
                <TBODY>
                  <TR>
                    <TD colSpan=3><IMG height=8 alt="" src="c.gif" 
width=8></TD>
                  </TR>
                  <TR>
                    <TD width=8><IMG height=1 alt="" src="c.gif" width=8></TD>
                    <TD colSpan=3><INPUT type=image height=21 alt=Submit width=120 
src="submit.gif" border=0></TD>
                  </TR>
                  <TR>
                    <TD colSpan=3><IMG height=8 alt="" src="c.gif" 
width=8></TD>
                  </TR>
                </TBODY>
              </TABLE>
            </FORM>
            <BR>
            </SPAN><SPAN class=no-print>
            <TABLE cellSpacing=0 cellPadding=0 align=right>
              <TBODY>
                <TR align=right>
                  <TD><TABLE cellSpacing=0 cellPadding=0 border=0>
                      <TBODY>
                        <TR>
                          <TD vAlign=center><IMG height=16 alt="" 
src="u_bold.gif" width=16 border=0><BR></TD>
                          <TD vAlign=top align=right><A class=fbox href="http://www.ibm.com/developerworks/java/library/j-jninls/jninls.html#main"><B>Back to 
                            top</B></A></TD>
                        </TR>
                      </TBODY>
                  </TABLE></TD>
                </TR>
              </TBODY>
            </TABLE>
            <BR>
            <BR>
          </SPAN></TD>
          <TD width=10><IMG height=1 alt="" src="c.gif" 
width=10></TD>
        </TR>
          </TBODY>
    </TABLE></TD>
  </TR>
    </TBODY>
</TABLE>
<!--FOOTER_BEGIN--><BR>
<TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
<TBODY>
  <TR>
    <TD class=bbg height=19><TABLE cellSpacing=0 cellPadding=0 border=0>
      <TBODY>
        <TR>
          <TD><SPAN class=spacer>&nbsp;&nbsp;&nbsp;&nbsp;</SPAN><A class=mainlink 
href="">About IBM</A></TD>
          <TD class=footer-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
          <TD><A class=mainlink href="http://www.ibm.com/privacy/">Privacy</A></TD>
          <TD class=footer-divider width=27>&nbsp;&nbsp;&nbsp;&nbsp;</TD>
          <TD><A class=mainlink 
href="">Contact</A></TD>
        </TR>
      </TBODY>
  </TAB>
