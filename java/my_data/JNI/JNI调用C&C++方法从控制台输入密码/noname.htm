<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">

<HTML>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>JNI调用C/C++方法从控制台输入密码</title>
<LINK 
href="css.css" type=text/css 
rel=stylesheet>
</HEAD>

<BODY onload=init()><!--StartFragment-->
<TABLE cellSpacing=0 cellPadding=0 width=778 align=center bgColor=#b4bcda 
border=0>
  <TBODY>
    <TR>
      <TD width=778 bgColor=#ffffff colSpan=2><TABLE height=107 cellSpacing=0 cellPadding=0 width=778 align=center border=0>
          <TBODY>
            <TR>
              <TD background=http://www.it-waibao.com/images/top.jpg><TABLE cellSpacing=0 cellPadding=0 width=150 align=right border=0>
                  <TBODY>
                    <TR>
                      <TD><FORM name=language_form>
                          <DIV align=center><IMG src="flag.gif" width=20 height=14>
                            <SELECT 
onchange="MM_jumpMenu('parent',language_form.languageMenu,0)" name=languageMenu>
                              <OPTION value=/index.html selected>Chinese</OPTION>
                              <OPTION 
value=/English/index.html>English</OPTION>
                              <OPTION 
value=/Japanese/index.html>Japanese</OPTION>
                            </SELECT>
                          </DIV>
                      </FORM></TD>
                    </TR>
                  </TBODY>
              </TABLE></TD>
            </TR>
          </TBODY>
      </TABLE></TD>
    </TR>
    <TR vAlign=top bgColor=#ffffff>
      <TD borderColorLight=#ffffff align=left borderColorDark=#cccccc colSpan=2><TABLE cellSpacing=0 cellPadding=0 width=778 align=center border=0>
          <TBODY>
            <TR>
              <TD width=87 background=http://www.it-waibao.com/images/b12.jpg height=28><DIV align=center><A class=mainMenu href="http://www.it-waibao.com/index.html">首 
                  页</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/gsjj.html">公司简介</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/itwb.html">IT外包</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/wlgc.html">网络工程</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/jhj.html">电话交换机</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/qyyx.html">企业邮箱</A></DIV></TD>
              <TD width=101 background=http://www.it-waibao.com/images/b2.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/case.html">成功案例</A></DIV></TD>
              <TD background=http://www.it-waibao.com/images/b8.jpg><DIV align=center><A class=mainMenu 
href="http://www.it-waibao.com/lxwm.html">联系我们</A></DIV>
                <DIV></DIV></TD>
            </TR>
          </TBODY>
      </TABLE></TD>
    </TR>
    <TR class=hg vAlign=top bgColor=#ffffff>
      <TD borderColorLight=#ffffff align=left borderColorDark=#cccccc colSpan=2><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
          <TBODY>
            <TR>
              <TD><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                  <TBODY>
                    <TR>
                      <TD class=menuBackground vAlign=top width="18%" bgColor=#e9fef0><DIV class=menuLayer align=center>
                          <TABLE height="100%" cellSpacing=0 cellPadding=0 width="100%" border=0>
                            <TBODY>
                              <TR>
                                <TD vAlign=bottom width="12%" bgColor=#ffffff>&nbsp;</TD>
                                <TD vAlign=bottom width="88%" bgColor=#ffffff height=25><DIV align=left></DIV></TD>
                              </TR>
                            </TBODY>
                          </TABLE>
                      </DIV></TD>
                      <TD vAlign=top width="2%">&nbsp;</TD>
                      <TD vAlign=top width="80%"><TABLE cellSpacing=0 cellPadding=0 border=0>
                          <TBODY>
                            <TR>
                              <TD vAlign=top width=559><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                                  <TBODY>
                                    <TR>
                                      <TD vAlign=top><IMG alt="" src="indexx_32.gif" 
width=559 
height=8></TD>
                                    </TR>
                                  </TBODY>
                              </TABLE></TD>
                            </TR>
                            <TR>
                              <TD class=yourCurrentPosition vAlign=middle><BR>
                                您现在的位置是： <A class=infoPath 
href="http://www.it-waibao.com/it-waibao/index.html">上海IT外包服务网</A> -&gt;<A 
class=infoPath 
href="http://www.it-waibao.com/it-waibao/zaqizaba/index.html">杂七杂八</A> -&gt;<A 
class=infoPath 
href="http://www.it-waibao.com/it-waibao/zaqizaba/rrr/index.html">tobe3</A> -&gt; </TD>
                            </TR>
                            <TR>
                              <TD vAlign=bottom height=29><SPAN class=infoKeywordName>本文关键字:</SPAN> <A 
class=infoKeywordValue 
href="http://www.it-waibao.com/info/jsp/queryInfo.jsp?keyword=Info.keywords&amp;value=JNI&amp;actionType=requery&amp;pageNumber=1">JNI</A></TD>
                            </TR>
                            <TR>
                              <TD vAlign=middle align=center height=50><SPAN 
class=infoTitle>JNI调用C/C++方法从控制台输入密码 </SPAN></TD>
                            </TR>
                            <TR>
                              <TD vAlign=middle height=35><DIV align=center><SPAN class=infoAuthorName>作者：</SPAN> <SPAN 
class=infoAuthorValue>不详 </SPAN>| <SPAN class=infoPublishedTimeName>发布时间:</SPAN> <SPAN class=infoPublishedTimeValue>2007-03-05 10:27 </SPAN>| <SPAN 
class=infoTypeName>信息类别：</SPAN> <SPAN class=infoTypeValue><A class=infoPath 
href="http://www.it-waibao.com/it-waibao/zaqizaba/rrr/index.html">tobe3</A> </SPAN>| <SPAN class=infoPeopleVisitedCountName>访问人次：</SPAN>
                                  <INPUT 
id=infoPeopleVisitedCountValue size=6 value=4 name=infoPeopleVisitedCountValue> 
                        次</SPAN></DIV></TD>
                            </TR>
                            <TR>
                              <TD vAlign=middle height=35><DIV align=center><!--信息评论开始-->【 <A onclick='forRemark("19427")' class=infoTool 
href="javascript:void(0)">评论</A>】 <!--信息评论结束--><!--信息推荐开始-->【 <A onclick='forRecommend("19427")' 
class=infoTool href="javascript:void(0)">推荐</A>】 
                        <!--信息推荐结束-->【 <A class=infoTool href="javascript:fontZoom(18)">大</A> <A class=infoTool 
href="javascript:fontZoom(15)">中</A> <A class=infoTool 
href="javascript:fontZoom(12)">小</A> 】 <!--信息打印开始-->【 <A onclick='forPrint("19427")' 
class=infoTool href="javascript:void(0)">打印 </A>】 <!--信息打印结束-->【 <A 
onclick='forEdit("19427")' class=infoTool href="javascript:void(0)">编辑</A> 】 【 <A class=infoTool href="javascript:window.close()">关闭 </A>】 </DIV></TD>
                            </TR>
                            <TR>
                              <TD vAlign=top>&nbsp;&nbsp;<SPAN class=infoContent id=fontzoom> <BR>
                                &nbsp;&nbsp;<BR>
                                最近看到一个问题，如何用<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>实现从控制台输入密码？ <BR>
                                本来以为是很简单的问题，查了一下发现<A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>居然没提供这样一个方法。目前实现的方式有2个，一个是利用JNI来调用C/C++方法，另一个是使用多线程。 <BR>
                                下面是使用JNI的方法： <BR>
                                首先，写出我们的<A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>类： <BR>
                                <BR>
                                <BR>
                                <BR>
                                public class JNIPasswordReader { <BR>
                                <BR>
                                private native String 
                                readPassword(); <BR>
                                static { <BR>
                                System.loadLibrary( " PasswordDLL " ); <BR>
                                } <BR>
                                /** */ /** <BR>
                                * @param args <BR>
                                */ <BR>
                                public static void main(String[] 
                                args) { <BR>
                                // TODO Auto-generated method stub <BR>
                                JNIPasswordReader reader = 
                                new JNIPasswordReader(); <BR>
                                String pwd = reader.readPassword(); <BR>
                                System.out.println( " \nYour Password is: " + pwd); <BR>
                                } <BR>
                                <BR>
                                } <BR>
                                这一段使用System.loadLiberary("..");来加载本地类库，PasswordDLL是<A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_14229.html">文件名</A>，不需要加dll后缀，系统会自动辨认。 <BR>
                                <BR>
                                编译成JNIPasswordReader.class以后，使用 <BR>
                                javah -jni JNIPasswordReader <BR>
                                命令，生成一个JNIPasswordReader.h文件，文件内容如下： <BR>
                                <BR>
                                <BR>
                                /**/ /* DO NOT EDIT THIS 
                                FILE - it is machine generated */ <BR>
                                #include &lt; jni.h &gt; <BR>
                                /**/ /* 
                                Header for class JNIPasswordReader */ <BR>
                                <BR>
                                #ifndef 
                                _Included_JNIPasswordReader <BR>
                                #define _Included_JNIPasswordReader <BR>
                                #ifdef 
                                __cplusplus <BR>
                                extern " C " { <BR>
                                #endif <BR>
                                /**/ /* <BR>
                                * Class: 
                                JNIPasswordReader <BR>
                                * Method: readPassword <BR>
                                * Signature: 
                                ()Ljava/lang/String; <BR>
                                */ <BR>
                                JNIEXPORT jstring JNICALL <A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>_JNIPasswordReader_readPassword <BR>
                                (JNIEnv * , jobject); <BR>
                                <BR>
                                #ifdef __cplusplus <BR>
                                } <BR>
                                #endif <BR>
                                #endif <BR>
                                <BR>
                                然后，我们需要写一个cpp文件来实现 <BR>
                                JNIEXPORT jstring JNICALL <A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>_JNIPasswordReader_readPassword 
                                (JNIEnv *, jobject); <BR>
                                <A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/smy/100_157_1460.html">接口</A>。 <BR>
                                于是，我写了一个PasswordDLL.cpp文件，内容如下： <BR>
                                <BR>
                                <BR>
                                // 这是主 DLL 文件。 <BR>
                                #include " 
                                stdafx.h " <BR>
                                #include " JNIPasswordReader.h " <BR>
                                #include &lt; iostream &gt; <BR>
                                #include &lt; iomanip &gt; <BR>
                                #include &lt; conio.h &gt; <BR>
                                using 
                                namespace std; <BR>
                                <BR>
                                /**/ /* <BR>
                                * Class: JNIPasswordReader <BR>
                                * Method: 
                                readPassword <BR>
                                * Signature: ()V <BR>
                                */ <BR>
                                JNIEXPORT jstring JNICALL <A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>_JNIPasswordReader_readPassword <BR>
                                (JNIEnv * env, jobject) { <BR>
                                char str[ 20 ] = { 0 } ; <BR>
                                jstring jstr; <BR>
                                char ch; <BR>
                                char * pstr = str; <BR>
                                while ( true ) <BR>
                                { <BR>
                                ch =
                                  getch(); <BR>
                                if (isdigit(ch) || isalpha(ch)) <BR>
                                { <BR>
                                cout &lt;&lt; " * " ; <BR>
                                * pstr 
                                ++ = ch; <BR>
                                } <BR>
                                else if (ch == ' \b ' &amp;&amp; pstr &gt; str) <BR>
                                { <BR>
                                * ( 
                                -- pstr) = 0 ; <BR>
                                cout &lt;&lt; " \b \b " ; <BR>
                                } <BR>
                                else if (ch == 0x0A || ch 
                                == 0x0D ) <BR>
                                { <BR>
                                break ; <BR>
                                } <BR>
                                } <BR>
                                jstr = env -&gt; NewStringUTF(str); <BR>
                                return jstr; <BR>
                                } <BR>
                                我使用VS2005来生成对应的dll文件，在生成之前，需要把$JDK_HOME/include/jni.h和$JDK_HOME/include/win32/jni_md.h这两个文件copy到<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12661.html">Microsoft</A> Visio Studio 8/<A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_14079.html">VC</A>/include<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_14203.html">目录</A>下，我就在这里卡了大概1个小时，一直说找不到jni.h文件 <BR>
                                <BR>
                                然后就可以使用VS2005来生成dll了，生成好对应的PasswordDLL.dll以后，把该dll文件放到系统变量<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/systemCommand/DOSCommand/100_461_9620.html">PATH</A>能找到的地方，比如windows/system32/或者jdk/bin<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_14203.html">目录</A>，我是放到JDK_HOME/bin下面了 <BR>
                                放好以后， <BR>
                                执行java JNIPasswordReader <BR>
                                就可以输入密码了。 <BR>
                                <BR>
                                关于JNI的更详细内容，可以参考： <BR>
                                《在<A class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_14089.html">Windows</A>中实现<A 
class=IT_Dictionary 
href="http://www.it-waibao.com/it-waibao/termCommentate/100_124_12646.html">Java</A>本地方法》http://www.ibm.com/developerworks/cn/java/jnimthds/index.html <BR>
                                <BR>
                                我的Password.dll文件 <BR>
                                http://www.blogjava.net/Files/richardeee/PasswordDLL.zip </SPAN></TD>
                            </TR>
                          </TBODY>
                        </TABLE>
                        <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                          <TBODY>
                            <TR>
                              <TD vAlign=middle height=35><DIV align=center><!--信息评论开始-->【 <A onclick='forRemark("19427")' class=infoTool 
href="javascript:void(0)">评论</A>】 <!--信息评论结束--><!--信息推荐开始-->【 <A onclick='forRecommend("19427")' 
class=infoTool href="javascript:void(0)">推荐</A>】 
                        <!--信息推荐结束-->【 <A class=infoTool href="javascript:fontZoom(18)">大</A> <A class=infoTool 
href="javascript:fontZoom(15)">中</A> <A class=infoTool 
href="javascript:fontZoom(12)">小</A> 】 <!--信息打印开始-->【 <A onclick='forPrint("19427")' 
class=infoTool href="javascript:void(0)">打印 </A>】 <!--信息打印结束-->【 <A 
onclick='forEdit("19427")' class=infoTool href="javascript:void(0)">编辑</A> 】 【 <A class=infoTool href="javascript:window.close()">关闭 </A>】 </DIV></TD>
                            </TR>
                            <TR>
                              <TD height=30><STRONG class=relativeLinkName>『相关链接』</STRONG></TD>
                            </TR>
                            <TR>
                              <TD><TABLE cellSpacing=0 cellPadding=0 width="100%">
                                  <TBODY>
                                    <TR>
                                      <TD align=left width="7%"><DIV align=center><STRONG>序号 </STRONG></DIV></TD>
                                      <TD align=left width="60%"><STRONG>标题 </STRONG></TD>
                                      <TD align=left width="33%"><STRONG>发布日期 </STRONG></TD>
                                    </TR>
                                    <TR>
                                      <TD><DIV align=center>1</DIV></TD>
                                      <TD><DIV align=left><A class=relativeLink 
href="100_80_7701.html">第一个JNI程序</A></DIV></TD>
                                      <TD>2006-05-07 12:16:08</TD>
                                    </TR>
                                  </TBODY>
                              </TABLE></TD>
                            </TR>
                            <TR>
                              <TD class=copyrightAnnounce height=115>【郑重声明】【<A class=homepageLink 
href="">上海IT外包服务网</A>】 
                                刊载此文不代表同意其说法或描述，仅为提供更多信息，也不构成任何投资或其他建议。转载需经作者本人同意并注明出处。本网站有部分文章是由网友自由上传。对于此类文章本站仅提供交流平台，不为其版权负责。如果您发现本网站上有侵犯您的知识产权的文章，请发信至 <A class=emailLink href="mailto:dieying@ 541help.com。%20">E-mail:dieying@ 
                                541help.com </A>或直接电话联系: 021-58879030 <BR></TD>
                            </TR>
                          </TBODY>
                        </TABLE>
                        <TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                          <TBODY>
                            <TR>
                              <TD><FORM name=remark_form action=http://www.it-waibao.com/info/jsp/remark.jsp 
method=post>
                                  <TABLE width="100%" border=0>
                                    <TBODY>
                                      <TR>
                                        <TD colSpan=3 height=36><DIV align=center><SPAN class=pleaseLeaveWord>请您留言</SPAN></DIV></TD>
                                      </TR>
                                      <TR>
                                        <TD><STRONG class=publishRemarkName>『发表评论』</STRONG> <IMG name=imageThatCanNotBeSeen alt="" 
src="recordClientViewedInfo.jsp_infoID=19427" 
width=1 height=1></TD>
                                        <TD width="68%"><DIV align=right><!--信息查看评论开始--><A onclick='forViewRemark("19427")' 
class=reviewRemark href="javascript:void(0)">『查看评论』 </A><!--信息查看评论结束--></DIV></TD>
                                        <TD width="10%"><!--信息评论ID开始-->
                                          <INPUT id=infoID type=hidden value=19427 
name=infoID>
                                          <INPUT id=actionType type=hidden value=saveRecord name=actionType> <!--信息评论ID结束--></TD>
                                      </TR>
                                      <TR>
                                        <TD width="22%"><INPUT class=infoRemarkIsNiMing id=isNiMing type=checkbox 
value=匿名 name=isNiMing>
                                          匿名发表 </TD>
                                        <TD colSpan=2>会员ID:
                                          <INPUT class=infoRemarkMemberID id=userID size=12 
name=userID>
                                          密码:
                                          <INPUT class=infoRemarkPassword id=password type=password 
size=12 name=password 
                         ></TD>
                                      </TR>
                                      <TR>
                                        <TD colSpan=3><DIV align=center><TEXTAREA id=content class=infoRemarkContent rows=5 cols=60 name=content></TEXTAREA>
                                          </DIV></TD>
                                      </TR>
                                      <TR>
                                        <TD colSpan=3><DIV align=center>
                                            <INPUT type=submit value=提交 name=Submit>
                                          </DIV></TD>
                                      </TR>
                                    </TBODY>
                                  </TABLE>
                              </FORM></TD>
                            </TR>
                          </TBODY>
                      </TABLE></TD>
                    </TR>
                  </TBODY>
              </TABLE></TD>
            </TR>
            <TR>
              <TD><TABLE cellSpacing=0 cellPadding=0 width="100%" border=0>
                  <TBODY>
                    <TR>
                      <TD><HR></TD>
                    </TR>
                    <TR>
                      <TD height=84><TABLE cellSpacing=0 cellPadding=0 width=778 align=center border=0>
                          <TBODY>
                            <TR>
                              <TD></TD>
                            </TR>
                            <TR>
                              <TD><DIV align=center>
                                  <DIV align=center><SPAN class=gray>Copyright@2007 IT-WAIBAO.COM Inc.<A 
href="http://www.miibeian.gov.cn/"><SPAN 
style="COLOR: #0000ff">沪ICP备05039378号</SPAN></A> 版权所有2007-2010 </SPAN><SPAN><A 
href="http://www.it-waibao.com/boot/jsp/boot.jsp">管理员登陆</A></SPAN><BR>
                                  </DIV>
                              </DIV></TD>
                            </TR>
                          </TBODY>
                      </TABLE></TD>
                    </TR>
                  </TBODY>
              </TABLE></TD>
            </TR>
          </TBODY>
        </TABLE>
         <SPAN id=LR_helplayer 
style="POSITION: absolute; LEFT: 0px; Z-INDEX: 8888; TOP: 2299px; VISIBILITY: visible"><A 
onclick="openZoosUrl('chatwin');return false;" 
href="http://www.it-waibao.com/it-waibao/zaqizaba/rrr/100_718_19427.html#"><IMG 
id=LiveReceptionCode_need_help border=0 
name=LiveReceptionCode_need_help alt=没有客服人员在线,请点击此处留言!我们会尽快答复; 
src="offline_cn3.gif"></A></SPAN><SPAN id=LR_closebtn 
style="WIDTH: 11px; POSITION: absolute; LEFT: 109px; Z-INDEX: 8889; TOP: 2299px; VISIBILITY: visible"><A 
onclick="LR_hideDiv();return false;" 
href="http://www.it-waibao.com/it-waibao/zaqizaba/rrr/100_718_19427.html#" 
target=_self><IMG border=0 name=LR_close alt=关闭 
src="7.gif"></A></SPAN> 
        <EMBED name=LR_Flash 
pluginspage=http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash 
src=SWT.swf width=0 height=0 
type="application/x-shockwave-flash" quality="high" 
swLiveConnect="true"></EMBED></TD>
    </TR>
  </TBODY>
</TABLE><!--EndFragment-->
</BODY>
</HTML>