<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">

<HTML xmlns="http://www.w3.org/1999/xhtml">
<HEAD>
<META content="IE=7.0000" 
http-equiv="X-UA-Compatible">
<title>Andriod 缩略图</title>
<!–[if lte IE 6]>
<SCRIPT type=text/javascript>
try{
document.execCommand("BackgroundImageCache", false, true);
}catch(e){}
</SCRIPT>
<![endif]–>
<SCRIPT type=text/javascript>
window.staticTime=new Date().getTime();

var locInterval = setInterval(function(){
var tc = document.getElementById('trayContainer');
if(tc) {
var isLogin = false;var sup = document.cookie.match(/sup=([^;]+);/gi);if(sup != null){ sup = decodeURIComponent(sup[0]);var uid = sup.match(/uid=([^&]+)/gi); isLogin = (uid != null); } if (isLogin){ tc.innerHTML = '<div class="topbar_loading"><img src="loading.gif" />加载中…</div>'; } else { tc.innerHTML = '<div class="topbar_menu"><span class="link"><a href="http://blog.sina.com.cn/" target="_blank">博客首页</a></span><span class="line_s"></span></div><div class="topbar_login"><a href="http://blog.sina.com.cn/s/blog_672f41790100t35n.html#" class="login" id="linkTrayLogin" onclick="return false;">登录</a><a href="http://login.sina.com.cn/signup/signupmail.php?entry=blog&r=&srcuid=&src=blogicp" class="register" target="_blank" id="linkReg">注册</a></div><div class="topbar_ad" id="divPopularize"></div><div id="phprender" ></div>';}
clearInterval(locInterval);
locInterval = null;
}
},50);

</SCRIPT>
<LINK rel=pingback 
href="xmlrpc.php">
<LINK 
title=RSD rel=EditURI type=application/rsd+xml 
href="xmlrpc.php_rsd">
<LINK 
rel=wlwmanifest type=application/wlwmanifest+xml 
href="wlwmanifest.xml">
<LINK title=RSS 
rel=alternate type=application/rss+xml 
href="1731150201.xml">
<LINK rel=stylesheet 
type=text/css href="article.css">
<STYLE id=tplstyle type=text/css>
@import url( http://simg.sinajs.cn/blog7newtpl/css/4/4_16/t.css );
</STYLE>
<STYLE id=positionstyle type=text/css>
.sinabloghead .blogtoparea {
	TOP: 42%;
	LEFT: 2px
}
.sinabloghead .blognav {
	TOP: 73%;
	LEFT: 220px
}
</STYLE>
<STYLE id=bgtyle type=text/css></STYLE>
<STYLE id=headtyle type=text/css></STYLE>
<STYLE id=navtyle type=text/css></STYLE>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
</HEAD>

<BODY>
<DIV id=sinabloga class=sinabloga>
  <DIV id=sinablogb class=sinablogb>
    <DIV id=sinablogbody class=sinablogbody>
      <DIV id=column_2 class=SG_colW73>
        <DIV id=module_920 class=SG_conn>
          <DIV class=SG_connBody>
            <DIV id=articlebody class='artical' 
favMD5='{"672f41790100t35n":"39a34d4467cd01e81f5604f6bd3ec53a"}'>
              <DIV id=sina_keyword_ad_area2 class="articalContent  "><!--StartFragment--><SPAN style="FONT-FAMILY: arial"><SPAN style="FONT-SIZE: 16px"><SPAN 
style="FONT-FAMILY: arial"><SPAN 
style="FONT-SIZE: 16px"></SPAN></SPAN>在开发图片浏览器等软件是，很多时候要显示图片的缩略图，而一般情况下，我们要将图片按照固定大小取缩略图，一般取缩略图的方法是使用BitmapFactory的decodeFile方法，然后通过传递进去 
                BitmapFactory.Option类型的参数进行取缩略图，在Option中，属性值inSampleSize表示缩略图大小为原始图片大小的几分之一，即如果这个值为2，则取出的缩略图的宽和高都是原始图片的1/2，图片大小就为原始大小的1/4。</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">　　然而，如果我们想取固定大小的缩略图就比较困难了，比如，我们想将不同大小的图片去出来的缩略图高度都为200px，而且要保证图片不失真，那怎么办?我们总不能将原始图片加载到内存中再进行缩放处理吧，要知道在移动开发中，内存是相当宝贵的，而且一张100K的图片，加载完所占用的内存何止 
                100K?</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">　　经过研究，发现，Options中有个属性inJustDecodeBounds，研究了一下，终于明白是什么意思了，SDK中的E文是这么说的</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">　　If set to true, the decoder will return null (no 
                bitmap), but the out... fields will still be set, allowing the caller to query 
                the bitmap without having to allocate the memory for its pixels.</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">　　意思就是说如果该值设为true那么将不返回实际的bitmap不给其分配内存空间而里面只包括一些解码边界信息即图片大小信息，那么相应的方法也就出来了，通过设置inJustDecodeBounds为true，获取到outHeight(图片原始高度)和 
                outWidth(图片的原始宽度)，然后计算一个inSampleSize(缩放值)，然后就可以取图片了，这里要注意的是，inSampleSize 
                可能小于0，必须做判断。</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">具体代码如下：</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">FrameLayout 
                fr=(FrameLayout)findViewById(R.id.FrameLayout01);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                BitmapFactory.Options options = new BitmapFactory.Options();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                options.inJustDecodeBounds = true;</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                // 
                获取这个图片的宽和高</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                Bitmap bitmap = 
                BitmapFactory.decodeFile("/sdcard/test.jpg", options); //此时返回bm为空</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                options.inJustDecodeBounds = false;</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                //计算缩放比</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                int be = 
                (int)(options.outHeight / (float)200);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                if (be &lt;= 
                0)</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                be = 1;</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                options.inSampleSize = be;</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                //重新读入图片，注意这次要把options.inJustDecodeBounds 设为 false哦</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                bitmap=BitmapFactory.decodeFile("/sdcard/test.jpg",options);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                int w = 
                bitmap.getWidth();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                int h = 
                bitmap.getHeight();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                System.out.println(w+"&nbsp;<WBR>
                &nbsp;<WBR>
                "+h);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                ImageView iv=new 
                ImageView(this);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                iv.setImageBitmap(bitmap);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">这样我们就可以读取较大的图片而不会内存溢出了。如果你想把压缩后的图片保存在Sdcard上的话就很简单了：</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">File file=new File("/sdcard/feng.png");</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                try {</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                FileOutputStream out=new FileOutputStream(file);</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                if(bitmap.compress(Bitmap.CompressFormat.PNG, 100, out)){</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                out.flush();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                out.close();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                }</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                } catch 
                (FileNotFoundException e) {</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                // TODO Auto-generated catch block</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                e.printStackTrace();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                } catch 
                (IOException e) {</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                // TODO Auto-generated catch block</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                e.printStackTrace();</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">&nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                &nbsp;<WBR>
                }</SPAN><BR 
style="PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px; PADDING-RIGHT: 0px">
                <SPAN 
style="FONT-SIZE: 16px">ok，这样就把图片保存在/sdcard/feng.png这个文件里面了，呵呵。</SPAN></SPAN>
                <DIV><SPAN style="FONT-FAMILY: arial"><SPAN 
style="FONT-SIZE: 16px">***********************************************************************************</SPAN></SPAN></DIV>
                <DIV>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">转自http://www.cnblogs.com/RayLee/archive/2010/11/09/1872856.html</P>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px"><CODE 
style="FONT-STYLE: normal">BitmapFactory.decodeFile(imageFile);</CODE></P>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">用BitmapFactory解码一张图片时，有时会遇到该错误。这往往是由于图片过大造成的。要想正常使用，则需要分配更少的内存空间来存储。</P>
                  <H1 
style="FONT-FAMILY: verdana, sans-serif; LINE-HEIGHT: 21px">BitmapFactory.Options.inSampleSize</H1>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">设置恰当的inSampleSize可以使BitmapFactory分配更少的空间以消除该错误。inSampleSize的具体含义请参考SDK文档。例如：</P>
                  <PRE><SPAN style="FONT-FAMILY: verdana, sans-serif; LINE-HEIGHT: 21px">BitmapFactory.Options opts = new BitmapFactory.Options();<BR>opts.inSampleSize = 4;<BR>Bitmap bitmap = BitmapFactory.decodeFile(imageFile, opts);</SPAN> </PRE>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">设置恰当的inSampleSize是解决该问题的关键之一。BitmapFactory.Options提供了另一个成员inJustDecodeBounds。</P>
                  <PRE><SPAN style="FONT-FAMILY: verdana, sans-serif; LINE-HEIGHT: 21px">BitmapFactory.Options opts = new BitmapFactory.Options();<BR>opts.inJustDecodeBounds = true;<BR>Bitmap bitmap = BitmapFactory.decodeFile(imageFile, opts);</SPAN> </PRE>
                  <DIV style="FONT-FAMILY: verdana, sans-serif; LINE-HEIGHT: 21px">
                    <DIV>
                      <DIV>
                        <TABLE border=0>
                          <TBODY>
                            <TR>
                              <TD></TD>
                              <TD></TD>
                            </TR>
                          </TBODY>
                        </TABLE>
                      </DIV>
                    </DIV>
                  </DIV>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">设置inJustDecodeBounds为true后，decodeFile并不分配空间，但可计算出原始图片的长度和宽度，即opts.width和opts.height。有了这两个参数，再通过一定的算法，即可得到一个恰当的inSampleSize。</P>
                  <P 
style="FONT-FAMILY: verdana, sans-serif; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 1em 0px 0.5em; LINE-HEIGHT: 21px; PADDING-RIGHT: 0px">查看Android源码，Android提供了一种动态计算的方法。</P>
                  <PRE><SPAN style="FONT-FAMILY: verdana, sans-serif; LINE-HEIGHT: 21px">public static int computeSampleSize(BitmapFactory.Options options,<BR>int minSideLength, int maxNumOfPixels) {<BR>int initialSize = computeInitialSampleSize<WBR>(options, minSideLength,<BR>maxNumOfPixels);<BR> <BR>int roundedSize;<BR>if (initialSize &lt;= 8) {<BR>roundedSize = 1;<BR>while (roundedSize &lt; initialSize) {<BR>roundedSize &lt;&lt;= 1;<BR>}<BR>} else {<BR>roundedSize = (initialSize + 7) / 8 * 8;<BR>}<BR> <BR>return roundedSize;<BR>}<BR> <BR>private static int computeInitialSampleSize<WBR>(BitmapFactory.Options options,<BR>int minSideLength, int maxNumOfPixels) {<BR>double w = options.outWidth;<BR>double h = options.outHeight;<BR> <BR>int lowerBound = (maxNumOfPixels == -1) ? 1 :<BR>(int) Math.ceil(Math.sqrt(w * h / maxNumOfPixels));<BR>int upperBound = (minSideLength == -1) ? 128 :<BR>(int) Math.min(Math.floor(w / minSideLength),<BR>Math.floor(h / minSideLength));<BR> <BR>if (upperBound &lt; lowerBound) {<BR>// return the larger one when there is no overlapping zone.<BR>return lowerBound;<BR>}<BR> <BR>if ((maxNumOfPixels == -1) &amp;&amp;<BR>(minSideLength == -1)) {<BR>return 1;<BR>} else if (minSideLength == -1) {<BR>return lowerBound;<BR>} else {<BR>return upperBound;<BR>}<BR>} <BR>使用该算法，就可动态计算出图片的inSampleSize。<BR>BitmapFactory.Options opts = new BitmapFactory.Options();<BR>opts.inJustDecodeBounds = true;<BR>BitmapFactory.decodeFile(imageFile, opts);<BR> <BR>opts.inSampleSize = computeSampleSize(opts, -1, 128*128); <BR>opts.inJustDecodeBounds = false;<BR>try {<BR>Bitmap bmp = BitmapFactory.decodeFile(imageFile, opts);<BR>imageView.setImageBitmap(bmp);<BR>} catch (OutOfMemoryError err) {<BR>}<BR> <BR>另外，可以通过Bitmap.recycle()方法来释放位图所占的空间，当然前提是位图没有被使用。</SPAN> </PRE>
                </DIV><!--EndFragment--></DIV>
<P>&nbsp;</P>
<P>&nbsp;</P>
            </DIV>
          </DIV>
        </DIV>
      </DIV>
    </DIV>
  </DIV>
</DIV>
</BODY>
</HTML>