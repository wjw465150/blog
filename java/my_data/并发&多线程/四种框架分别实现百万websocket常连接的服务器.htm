<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>New Item</title>
<meta name="GENERATOR" content="WinCHM">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style>
html,body { 
	/* Default Font */
	font-family: Arial, Helvetica, sans-serif;
	font-size: 11pt;
}
</style>

</head>

<body>
<H1 
style='FONT-SIZE: 24px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); FONT-STYLE: normal; MARGIN: 0px 0px 5px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.5em; TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; text-rendering: optimizeLegibility; font-variant-ligatures: normal; font-variant-caps: normal'>四种框架分别实现百万websocket常连接的服务器</H1>
<DIV class=article_meta 
style='FONT-SIZE: 14px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; BORDER-BOTTOM: rgb(211,211,211) 1px dashed; TEXT-TRANSFORM: none; FONT-WEIGHT: normal; COLOR: rgb(153,153,153); PADDING-BOTTOM: 5px; FONT-STYLE: normal; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 21px; TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; font-variant-ligatures: normal; font-variant-caps: normal'>
<DIV style="MARGIN-BOTTOM: 5px"><SPAN class=timestamp 
style="MARGIN-RIGHT: 5px">时间&nbsp;2016-07-31 11:45:46<SPAN 
class=Apple-converted-space>&nbsp;</SPAN></SPAN><SPAN class=from 
style="MARGIN-RIGHT: 5px"><I class=icon-globe 
style="TEXT-DECORATION: ; HEIGHT: auto; FONT-FAMILY: FontAwesome; WIDTH: auto; VERTICAL-ALIGN: baseline; BACKGROUND-IMAGE: none; BACKGROUND-REPEAT: repeat; BACKGROUND-POSITION: 0px 0px; FONT-WEIGHT: normal; FONT-STYLE: normal; MARGIN-TOP: 0px; DISPLAY: inline; LINE-HEIGHT: normal; MARGIN-RIGHT: 0px; -webkit-font-smoothing: antialiased"></I><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A class="cut cut28 from" 
style="OVERFLOW: hidden; TEXT-DECORATION: none; MAX-WIDTH: 28%; WHITE-SPACE: nowrap; TEXT-OVERFLOW: ellipsis; WORD-BREAK: keep-all; COLOR: rgb(51,51,51); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; DISPLAY: inline; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://www.tuicool.com/sites/Yni6be" target=_blank>伯乐在线</A></SPAN></DIV>
<DIV class=source><I style="FLOAT: left; FONT-STYLE: normal">原文</I>&nbsp;<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A class="cut cut70" 
style="OVERFLOW: hidden; TEXT-DECORATION: none; MAX-WIDTH: 69%; WHITE-SPACE: nowrap; TEXT-OVERFLOW: ellipsis; WORD-BREAK: keep-all; COLOR: rgb(51,51,51); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; DISPLAY: inline-block; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://blog.jobbole.com/103995/?utm_source=tuicool&amp;utm_medium=referral">http://blog.jobbole.com/103995/</A></DIV>
<DIV><SPAN style="MARGIN-RIGHT: 5px">主题</SPAN><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; COLOR: rgb(51,51,51); OUTLINE-WIDTH: 0px; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://www.tuicool.com/topics/11060032" target=_blank><SPAN 
class=new-label 
style="FONT-SIZE: 0.9em; TEXT-DECORATION: none; VERTICAL-ALIGN: baseline; WHITE-SPACE: nowrap; COLOR: rgb(120,120,120); PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; DISPLAY: inline-block; LINE-HEIGHT: 16px; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(242,242,242); MARGIN-RIGHT: 5px">WebSocket</SPAN></A></DIV></DIV>
<DIV id=nei class=article_body 
style='WORD-WRAP: break-word; MARGIN-BOTTOM: 0px; FONT-SIZE: 16px; FONT-FAMILY: "Helvetica Neue", Helvetica, Tahoma, Arial, STXihei, "Microsoft YaHei", 微软雅黑, sans-serif; WHITE-SPACE: normal; WORD-SPACING: 0px; OVERFLOW-X: hidden; TEXT-TRANSFORM: none; WORD-BREAK: break-all; FONT-WEIGHT: normal; COLOR: rgb(51,51,51); PADDING-BOTTOM: 25px; FONT-STYLE: normal; PADDING-TOP: 20px; PADDING-LEFT: 5px; MIN-HEIGHT: 340px; ORPHANS: 2; WIDOWS: 2; LETTER-SPACING: normal; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 5px; TEXT-INDENT: 0px; -webkit-text-stroke-width: 0px; font-variant-ligatures: normal; font-variant-caps: normal'>
<DIV style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">事实上，最近我又增加了几个框架，现在包括 
Netty, Undertow, Jetty, Spray, Vert.x, Grizzly 和 Node.js七种框架。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">测试数据可以看下一篇文章:<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://blog.jobbole.com/103994/" rel=nofollow,noindex 
target=_blank>七种WebSocket框架的性能比较</A></P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">著名的<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://www.kegel.com/c10k.htm" rel=nofollow,noindex 
target=_blank>C10K</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>问题提出的时候, 正是 
2001 
年。这篇文章可以说是高性能服务器开发的一个标志性文档，它讨论的就是单机为1万个连接提供服务这个问题，当时因为硬件和软件的限制，单机1万还是一个非常值得挑战的目标。但是时光荏苒，随着硬件和软件的飞速发展，单机1万的目标已经变成了最简单不过的事情。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">现在用任何一种主流语言都能提供单机1万的并发处理的能力。所以现在目标早已提高了100倍，变成C1000k，也就是一台服务器为100万连接提供服务。在2010年,2011年已经看到一些实现C1000K的文章了，所以在2015年，实现C1000K应该不是一件困难的事情。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">本文是我在实践过程中的记录，我的目标是使用spran-websocket，netty, 
undertow和node.js四种框架分别实现C1000K的服务器，看看这几个框架实现的难以程度，性能如何。开发语言为Scala和Javascript。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">当然，谈起性能，我们还必须谈到每秒每个连接有多少个请求，也就是RPS数，还要考虑每条消息的大小。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">一般来说，我们会选取一个百分比，比如每秒20%的连接会收发消息。我的需求是服务器只是<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>push</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>,客户端不会主动发送消息。 一般每一分钟会为这一百万群发一条消息。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">所以实现的测试工具每个client建立60000个websocket连接，一共二十个client。实际不可能使用20台机器，我使用了两台AWS 
C3.2xlarge(8核16G)服务器作为客户端机。每台机器10个客户端。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">服务器每1分钟群发一条消息。消息内容很简单，只是服务器的当天时间。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">最近看到360用Go实现的消息推送系统，下面是他们的数据：</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">目前360消息推送系统服务于50+内部产品，万款开发平台App，实时长连接数亿量级，日独数十亿量级，1分钟内可以实现亿量级广播，日下发峰值百亿量级，400台物理机，3000多个实例分布在9个独立集群中，每个集群跨国内外近10个IDC。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">四个服务器的代码和Client测试工具代码可以在<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="https://github.com/smallnest/C1000K-Servers" rel=nofollow,noindex 
target=_blank>github</A><SPAN class=Apple-converted-space>&nbsp;</SPAN>上下载。 
(其实不止四种框架了，现在包括Netty, Undertow, Jetty, Spray-websocket, Vert.x, Grizzly 和 
Node.js 七种框架的实现)</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">测试下来可以看到每种服务器都能轻松达到同时120万的websocket活动连接，只是资源占用和事务处理时间有差别。120万只是保守数据，在这么多连接情况下服务器依然很轻松，下一步我会进行C2000K的测试。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">在测试之前我们需要对服务器/客户机的一些参数进行调优。</P>
<H3 
style="FONT-SIZE: 18px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.6em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">服务器的参数调优</H3>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">一般会修改两个文件，<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>和<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/security/limits.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>， 用来配置TCP/IP参数和最大文件描述符。</P>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">TCP/IP参数配置</H4>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">修改文件<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>,配置网络参数。</P><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>net.ipv4.tcp_wmem = 4096 87380 4161536
net.ipv4.tcp_rmem = 4096 87380 4161536
net.ipv4.tcp_mem = 786432 2097152 3145728
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">数值根据需求进行调整。更多的参数可以看以前整理的一篇文章:<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><A 
style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
href="http://colobu.com/2014/09/18/linux-tcpip-tuning/" rel=nofollow,noindex 
target=_blank>Linux TCP/IP 协议栈调优</A><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">执行<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/sbin/sysctl 
-p</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>即时生效。</P>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">最大文件描述符</H4>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">Linux内核本身有文件描述符最大值的限制，你可以根据需要更改：</P>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">系统最大打开文件描述符数：/proc/sys/fs/file-max
  <OL 
  style="FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0px 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
    <LI 
    style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">临时性设置：<SPAN 
    class=Apple-converted-space>&nbsp;</SPAN><CODE 
    style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>echo 
    1000000 &gt; /proc/sys/fs/file-max</CODE></LI>
    <LI 
    style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">永久设置：修改<SPAN 
    class=Apple-converted-space>&nbsp;</SPAN><CODE 
    style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
    class=Apple-converted-space>&nbsp;</SPAN>文件，增加<SPAN 
    class=Apple-converted-space>&nbsp;</SPAN><CODE 
    style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>fs.file-max 
    = 1000000</CODE></LI></OL></LI>
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">进程最大打开文件描述符数<SPAN 
  class=Apple-converted-space>&nbsp;</SPAN><BR>使用<SPAN 
  class=Apple-converted-space>&nbsp;</SPAN><CODE 
  style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>ulimit 
  -n</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>查看当前设置。使用<SPAN 
  class=Apple-converted-space>&nbsp;</SPAN><CODE 
  style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>ulimit 
  -n 1000000</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>进行临时性设置。<SPAN 
  class=Apple-converted-space>&nbsp;</SPAN><BR>要想永久生效，你可以修改<SPAN 
  class=Apple-converted-space>&nbsp;</SPAN><CODE 
  style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/security/limits.conf</CODE><SPAN 
  class=Apple-converted-space>&nbsp;</SPAN>文件，增加下面的行：</LI></UL><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>* hardnofile 1000000
* softnofile 1000000
roothardnofile 1000000
rootsoftnofile 1000000
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">还有一点要注意的就是hard 
limit不能大于<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/proc/sys/fs/nr_open</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>，因此有时你也需要修改nr_open的值。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">执行<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>echo 
2000000 &gt; /proc/sys/fs/nr_open</CODE></P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">查看当前系统使用的打开文件描述符数，可以使用下面的命令：</P><PRE class=ruby style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>[root<SPAN class=variable style="COLOR: rgb(0,128,128)">@localhost</SPAN> ~]<SPAN class=comment style="COLOR: rgb(153,153,136); FONT-STYLE: italic"># cat /proc/sys/fs/file-nr</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">1632</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1513506</SPAN>
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">其中第一个数表示当前系统已分配使用的打开文件描述符数，第二个数为分配后已释放的（目前已不再使用），第三个数等于file-max。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">总结一下：</P>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">所有进程打开的文件描述符数不能超过/proc/sys/fs/file-max</LI>
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">单个进程打开的文件描述符数不能超过user 
  limit中nofile的soft limit</LI>
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">nofile的soft 
  limit不能超过其hard limit</LI>
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">nofile的hard 
  limit不能超过/proc/sys/fs/nr_open</LI></UL>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">应用运行时调优</H4>
<OL 
style="FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">Java 
  应用内存调优</P>
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">服务器使用12G内存，吞吐率优先的垃圾回收器：</P></LI></OL>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">2. 
V8引擎</P><PRE class="prettyprint cs" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>node --nouse-idle-notification --expose-gc --max-<SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">new</SPAN>-space-size=<SPAN class=number style="COLOR: rgb(0,153,153)">1024</SPAN> --max-<SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">new</SPAN>-space-size=<SPAN class=number style="COLOR: rgb(0,153,153)">2048</SPAN> --max-old-space-size=<SPAN class=number style="COLOR: rgb(0,153,153)">8192</SPAN> ./webserver.js
</PRE>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">OutOfMemory 
Killer</H4>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">如果服务器本身内存不大，比如8G，在不到100万连接的情况下，你的服务器进程有可能出现”Killed”的问题。 
运行<SPAN class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>dmesg</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>可以看到</P><PRE class=http style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'><SPAN class=attribute style="COLOR: rgb(0,128,128)">Outofmemory</SPAN>: <SPAN class=string style="COLOR: rgb(221,17,68)">Kill process 10375 (java) score 59 or sacrificechild</SPAN>
</PRE>
<DIV style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">这是Linux的OOM 
Killer主动杀死的。 
开启oom-killer的话，在/proc/pid下对每个进程都会多出3个与oom打分调节相关的文件。临时对某个进程可以忽略oom-killer可以使用下面的方式:</P><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>echo 
-17 &gt; /proc/$(pidof java)/oom_adj</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN><BR>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">解决办法有多种，可以参看文章最后的参考文章,最好是换一个内存更大的机器。</P></DIV>
<H3 
style="FONT-SIZE: 18px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.6em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">客户端的参数调优</H3>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">在一台系统上，连接到一个远程服务时的本地端口是有限的。根据TCP/IP协议，由于端口是16位整数，也就只能是0到 
65535，而0到1023是预留端口，所以能分配的端口只是1024到65534，也就是64511个。也就是说，一台机器一个IP只能创建六万多个长连接。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">要想达到更多的客户端连接，可以用更多的机器或者网卡，也可以使用虚拟IP来实现,比如下面的命令增加了19个IP地址，其中一个给服务器用，其它18个给client,这样</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">可以产生18 
* 60000 = 1080000个连接。</P><PRE class="prettyprint css" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'><SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:0</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.10</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:1</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.11</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:2</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.12</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:3</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.13</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:4</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.14</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:5</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.15</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:6</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.16</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:7</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.17</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:8</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.18</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:9</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.19</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:10</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.20</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:11</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.21</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:12</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.22</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:13</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.23</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:14</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.24</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:15</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.25</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:16</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.26</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:17</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.27</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">ifconfigeth0</SPAN><SPAN class=pseudo>:18</SPAN> 192<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.168</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.77</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.28</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">netmask</SPAN> 255<SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.255</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.0</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">up</SPAN>
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">修改<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>文件：</P><PRE class=undefined style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 0.75em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>net.ipv4.ip_local_port_range = 1024 65535
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">执行<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/sbin/sysctl 
-p</CODE><SPAN class=Apple-converted-space>&nbsp;</SPAN>即时生效。</P>
<H3 
style="FONT-SIZE: 18px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.6em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">服务器测试</H3>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">实际测试中我使用一台<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><STRONG 
style="FONT-WEIGHT: bold; TEXT-INDENT: 0px">AWS C3.4xlarge (16 cores, 32G 
memory)</STRONG><SPAN class=Apple-converted-space>&nbsp;</SPAN>作为应用服务器，两台<SPAN 
class=Apple-converted-space>&nbsp;</SPAN><STRONG 
style="FONT-WEIGHT: bold; TEXT-INDENT: 0px">AWS C3.2xlarge (8 cores, 16G 
memory)</STRONG><SPAN class=Apple-converted-space>&nbsp;</SPAN>服务器作为客户端。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">这两台机器作为测试客户端绰绰有余，每台客户端机器创建了十个内网虚拟IP, 
每个IP创建60000个websocket连接。</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">客户端配置如下：</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em"><EM 
style="FONT-STYLE: italic"><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>配置</EM></P><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>fs.file-max = 2000000
fs.nr_open = 2000000
net.ipv4.ip_local_port_range = 1024 65535
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em"><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/security/limits.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>配置</P><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>* softnofile 2000000
* hardnofile 2000000
&nbsp;
* softnproc 2000000
* hardnproc 2000000
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">服务端配置如下：</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em"><EM 
style="FONT-STYLE: italic"><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/sysctl.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>配置</EM></P><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>fs.file-max = 2000000
fs.nr_open = 2000000
net.ipv4.ip_local_port_range = 1024 65535
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em"><CODE 
style='BORDER-TOP: medium none; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: medium none; WHITE-SPACE: normal; BORDER-BOTTOM: medium none; COLOR: rgb(51,51,51) !important; PADDING-BOTTOM: 2px; PADDING-TOP: 2px; PADDING-LEFT: 4px; BORDER-LEFT: medium none; PADDING-RIGHT: 4px; BACKGROUND-COLOR: rgb(247,247,249); border-radius: 3px'>/etc/security/limits.conf</CODE><SPAN 
class=Apple-converted-space>&nbsp;</SPAN>配置</P><PRE class="prettyprint undefined" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>* softnofile 2000000
* hardnofile 2000000
&nbsp;
* softnproc 2000000
* hardnproc 2000000
</PRE>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">Netty服务器</H4>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">建立120万个连接，不发送消息，轻轻松松达到。内存还剩14G未用。</LI></UL>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><PRE class="prettyprint ruby" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>[roocolobu ~]<SPAN class=comment style="COLOR: rgb(153,153,136); FONT-STYLE: italic"># ss -s; free -m</SPAN>
<SPAN class=constant>Total</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200231</SPAN> (kernel <SPAN class=number style="COLOR: rgb(0,153,153)">1200245</SPAN>)
<SPAN class=constant>TCP</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> (estab <SPAN class=number style="COLOR: rgb(0,153,153)">1200002</SPAN>, closed <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, orphaned <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, synrecv <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, timewait <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>/<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>), ports <SPAN class=number style="COLOR: rgb(0,153,153)">4</SPAN>
&nbsp;
<SPAN class=constant>TransportTotalIPIPv6</SPAN>
* <SPAN class=number style="COLOR: rgb(0,153,153)">1200245</SPAN> - -
<SPAN class=constant>RAW</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>UDP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>TCP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>INET</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>FRAG</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
&nbsp;
totalusedfreesharedbufferscached
<SPAN class=constant>Mem</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">30074</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">15432</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">14641</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">9</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">254</SPAN>
-<SPAN class=regexp style="COLOR: rgb(0,153,38)">/+ buffers/cache</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">15167</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">14906</SPAN>
<SPAN class=constant>Swap</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN>
</PRE>每分钟给所有的120万个websocket发送一条消息，消息内容为当前的服务器的时间。这里发送显示是单线程发送，服务器发送完120万个总用时15秒左右。</LI></UL>
<DIV style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><PRE class="prettyprint css" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>02<SPAN class=pseudo>:15</SPAN><SPAN class=pseudo>:43</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.307</SPAN> <SPAN class=attr_selector>[pool-1-thread-1]</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">INFOcom</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.colobu</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.webtest</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.netty</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.WebServer</SPAN>$ - <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">sendmsgto</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">channelsfor</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">c4453a26</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">bca6</SPAN>-42<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">b6</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">b29b</SPAN>-43653767<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">f9fc</SPAN>
02<SPAN class=pseudo>:15</SPAN><SPAN class=pseudo>:57</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.190</SPAN> <SPAN class=attr_selector>[pool-1-thread-1]</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">INFOcom</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.colobu</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.webtest</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.netty</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.WebServer</SPAN>$ - <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">sent</SPAN> 1200000 <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">channelsfor</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">c4453a26</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">bca6</SPAN>-42<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">b6</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">b29b</SPAN>-43653767<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">f9fc</SPAN>
</PRE></DIV>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">发送时CPU使用率并不高，网络带宽占用基本在10M左右。</P><PRE class="prettyprint perl" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---<SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">system</SPAN>--
usrsysidlwaihiqsi<SPAN class=string style="COLOR: rgb(221,17,68)">q| read writ|</SPAN> recvsend| in out | <SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">int</SPAN> csw
<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">100</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">60</SPAN>B <SPAN class=number style="COLOR: rgb(0,153,153)">540</SPAN>B| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">224</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">440</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">100</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">60</SPAN>B <SPAN class=number style="COLOR: rgb(0,153,153)">870</SPAN>B| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">192</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">382</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">100</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">59</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">74</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">2306</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">2166</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">2</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">4</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">4998</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6134</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">169</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">140</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">4996</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6132</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">174</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">140</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">4972</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6102</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">176</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">140</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5095</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6253</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">178</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">142</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">2</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5238</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6428</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">179</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">144</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>k|<SPAN class=number style="COLOR: rgb(0,153,153)">4611</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">5660</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">166</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">129</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5083</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6238</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">175</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">142</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5277</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6477</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">179</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">146</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5297</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6500</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">179</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">146</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5383</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6607</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">180</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">148</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5504</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6756</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">184</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">152</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">48</SPAN>k|<SPAN class=number style="COLOR: rgb(0,153,153)">5584</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6854</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">183</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">152</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5585</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6855</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">183</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">153</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">87</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">5589</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">6859</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">184</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">153</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">91</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">3</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">4073</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">4999</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">135</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">110</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">100</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">32</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">60</SPAN>B <SPAN class=number style="COLOR: rgb(0,153,153)">390</SPAN>B| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">4822</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">424</SPAN>
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">客户端(一共20个，这里选取其中一个查看它的指标)。每个客户端保持6万个连接。每个消息从服务器发送到客户端接收到总用时平均633毫秒，而且标准差很小，每个连接用时差不多。</P><PRE class="prettyprint diff" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>ActiveWebSocketsfor eb810c24-8565-43ea-bc27-9a0b2c910ca4
count = 60000
WebSocketErrorsfor eb810c24-8565-43ea-bc27-9a0b2c910ca4
count = 0
&nbsp;
<SPAN class=deletion style="BACKGROUND: rgb(255,221,221)">-- Histograms ------------------------------------------------------------------</SPAN>
Messagelatencyfor eb810c24-8565-43ea-bc27-9a0b2c910ca4
count = 693831
min = 627
max = 735
mean = 633.06
stddev = 9.61
median = 631.00
75% 633.00
95% 640.00
98% 651.00
99% 670.00
99.9% 735.00
&nbsp;
<SPAN class=deletion style="BACKGROUND: rgb(255,221,221)">-- Meters ----------------------------------------------------------------------</SPAN>
MessageRatefor eb810c24-8565-43ea-bc27-9a0b2c910ca4
count = 693832
meanrate = 32991.37 events/minute
1-minuterate = 60309.26 events/minute
5-minuterate = 53523.45 events/minute
15-minuterate = 31926.26 events/minute
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">平均每个client的RPS 
= 1000, 总的RPS大约为 20000 requests /seconds.</P>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">latency平均值为633 
ms，最长735 ms，最短627ms。</P>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">Spray服务器</H4>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI 
  style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">建立120万个连接，不发送消息，轻轻松松达到。它的内存相对较高，内存还剩7G。</LI></UL>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><PRE class="prettyprint ruby" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'><SPAN class=comment style="COLOR: rgb(153,153,136); FONT-STYLE: italic"># ss -s; free -m</SPAN>
<SPAN class=constant>Total</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200234</SPAN> (kernel <SPAN class=number style="COLOR: rgb(0,153,153)">1200251</SPAN>)
<SPAN class=constant>TCP</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> (estab <SPAN class=number style="COLOR: rgb(0,153,153)">1200002</SPAN>, closed <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, orphaned <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, synrecv <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, timewait <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>/<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>), ports <SPAN class=number style="COLOR: rgb(0,153,153)">4</SPAN>
&nbsp;
<SPAN class=constant>TransportTotalIPIPv6</SPAN>
* <SPAN class=number style="COLOR: rgb(0,153,153)">1200251</SPAN> - -
<SPAN class=constant>RAW</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>UDP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>TCP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>INET</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>FRAG</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
&nbsp;
totalusedfreesharedbufferscached
<SPAN class=constant>Mem</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">30074</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">22371</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7703</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">10</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">259</SPAN>
-<SPAN class=regexp style="COLOR: rgb(0,153,38)">/+ buffers/cache</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">22100</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7973</SPAN>
<SPAN class=constant>Swap</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN>
</PRE>
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 0px">每分钟给所有的120万个websocket发送一条消息，消息内容为当前的服务器的时间。</P>
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 0px">CPU使用较高，发送很快，带宽可以达到46M。群发完一次大约需要8秒左右。</P></LI></UL>
<DIV style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><PRE class="prettyprint bash" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>05/22 04:42:57.569 INFO [ool-2-worker-15] c.c.w.s.WebServer - sendmsgto workers 。<SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">for</SPAN> 8454e7d8-b8ca-4881-912b-6cdf3e6787bf
05/22 04:43:05.279 INFO [ool-2-worker-15] c.c.w.s.WebServer - sentmsgto workersfor 8454e7d8-b8ca-4881-912b-6cdf3e6787bf. currentworkers: 1200000
</PRE><PRE class="prettyprint perl" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---<SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">system</SPAN>--
usrsysidlwaihiqsi<SPAN class=string style="COLOR: rgb(221,17,68)">q| read writ|</SPAN> recvsend| in out | <SPAN class=keyword style="FONT-WEIGHT: bold; COLOR: rgb(51,51,51)">int</SPAN> csw
<SPAN class=number style="COLOR: rgb(0,153,153)">74</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">9</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">14</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">3</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>k|<SPAN class=number style="COLOR: rgb(0,153,153)">6330</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">20</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">20</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">1696</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">70</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">23</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">6</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">64</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">11</SPAN>M <SPAN class=number style="COLOR: rgb(0,153,153)">58</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">18</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">2526</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">75</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">11</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">6</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">7</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">9362</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">66</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">11</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">82</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">4</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">8</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">6</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">11</SPAN>M <SPAN class=number style="COLOR: rgb(0,153,153)">35</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">10</SPAN>k
<SPAN class=number style="COLOR: rgb(0,153,153)">85</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">14</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">8334</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">12</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">44</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">415</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">84</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">15</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> |<SPAN class=number style="COLOR: rgb(0,153,153)">9109</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">16</SPAN>M| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">36</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">425</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">81</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">19</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">919</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">858</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">23</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">629</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">76</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">23</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">151</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">185</SPAN>k| <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> | <SPAN class=number style="COLOR: rgb(0,153,153)">18</SPAN>k <SPAN class=number style="COLOR: rgb(0,153,153)">1075</SPAN>
</PRE></DIV>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">客户端(一共20个，这里选取其中一个查看它的指标)。每个客户端保持6万个连接。每个消息从服务器发送到客户端接收到总用时平均1412毫秒，而且标准差较大，每个连接用时差别较大。</P><PRE class="prettyprint cpp" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>ActiveWebSocketsfor <SPAN class=number style="COLOR: rgb(0,153,153)">6674</SPAN>c9d8-<SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>c6-<SPAN class=number style="COLOR: rgb(0,153,153)">4e77</SPAN>-<SPAN class=number style="COLOR: rgb(0,153,153)">9f</SPAN>c0-<SPAN class=number style="COLOR: rgb(0,153,153)">58</SPAN>afabe7436f
count = <SPAN class=number style="COLOR: rgb(0,153,153)">60000</SPAN>
WebSocketErrorsfor <SPAN class=number style="COLOR: rgb(0,153,153)">6674</SPAN>c9d8-<SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>c6-<SPAN class=number style="COLOR: rgb(0,153,153)">4e77</SPAN>-<SPAN class=number style="COLOR: rgb(0,153,153)">9f</SPAN>c0-<SPAN class=number style="COLOR: rgb(0,153,153)">58</SPAN>afabe7436f
count = <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
&nbsp;
-- Histograms ------------------------------------------------------------------
Messagelatencyfor <SPAN class=number style="COLOR: rgb(0,153,153)">6674</SPAN>c9d8-<SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>c6-<SPAN class=number style="COLOR: rgb(0,153,153)">4e77</SPAN>-<SPAN class=number style="COLOR: rgb(0,153,153)">9f</SPAN>c0-<SPAN class=number style="COLOR: rgb(0,153,153)">58</SPAN>afabe7436f
count = <SPAN class=number style="COLOR: rgb(0,153,153)">454157</SPAN>
min = <SPAN class=number style="COLOR: rgb(0,153,153)">716</SPAN>
max = <SPAN class=number style="COLOR: rgb(0,153,153)">9297</SPAN>
mean = <SPAN class=number style="COLOR: rgb(0,153,153)">1412.77</SPAN>
stddev = <SPAN class=number style="COLOR: rgb(0,153,153)">1102.64</SPAN>
median = <SPAN class=number style="COLOR: rgb(0,153,153)">991.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">75</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">1449.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">95</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">4136.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">98</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">4951.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">99</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">5308.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">99.9</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">8854.00</SPAN>
&nbsp;
-- Meters ----------------------------------------------------------------------
MessageRatefor <SPAN class=number style="COLOR: rgb(0,153,153)">6674</SPAN>c9d8-<SPAN class=number style="COLOR: rgb(0,153,153)">24</SPAN>c6-<SPAN class=number style="COLOR: rgb(0,153,153)">4e77</SPAN>-<SPAN class=number style="COLOR: rgb(0,153,153)">9f</SPAN>c0-<SPAN class=number style="COLOR: rgb(0,153,153)">58</SPAN>afabe7436f
count = <SPAN class=number style="COLOR: rgb(0,153,153)">454244</SPAN>
meanrate = <SPAN class=number style="COLOR: rgb(0,153,153)">18821.51</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">67705.18</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">49917.79</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">15</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">24355.57</SPAN> events/minute
</PRE>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">Undertow</H4>
<UL 
style="LIST-STYLE-TYPE: none; FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI style="LIST-STYLE-TYPE: disc; FONT-SIZE: 16px; LINE-HEIGHT: 1.7em">
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 0px">建立120万个连接，不发送消息，轻轻松松达到。内存占用较少，还剩余11G内存。</P><PRE class="prettyprint ruby" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'><SPAN class=comment style="COLOR: rgb(153,153,136); FONT-STYLE: italic"># ss -s; free -m</SPAN>
<SPAN class=constant>Total</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200234</SPAN> (kernel <SPAN class=number style="COLOR: rgb(0,153,153)">1200240</SPAN>)
<SPAN class=constant>TCP</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> (estab <SPAN class=number style="COLOR: rgb(0,153,153)">1200002</SPAN>, closed <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, orphaned <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, synrecv <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>, timewait <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>/<SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>), ports <SPAN class=number style="COLOR: rgb(0,153,153)">4</SPAN>
&nbsp;
<SPAN class=constant>TransportTotalIPIPv6</SPAN>
* <SPAN class=number style="COLOR: rgb(0,153,153)">1200240</SPAN> - -
<SPAN class=constant>RAW</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>UDP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>TCP</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200006</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>INET</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">1200007</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
<SPAN class=constant>FRAG</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
&nbsp;
totalusedfreesharedbufferscached
<SPAN class=constant>Mem</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">30074</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">18497</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">11576</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">10</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">286</SPAN>
-<SPAN class=regexp style="COLOR: rgb(0,153,38)">/+ buffers/cache</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">18200</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">11873</SPAN>
<SPAN class=constant>Swap</SPAN><SPAN class=symbol style="COLOR: rgb(153,0,115)">:</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN> <SPAN class=number style="COLOR: rgb(0,153,153)">815</SPAN>
</PRE>
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 0px">每分钟给所有的120万个websocket发送一条消息，消息内容为当前的服务器的时间。</P>
  <P 
  style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 0px">群发玩一次大约需要15秒。</P></LI></UL><PRE class="prettyprint css" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>03<SPAN class=pseudo>:19</SPAN><SPAN class=pseudo>:31</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.154</SPAN> <SPAN class=attr_selector>[pool-1-thread-1]</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">INFO</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">c</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.colobu</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.webtest</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.undertow</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.WebServer</SPAN>$ - <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">sendmsgto</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">channelsfor</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">d9b450da</SPAN>-2631-42<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">bc</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">a802</SPAN>-44285<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">f63a62d</SPAN>
03<SPAN class=pseudo>:19</SPAN><SPAN class=pseudo>:46</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.755</SPAN> <SPAN class=attr_selector>[pool-1-thread-1]</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">INFO</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">c</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.colobu</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.webtest</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.undertow</SPAN><SPAN class=class style="FONT-WEIGHT: bold; COLOR: rgb(68,85,136)">.WebServer</SPAN>$ - <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">sent</SPAN> 1200000 <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">channelsfor</SPAN> <SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">d9b450da</SPAN>-2631-42<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">bc</SPAN>-<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">a802</SPAN>-44285<SPAN class=tag style="FONT-WEIGHT: normal; COLOR: rgb(0,0,128)">f63a62d</SPAN>
</PRE>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">客户端(一共20个，这里选取其中一个查看它的指标)。每个客户端保持6万个连接。每个消息从服务器发送到客户端接收到总用时平均672毫秒，而且标准差较小，每个连接用时差别不大。</P><PRE class="prettyprint diff" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>ActiveWebSocketsfor b2e95e8d-b17a-4cfa-94d5-e70832034d4d
count = 60000
WebSocketErrorsfor b2e95e8d-b17a-4cfa-94d5-e70832034d4d
count = 0
&nbsp;
<SPAN class=deletion style="BACKGROUND: rgb(255,221,221)">-- Histograms ------------------------------------------------------------------</SPAN>
Messagelatencyfor b2e95e8d-b17a-4cfa-94d5-e70832034d4d
count = 460800
min = 667
max = 781
mean = 672.12
stddev = 5.90
median = 671.00
75%
95%
98%
99%
99.9%
&nbsp;
<SPAN class=deletion style="BACKGROUND: rgb(255,221,221)">-- Meters ----------------------------------------------------------------------</SPAN>
MessageRatefor b2e95e8d-b17a-4cfa-94d5-e70832034d4d
count = 460813
meanrate = 27065.85 events/minute
1-minuterate = 69271.67 events/minute
5-minuterate = 48641.78 events/minute
15-minuterate = 24128.67 events/minute
SetupRatefor b2e95e8d-b17a-4cfa-94d5-e70832034d4d
</PRE>
<H4 
style="FONT-SIZE: 16px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">node.js</H4>
<P 
style="FONT-SIZE: 16px; MARGIN: 0px 0px 0.75em; LINE-HEIGHT: 1.7em; TEXT-INDENT: 1em">node.js不是我要考虑的框架，列在这里只是作为参考。性能也不错。</P><PRE class="prettyprint cpp" style='WORD-WRAP: break-word; FONT-SIZE: 12px; BORDER-TOP: 1px solid; FONT-FAMILY: Monaco, Menlo, Consolas, "Courier New", monospace; BORDER-RIGHT: 1px solid; WHITE-SPACE: pre-wrap; OVERFLOW-Y: auto; BORDER-BOTTOM: 1px solid; WORD-BREAK: break-all; COLOR: rgb(51,51,51); PADDING-BOTTOM: 0.3em; PADDING-TOP: 0.3em; PADDING-LEFT: 0.3em; MARGIN: 0px 0px 1.5em; BORDER-LEFT: 1px solid; DISPLAY: block; LINE-HEIGHT: 1.5em; PADDING-RIGHT: 0.3em; BACKGROUND-COLOR: rgb(246,246,246); border-radius: 4px'>ActiveWebSocketsfor <SPAN class=number style="COLOR: rgb(0,153,153)">537</SPAN>c7f0d-e58b-<SPAN class=number style="COLOR: rgb(0,153,153)">4996</SPAN>-b29e-<SPAN class=number style="COLOR: rgb(0,153,153)">098f</SPAN>e2682dcf
count = <SPAN class=number style="COLOR: rgb(0,153,153)">60000</SPAN>
WebSocketErrorsfor <SPAN class=number style="COLOR: rgb(0,153,153)">537</SPAN>c7f0d-e58b-<SPAN class=number style="COLOR: rgb(0,153,153)">4996</SPAN>-b29e-<SPAN class=number style="COLOR: rgb(0,153,153)">098f</SPAN>e2682dcf
count = <SPAN class=number style="COLOR: rgb(0,153,153)">0</SPAN>
&nbsp;
-- Histograms ------------------------------------------------------------------
Messagelatencyfor <SPAN class=number style="COLOR: rgb(0,153,153)">537</SPAN>c7f0d-e58b-<SPAN class=number style="COLOR: rgb(0,153,153)">4996</SPAN>-b29e-<SPAN class=number style="COLOR: rgb(0,153,153)">098f</SPAN>e2682dcf
count = <SPAN class=number style="COLOR: rgb(0,153,153)">180000</SPAN>
min = <SPAN class=number style="COLOR: rgb(0,153,153)">808</SPAN>
max = <SPAN class=number style="COLOR: rgb(0,153,153)">847</SPAN>
mean = <SPAN class=number style="COLOR: rgb(0,153,153)">812.10</SPAN>
stddev = <SPAN class=number style="COLOR: rgb(0,153,153)">1.95</SPAN>
median = <SPAN class=number style="COLOR: rgb(0,153,153)">812.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">75</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">812.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">95</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">813.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">98</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">814.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">99</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">815.00</SPAN>
<SPAN class=number style="COLOR: rgb(0,153,153)">99.9</SPAN>% <SPAN class=number style="COLOR: rgb(0,153,153)">847.00</SPAN>
&nbsp;
-- Meters ----------------------------------------------------------------------
MessageRatefor <SPAN class=number style="COLOR: rgb(0,153,153)">537</SPAN>c7f0d-e58b-<SPAN class=number style="COLOR: rgb(0,153,153)">4996</SPAN>-b29e-<SPAN class=number style="COLOR: rgb(0,153,153)">098f</SPAN>e2682dcf
count = <SPAN class=number style="COLOR: rgb(0,153,153)">180000</SPAN>
meanrate = <SPAN class=number style="COLOR: rgb(0,153,153)">7191.98</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">1</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">10372.33</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">5</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">16425.78</SPAN> events/minute
<SPAN class=number style="COLOR: rgb(0,153,153)">15</SPAN>-minuterate = <SPAN class=number style="COLOR: rgb(0,153,153)">9080.53</SPAN> events/minute
</PRE>
<H3 
style="FONT-SIZE: 18px; FONT-FAMILY: inherit; FONT-WEIGHT: bold; COLOR: ; MARGIN: 0px 0px 0.5em; LINE-HEIGHT: 1.6em; TEXT-INDENT: 1em; text-rendering: optimizeLegibility">参考文档</H3>
<OL 
style="FONT-SIZE: 16px; PADDING-BOTTOM: 0px; PADDING-TOP: 0px; PADDING-LEFT: 0px; MARGIN: 0px 0px 0.75em 25px; LINE-HEIGHT: 1.7em; PADDING-RIGHT: 0px">
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.linuxde.net/2013/08/15150.html" rel=nofollow,noindex 
  target=_blank>HTTP长连接200万尝试及调优</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://blog.csdn.net/superchanon/article/details/13303705" 
  rel=nofollow,noindex target=_blank>Linux最大打开文件描述符数</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.blogjava.net/yongboy/archive/2013/04/11/397677.html" 
  rel=nofollow,noindex target=_blank>100万并发连接服务器笔记之1M并发连接目标达成</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.zhihu.com/question/20831000" rel=nofollow,noindex 
  target=_blank>知乎：如何实现单服务器300万个长连接的？</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.ideawu.net/blog/archives/740.html" rel=nofollow,noindex 
  target=_blank>构建C1000K的服务器</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.csdn.net/article/2013-05-16/2815317-The-Secret-to-10M-Concurrent-Connections" 
  rel=nofollow,noindex target=_blank>千万级并发实现的秘密</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://blog.csdn.net/solstice/article/details/26363901" 
  rel=nofollow,noindex target=_blank>C1000k 新思路：用户态 TCP/IP 协议栈</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="https://github.com/xiaojiaqi/C1000kPracticeGuide" rel=nofollow,noindex 
  target=_blank>https://github.com/xiaojiaqi/C1000kPracticeGuide</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.jayway.com/2015/04/13/600k-concurrent-websocket-connections-on-aws-using-node-js/" 
  rel=nofollow,noindex target=_blank>600k concurrent websocket connections on 
  AWS using Node.js</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="https://plumbr.eu/blog/memory-leaks/out-of-memory-kill-process-or-sacrifice-child?utm_source=feedly&amp;utm_reader=feedly&amp;utm_medium=rss&amp;utm_campaign=rss" 
  rel=nofollow,noindex 
  target=_blank>https://plumbr.eu/blog/memory-leaks/out-of-memory-kill-process-or-sacrifice-child?utm_source=feedly&amp;utm_reader=feedly&amp;utm_medium=rss&amp;utm_campaign=rss</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://it.deepinmind.com/java/2014/06/12/out-of-memory-kill-process-or-sacrifice-child.html" 
  rel=nofollow,noindex 
  target=_blank>http://it.deepinmind.com/java/2014/06/12/out-of-memory-kill-process-or-sacrifice-child.html</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-memory-captun.html" 
  rel=nofollow,noindex 
  target=_blank>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/6/html/Performance_Tuning_Guide/s-memory-captun.html</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://www.nateware.com/linux-network-tuning-for-2013.html#.VV0s6kawqgQ" 
  rel=nofollow,noindex 
  target=_blank>http://www.nateware.com/linux-network-tuning-for-2013.html#.VV0s6kawqgQ</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://warmjade.blogspot.jp/2014_03_22_archive.html" 
  rel=nofollow,noindex 
  target=_blank>http://warmjade.blogspot.jp/2014_03_22_archive.html</A></LI>
  <LI style="FONT-SIZE: 16px; LINE-HEIGHT: 1.7em"><A 
  style="TEXT-DECORATION: none; BORDER-BOTTOM: rgb(148,148,148) 1px dashed; FONT-WEIGHT: bold; COLOR: rgb(148,148,148); OUTLINE-WIDTH: 0px; FONT-STYLE: italic; OUTLINE-STYLE: none; OUTLINE-COLOR: invert; transition: 0.25s" 
  href="http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=209282398&amp;idx=1&amp;sn=9ffef32b3ab93d1e239c9dc753a3a9bb" 
  rel=nofollow,noindex 
  target=_blank>http://mp.weixin.qq.com/s?__biz=MjM5NzAwNDI4Mg==&amp;mid=209282398&amp;idx=1&amp;sn=9ffef32b3ab93d1e239c9dc753a3a9bb</A></LI></OL></DIV></DIV></body>
</html>
