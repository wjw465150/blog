<!DOCTYPE html><!--
 ______________ 
< TUICOOL.COM >
 -------------- 
        \   ^__^
         \  (**)\__$__$__
            (__)\       )\/\
             U  ||------|
                ||     ||
--><html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta content="authenticity_token" name="csrf-param">
<meta content="1MP1OAXJ8yx0+PjalJ20DMMWkeTUorzPMZG+a0yVYr0=" name="csrf-token">
    <title>
            支付开发填坑记之支付宝 - 推酷
   </title>
    <meta name="description" content="支付开发填坑记之支付宝">
  <link rel="shortcut icon" href="urn:not-loaded:http://static0.tuicool.com/favicon.ico" type="image/x-icon">
  <link href="http://static0.tuicool.com/images/icon114.png" rel="Bookmark">
  <link rel="apple-touch-icon" sizes="57x57" href="urn:not-loaded:http://static1.tuicool.com/images/icon57.png"> 
  <link rel="apple-touch-icon" sizes="72x72" href="urn:not-loaded:http://static2.tuicool.com/images/icon72.png">  
  <link rel="apple-touch-icon" sizes="114x114" href="urn:not-loaded:http://static0.tuicool.com/images/icon114.png">    
  <link rel="apple-touch-icon" sizes="144x144" href="urn:not-loaded:http://static1.tuicool.com/images/icon144.png">
  <link href="index_files/pub.css" rel="stylesheet">
  <link href="index_files/application-e90ef7ce56579081ef4f956c640f005f.css" media="screen" rel="stylesheet" type="text/css">
  <link href="index_files/font-awesome.min.css" rel="stylesheet">
  <script type="text/javascript" src="index_files/pub.js"></script>
  <script src="index_files/application-f8dd22e38da72b470d036c6151afa4cc.js" type="text/javascript"></script>
  
      <style type="text/css"><!--
/* Effective stylesheet produced by snapshot save */
.load-fail { display: none; }
--></style>

</head>
<body class="  pace-done"><div class="pace  pace-inactive"><div class="pace-progress" style="transform: translate3d(100%, 0px, 0px);" data-progress-text="100%" data-progress="99">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
  
  <div id="header" class="navbar-fixed-top">
    <div class="container">
      <div class="navbar">
        <div class="navbar-inner">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> 
            <span class="icon-bar"></span> 
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span> 
          </a>
          <a href="http://www.tuicool.com/" class="brand">推酷</a>        
        <nav class="nav-collapse collapse">
            <ul class="nav navbar primary-nav">                            
              <li class="active">
                <a href="http://www.tuicool.com/ah">
                  文章
                </a>
              </li>              
              <li class="">
                <a href="http://www.tuicool.com/sites/hot">
                  站点
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/topics">
                  主题
                </a>
              </li>
              <li class="">
                <a href="http://huodong.tuicool.com/">
                  活动
                </a>
              </li>
              <li class="">
                <a href="http://www.tuicool.com/mobile">
                  APP
                    <sup style="font-size:0.8em;color: #16A085;">荐</sup>
                </a>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">周刊 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://www.tuicool.com/mags">编程狂人</a></li>
                  <li><a href="http://www.tuicool.com/mags/design">设计匠艺</a></li> 
                  <li><a href="http://www.tuicool.com/mags/startup">创业周刊</a></li> 
                  <li><a href="http://www.tuicool.com/mags/tech">科技周刊</a></li>      
                  <li><a href="http://www.tuicool.com/articles/weekly">一周拾遗</a></li>
                </ul>
              </li>
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">更多 <b class="caret"></b></a>
                <ul class="dropdown-menu">
                  <li><a href="http://course.tuicool.com/">
                    公开课
                  </a>
                  </li>
                  <li><a href="http://www.tuicool.com/daily_news">今日酷闻</a></li>
                  <li><a href="http://www.tuicool.com/bbs/go/issues">意见反馈</a></li>
                </ul>
              </li>
              </ul>
            <form class="navbar-search pull-left" action="http://www.tuicool.com/search">
              <input class="search-query span2" name="kw" placeholder="搜索" type="text">
            </form>
            <ul class="nav pull-right">
                <li><a href="http://www.tuicool.com/login">登录</a></li>
            </ul>
          </nav>
        </div>
      </div>
  </div>   
</div>
  <div id="flash_container" class="noPrint">    
  </div>
  
  <div class="container-fluid">  
      
<div class="row-fluid article_row_fluid">
    <div class="span8 contant article_detail_bg">
        <h1>支付开发填坑记之支付宝</h1>
        <div class="article_meta">
            <div style="margin-bottom: 5px;">
            <span class="timestamp">时间 2017-05-11 08:37:09
            </span>
            <span class="from">
                <i class="icon-globe"></i>
                    <a class="cut cut28 from" href="http://www.tuicool.com/sites/3uEjYv" target="_blank">SegmentFault
                    </a>
            </span>
            </div>
            <div class="source">
                <i style="float:left;">原文</i>  
                <a class="cut cut70" href="https://segmentfault.com/a/1190000009366105?utm_source=tuicool&amp;utm_medium=referral" style="display:inline-block;">https://segmentfault.com/a/1190000009366105</a>
            </div>
            <div>
                <span>主题</span>
                <a href="http://www.tuicool.com/topics/10100004" target="_blank">
                    <span class="new-label">支付宝</span>
                </a>
            </div>
        </div>
        <div class="article_body" id="nei">
            <div> 
 <p>支付宝在所有支付方式中最好开发的了，因为文档比较清晰，而且开发起来也比较简单。因此，支付宝的坑是相对较少的。</p> 
 <h2>APP支付</h2> 
 <p>APP支付步骤为：</p> 
 <ol> 
  <li> <p class="no-text-indent">获取支付宝的配置信息。</p> </li> 
  <li> <p class="no-text-indent">生成商家订单信息。</p> </li> 
  <li> <p class="no-text-indent"> 根据订单信息生成 <strong>待校验数据</strong> 。 </p> </li> 
  <li> <p class="no-text-indent"> 生成请求给支付宝的 <strong>加密字符串</strong> 。 </p> </li> 
  <li> <p class="no-text-indent">将待校验数据和加密字符串拼接，返回给APP。</p> </li> 
  <li> <p class="no-text-indent">APP将得到的数据请求支付宝客户端进行支付。</p> </li> 
 </ol> 
 <p>由于APP支付是由APP去调起支付宝支付，所以服务端需要做的事情就是将请求参数封装好之后返回APP即可。</p> 
 <ol> 
  <li> <p>获取支付宝的配置信息。</p> <p>支付时需要的配置信息有：</p> 
   <ul> 
    <li> <p class="no-text-indent">key： 交易安全校验码。</p> </li> 
    <li> <p class="no-text-indent">app_id：支付宝分配给开发者的应用ID。</p> </li> 
   </ul> </li> 
  <li> <p>生成商家订单信息。</p> <p>这个步骤由商家自行生成。支付宝那边只需要知道的订单信息为：</p> 
   <ul> 
    <li> <p class="no-text-indent">subject: 必填。商品的标题/交易标题/订单标题/订单关键字等。</p> </li> 
    <li> <p class="no-text-indent">total_amount: 必填。订单价格。</p> </li> 
    <li> <p class="no-text-indent">out_trade_no: 必填。商户网站唯一订单号。</p> </li> 
    <li> <p class="no-text-indent">body: 非必填。交易的具体描述信息。</p> </li> 
   </ul> </li> 
  <li> <p> 根据订单信息生成 <strong>待校验数据</strong> 。 </p> <p> APP支付的详细请求参数: <a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.W1CdRr&amp;treeId=204&amp;articleId=105465&amp;docType=1" rel="nofollow,noindex" target="_blank">点击查看</a> </p> <p> <img src="index_files/3aERraM.png%21web.png" class="alignCenter"> </p> </li> 
  <li> <p> 生成请求给支付宝的 <strong>加密字符串</strong> 。 </p> <pre class="hljs elixir"><span class="hljs-variable">$sign</span> = <span class="hljs-variable">$alipaySubmit</span>-&gt;buildRequestParaForApp(<span class="hljs-variable">$para_token</span>);</pre> <p> 其中， <code>buildRequestParaForApp</code> 的实现为： </p> 
   <ol> 
    <li> <p class="no-text-indent">对待签名参数数组排序</p> </li> 
   </ol> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * 对数组排序
 * <span class="hljs-doctag">@param</span> $para 排序前的数组
 * return 排序后的数组
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">argSort</span><span class="hljs-params">($para)</span> </span>{
    ksort($para);
    reset($para);
    <span class="hljs-keyword">return</span> $para;
}</pre> 
   <ol> 
    <li> <p class="no-text-indent">生成签名结果（阿里推荐的是RSA2的签名方式，这里项目用的是RSA）</p> </li> 
   </ol> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * RSA签名
 * <span class="hljs-doctag">@param</span> $data 待签名数据
 * <span class="hljs-doctag">@param</span> $private_key_path 商户私钥文件路径
 * return 签名结果
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rsaSign</span><span class="hljs-params">($data, $private_key_path)</span> </span>{
    $priKey = file_get_contents($private_key_path);
    $res = openssl_get_privatekey($priKey);
    openssl_sign($data, $sign, $res);
    openssl_free_key($res);
    <span class="hljs-comment">//base64编码</span>
    $sign = base64_encode($sign);
    <span class="hljs-keyword">return</span> $sign;
}</pre> </li> 
  <li> <p>将待校验数据和加密字符串拼接，返回给APP。</p> <pre class="prettyprint hljs php">$url = <span class="hljs-string">""</span>;
<span class="hljs-keyword">foreach</span> ($para_token <span class="hljs-keyword">as</span> $key =&gt; $value) {
    $url .= $key.<span class="hljs-string">"="</span>.urlencode($value).<span class="hljs-string">"&amp;"</span>;
}
<span class="hljs-keyword">return</span> $url.<span class="hljs-string">"sign="</span>.urlencode($sign);</pre> </li> 
  <li> <p>APP将得到的数据请求支付宝客户端进行支付。</p> <p>APP端将拼接好的字符串拿去请求支付宝客户端即可调起支付宝进行支付。拼接好的字符串大致如下图所示：</p> <p> <img src="index_files/RFnEjmY.png%21web.png" class="alignCenter"> </p> </li> 
 </ol> 
 <h2>网页版支付</h2> 
 <p>网页版支付步骤为：</p> 
 <ol> 
  <li> <p class="no-text-indent">设置支付宝的配置信息。</p> </li> 
  <li> <p class="no-text-indent">向支付宝申请新订单，获取支付token。</p> </li> 
  <li> <p class="no-text-indent">携带token进行订单支付。</p> </li> 
 </ol> 
 <p>网页版的支付宝支付相对于APP调起支付宝要复杂，因为网页支付时，需要多次请求支付宝服务器获取支付的必要参数。</p> 
 <ol> 
  <li> <p>设置支付宝配置信息。</p> <pre class="prettyprint hljs php"><span class="hljs-comment">/**调用授权接口alipay.wap.trade.create.direct获取授权码token**/</span>
        
    <span class="hljs-comment">//返回格式</span>
    <span class="hljs-keyword">private</span>  $format = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填，不需要修改</span>
    
    <span class="hljs-comment">//版本</span>
    <span class="hljs-keyword">private</span> $v = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填，不需要修改</span>
    
    <span class="hljs-comment">//请求号</span>
    <span class="hljs-keyword">private</span> $req_id = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填，须保证每次请求都是唯一</span>
    
    <span class="hljs-comment">//**req_data详细信息**</span>
    
    <span class="hljs-comment">//服务器异步通知页面路径</span>
    <span class="hljs-keyword">private</span> $notify_url = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//需http://格式的完整路径，不允许加?id=123这类自定义参数</span>
    
    <span class="hljs-comment">//页面跳转同步通知页面路径</span>
    <span class="hljs-keyword">private</span> $call_back_url = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//需http://格式的完整路径，不允许加?id=123这类自定义参数</span>
    
    <span class="hljs-comment">//卖家支付宝账户</span>
    <span class="hljs-keyword">private</span> $seller_email = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填</span>
    
    <span class="hljs-comment">//商户订单号</span>
    <span class="hljs-keyword">private</span> $out_trade_no = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//商户网站订单系统中唯一订单号，必填</span>
    
    <span class="hljs-comment">//订单名称</span>
    <span class="hljs-keyword">private</span> $subject = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填</span>
    
    <span class="hljs-comment">//付款金额</span>
    <span class="hljs-keyword">private</span> $total_fee = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填</span>
    
    <span class="hljs-comment">//请求业务参数详细</span>
    <span class="hljs-keyword">private</span> $req_data = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//必填</span>
    
    <span class="hljs-comment">//配置</span>
    <span class="hljs-keyword">private</span> $alipay_config = <span class="hljs-keyword">array</span>();
    
<span class="hljs-comment">/************************************************************/</span></pre> </li> 
  <li> <p>向支付宝申请新订单，并获取订单的token。</p> <p> <img src="index_files/nQbQFbz.png%21web.png" class="alignCenter"> </p> <p> 请求token的service为： <code>alipay.wap.trade.create.direct</code> 。 </p> 
   <ol> 
    <li> <p>构造参数：</p> <pre class="prettyprint hljs php">$para_token = <span class="hljs-keyword">array</span>(
    <span class="hljs-string">"service"</span> =&gt; <span class="hljs-string">"alipay.wap.trade.create.direct"</span>,
    <span class="hljs-comment">//  合作者身份(partner ID)</span>
    <span class="hljs-string">"partner"</span> =&gt; trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'partner'</span>]),
    <span class="hljs-comment">//  APP使用的是RSA，网页版使用的是MD5</span>
    <span class="hljs-string">"sec_id"</span> =&gt; trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'sign_type'</span>]),
    <span class="hljs-comment">//  返回的数据格式</span>
    <span class="hljs-string">"format"</span>    =&gt; <span class="hljs-keyword">$this</span>-&gt;format,
    <span class="hljs-comment">//  版本号？</span>
    <span class="hljs-string">"v"</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;v,
    <span class="hljs-comment">//  唯一的请求号</span>
    <span class="hljs-string">"req_id"</span>    =&gt; <span class="hljs-keyword">$this</span>-&gt;req_id,
    <span class="hljs-comment">//  请求参数</span>
    <span class="hljs-string">"req_data"</span>  =&gt; $req_data,
    <span class="hljs-comment">//  字符集，一般为utf8即可。</span>
    <span class="hljs-string">"_input_charset"</span>    =&gt; trim(strtolower(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'input_charset'</span>]))
);</pre> </li> 
    <li> <p>将构造好的请求参数，进行处理，字典排序，拼接字符串，签名：</p> <pre class="prettyprint hljs elixir"><span class="hljs-variable">$para_filter</span> = paraFilter(<span class="hljs-variable">$para_temp</span>);
<span class="hljs-variable">$para_sort</span> = argSort(<span class="hljs-variable">$para_filter</span>);
<span class="hljs-variable">$mysign</span> = <span class="hljs-variable">$this</span>-&gt;buildRequestMysign(<span class="hljs-variable">$para_sort</span>);
<span class="hljs-regexp">//</span>签名结果与签名方式加入请求提交参数组中
<span class="hljs-variable">$para_sort</span>[<span class="hljs-string">'sign'</span>] = <span class="hljs-variable">$mysign</span>;
<span class="hljs-keyword">return</span> <span class="hljs-variable">$para_sort</span>;</pre> <p>处理：过滤值为空的数据，过滤签名类型和签名。</p> <pre class="prettyprint hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">paraFilter</span><span class="hljs-params">($para)</span> </span>{
    $para_filter = <span class="hljs-keyword">array</span>();
    <span class="hljs-keyword">while</span> (<span class="hljs-keyword">list</span> ($key, $val) = each ($para)) {
        <span class="hljs-keyword">if</span>($key == <span class="hljs-string">"sign"</span> || $key == <span class="hljs-string">"sign_type"</span> || $val == <span class="hljs-string">""</span>)<span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">else</span>    $para_filter[$key] = $para[$key];
    }
    <span class="hljs-keyword">return</span> $para_filter;
}</pre> <p>字典排序：</p> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * 对数组排序
 * <span class="hljs-doctag">@param</span> $para 排序前的数组
 * return 排序后的数组
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">argSort</span><span class="hljs-params">($para)</span> </span>{
    ksort($para);
    reset($para);
    <span class="hljs-keyword">return</span> $para;
}</pre> <p>签名：</p> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * 生成签名结果
 * <span class="hljs-doctag">@param</span> $para_sort 已排序要签名的数组
 * return 签名结果字符串
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">buildRequestMysign</span><span class="hljs-params">($para_sort)</span> </span>{
    <span class="hljs-comment">//把数组所有元素，按照“参数=参数值”的模式用“&amp;”字符拼接成字符串</span>
    $prestr = createLinkstring($para_sort);
    $mysign = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">switch</span> (strtoupper(trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'sign_type'</span>]))) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"MD5"</span> :
            <span class="hljs-comment">//  MD5直接将密钥拼接在字符串后面再进行MD5加密。</span>
            $mysign = md5Sign($prestr, <span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'key'</span>]);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"RSA"</span> :
            <span class="hljs-comment">//  RSA则是先读取商户的私钥，再用该密钥对字符串进行加密。</span>
            $mysign = rsaSign($prestr, <span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'private_key_path'</span>]);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"0001"</span> :
            $mysign = rsaSign($prestr, <span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'private_key_path'</span>]);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span> :
            $mysign = <span class="hljs-string">""</span>;
    }
    
    <span class="hljs-keyword">return</span> $mysign;
}</pre> </li> 
    <li> <p>用构造好的参数请求支付宝后台申请新订单：</p> <h4>注意：请求时，必须带上SSL证书。</h4> <pre class="prettyprint hljs elixir"><span class="hljs-variable">$sResult</span> = getHttpResponsePOST(<span class="hljs-variable">$this</span>-&gt;alipay_gateway_new, <span class="hljs-variable">$this</span>-&gt;alipay_config[<span class="hljs-string">'cacert'</span>],<span class="hljs-variable">$request_data</span>,trim(strtolower(<span class="hljs-variable">$this</span>-&gt;alipay_config[<span class="hljs-string">'input_charset'</span>])));</pre> <p>请求函数的实现：</p> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * 远程获取数据，POST模式
 * 注意：
 * 1.使用Crul需要修改服务器中php.ini文件的设置，找到php_curl.dll去掉前面的";"就行了
 * 2.文件夹中cacert.pem是SSL证书请保证其路径有效，目前默认路径是：getcwd().'\\cacert.pem'
 * <span class="hljs-doctag">@param</span> $url 指定URL完整路径地址
 * <span class="hljs-doctag">@param</span> $cacert_url 指定当前工作目录绝对路径
 * <span class="hljs-doctag">@param</span> $para 请求的数据
 * <span class="hljs-doctag">@param</span> $input_charset 编码格式。默认值：空值
 * return 远程输出的数据
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getHttpResponsePOST</span><span class="hljs-params">($url, $cacert_url, $para, $input_charset = <span class="hljs-string">''</span>)</span> </span>{

    <span class="hljs-keyword">if</span> (trim($input_charset) != <span class="hljs-string">''</span>) {
        $url = $url.<span class="hljs-string">"_input_charset="</span>.$input_charset;
    }
    $curl = curl_init($url);
    curl_setopt($curl, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword">true</span>);<span class="hljs-comment">//SSL证书认证</span>
    curl_setopt($curl, CURLOPT_SSL_VERIFYHOST, <span class="hljs-number">2</span>);<span class="hljs-comment">//严格认证</span>
    curl_setopt($curl, CURLOPT_CAINFO,$cacert_url);<span class="hljs-comment">//证书地址</span>
    curl_setopt($curl, CURLOPT_HEADER, <span class="hljs-number">0</span> ); <span class="hljs-comment">// 过滤HTTP头</span>
    curl_setopt($curl,CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<span class="hljs-comment">// 显示输出结果</span>
    curl_setopt($curl,CURLOPT_POST,<span class="hljs-keyword">true</span>); <span class="hljs-comment">// post传输数据</span>
    curl_setopt($curl,CURLOPT_POSTFIELDS,$para);<span class="hljs-comment">// post传输数据</span>
    $responseText = curl_exec($curl);
    <span class="hljs-comment">//var_dump( curl_error($curl) );//如果执行curl过程中出现异常，可打开此开关，以便查看异常内容</span>
    curl_close($curl);
    
    <span class="hljs-keyword">return</span> $responseText;
}</pre> <p>处理支付宝返回的数据，并获取token。</p> <pre class="prettyprint hljs awk"><span class="hljs-regexp">//</span>URLDECODE返回的信息
<span class="hljs-variable">$html_text</span> = urldecode(<span class="hljs-variable">$html_text</span>);
<span class="hljs-regexp">//</span>解析远程模拟提交后返回的信息
<span class="hljs-variable">$para_html_text</span> = parseResponse(<span class="hljs-variable">$html_text</span>);
<span class="hljs-regexp">//</span>获取request_token
<span class="hljs-variable">$request_token</span> = <span class="hljs-variable">$para_html_text</span>[<span class="hljs-string">'request_token'</span>];</pre> <p>parseResponse函数的实现：</p> <pre class="prettyprint hljs php"><span class="hljs-comment">/**
 * 解析远程模拟提交后返回的信息
 * <span class="hljs-doctag">@param</span> $str_text 要解析的字符串
 * <span class="hljs-doctag">@return</span> 解析结果
 */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseResponse</span><span class="hljs-params">($str_text)</span> </span>{
    <span class="hljs-comment">//以“&amp;”字符切割字符串</span>
    $para_split = explode(<span class="hljs-string">'&amp;'</span>,$str_text);
    <span class="hljs-comment">//把切割后的字符串数组变成变量与数值组合的数组</span>
    <span class="hljs-keyword">foreach</span> ($para_split <span class="hljs-keyword">as</span> $item) {
        <span class="hljs-comment">//获得第一个=字符的位置</span>
        $nPos = strpos($item,<span class="hljs-string">'='</span>);
        <span class="hljs-comment">//获得字符串长度</span>
        $nLen = strlen($item);
        <span class="hljs-comment">//获得变量名</span>
        $key = substr($item,<span class="hljs-number">0</span>,$nPos);
        <span class="hljs-comment">//获得数值</span>
        $value = substr($item,$nPos+<span class="hljs-number">1</span>,$nLen-$nPos<span class="hljs-number">-1</span>);
        <span class="hljs-comment">//放入数组中</span>
        $para_text[$key] = $value;
    }
    
    <span class="hljs-keyword">if</span>( ! <span class="hljs-keyword">empty</span> ($para_text[<span class="hljs-string">'res_data'</span>])) {
        <span class="hljs-comment">//解析加密部分字符串</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'sign_type'</span>] == <span class="hljs-string">'0001'</span>) {
            $para_text[<span class="hljs-string">'res_data'</span>] = rsaDecrypt($para_text[<span class="hljs-string">'res_data'</span>], <span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'private_key_path'</span>]);
        }
        
        <span class="hljs-comment">//token从res_data中解析出来（也就是说res_data中已经包含token的内容）</span>
        $doc = <span class="hljs-keyword">new</span> DOMDocument();
        $doc-&gt;loadXML($para_text[<span class="hljs-string">'res_data'</span>]);
        $para_text[<span class="hljs-string">'request_token'</span>] = $doc-&gt;getElementsByTagName( <span class="hljs-string">"request_token"</span> )-&gt;item(<span class="hljs-number">0</span>)-&gt;nodeValue;
    }
    
    <span class="hljs-keyword">return</span> $para_text;
}</pre> </li> 
   </ol> </li> 
  <li> <p>携带token进行订单支付。</p> <p>成功请求token回来后，就可以向支付宝发出一次支付请求。</p> <p>同样构造请求数据：</p> <pre class="prettyprint hljs php"><span class="hljs-comment">//业务详细只需要携带步骤2的token即可。</span>
$req_data = <span class="hljs-string">'&lt;auth_and_execute_req&gt;&lt;request_token&gt;'</span> . $request_token . <span class="hljs-string">'&lt;/request_token&gt;&lt;/auth_and_execute_req&gt;'</span>;
<span class="hljs-comment">//必填</span>

<span class="hljs-comment">//构造要请求的参数数组，无需改动</span>
$parameter = <span class="hljs-keyword">array</span>(
    <span class="hljs-string">"service"</span> =&gt; <span class="hljs-string">"alipay.wap.auth.authAndExecute"</span>,
    <span class="hljs-comment">//  合作者身份(partner ID)</span>
    <span class="hljs-string">"partner"</span> =&gt; trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'partner'</span>]),
    <span class="hljs-comment">//  签名类型</span>
    <span class="hljs-string">"sec_id"</span> =&gt; trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'sign_type'</span>]),
    <span class="hljs-comment">//  和步骤2一致</span>
    <span class="hljs-string">"format"</span>    =&gt; <span class="hljs-keyword">$this</span>-&gt;format,
    <span class="hljs-string">"v"</span> =&gt; <span class="hljs-keyword">$this</span>-&gt;v,
    <span class="hljs-string">"req_id"</span>    =&gt; <span class="hljs-keyword">$this</span>-&gt;req_id,
    <span class="hljs-comment">//  业务详细参数</span>
    <span class="hljs-string">"req_data"</span>  =&gt; $req_data,
    <span class="hljs-comment">//  字符集，一般为utf8.</span>
    <span class="hljs-string">"_input_charset"</span>    =&gt; trim(strtolower(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'input_charset'</span>]))
);</pre> <p>将这些参数，在页面中传送给支付宝即可发起一次支付请求。</p> <p>在PHP 中的实现就是将这些参数，渲染至HTML中，再将HTML中的表单提交即可。</p> <p>到此，网页版的支付宝支付完成整个流程。</p> </li> 
 </ol> 
 <h2>支付结果异步通知</h2> 
 <p>在上面，我们看到有两个参数传给了支付宝：</p> 
 <ul> 
  <li> <p class="no-text-indent"> <code>call_back_url</code> : 交易成功后，支付宝页面上“返回到商家页面”的地址（同步回调） </p> </li> 
  <li> <p class="no-text-indent"> <code>notify_url</code> : 交易状态变更后，支付宝通知网站的回调地址（异步通知） </p> </li> 
 </ul> 
 <p>对于手机网站支付产生的交易，支付宝会根据原始支付API中传入的异步通知地址notify_url，通过POST请求的形式将支付结果作为参数通知到商户系统。</p> 
 <p>对于App支付产生的交易，支付宝会根据原始支付API中传入的异步通知地址notify_url，通过POST请求的形式将支付结果作为参数通知到商户系统。</p> 
 <p> <a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.kuchJN&amp;treeId=204&amp;articleId=105301&amp;docType=1" rel="nofollow,noindex" target="_blank">支付宝异步通知官方文档</a> 中写的比较清楚，什么时候出发通知，返回什么参数，注意事项都有，开发者可以根据自己的情况查看具体信息。 </p> 
 <p> 验签步骤可以移步至 <a href="https://doc.open.alipay.com/docs/doc.htm?spm=a219a.7629140.0.0.kuchJN&amp;treeId=204&amp;articleId=105301&amp;docType=1#s7" rel="nofollow,noindex" target="_blank">这里</a> </p> 
 <p>这里就简单的用手上的项目举例说明，支付宝通知后，后台是如何进行验签和处理订单。</p> 
 <pre class="prettyprint hljs php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">app_notifyOp</span><span class="hljs-params">()</span></span>{
    $payment_api = <span class="hljs-keyword">$this</span>-&gt;_get_payment_api();
    $payment_config = <span class="hljs-keyword">$this</span>-&gt;_get_payment_config();
    <span class="hljs-comment">// 支付宝是用POST方式发送通知信息</span>
    $callback_info = $payment_api-&gt;getNotifyInfoApp($_POST);
    <span class="hljs-keyword">if</span>($callback_info) {
        <span class="hljs-comment">//验证成功</span>
        <span class="hljs-keyword">if</span> ($callback_info[<span class="hljs-string">'order_state'</span>]) {
            <span class="hljs-comment">// 如果是支付成功则改变订单状态</span>
            $result = <span class="hljs-keyword">$this</span>-&gt;_update_order($callback_info[<span class="hljs-string">'out_trade_no'</span>], $callback_info[<span class="hljs-string">'trade_no'</span>]);
        }<span class="hljs-keyword">else</span>{
            <span class="hljs-comment">// 如果是退款成功则修改退订的相关状态</span>
            $result = <span class="hljs-keyword">$this</span>-&gt;_app_refund($callback_info[<span class="hljs-string">'out_trade_no'</span>], $callback_info[<span class="hljs-string">'trade_no'</span>], $callback_info[<span class="hljs-string">'refund_fee'</span>]);
        }
        <span class="hljs-keyword">if</span>($result[<span class="hljs-string">'state'</span>]) {
            <span class="hljs-keyword">echo</span> <span class="hljs-string">'success'</span>;<span class="hljs-keyword">die</span>;
        }
    }
    <span class="hljs-comment">//验证失败</span>
    <span class="hljs-keyword">echo</span> <span class="hljs-string">"fail"</span>;<span class="hljs-keyword">die</span>;
}</pre> 
 <ol> 
  <li> <p>获取支付宝通知数据</p> <p> 支付宝异步通知是 <em>POST</em> 请求，返回的数据结构如下： </p> <pre class="prettyprint hljs json">{
    <span class="hljs-attr">"total_amount"</span>: <span class="hljs-string">"31.00"</span>,
    <span class="hljs-attr">"buyer_id"</span>: <span class="hljs-string">"ID"</span>,
    <span class="hljs-attr">"trade_no"</span>: <span class="hljs-string">"TRADE_NO"</span>,
    <span class="hljs-attr">"body"</span>: <span class="hljs-string">"pay_sn:580546601841783375"</span>,
    <span class="hljs-attr">"notify_time"</span>: <span class="hljs-string">"2017-04-27 09:50:59"</span>,
    <span class="hljs-attr">"subject"</span>: <span class="hljs-string">"580546601841783375"</span>,
    <span class="hljs-attr">"sign_type"</span>: <span class="hljs-string">"RSA"</span>,
    <span class="hljs-attr">"buyer_logon_id"</span>: <span class="hljs-string">"ID"</span>,
    <span class="hljs-attr">"auth_app_id"</span>: <span class="hljs-string">"APPID"</span>,
    <span class="hljs-attr">"charset"</span>: <span class="hljs-string">"utf-8"</span>,
    <span class="hljs-attr">"notify_type"</span>: <span class="hljs-string">"trade_status_sync"</span>,
    <span class="hljs-attr">"invoice_amount"</span>: <span class="hljs-string">"31.00"</span>,
    <span class="hljs-attr">"out_trade_no"</span>: <span class="hljs-string">"580546601841783375_r"</span>,
    <span class="hljs-attr">"trade_status"</span>: <span class="hljs-string">"TRADE_SUCCESS"</span>,
    <span class="hljs-attr">"gmt_payment"</span>: <span class="hljs-string">"2017-04-27 09:50:58"</span>,
    <span class="hljs-attr">"version"</span>: <span class="hljs-string">"1.0"</span>,
    <span class="hljs-attr">"point_amount"</span>: <span class="hljs-string">"0.00"</span>,
    <span class="hljs-attr">"sign"</span>: <span class="hljs-string">"SIGNATURE"</span>,
    <span class="hljs-attr">"gmt_create"</span>: <span class="hljs-string">"2017-04-27 09:50:58"</span>,
    <span class="hljs-attr">"buyer_pay_amount"</span>: <span class="hljs-string">"31.00"</span>,
    <span class="hljs-attr">"receipt_amount"</span>: <span class="hljs-string">"31.00"</span>,
    <span class="hljs-attr">"fund_bill_list"</span>: <span class="hljs-string">"[{"</span>amount<span class="hljs-string">":"</span><span class="hljs-number">31.00</span><span class="hljs-string">","</span>fundChannel<span class="hljs-string">":"</span>ALIPAYACCOUNT<span class="hljs-string">"}]"</span>,
    <span class="hljs-attr">"app_id"</span>: <span class="hljs-string">"APPID"</span>,
    <span class="hljs-attr">"seller_id"</span>: <span class="hljs-string">"SELLERID"</span>,
    <span class="hljs-attr">"notify_id"</span>: <span class="hljs-string">"8414394a1190f25edbbec9ba4b98642mem"</span>,
    <span class="hljs-attr">"seller_email"</span>: <span class="hljs-string">"YOUR_ALIPAY_ACCOUNT"</span>
}</pre> </li> 
  <li> <p>验签数据</p> <p> 验签需要支付宝的公钥 </p> <p> 验签和签名的流程是一样的，都是将所有除了 <code>sign</code> 以外的参数，进行字典排序，并以 <code>key=value</code> 的形式以 <code>&amp;</code> 符号拼成字符串，再使用密钥进行签名，将得到的签名与支付宝返回的签名进行对比，完成验签过程。 </p> <pre class="prettyprint hljs php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignVeryfy</span><span class="hljs-params">($para_temp, $sign)</span> </span>{
    <span class="hljs-comment">//除去待签名参数数组中的空值和签名参数</span>
    $para = paraFilter($para_temp);
    
    <span class="hljs-comment">//对待签名参数数组排序</span>
    $para = argSort($para);

    <span class="hljs-comment">//把数组所有元素，按照“参数=参数值”的模式用“&amp;”字符拼接成字符串</span>
    $prestr = createLinkstring($para);
    $prestr = htmlspecialchars_decode($prestr);
    $isSgin = <span class="hljs-keyword">false</span>;
    <span class="hljs-keyword">switch</span> (strtoupper(trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'sign_type'</span>]))) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">"MD5"</span> :
            $isSgin = md5Verify($prestr, $sign, <span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'key'</span>]);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"RSA"</span> :
            $isSgin = rsaVerify($prestr, trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'ali_public_key_path'</span>]), $sign);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">"0001"</span> :
            $isSgin = rsaVerify($prestr, trim(<span class="hljs-keyword">$this</span>-&gt;alipay_config[<span class="hljs-string">'ali_public_key_path'</span>]), $sign);
            <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span> :
            $isSgin = <span class="hljs-keyword">false</span>;
    }
    logResult($log);
    
    <span class="hljs-keyword">return</span> $isSgin;
}</pre> <p> 但是这里有个坑，就是返回数据中的 <code>fund_bill_list</code> 是经过html转义的（如例子中的数据： <code>[{&amp;quot;amount&amp;quot;:&amp;quot;31.00&amp;quot;,&amp;quot;fundChannel&amp;quot;:&amp;quot;ALIPAYACCOUNT&amp;quot;}]</code> ），如果直接使用该参数进行签名，则会导致签名失败。这里就需要将字符串转义了： <code>[{"amount":"31.00","fundChannel":"ALIPAYACCOUNT"}]</code> ，用转义后的参数值进行签名，通过校验。 </p> </li> 
  <li> <p>更改订单状态</p> <p>验签完毕后，后台就可以根据实际情况进行订单状态的更改。</p> </li> 
 </ol> 
 <h2>完毕</h2> 
 <p>祝各位程序猿在开发支付宝支付时不再有坑，也希望支付宝在后续的更新中不再埋雷。</p> 
</div>
        </div>
        <div class="article_social">
         <div class="article_like">
    <div class="circle circle-like" id="my_zan" data_id="BrEf2yr">  </div>

</div>
        <div id="share_weixin_image">
            <img src="index_files/qrcode.php.png" height="100px" width="100px">
        </div>
<div class="article_share_fav">
    <div class="share" id="ckepop">
        <span>分享</span>
        <button class="share_weibo" id="share_weibo_id" title="分享到新浪微博"></button>
        <button class="share_qq" id="share_qq_id" title="分享到QQ空间"></button>
        <button class="share_weixin" id="share_weixin_id"></button>
    </div>
    <div class="fav_correct">
        <button id="my_fav" data_id="BrEf2yr">
            <i class="icon icon-star-empty"></i> <span id="fav_tip">收藏</span>
        </button>
        <button id="article-correct" data_id="BrEf2yr" uid="0">
            <i class="icon icon-warning-sign"></i>
            <span>纠错</span>
        </button>
    </div>
</div>
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>


            <div class="bottom_plink huodong-detail-plink-banner clearfix">
                    <a href="https://www.mysubmail.com/sms?s=tuicool" target="_blank"><img src="index_files/submail7001.jpg"></a>

            </div>
        </div>
        <div id="site_articles" style="clear:both;">
              <div class="article-part-title">
                <span>推荐文章</span>
              </div>
          <ul class="side_article_list">
                <li class="side_article_list_item">
                    1.<a href="http://www.tuicool.com/articles/FFveU33" target="_blank" title="专做小项目的 PHP 框架 Razor，支持正则路由、数据库链式查询">
                    专做小项目的 PHP 框架 Razor，支持正则路由、数据库链式查询
                    </a>
                </li>
                <li class="side_article_list_item">
                    2.<a href="http://www.tuicool.com/articles/Y3MJruU" target="_blank" title="为什么你一定要使用 Homestead 来开发 Laravel 应用？">
                    为什么你一定要使用 Homestead 来开发 Laravel 应用？
                    </a>
                </li>
                <li class="side_article_list_item">
                    3.<a href="http://www.tuicool.com/articles/vM3aEnq" target="_blank" title="chatbot：基于 AIML 的 PHP 聊天机器人">
                    chatbot：基于 AIML 的 PHP 聊天机器人
                    </a>
                </li>
                <li class="side_article_list_item">
                    4.<a href="http://www.tuicool.com/articles/QNNfEfE" target="_blank" title="[PHP] 又是知乎，用 Beanbun 爬取知乎用户">
                    [PHP] 又是知乎，用 Beanbun 爬取知乎用户
                    </a>
                </li>
                <li class="side_article_list_item">
                    5.<a href="http://www.tuicool.com/articles/263YRfY" target="_blank" title="ThinkPHP 模板引擎 使用备忘">
                    ThinkPHP 模板引擎 使用备忘
                    </a>
                </li>
                <li class="side_article_list_item">
                    6.<a href="http://www.tuicool.com/articles/Fraiqa6" target="_blank" title="PHP超实用系列·自动捕获Fatal Error">
                    PHP超实用系列·自动捕获Fatal Error
                    </a>
                </li>
          </ul>
        </div>
        <div id="kan_articles"> <div class="article-part-title"> <span>相关推刊</span></div><div class="kan-list-container"><ul class="kan-list clearfix">          <li class="kan-item">            <a href="http://www.tuicool.com/kans/50736954" target="_blank" class="kan-item-head">              <small>by Harry2010</small>              <img class="kan-cover" src="index_files/iIFN732.jpg%21kan.jpg">            </a>            <span class="kan-detail">              <a href="http://www.tuicool.com/kans/50736954" target="_blank">《默认推刊》</a>              <i class="kan-num">47</i>            </span>          </li>                  <li class="kan-item">            <span class="kan-item-head">              <small></small>              <img class="kan-cover" src="index_files/default_kan_cover.png">            </span>            <span class="kan-detail">              <i>《匿名收藏》</i>              <i class="kan-num">5</i>            </span>          </li>                  <li class="kan-item">            <a href="http://www.tuicool.com/kans/2615789844" target="_blank" class="kan-item-head">              <small>by 飞羽无痕</small>              <img class="kan-cover" src="index_files/default_kan_cover.png">            </a>            <span class="kan-detail">              <a href="http://www.tuicool.com/kans/2615789844" target="_blank">《消息中间件》</a>              <i class="kan-num">2</i>            </span>          </li>        </ul></div><i class="clearfix"></i></div>
        <div id="article_weibo" style="display:none;">
            <div class="article-part-title">
                <span>相关微博</span>
                <sub>
                    <a href="http://www.tuicool.com/articles/weibo_list/BrEf2yr" target="_blank">(<i id="weibo_num"></i>)</a> 
               </sub>
            </div>
            <div class="related-weibo-list"></div>
        </div>
        <div class="comments">
    <div class="comments-area">
    <div class="comments-header">
        <h5>我来评几句</h5>
        <div class="alert comment-alert alert-error" style="display:none;">
            错误
        </div>
            <textarea cols="60" rows="5" id="comment-body" placeholder="请输入评论内容..." style="resize: none;"></textarea>
            <span class="btn btn-medium btn-submit" id="comment-submit">登录后评论</span>
        <p style="margin-top: 5px;margin-left:10px;">
            已发表评论数(<span class="comment_cnt">0</span>)
        </p>
    </div>
    <div class="comments-list">
        <div class="empty-cmts alert alert-success" style="display:none;">
            没有更多评论了^^
        </div>
    </div>
    <div class="more-comments" style="display:none;">
        <a href="">更多评论</a>
    </div>
    <div class="load-fail" style="display:none;">
        评论加载失败，<a href="javascript:void(0);">重新加载</a>
    </div>
    </div>
</div>

    </div>
        <div class="span4 article_right_side">
            <div class="right_top">
    <div class="article_related_site article_detail_bg">
    <h4 class="article-part-title">相关站点</h4>
    <div class="article_related_site_body clearfix">
        <div class="logo">
            <img src="index_files/3uEjYv.png">
        </div>
        <div class="name">
            <div>
                <a href="http://www.tuicool.com/sites/3uEjYv" target="_blank"> SegmentFault</a>
            </div>
            <div>
                <div class="btn btn-success right_site_follow" id="my_follow" data_id="3uEjYv">＋订阅</div>
            </div>
        </div>
    </div>
</div>

<div id="right_site_articles" class="article_detail_bg">
    <div class="article-part-title">
        <span>热门文章</span>
    </div>
    <ul class="side_article_list">
        <li class="side_article_list_item">
            1.<a href="http://www.tuicool.com/articles/Fraiqa6" target="_blank" title="PHP超实用系列·自动捕获Fatal Error"> PHP超实用系列·自动捕获Fatal Error </a>
        </li>
        <li class="side_article_list_item">
            2.<a href="http://www.tuicool.com/articles/QZ7Nvau" target="_blank" title="Laravel服务之任务调度"> Laravel服务之任务调度 </a>
        </li>
        <li class="side_article_list_item">
            3.<a href="http://www.tuicool.com/articles/7Jbai2n" target="_blank" title="如何正确构建 PHP 项目"> 如何正确构建 PHP 项目 </a>
        </li>
        <li class="side_article_list_item">
            4.<a href="http://www.tuicool.com/articles/EnA3yiN" target="_blank" title="使用 IBM Bluemix 和 PHP 构建可搜索的简历数据库: 通过可扩展存储和关键词搜索来增强简历搜索应用..."> 使用 IBM Bluemix 和 PHP 构建可搜索的简历数据库: 通过可扩展存储和关键词搜.. </a>
        </li>
        <li class="side_article_list_item">
            5.<a href="http://www.tuicool.com/articles/EB3mYbQ" target="_blank" title="在平行空间中运行程序"> 在平行空间中运行程序 </a>
        </li>
    </ul>
</div>


      <div class="right-link">
                <a href="https://www.mysubmail.com/sms?s=tuicool" target="_blank"><img src="index_files/submail1201.jpg"></a>

      </div>
      <div class="right-link" style="margin-top: 5px">
                <a href="https://mos.meituan.com/firework/newcustomer?site=tuicool&amp;campaign=20170401sales" target="_blank"><img src="index_files/mos120.jpg" class="psprzexoiewmmwidwzlv"></a>

      </div>
      <div class="right-link" style="margin-top: 5px">
                <a href="http://www.bagevent.com/event/268776?bag_track=tuicool" target="_blank"><img src="index_files/phpdev300.jpg" class="psprzexoiewmmwidwzlv"></a>

      </div>
<div class="right-link" style="margin-top: 5px">
        <a href="https://activity.ksyun.com/1703/index.html?ch=00033.00018&amp;hmsr=%E6%8E%A8%E9%85%B7&amp;hmpl=1703&amp;hmcu=&amp;hmkw=&amp;hmci=" target="_blank"><img src="index_files/ksyun122.jpg"></a>

</div>
      <div class="right-link" style="margin-top: 5px">
                <a href="http://ml-summit.org/?hmsr=tuicool&amp;hmpl=banner&amp;hmcu=&amp;hmkw=&amp;hmci=" target="_blank"><img src="index_files/mlsummit300.jpg" class="psprzexoiewmmwidwzlv"></a>

      </div>
<div class="right-link" style="margin-top: 5px">
        <a href="https://sspaas.com/" target="_blank"><img src="index_files/sspaas320.jpg" class="psprzexoiewmmwidwzlv"></a>

</div>
</div>
<div class="operate_zone">
      <div class="right-link" style="margin-top: 0px">
                <a href="http://click.aliyun.com/m/17039/" target="_blank"><img src="index_files/aliyun1200.jpg" class="psprzexoiewmmwidwzlv"></a>

      </div>
        <div class="frd_pos">
        <script async="" src="index_files/adsbygoogle.js"></script>
<ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-7054762349007490" data-ad-slot="5705695566"></ins>
<script><!--
/* Script removed by snapshot save */
--></script>

        </div>
</div>
         </div>
</div>

<div>
   <!-- add_article to kan -->
<div id="add-article-to-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <span class="add-title">收藏到推刊</span>
    <a href="#new-kan" class="btn pull-right" data-toggle="modal">创建推刊</a>
    <i class="clearfix"></i>
  </div>
  <div class="modal-body">
    <ul id="add-kan-list">
    </ul>
  </div>
  <div class="modal-footer">
    <input value="BrEf2yr" class="article-id" type="hidden"> 
    <button class="btn btn-primary pull-left add-to-btn">  收 藏  </button>
    <button class="btn" data-dismiss="modal" aria-hidden="true" style="margin-right: 15px">取消</button>
  </div>
</div>

   <div id="new-kan" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-body">
    <input name="name" id="new-kan-name" placeholder="推刊名(必填)" required="" data-validation-required-message="请填写推刊名" type="text">
    <span class="new-ness-name">请填写推刊名</span>
    <br>
    <textarea name="desc" id="desc" rows="6" placeholder="推刊描述"></textarea>
    <span class="new-ness-desc">描述不能大于100个字符!</span>
    <br>
    权限设置：<input name="type" value="1" checked="checked" type="radio"> 公开
    <input name="type" value="0" type="radio"> 仅自己可见
  </div>
  <div class="modal-footer">
    <button class="btn btn-primary pull-left create-kan-btn" disabled="disabled">创建</button>
    <button class="btn dismiss-new-kan" data-dismiss="modal" aria-hidden="true">取消</button>
  </div>
</div>


</div>
<div id="article-correct-modal" class="modal hide fade in" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
            ×
        </button>
        <h3>文章纠错</h3>
    </div>
    <div class="modal-body">
        <input value="BrEf2yr" id="article-correct-source" type="hidden">
        <div>
            <label for="article-correct-email">
                邮箱地址
            </label>
            <input id="article-correct-email" class="input-large" type="email">
        </div>
        <div>
            <label for="article-correct-select">
                错误类型
            </label>
            <select id="article-correct-select">
                <option value="正文不准确" selected="selected">正文不准确</option>
                <option value="标题不准确">标题不准确</option>
                <option value="排版有问题">排版有问题</option>
                <option value="排版有问题">主题不准确</option>
                <option value="没有分页内容">没有分页内容</option>
                <option value="图片无法显示">图片无法显示</option>
                <option value="视频无法显示">视频无法显示</option>
                <option value="与原文不一致">与原文不一致</option>
            </select>
        </div>
        <div>
            <label for="article-correct-other">
                补充信息
            </label>
            <textarea id="article-correct-other" class="span4"></textarea>
        </div>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary pull-right huodong_correct_submit" id="article-correct-submit">
              提交  
        </button>
    </div>
</div>
      <link rel="stylesheet" href="index_files/highlight.default.css">
      <script src="index_files/highlight.pack.js"></script>
<script type="text/javascript"><!--
/* Script removed by snapshot save */
--></script>


    <div class="loader-inner ball-pulse ball-loading-center" id="page-loading" style="display: none">
      <div></div>
      <div></div>
      <div></div>
    </div>
    <div class="read-later-alert"></div>
  </div>

        <div class="footer">
      <div class="footer-inner" style="padding-top: 50px;padding-bottom: 50px">
        <a href="http://www.tuicool.com/about" target="_blank">关于我们</a>
        <a href="http://www.tuicool.com/mobile" target="_blank">移动应用</a>
        <a href="http://www.tuicool.com/bbs/go/issues" target="_blank">意见反馈</a>
        <a target="_blank" href="http://e.weibo.com/tuicool2012">官方微博</a>
      </div>
    </div>
    <div style="display:none;">
      <script src="index_files/stat.php.js" language="JavaScript"></script>
    </div>

    <script type="text/javascript" src="index_files/tip.js" async=""></script>


<div class="return" title="返回顶部" style="display: none;"></div></body></html>